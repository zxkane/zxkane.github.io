[{"body":"","link":"https://kane.mx/tags/amazon-ecs/","section":"tags","tags":null,"title":"Amazon ECS"},{"body":"","link":"https://kane.mx/tags/aws/","section":"tags","tags":null,"title":"AWS"},{"body":"","link":"https://kane.mx/tags/aws-cdk/","section":"tags","tags":null,"title":"AWS CDK"},{"body":"","link":"https://kane.mx/tags/aws-cloudformation/","section":"tags","tags":null,"title":"AWS CloudFormation"},{"body":"","link":"https://kane.mx/categories/blogging/","section":"categories","tags":null,"title":"Blogging"},{"body":"","link":"https://kane.mx/categories/","section":"categories","tags":null,"title":"Categories"},{"body":"","link":"https://kane.mx/tags/clickstream-analtyics/","section":"tags","tags":null,"title":"Clickstream Analtyics"},{"body":"","link":"https://kane.mx/series/clickstream-analytics/","section":"series","tags":null,"title":"Clickstream-Analytics"},{"body":"","link":"https://kane.mx/categories/cloud-computing/","section":"categories","tags":null,"title":"Cloud-Computing"},{"body":"","link":"https://kane.mx/tags/container/","section":"tags","tags":null,"title":"Container"},{"body":"In this post, we will delve into the data ingestion service of our clickstream solution. This service is a vital part of the clickstream analytics system. It is designed to be reliable, resilient, high-performing, flexible, and cost-effective. It plays a key role in capturing clickstream data from various sources and delivering it to downstream processing and modeling components.\nOverview Architecture Overview architecture for data ingestion service The data ingestion service of our clickstream solution is a standard web service that can be used by a wide range of clients, including web servers, mobile apps, IoT devices, and third-party platforms. It offers the following capabilities:\nOptional use of AWS Global Accelerator for accelerating end-users' global footprints and fast failover for multi-Region architectures. Application Load Balancer for backend fleet load balancing, SSL certificate offload, basic payload verification, and authentication via OIDC provider. The backend service is hosted on Amazon Elastic Container Service (Amazon ECS), supporting either EC2 or serverless Fargate (in future releases) for container hosting. Two-service backend architecture: Apache Nginx service for processing CORS requests and forwarding incoming events. Worker service powered by open-source Vector for sending events to the configured sink service and enriching events with fields like ingest time and source IP. Support for three different sink services based on user preference: Amazon Kinesis or Apache Kafka for near real-time analysis with seconds latency. Amazon Managed Streaming for Apache Kafka (MSK) for those who prefer a fully managed Apache Kafka service, self-managed Kafka also is supported. Amazon S3 bucket for cost-effective sink when real-time analysis isn't required. Provisioning of MSK Connect instances or AWS Lambda functions to periodically synchronize events from upstream services to S3 bucket when using Kafka or Kinesis as sink destinations. Design Tenets Reliability Reliability is crucial for data ingestion, especially when handling large-scale events. Our service ensures reliability through:\nAuto Scaling groups with warm pools for rapid scaling during traffic spikes. Buffering mechanisms using Amazon Kinesis Data Streams, Amazon MSK, or Amazon S3 to handle sudden traffic spikes and potential downstream processing delays. All sink requests to Kafka and Kinesis are synchronized; the error HTTP status code (500 or greater) will be returned when failing to write an event to the downstream sink destination. All SDKs of clickstream will retry the event-sending request when receiving the error response code from the data ingestion service. However, using Amazon S3 as a sink destination is a bit different. The worker uses an in-memory cache to buffer the incoming events, then persists the batch events (use total event size or time interval as threshold) to the S3 bucket. It might lose a few events if the container or host instance is crashed or restarted before the batch events are persisted. Once the incoming events are persisted in streaming services (Kafka or Kinesis), the solution uses asynchronized jobs to write the events to the S3 bucket to make sure all events are well received. Resilience Our data ingestion service is designed to withstand and recover from various failures and disruptions:\nMulti-AZ deployment for enhanced fault tolerance and high availability. Retry mechanisms with exponential backoff for handling transient failures. High Performance at Scale Optimized for high performance, especially during large scaling events:\nAWS Global Accelerator integration for improved global availability and performance. High-performance ingestion service capable of handling 4000 to 6000 requests per second (RPS) per EC2 server, with horizontal scaling to serve massive data volumes. Due to the ingestion service being stateless, we could use a horizontal scaling policy to serve the massive data volumes. We successfully guided the customer to serve the 500, 000 RPS in a single ingestion fleet. Flexibility The service offers flexibility through:\nMultiple sink options: Amazon S3, Amazon Kinesis Data Streams, and Amazon MSK. Customizable authentication and compatibility with third-party clickstream SDKs or clients. Cost-Effectiveness We ensure cost-effectiveness by:\nLeveraging serverless technologies for a pay-per-use model. Implementing data lifecycle management for optimized storage costs. Utilizing auto-scaling fleet with built-in policies to scale in during low-load periods. Resources Management Resource management is handled through AWS CloudFormation and AWS CDK, with:\nSeparate CloudFormation nested stacks for different sink destinations. Conditional resource management to control sink destination configurations. Shared stack for managing replacement CloudFormation resources to minimize outages during service updates. In conclusion, the data ingestion service is a critical component of our clickstream analytics system, providing reliable, resilient, high-performance, flexible, and cost-effective capabilities for capturing and processing clickstream data. Its robust architecture makes it suitable for businesses of all sizes, from small startups to large enterprises handling massive data volumes.\nStay tuned for our next post, where we'll delve into the data processing module of the clickstream analytics system!\n","link":"https://kane.mx/posts/deep-dive-clickstream-analytics/ingestion-service/","section":"posts","tags":["Clickstream Analtyics","AWS","Container","Amazon ECS","AWS CDK","AWS CloudFormation"],"title":"Deep dive clickstream analytic series: Data ingestion"},{"body":"","link":"https://kane.mx/posts/","section":"posts","tags":null,"title":"Posts"},{"body":"","link":"https://kane.mx/series/","section":"series","tags":null,"title":"Series"},{"body":"","link":"https://kane.mx/tags/","section":"tags","tags":null,"title":"Tags"},{"body":"","link":"https://kane.mx/","section":"","tags":null,"title":"The road"},{"body":"This post explores the web console module of the clickstream solution.\nThe web console allows users to create and manage projects with their data pipeline, which ingests, processes, analyzes, and visualizes clickstream data. In version 1.1, the Analytics Studio was introduced for business analysts, enabling them to view metrics dashboards, explore clickstream data, design customized dashboards, and manage metadata without requiring in-depth knowledge of data warehouses and SQL.\nOne code base for different architectures The web console is a web application built using AWS serverless technologies, as demonstrated in the Build serverless web application with AWS Serverless series.\nUse CloudFront, S3 and API Gateway for hosting web console Another use case is deploying the web console within a private network, such as a VPC, to meet compliance requirements. In this architecture, CloudFront, S3, and API Gateway are replaced by an internal application load balancer and Lambda functions running within the VPC.\nUse Application Load Balancer and Lambda for hosting web console privately When implementing those two deployment modes, using the AWS Lambda Web Adapter allows for sharing the same code base to gracefully process the events sent from both API Gateway and Application Load Balancer.\nAuthentication and Authorization The web console supports two deployment modes for authentication:\nIf the AWS region has Amazon Cognito User Pool available, the solution can automatically create a Cognito user pool as an OIDC provider. If the region does not have Cognito User Pool, or the user wants to use existing third-party OIDC providers like Okta or Keycloak, the solution allows specifying the OIDC provider information. For the API layer, a custom authorizer is used when the API is provided by API Gateway, and a middleware of Express framework is used when the API is provided by Application Load Balancer.\nThe backend code uses the Express framework to implement the authorization of the API, supporting both deployment modes.\nCentralized web console The clickstream tenet utilizes a single web console, which serves as the control plane, to manage one or more isolated data pipelines across any supported region.\nPipeline lifecycle management The web console manages the lifecycle of the project's data pipeline, which is composed of modular components managed by multiple AWS CloudFormation stacks. The web console uses Step Functions workflows to orchestrate the workflow for managing the lifecycle of those CloudFormation stacks. The workflows are abstracted as parallel execution, serial execution and stack execution.\nStack Orchestration - Parallel execution Stack Orchestration - Serial execution Stack Orchestration - Stack execution And the status change events of CloudFormation stacks are emitted to SNS topic via EventBridge, then the message is deliverred to same region or cross region SQS queue for meeting the centralized web console.\nUse SQS \u0026 SNS cross-regions messages Service availability checks The web console provides a wizard that allows users to provision a data pipeline on the cloud based on their requirements, such as pipeline region, VPC, sink type, and data processing interval. Since AWS services have varying regional availability and features, the web console needs to dynamically display the available options based on the service availability, which it checks through the CloudFormation registry, as the pipeline components are managed by CloudFormation.\nBelow is a sample code snippet for checking the availability of key services used in the solution.\n1import { CloudFormationClient, DescribeTypeCommand } from \u0026#39;@aws-sdk/client-cloudformation\u0026#39;; 2 3export const describeType = async (region: string, typeName: string) =\u0026gt; { 4 try { 5 const cloudFormationClient = new CloudFormationClient({ 6 ...aws_sdk_client_common_config, 7 region, 8 }); 9 const params: DescribeTypeCommand = new DescribeTypeCommand({ 10 Type: \u0026#39;RESOURCE\u0026#39;, 11 TypeName: typeName, 12 }); 13 return await cloudFormationClient.send(params); 14 } catch (error) { 15 logger.warn(\u0026#39;Describe AWS Resource Types Error\u0026#39;, { error }); 16 return undefined; 17 } 18}; 19 20export const pingServiceResource = async (region: string, service: string) =\u0026gt; { 21 let resourceName = \u0026#39;\u0026#39;; 22 switch (service) { 23 case \u0026#39;emr-serverless\u0026#39;: 24 resourceName = \u0026#39;AWS::EMRServerless::Application\u0026#39;; 25 break; 26 case \u0026#39;msk\u0026#39;: 27 resourceName = \u0026#39;AWS::KafkaConnect::Connector\u0026#39;; 28 break; 29 case \u0026#39;redshift-serverless\u0026#39;: 30 resourceName = \u0026#39;AWS::RedshiftServerless::Workgroup\u0026#39;; 31 break; 32 case \u0026#39;quicksight\u0026#39;: 33 resourceName = \u0026#39;AWS::QuickSight::Dashboard\u0026#39;; 34 break; 35 case \u0026#39;athena\u0026#39;: 36 resourceName = \u0026#39;AWS::Athena::WorkGroup\u0026#39;; 37 break; 38 case \u0026#39;global-accelerator\u0026#39;: 39 resourceName = \u0026#39;AWS::GlobalAccelerator::Accelerator\u0026#39;; 40 break; 41 case \u0026#39;flink\u0026#39;: 42 resourceName = \u0026#39;AWS::KinesisAnalyticsV2::Application\u0026#39;; 43 break; 44 default: 45 break; 46 }; 47 if (!resourceName) return false; 48 const resource = await describeType(region, resourceName); 49 return !!resource?.Arn; 50}; Optimize package size Node modules hell One crucial best practice when working with serverless functions like AWS Lambda is optimizing the package size. Just like in the analogy shown here, a smaller and more compact package results in faster performance, lower costs, and more efficient resource utilization. However, when we reach the node_modules folder, it's akin to a vast, sprawling structure, representing an unoptimized and bloated package size. This can lead to slower cold starts, higher compute costs, and potential issues with deployment limits. By following best practices such as minimizing dependencies, leveraging code bundling and tree-shaking techniques, and optimizing asset handling, you can achieve an optimized package size, ensuring your serverless functions are lean, efficient, and cost-effective.\nOriginally, the solution uses node_prune to remove useless dependencies in node_modules for reducing the lambda size. The package size was reduced to 120MB from 200MB. After introducing new dependencies, the original package size became 300MB. Node_prune could not reduce the size to meet the hard limit of Lambda package size 256 MB. The team introduced a new open-sourced tool vercel/ncc for bundling and tree-shaking the node_modules. Vercel/ncc bundled the solution code and dependencies as a single file, it only 20MB from original 300MB. Itâ€™s amazing!\nOptimized package size One more thing to keep in mind is to maintain the relative path of the configuration files used by your application.\nEmbedded QuickSight dashboards Analytics Studio is a component of the clickstream web console that integrates Amazon QuickSight dashboards into our web application.\nHigh level architecture of embedded QuickSight in web console Embedded QuickSight dashboard In the Exploration of Analytics Studio, the web console will automatically create temporary visuals and dashboards for each query owned by the QuickSight role/user used by the web console, ensuring these temporary resources remain invisible to other QuickSight users.\n","link":"https://kane.mx/posts/deep-dive-clickstream-analytics/web-console/","section":"posts","tags":["Clickstream Analtyics","AWS","Serverless computing"],"title":"Deep dive clickstream analytic series: Serverless web console"},{"body":"","link":"https://kane.mx/tags/serverless-computing/","section":"tags","tags":null,"title":"Serverless Computing"},{"body":"In the last couple of months, I led a team to build a comprehensive and open-sourced solution that helps customers analyze clickstream events on the cloud. The solution provides data autonomy, allowing users full access to raw data, near real-time ingestion, flexible configurations, and cost-effectiveness. It is a system that utilizes serverless services to cater to various customers, whether small businesses or large-scale events with massive data volumes, offering fully managed services with minimal operational efforts or the flexibility to use preferred open-source technical stacks.\nThe clickstream analytics system typically consists of several modules: SDKs, Data Ingest, Data Processing, Data Modeling and Visualization.\nGeneral clickstream analytics system architecture Building a well-architected and secure cloud-native system with modular, resilient, and cost-effective components is always challenging. The solution provides a production-ready and decoupled implementation, with most modules being optional.\nI will thoroughly explore all modules to deeply dive how to build a cloud-native system and implement a system that supports multiple technical variations and components.\nServerless Web Console ","link":"https://kane.mx/posts/deep-dive-clickstream-analytics/preface/","section":"posts","tags":["Clickstream Analtyics","AWS","Serverless computing"],"title":"How to build a clickstream analytic system for small businesses to large-scale events"},{"body":"","link":"https://kane.mx/tags/amazon-athena/","section":"tags","tags":null,"title":"Amazon Athena"},{"body":"","link":"https://kane.mx/tags/analytics/","section":"tags","tags":null,"title":"Analytics"},{"body":"In today's digital age, businesses are constantly seeking ways to understand and analyze user behavior on their websites. Clickstream events provide valuable insights into how users interact with a website, and analyzing this data can help businesses make informed decisions to improve user experience and drive conversions.\nClickstream Analytics on AWS collects, ingests, analyzes, and visualizes clickstream events from your websites and mobile applications. The solution manages an ingestion endpoint to receive clickstream events, which are multiple events in a batch sent by the solutionâ€˜s SDKs.\nOnce the ingestion endpoint receives the events, they are stored in an Amazon S3 bucket without additional processing. The bucket path is configured as a Glue table in the solution's AWS Glue Data Catalog. So the data is available for analysis using Amazon Athena.\nOne use case is to query and analyze the raw clickstream data to gain immediate insights after the data is stored in the S3 bucket. For example, the operators can debug the clickstream events without waiting for the data to be processed. However, the challenges of querying the raw data are:\nthe clickstream events are compressed by SDKs, so the data is not easily query-able reach the Lambda payload limitation Response payload size exceeded maximum allowed payload size (6291556 bytes) when using Athena UDF to extract the events In this post, I will show you how to use Amazon Athena UDFs to query the raw clickstream data to overcome the challenges.\nThe steps are:\nclone repo: https://github.com/zxkane/aws-athena-query-federation Follow the steps to build and deploy the UDFs as Lambda function. After completing the deployment, find the ARN of Lambda function. Letâ€™s say it as clickstream-udfs. Go to the console of Glue. Run the below query to load the latest partitions of raw data. 1msck repair table \u0026lt;your project id\u0026gt;.ingestion_events; Run below sample query to view compressed data. 1-- view compressed data 2USING EXTERNAL FUNCTION decompress_clickstream_common_fields(col1 VARCHAR) RETURNS VARCHAR LAMBDA \u0026#39;\u0026lt;your lambda arn\u0026gt;\u0026#39;, 3 EXTERNAL FUNCTION decompress_clickstream_attribute_fields(col1 VARCHAR) RETURNS VARCHAR LAMBDA \u0026#39;\u0026lt;your lambda arn\u0026gt;\u0026#39;, 4 EXTERNAL FUNCTION decompress_clickstream_user_fields(col1 VARCHAR) RETURNS VARCHAR LAMBDA \u0026#39;\u0026lt;your lambda arn\u0026gt;\u0026#39; 5SELECT 6 json_parse(decompress_clickstream_user_fields(data)), 7 json_parse(decompress_clickstream_common_fields(data)), 8 json_parse(decompress_clickstream_attribute_fields(data)) 9FROM \u0026#34;\u0026lt;your project id\u0026gt;\u0026#34;.\u0026#34;ingestion_events\u0026#34; 10WHERE year=\u0026#39;2024\u0026#39; and month=\u0026#39;06\u0026#39; and day=\u0026#39;20\u0026#39; and hour=\u0026#39;02\u0026#39; 11limit 10; 12 13-- count the received raw events 14USING EXTERNAL FUNCTION decompress_clickstream_common_fields(col1 VARCHAR) RETURNS VARCHAR LAMBDA \u0026#39;\u0026lt;your lambda arn\u0026gt;\u0026#39;, 15 EXTERNAL FUNCTION decompress_clickstream_attribute_fields(col1 VARCHAR) RETURNS VARCHAR LAMBDA \u0026#39;\u0026lt;your lambda arn\u0026gt;\u0026#39;, 16 EXTERNAL FUNCTION decompress_clickstream_user_fields(col1 VARCHAR) RETURNS VARCHAR LAMBDA \u0026#39;\u0026lt;your lambda arn\u0026gt;\u0026#39; 17SELECT 18 sum(json_array_length(json_parse(decompress_clickstream_common_fields(data)))) 19FROM \u0026#34;\u0026lt;your project id\u0026gt;\u0026#34;.\u0026#34;ingestion_events\u0026#34; 20WHERE year=\u0026#39;2024\u0026#39; and month=\u0026#39;06\u0026#39; and day=\u0026#39;20\u0026#39; and hour=\u0026#39;02\u0026#39;; This conclusion summarizes the key benefits of using Amazon Athena UDFs for querying raw clickstream data, provides some final thoughts and considerations.\nImmediate access to data: You can analyze clickstream events as soon as they're stored in the S3 bucket, without waiting for additional processing. Debugging capabilities: Operators can quickly debug clickstream events by directly querying the raw data. Overcoming compression challenges: The UDFs allow you to decompress and parse the data on-the-fly, making it easily queryable. Avoiding Lambda payload limitations: By using separate UDFs for different parts of the data, you can circumvent the Lambda payload size restrictions. ","link":"https://kane.mx/posts/2024/analyzing-clickstream-events-using-amazon-athena-udfs/","section":"posts","tags":["Amazon Athena","Analytics","Athena UDF","Clickstream Analytics","AWS","AWS Lambda"],"title":"Analyzing Clickstream Events Using Amazon Athena UDFs"},{"body":"","link":"https://kane.mx/tags/athena-udf/","section":"tags","tags":null,"title":"Athena UDF"},{"body":"","link":"https://kane.mx/tags/aws-lambda/","section":"tags","tags":null,"title":"AWS Lambda"},{"body":"","link":"https://kane.mx/tags/clickstream-analytics/","section":"tags","tags":null,"title":"Clickstream Analytics"},{"body":"","link":"https://kane.mx/tags/ci/","section":"tags","tags":null,"title":"CI"},{"body":"","link":"https://kane.mx/tags/clean-code/","section":"tags","tags":null,"title":"Clean Code"},{"body":"","link":"https://kane.mx/tags/devops/","section":"tags","tags":null,"title":"DevOps"},{"body":"","link":"https://kane.mx/tags/github-actions/","section":"tags","tags":null,"title":"Github Actions"},{"body":"As developers, we all know the importance of maintaining high code quality standards. One powerful tool that can help us achieve this is SonarQube, a renowned platform for continuous code quality inspection. However, setting up and maintaining a dedicated SonarQube instance can be a cumbersome task, requiring significant resources and ongoing maintenance.\nFortunately, GitHub Actions offers a convenient solution by allowing us to spin up an ephemeral (short-lived) SonarQube instance directly within our workflow. This approach streamlines the process, eliminating the need for a permanent SonarQube server while still reaping the benefits of its code analysis capabilities.\nWhy Ephemeral SonarQube? Using an ephemeral SonarQube instance in your GitHub Actions workflow provides several advantages:\nNo Infrastructure Overhead: With ephemeral SonarQube, you don't need to worry about provisioning and maintaining a dedicated server or virtual machine for SonarQube. This reduces infrastructure costs and management overhead. Scalability: Ephemeral instances can be easily spun up and torn down as needed, making the process highly scalable and adaptable to your project's requirements. Consistent Environment: By running SonarQube within the GitHub Actions environment, you ensure a consistent and reproducible analysis environment across all your builds. For open-source projects, it validates every Pull Request without requiring a SonarQube instance and permissions for contributors. Secure and Isolated: Each ephemeral SonarQube instance is isolated and secure, reducing the risk of cross-contamination or security vulnerabilities. Setting up Ephemeral SonarQube in GitHub Actions Setting up an ephemeral SonarQube instance in your GitHub Actions workflow is a straightforward process. Here's a high-level overview of the steps involved:\nDefine a GitHub Actions Workflow: Create a new workflow file (e.g., .github/workflows/sonar-check.yml) in your repository. Configure SonarQube Instance as a service: Run SonarQube instance as a service container. Specify the instance details, including the version and edition (community or enterprise) you want to use. Then, configure the custom quality profiles and quality gate for meeting the code quality standards of your project. Build Your Project and Run Tests with Reports: Build your code and run tests for coverage reports, if applicable. Trigger Code Analysis: Use the sonarsource/sonarqube-scanner-action or another community action using SonarQube Scanner CLI to run the SonarQube Scanner against your codebase, configuring any necessary analysis properties or exclusions. Check the Analysis Result: After the analysis is complete, check if the result meets the quality gate or not. Update Analysis Result to Pull Request: Write the SonarQube analysis result to the Pull Request as a new comment. It would be ideal to comment on the new code for any new finding issues. Here's an example of how your GitHub Actions workflow might look:\n1name: code scans 2on: 3 pull_request: {} 4 workflow_dispatch: {} 5jobs: 6 sonarqube: 7 name: sonarqube scan 8 runs-on: \u0026#39;ubuntu-latest\u0026#39; 9 services: 10 sonarqube: 11 image: public.ecr.aws/docker/library/sonarqube:10-community 12 ports: 13 - 9000:9000 14 steps: 15 - uses: actions/checkout@v4 16 - name: Setup Node.js 17 uses: actions/setup-node@v4 18 with: 19 node-version: 20.x 20 - name: Install dependencies 21 run: yarn install --check-files \u0026amp;\u0026amp; yarn --cwd example/ install --check-files 22 - name: Run build and unit tests 23 run: npx projen compile \u0026amp;\u0026amp; npx projen test 24 - name: Configure sonarqube 25 env: 26 SONARQUBE_URL: http://localhost:9000 27 SONARQUBE_ADMIN_PASSWORD: ${{ secrets.SONARQUBE_ADMIN_PASSWORD }} 28 run: | 29 bash .github/workflows/sonarqube/sonar-configure.sh 30 - name: SonarQube Scan 31 uses: sonarsource/sonarqube-scan-action@master 32 env: 33 SONAR_HOST_URL: http://sonarqube:9000 34 SONAR_TOKEN: ${{ env.SONARQUBE_TOKEN }} 35 with: 36 args: \u0026gt; 37 -Dsonar.projectKey=pr-${{ github.event.pull_request.number }} 38 # Check the Quality Gate status. 39 - name: SonarQube Quality Gate check 40 id: sonarqube-quality-gate-check 41 uses: sonarsource/sonarqube-quality-gate-action@master 42 # Force to fail step after specific time. 43 timeout-minutes: 5 44 env: 45 SONAR_TOKEN: ${{ env.SONARQUBE_TOKEN }} 46 SONAR_HOST_URL: http://localhost:9000 47 - uses: phwt/sonarqube-quality-gate-action@v1 48 id: quality-gate-check 49 if: always() 50 with: 51 sonar-project-key: pr-${{ github.event.pull_request.number }} 52 sonar-host-url: http://sonarqube:9000 53 sonar-token: ${{ env.SONARQUBE_TOKEN }} 54 github-token: ${{ secrets.PROJEN_GITHUB_TOKEN }} 55 - name: Comment results and findings on Pull Request 56 uses: zxkane/sonar-quality-gate@master 57 if: always() 58 env: 59 DEBUG: true 60 GITHUB_TOKEN: ${{ secrets.PROJEN_GITHUB_TOKEN }} 61 GIT_URL: \u0026#34;https://api.github.com\u0026#34; 62 GIT_TOKEN: ${{ secrets.PROJEN_GITHUB_TOKEN }} 63 SONAR_URL: http://sonarqube:9000 64 SONAR_TOKEN: ${{ env.SONARQUBE_TOKEN }} 65 SONAR_PROJECT_KEY: pr-${{ github.event.pull_request.number }} 66 with: 67 login: ${{ env.SONARQUBE_TOKEN }} 68 skipScanner: true In this example, the workflow is triggered on pull request events to the main branch. The sonarsource/sonarqube-scanner-action is used to install the SonarQube Scanner and perform the code analysis. The SONAR_TOKEN environment variables is used to authenticate with the ephemeral SonarQube instance and its URL is specified as localhost:9000 or sonarqube:9000 which only could be accessed from the workflow runtime, respectively.\nAfter the analysis is complete, the sonarsource/sonarqube-quality-gate-action is used to check if the code meets the defined quality gate criteria. The customize quality gate is configured in the Configure sonarqube step.\nThe final step comments the results on the Pull Request and adds finding issues as inline comments too.\nYou can check the complete sample in this repo.\nConclusion Incorporating ephemeral SonarQube into your GitHub Actions workflow streamlines the process of continuous code quality inspection. By leveraging the power of SonarQube without the overhead of maintaining a dedicated instance, you can ensure that your codebase adheres to high quality standards with minimal effort.\nGive ephemeral SonarQube a try in your next project and experience the benefits of seamless code analysis and quality assurance within your GitHub Actions workflows.\n","link":"https://kane.mx/posts/2024/scan-your-code-with-ephemeral-sonarqube-in-github-actions/","section":"posts","tags":["Clean Code","SonarQube","Github Actions","CI","DevOps"],"title":"Scan Your Code with Ephemeral SonarQube in GitHub Actions"},{"body":"","link":"https://kane.mx/tags/sonarqube/","section":"tags","tags":null,"title":"SonarQube"},{"body":"","link":"https://kane.mx/tags/amazon-dynamodb/","section":"tags","tags":null,"title":"Amazon DynamoDB"},{"body":"","link":"https://kane.mx/tags/amazon-vpc/","section":"tags","tags":null,"title":"Amazon VPC"},{"body":"Amazon DynamoDB now supports AWS PrivateLink as of March 19, 2024. This feature allows you to securely access DynamoDB from your Amazon Virtual Private Cloud (VPC) without exposing your traffic to the public internet.\nHowever, unlike VPC endpoints for other AWS managed services, the AWS PrivateLink for Amazon DynamoDB does not support the Private DNS feature. This means that if your subnets are configured with only a DynamoDB Interface VPC endpoint, the public DNS name of the DynamoDB service (e.g., dynamodb.us-east-1.amazonaws.com in the us-east-1 region) cannot be resolved in those subnets.\nAs a result, you cannot share the same code to connect to the DynamoDB endpoint via the internet or a Gateway VPC endpoint when using Interface VPC endpoints. Instead, when you create an interface endpoint, DynamoDB generates two types of endpoint-specific DNS names: Regional and zonal. You must specify your own endpoint information when creating the DynamoDB client.\n1# replace the Region us-east-1 and VPC endpoint ID https://vpce-1a2b3c4d-5e6f.dynamodb.us-east-1.vpce.amazonaws.com with your own information. 2ddb_client = session.client( 3service_name=\u0026#39;dynamodb\u0026#39;, 4region_name=\u0026#39;us-east-1\u0026#39;, 5endpoint_url=\u0026#39;https://vpce-1a2b3c4d-5e6f.dynamodb.us-east-1.vpce.amazonaws.com\u0026#39; 6) As an experienced AWS developer, it's easy to assume that the newly launched DynamoDB Interface VPC endpoint behaves like other AWS managed services, allowing you to continue using existing code to initialize the DynamoDB client in isolated subnets. However, this assumption would be incorrect and could lead to issues.ðŸ˜‚ðŸ˜‚ðŸ˜‚\nMake sure to update your application code to use the endpoint-specific DNS names or the endpoint URL when working with DynamoDB Interface VPC endpoints. You can find more examples in the AWS documentation.\n","link":"https://kane.mx/posts/2024/dynamodb-interface-vpc-endpoint/","section":"posts","tags":["AWS","Amazon DynamoDB","Amazon VPC","Tip"],"title":"Avoiding Pitfalls When Using Amazon DynamoDB Interface VPC Endpoints"},{"body":"","link":"https://kane.mx/tags/tip/","section":"tags","tags":null,"title":"Tip"},{"body":"","link":"https://kane.mx/tags/amazon-redshift/","section":"tags","tags":null,"title":"Amazon Redshift"},{"body":"","link":"https://kane.mx/series/effective-cloud-computing/","section":"series","tags":null,"title":"Effective-Cloud-Computing"},{"body":"Serverless computing is all the rage, promising pay-as-you-go magic and freedom from infrastructure woes. But what about serverless for data warehouses? Let's delve into the fascinating (and sometimes confusing) world of Redshift Serverless: its cost structure, ideal use cases, and situations where it might not be the best fit.\nCost Breakdown: Beyond the Illusion of Free Redshift Serverless offers a compelling promise: only pay for what you use. But like any good magic trick, there's more to the story. Here's the primary cost breakdown:\nCompute Units (RPUs): You're charged per second for used compute capacity. This is fantastic for burst workloads, but beware of idle charges. Even when your warehouse is inactive, the base capacity incurs costs. It's with a 60-second minimum charge, even just one query is executed in a second in the charge period. Storage: Redshift Managed Storage (RMS) charges apply to the data you store, regardless of serverless or provisioned clusters. Data Transfer: Cross-region data sharing or accessing data from other AWS services like S3, Glue, etc outside the region attract data transfer charges. By breaking down the cost of Redshift serverless, the RPUs usage majorly impacts the cost. Let's see a few examples of how to analyze the cost of your Redshift serverless.\nRedshift serverless uses SYS_SERVERLESS_USAGE to view details of Amazon Redshift serverless usage of resources. After selecting some rows from the tables, it looks like below,\nstart_time end_time compute_seconds compute_capacity data_storage cross_region_transferred_data charged_seconds 2024-02-24 16:34:00 2024-02-24 16:35:00 62 8 31224 0 480 2024-02-24 16:33:00 2024-02-24 16:34:00 48 8 31218 0 0 2024-02-24 16:30:00 2024-02-24 16:31:00 0 0 31218 0 480 2024-02-24 16:29:00 2024-02-24 16:30:00 13 8 31217 0 0 2024-02-24 16:28:00 2024-02-24 16:29:00 0 0 31217 0 480 2024-02-24 16:27:00 2024-02-24 16:28:00 29 8 31210 0 480 From the above records, we know the Redshift serverless is configured with 8 RPUs (minimum RPUs). Every minute for the active Redshift serverless, 480 seconds (60 * 8 RPUs) are charged for the compute units of the Redshift serverless, though the actual usage of compute-seconds is small!\nYou can use the below query to view the percentage of actual computed seconds for your queries in the charged seconds.\n1-- query actual compute usage vs charged usage per day for Redshift Serverless running in us-west-2 2select 3 DATE_TRUNC(\u0026#39;day\u0026#39;, start_time) AS query_day, 4 sum(compute_seconds) as used_compute_seconds, sum(charged_seconds) as charged_seconds, 2/3 as utility_percentage, 5 sum(charged_seconds)*0.360/3600 as cost 6from sys_serverless_usage where CAST(start_time AS TIMESTAMP) \u0026gt;= CURRENT_DATE - INTERVAL \u0026#39;7 days\u0026#39; 7GROUP BY 1; If you want to which queries are charged in a specific period, leverage SYS_QUERY_HISTORY to view details of user queries. You could join those two tables to see the relationship like below example,\n1with query_info as ( 2 select 3 start_time, 4 end_time, 5 (\u0026#39;[ user_id: \u0026#39; || user_id || \u0026#39; query_id: \u0026#39; || query_id || \u0026#39; transaction_id: \u0026#39; || transaction_id || \u0026#39; session_id: \u0026#39; || session_id ||\u0026#39; - queries: \u0026#39; || SUBSTRING(btrim(query_text), 1, 100) || \u0026#39; ]\u0026#39;) as per_query_info 6 from sys_query_history where start_time ilike \u0026#39;%2024-02-24%\u0026#39; 7 order by start_time 8) 9select 10 syu.start_time, 11 syu.end_time, 12 compute_capacity, 13 charged_seconds, 14 listagg(per_query_info, \u0026#39;,\u0026#39;) as queries_within 15from sys_serverless_usage syu 16inner join query_info sqh 17on sqh.end_time \u0026lt;= syu.end_time 18and sqh.end_time \u0026gt;= syu.start_time 19group by 1,2,3,4; By analyzing the queries, you can evaluate the performance of Redshift serverless and identify the most expensive queries for optimization.\nUse Cases: Where Serverless Shines Redshift Serverless shines in specific scenarios:\nThe intensive queries in a short period (like massive BI queries in few hours). Ad-hoc analytics: Need to run quick queries on your data without spinning up a cluster? Serverless is perfect. Dev/test environments: Test your data pipeline and queries without managing infrastructure. Unpredictable workloads: For workloads with variable demand, serverless scales automatically, saving you from overprovisioning costs. When to Say No: Serverless Isn't for Everyone While tempting, serverless isn't always the answer. Consider these situations:\nLong-running queries: Serverless charges per second, making it less cost-effective for long-running queries compared to provisioned clusters. For example, streaming ingestion from Kinesis data stream or Kafka. Cost-sensitive workloads: If strict budget control is crucial, the base capacity charge and potential idle costs might outweigh the benefits. Conclusion: Choose Wisely Redshift Serverless offers a powerful, flexible option for specific data warehouse needs. However, understanding its cost structure and ideal use cases is crucial to avoid surprises. Carefully evaluate your workload characteristics and budget constraints before diving in. Remember, the magic of serverless lies in using it wisely!\nBonus Tip: Explore hybrid approaches, combining serverless for ad-hoc queries with provisioned clusters for predictable workloads via data sharing feature.\nI hope this blog post helps you navigate the world of Redshift Serverless! Do you have any questions or experiences to share? Let's discuss in the comments!\n","link":"https://kane.mx/posts/2024/redshift-serverless-cost-deep-dive/","section":"posts","tags":["AWS","Amazon Redshift","Serverless Computing"],"title":"Redshift Serverless: Cost Deep Dive and Use Cases"},{"body":"","link":"https://kane.mx/categories/serverless-computing/","section":"categories","tags":null,"title":"Serverless-Computing"},{"body":"AWS CDK accelerates cloud development using common programming languages to model your applications. I had a series of posts using CDK to demonstrate Building serverless web applications with AWS Serverless. Because CDK uses a programming language to model your application, you can encapsulate your library via Constructs, and then reuse it crossing the entire application.\nMeanwhile, you can create your own constructs to encapsulate the compliance requirements to simplify the code. For example, in our solution, I used the construct SolutionFunction to force using the same Node.js version(18.x), architecture(ARM64), Lambda logging configuration(JSON log), environment variables for Powertools Logger and so on crossing all NodejsFunction. In addition, using Aspects and escape hatches to make sure the application meets the compliance requirements.\nLet's deep dive into how to make all Nodejs Lambda functions compliant with the above requirements.\nFirstly, define the SolutionFunction for making a generic configuration of solutions's Nodejs Lambda,\n1export class SolutionNodejsFunction extends NodejsFunction { 2 3 constructor(scope: Construct, id: string, props?: NodejsFunctionProps) { 4 super(scope, id, { 5 ...props, 6 bundling: props?.bundling ? { 7 ...props.bundling, 8 externalModules: props.bundling.externalModules?.filter(p =\u0026gt; p === \u0026#39;@aws-sdk/*\u0026#39;) ?? [], 9 } : { 10 externalModules: [], 11 }, 12 runtime: Runtime.NODEJS_18_X, 13 architecture: Architecture.ARM_64, 14 environment: { 15 ...POWERTOOLS_ENVS, 16 ...(props?.environment ?? {}), 17 }, 18 logRetention: props?.logRetention ?? RetentionDays.ONE_MONTH, 19 logFormat: \u0026#39;JSON\u0026#39;, 20 applicationLogLevel: props?.applicationLogLevel ?? \u0026#39;INFO\u0026#39;, 21 }); 22 } 23} Then, add an Aspect to the application to make sure the NodejsFunction functions are an instance of SolutionFunction.\n1class NodejsFunctionSanityAspect implements IAspect { 2 3 public visit(node: IConstruct): void { 4 if (node instanceof NodejsFunction) { 5 if (!(node instanceof SolutionNodejsFunction)) { 6 Annotations.of(node).addError(\u0026#39;Directly using NodejsFunction is not allowed in the solution. Use SolutionNodejsFunction instead.\u0026#39;); 7 } 8 if (node.runtime != Runtime.NODEJS_18_X) { 9 Annotations.of(node).addError(\u0026#39;You must use Nodejs 18.x runtime for Lambda with javascript in this solution.\u0026#39;); 10 } 11 } 12 } 13} 14Aspects.of(app).add(new NodejsFunctionSanityAspect()); The above code snippets help us to archive the compliance of Nodejs Lambda functions without modifying tens or hundreds of occurrences one by one.\nHowever, due to service availability, the ARM64 architect and JSON log Lambda function are not available in the AWS China partition. Also, using another Aspect with escape hatches to override the attributes with conditional values.\n1class CNLambdaFunctionAspect implements IAspect { 2 3 private conditionCache: { [key: string]: CfnCondition } = {}; 4 5 public visit(node: IConstruct): void { 6 if (node instanceof Function) { 7 const func = node.node.defaultChild as CfnFunction; 8 if (func.loggingConfig) { 9 func.addPropertyOverride(\u0026#39;LoggingConfig\u0026#39;, 10 Fn.conditionIf(this.awsChinaCondition(Stack.of(node)).logicalId, 11 Fn.ref(\u0026#39;AWS::NoValue\u0026#39;), { 12 LogFormat: (func.loggingConfig as CfnFunction.LoggingConfigProperty).logFormat, 13 ApplicationLogLevel: (func.loggingConfig as CfnFunction.LoggingConfigProperty).applicationLogLevel, 14 LogGroup: (func.loggingConfig as CfnFunction.LoggingConfigProperty).logGroup, 15 SystemLogLevel: (func.loggingConfig as CfnFunction.LoggingConfigProperty).systemLogLevel, 16 })); 17 } 18 if (func.architectures \u0026amp;\u0026amp; func.architectures[0] == Architecture.arm64) { 19 func.addPropertyOverride(\u0026#39;Architectures\u0026#39;, 20 Fn.conditionIf(this.awsChinaCondition(Stack.of(node)).logicalId, 21 Fn.ref(\u0026#39;AWS::NoValue\u0026#39;), func.architectures)); 22 } 23 } 24 } 25 26 private awsChinaCondition(stack: Stack): CfnCondition { 27 const conditionName = \u0026#39;AWSCNCondition\u0026#39;; 28 // Check if the resource already exists 29 const existingResource = this.conditionCache[stack.artifactId]; 30 31 if (existingResource) { 32 return existingResource; 33 } else { 34 const awsCNCondition = new CfnCondition(stack, conditionName, { 35 expression: Fn.conditionEquals(\u0026#39;aws-cn\u0026#39;, stack.partition), 36 }); 37 this.conditionCache[stack.artifactId] = awsCNCondition; 38 return awsCNCondition; 39 } 40 } 41} 42Aspects.of(app).add(new CNLambdaFunctionAspect()); Alright, using the above two aspects forces the solution to meet the compliance requirements of Lambda functions with the same runtime version, architecture, and logger configuration. \u0026#x1f929; \u0026#x1f604; \u0026#x1f929;\n","link":"https://kane.mx/posts/2024/custom-compliance-for-aws-cdk/","section":"posts","tags":["AWS","AWS CDK","AWS Lambda","Tips"],"title":"Custom compliance implementation in AWS CDK"},{"body":"","link":"https://kane.mx/tags/tips/","section":"tags","tags":null,"title":"Tips"},{"body":"","link":"https://kane.mx/tags/amazon-codewhisperer/","section":"tags","tags":null,"title":"Amazon CodeWhisperer"},{"body":" Disclaimer: the cover image was generated by Amazon Bedrock's Titan Image Generator G1.\nAWS CLI is a swiss knife for orchestrating the operations of AWS resources. Especially, the filter option could help your filter and transform the output then combine with other Linux commands together.\nThis post collects the CLI usages to resolve my AWS operation needs.\nDelete the legacy versions of a service catalog product AWS Service Catalog has default 100 versions per product. Below is a one line command to delete the legacy versions.\n1export PRODUCT_ID=\u0026lt;product-id\u0026gt; 2 3# query the version name starting with \u0026#39;v5.0.0\u0026#39; then show Id and Name only 4aws servicecatalog describe-product --no-paginate --id $PRODUCT_ID --query \u0026#39;ProvisioningArtifacts[?starts_with(Name, `v5.0.0`)].{Id:Id, Name:Name}\u0026#39; 5 6# query the version name contains \u0026#39;v5.0.0-beta\u0026#39; then delete them 7aws servicecatalog describe-product --no-paginate --id $PRODUCT_ID --query \u0026#39;ProvisioningArtifacts[?contains(Name, `v5.0.0-beta`)].Id\u0026#39; |jq -r \u0026#39;.[]\u0026#39; | xargs -I {} aws servicecatalog delete-provisioning-artifact --product-id $PRODUCT_ID --provisioning-artifact-id {} Public all S3 objects with specific prefix 1aws s3 ls s3://$name/$prefix --recursive | awk \u0026#39;{print $4}\u0026#39; | xargs -I {} -n 1 aws s3api put-object-acl --acl public-read --bucket $name --key {} Reset resource policy of CloudWatch logs You might encounter a CloudFormation stack deployment failure due to creating CloudWatch log group with an error message like the one below,\nCannot enable logging. Policy document length breaking Cloudwatch Logs Constraints, either \u0026lt; 1 or \u0026gt; 5120 (Service: AmazonApiGatewayV2; Status Code: 400; Error Code: BadRequestException; Request ID: xxx-yyy-zzz; Proxy: null)\nCloudWatch Logs resource policies are limited to 5120 characters. The remediation is merging or removing useless policies, then updating the resource policies of CloudWatch logs to reduce the number of policies.\nBelow is a sample command to reset resource policy of CloudWatch logs:\nPush Helm chart to all regional ECR repositories Import a local SSH key to all AWS regions Query latest amazon linux2 AMI Delete multiple CloudWatch Log groups Launch an EC2 within default VPC with default security group Add below script in your .zshrc, then run ec2-launch-amazon-linux in terminal to launch a new instance.\nAmazon CodeWhisperer for command line is a new set of capabilities and integrations for AI-powered productivity tool, Amazon CodeWhisperer, that makes software developers more productive in the command line. It can also assist you generating the CLI command based on your natural language inputs.\n","link":"https://kane.mx/posts/2024/awscli-collection/","section":"posts","tags":["AWS","AWS CLI","Amazon CodeWhisperer","Tips","Collections"],"title":"Awesome AWS CLI"},{"body":"","link":"https://kane.mx/tags/aws-cli/","section":"tags","tags":null,"title":"AWS CLI"},{"body":"","link":"https://kane.mx/tags/collections/","section":"tags","tags":null,"title":"Collections"},{"body":" Disclaimer: the cover image was generated by StableDiffusionXL with prompts 'cover image, spring boot, flask framework running in aws lambda'.\nWhen deploying and operating a web application on the cloud, you prefer to use your favorite programming language and web framework. Also, you want to benefit from Serverless technologies for stability, scalability, cost optimization, and operation excellence.\nAWS Lambda Web Adapter is a tool that perfectly meets your expectations. It lifts and shifts the web application based on your preferred language and web framework, including FastAPI, Flask, Django, Express.js, Next.js, Spring Boot, Nginx, PHP, Rust, Golang Gin, Laravel, ASP.NET, and so on! You don't have to change any code to migrate your application to Lambda runtime. It also supports WebSocket and streaming features that work well with your LLM applications.\nAnother use case is that you can orchestrate your cloud infrastructure to support different network topologies without changing any code. Assuming you are ISV, your customers want to deploy your services as both public service and private service. With lambda web adapter, you can share the source code of the service, just orchestrating the AWS services to meet the requirements.\nPublic service pattern: CloudFront + S3 + API Gateway + Lambda You can use CloudFront to publish your entire web service. Using S3 to host all static content of your site and API Gateway with Lambda integration serves as the backend API.\nThe pattern architect for hosting web application as public service Private service pattern: Application Load Balancer (ALB) + Lambda With lambda web adapter, you can deploy your web application with Amazon VPC without exposing it to the internet. In this pattern, we choose ALB as the gateway of network traffic, then forward the different requests to two Lambda functions running web frontend and backend correspondingly.\nThe pattern architect for hosting web application as private service without public access In Clickstream Analytics on AWS solution it applies the above patterns to deploy its web console for different network topologies without changing the code of the web application. Also, the solution implements the above pattern as CDK constructs for replication using,\nCloudFront + S3 + API Gateway + Lambda ALB + Lambda Learns While implementing the above patterns in the Clickstream solution, we learned the below tips for applying them on AWS.\nFor CloudFront + S3 + API Gateway + Lambda Put API Gateway behind CloudFront for the same origin Use CloudFront function to rewrite requests for React Browser Router Can not enable access log of CloudFront in the same region when deploying to opt-in regions For ALB + Lambda The payload size for Lambda behind ALB is 1MB Split the bundled JS into multiple chunks Handle with the authentication and authorization via your Web framework I presented this topic in AWS User Group Taiwan CDK Squad Meetup in Chinese. Below are the slides in the community sharing,\n","link":"https://kane.mx/posts/2023/build-serverless-web-application-with-aws-lambda-web-adapter/","section":"posts","tags":["AWS","AWS CDK","AWS Lambda","Lambda Web Adapter","Serverless Pattern","Serverless","CDK Construct"],"title":"Build serverless web application with AWS Lambda web adapter"},{"body":"","link":"https://kane.mx/series/build-serverless-application/","section":"series","tags":null,"title":"Build-Serverless-Application"},{"body":"","link":"https://kane.mx/tags/cdk-construct/","section":"tags","tags":null,"title":"CDK Construct"},{"body":"","link":"https://kane.mx/tags/lambda-web-adapter/","section":"tags","tags":null,"title":"Lambda Web Adapter"},{"body":"","link":"https://kane.mx/tags/serverless/","section":"tags","tags":null,"title":"Serverless"},{"body":"","link":"https://kane.mx/tags/serverless-pattern/","section":"tags","tags":null,"title":"Serverless Pattern"},{"body":"","link":"https://kane.mx/tags/aws-js-sdk/","section":"tags","tags":null,"title":"AWS JS SDK"},{"body":"When programming with the AWS SDK, developers sometimes want to debug a specific HTTP request when invoking an SDK API. Due to the poor documentation of AWS JS SDK v3, it takes a lot of work to find a way to print the verbose logging of AWS SDK by asking it to the LLMs.\nBelow is a practical tip for enabling verbose logging for AWS JS SDK v3.\nSolution 1 - specify a custom logger for AWS SDK clients 1import { DescribeParametersCommand, SSMClient } from \u0026#34;@aws-sdk/client-ssm\u0026#34;; 2import * as log4js from \u0026#34;log4js\u0026#34;; 3 4log4js.configure({ 5 appenders: { out: { type: \u0026#34;stdout\u0026#34; } }, 6 categories: { default: { appenders: [\u0026#34;out\u0026#34;], level: \u0026#34;debug\u0026#34; } }, 7}); 8 9const logger = log4js.getLogger(); 10 11const ssmClient = new SSMClient({ 12 logger: logger, 13}); Solution 2 - use middleware to hook the life cyele of request 1import { DescribeParametersCommand, SSMClient } from \u0026#34;@aws-sdk/client-ssm\u0026#34;; 2 3const logRequestMiddleware = (next: any, _context: any) =\u0026gt; async (args: any) =\u0026gt; { 4 console.log(\u0026#39;Request:\u0026#39;, args.request); 5 return next(args); 6}; 7 8const ssmClient = new SSMClient({ 9}); 10 11ssmClient.middlewareStack.add(logRequestMiddleware, { step: \u0026#39;finalizeRequest\u0026#39; }); See complete working example gist below,\n","link":"https://kane.mx/posts/2023/aws-js-sdk-v3-verbose-logging/","section":"posts","tags":["AWS JS SDK","Tip","AWS"],"title":"Verbose logging for AWS JS SDK v3"},{"body":"","link":"https://kane.mx/tags/amazon-api-gateway/","section":"tags","tags":null,"title":"Amazon API Gateway"},{"body":"","link":"https://kane.mx/tags/amazon-sqs/","section":"tags","tags":null,"title":"Amazon SQS"},{"body":"Application Programming Interfaces(APIs) is a critical part of the web service, Werner Vogel, the CTO of AWS had a great 6 Rules for Good API Design presentation in 2021 re:Invent keynote.\nIn AWS the developers could manage and proxy the APIs via Amazon API Gateway. The developers can use console, CLI, API or IaC code(for example, Terraform/CloudFormation/CDK) to provisioning the API resources on AWS. However some developers might flavor with using OpenAPI specification to define the APIs. It enables multiple services/tools to understand the APIs' specification, such as Postman. Amazon API Gateway supports this use case, you can import the existing OpenAPI definition as API.\nAmazon API Gateway offers two RESTful API products, REST API and HTTP API. Both of those two APIs support importing OpenAPI definition, but they might use different OpenAPI extensions to support different features.\nAnd below example will use infrastructure as code(AWS CDK) to import the OpenAPI definition to the API Gateway APIs. While importing OpenAPI definition, the most challenge is updating the OpenAPI definition with dynamic resources information(for example, IAM role for calling downstream resources of integration) before importing the OpenAPI definition. For AWS CDK(on top of AWS CloudFormation) uses the intrinsic functions of CloudFormation(Fn::Join) to archive it.\nREST API 1 const deployOptions = { 2 stageName: \u0026#39;\u0026#39;, 3 loggingLevel: MethodLoggingLevel.ERROR, 4 dataTraceEnabled: false, 5 metricsEnabled: true, 6 tracingEnabled: false, 7 }; 8 const restOpenAPISpec = this.resolve(Mustache.render( 9 fs.readFileSync(path.join(__dirname, \u0026#39;./rest-sqs.yaml\u0026#39;), \u0026#39;utf-8\u0026#39;), 10 variables)); 11 new SpecRestApi(this, \u0026#39;rest-to-sqs\u0026#39;, { 12 apiDefinition: ApiDefinition.fromInline(restOpenAPISpec), 13 endpointExportName: \u0026#39;APIEndpoint\u0026#39;, 14 deployOptions, 15 }); HTTP API But above solution does not work with HTTP API, because the CloudFormation of HTTP API does not support intrinsic functions of CFN. \u0026#x1f625; The workaround is putting the OpenAPI definition to Amazon S3 firstly, then import it from S3 bucket via CloudFormation. It involves putting the OpenAPI definition with dynamic resource information to S3 bucket before importing the OpenAPI definition from S3. Here I leveage the CDK built-in custom resource to call S3 API to put the OpenAPI definition file to S3.\n22/11/09 UPDATE: The Body of AWS::ApiGatewayV2::Api only supports the json object. It works after converting the Yaml OpenAPI definition to JSON!\n1const yaml = require(\u0026#39;js-yaml\u0026#39;); 2 3... 4 5 // import openapi as http api 6 const variables = { 7 integrationRoleArn: apiRole.roleArn, 8 queueName: bufferQueue.queueName, 9 queueUrl: bufferQueue.queueUrl, 10 }; 11 const openAPISpec = this.resolve(yaml.load(Mustache.render( 12 fs.readFileSync(path.join(__dirname, \u0026#39;./http-sqs.yaml\u0026#39;), \u0026#39;utf-8\u0026#39;), variables))); 13 14 const httpApi = new CfnApi(this, \u0026#39;http-api-to-sqs\u0026#39;, { 15 body: openAPISpec, 16 failOnWarnings: false, 17 }); The example code creates both REST API and HTTP API, both of them forwards the events to Amazon SQS queue that are sent by HTTP POST requests. See OpenAPI definition of HTTP to SQS, OpenAPI definition of REST to SQS or complete source for further reference.\n","link":"https://kane.mx/posts/2022/import-oas-as-api-on-aws/","section":"posts","tags":["Serverless","Amazon API Gateway","OpenAPI","OAS","Amazon SQS","AWS","AWS CDK"],"title":"Define your API via OpenAPI definition on AWS"},{"body":"","link":"https://kane.mx/tags/oas/","section":"tags","tags":null,"title":"OAS"},{"body":"","link":"https://kane.mx/tags/openapi/","section":"tags","tags":null,"title":"OpenAPI"},{"body":"","link":"https://kane.mx/tags/codepipeline/","section":"tags","tags":null,"title":"CodePipeline"},{"body":"","link":"https://kane.mx/tags/continuous-deployment/","section":"tags","tags":null,"title":"Continuous Deployment"},{"body":"DevOps pipeline is a key component of project operation, it helps you automate steps in your software delivery process.\nAmazon itself has rich expirence on DevOps with large scale services, it shares the lesson and learn from operating the Amazon's services. You can read this summary post written in Chinese.\nAlso AWS provides fully managed SaaS services for the lifecycle of software development, including AWS CodePipeline for automating continuous delivery pipelines, AWS CodeCommit for securely hosting highly scalable private Git repositories, AWS CodeArtifact for artifact management, AWS CodeBuild for building and testing code with continuous scaling and AWS CodeDeploy for automating code deployments to maintain application uptime.\nAWS Code series services are feasible to build the different DevOps pipelines to satisfy the customer's requirements. But it's required some work to assemble the building blocks to build the pipeline.\nCDK Pipeline is an abstract to simplify the builder experience to build DevOps pipeline for CDK application. It leveages the Infrastructure as Code and Construct to standarndize and customize the pipeline of CDK application.\nThe pipeline code just has few lines and looks like below,\n1 const connectArn = scope.node.tryGetContext(\u0026#39;SourceConnectionArn\u0026#39;); 2 if (!connectArn) {throw new Error(\u0026#39;Must specify the arn of source repo connection.\u0026#39;);} 3 const oidcSecret: string = scope.node.tryGetContext(\u0026#39;OIDCSerectArn\u0026#39;); 4 if (!oidcSecret) {throw new Error(\u0026#39;Must specify the context \u0026#34;OIDCSerectArn\u0026#34; for storing secret.\u0026#39;);} 5 6 const pipeline = new CodePipeline(this, \u0026#39;Pipeline\u0026#39;, { 7 synth: new ShellStep(\u0026#39;Synth\u0026#39;, { 8 input: CodePipelineSource.connection(\u0026#39;zxkane/cdk-collections\u0026#39;, \u0026#39;master\u0026#39;, { 9 connectionArn: connectArn, 10 codeBuildCloneOutput: true, 11 }), 12 installCommands: [ 13 \u0026#39;git submodule init \u0026amp;\u0026amp; git submodule update \u0026amp;\u0026amp; git submodule sync\u0026#39;, 14 \u0026#39;npm i --prefix serverlesstodo/frontend\u0026#39;, 15 \u0026#39;npm run build --prefix serverlesstodo/frontend\u0026#39;, 16 \u0026#39;yarn --cwd serverlesstodo install --check-files --frozen-lockfile\u0026#39;, 17 ], 18 commands: [ 19 \u0026#39;cd serverlesstodo\u0026#39;, 20 \u0026#39;npx projen\u0026#39;, 21 \u0026#39;npx projen test\u0026#39;, 22 `npx cdk synth serverlesstodo -c OIDCSerectArn=${oidcSecret} -c SourceConnectionArn=${connectArn} -c CognitoDomainPrefix=todolist-userpool-prod`, 23 ], 24 primaryOutputDirectory: \u0026#39;serverlesstodo/cdk.out/\u0026#39;, 25 }), 26 dockerEnabledForSynth: true, 27 codeBuildDefaults: { 28 cache: Cache.local(LocalCacheMode.SOURCE, LocalCacheMode.DOCKER_LAYER), 29 }, 30 synthCodeBuildDefaults: { 31 partialBuildSpec: BuildSpec.fromObject({ 32 version: \u0026#39;0.2\u0026#39;, 33 phases: { 34 install: { 35 \u0026#39;runtime-versions\u0026#39;: { 36 nodejs: 14, 37 }, 38 }, 39 }, 40 }), 41 }, 42 }); 43 44 pipeline.addStage(new TodolistApplication(this, \u0026#39;Prod\u0026#39;, { 45 env: { 46 account: process.env.CDK_DEFAULT_ACCOUNT, 47 region: process.env.CDK_DEFAULT_REGION, 48 }, 49 })); Some key points in above pipeline code snippet,\nthis example code hosts on Github, so using CodeStar connection to fetch code from Github synth of CodePipeline is the configuration of CodeBuild project, it installs the dependencies of project then build, test and generate the deployment artifacts(CloudFormation template), see docs of deploying from source the CDK pipeline has built-in mutation step to update pipeline itself before deploying the application After deploying the pipeline stack, the screenshot of pipeline looks like below, Todolist app pipeline As usual, all AWS resources are orchestrated by a AWS CDK project, it's easliy to be deployed to any account and any region of AWS!\nHappying continuously deploy your application \u0026#x1f680; \u0026#x1f606;\u0026#x1f606;\u0026#x1f606;\n","link":"https://kane.mx/posts/2022/build-serverless-app-on-aws/devops-pipeline/","section":"posts","tags":["Serverless","AWS","AWS CDK","CodePipeline","DevOps","Continuous Deployment"],"title":"Setup DevOps pipeline with few code"},{"body":"","link":"https://kane.mx/tags/amplify/","section":"tags","tags":null,"title":"Amplify"},{"body":"","link":"https://kane.mx/tags/api-gateway/","section":"tags","tags":null,"title":"API Gateway"},{"body":"","link":"https://kane.mx/tags/authentication/","section":"tags","tags":null,"title":"Authentication"},{"body":"","link":"https://kane.mx/tags/cognito/","section":"tags","tags":null,"title":"Cognito"},{"body":"When working on either 2C application or 2B service, the customers do not want to or is not allowed to sign up the new account, they can login the application via existing IdP or enterprise SSO. So, building the application supports the federated OIDC login to address such requirements.\nThis post extends the capability of Todolist application protected by Amazon Cognito, using Auth0 as the third party OpenID Connect provider introduces the external user pool.\nThe application also uses the AWS Amplify to build the frontend capabilities(for example, authentication, invoke backend restful api), Amazon Cognito providing both federated OIDC login and self-managed users sign in/sign up, and Amazon API Gateway providing the backend API and validating the token with OIDC provider.\nBelow is the key procedures to add the federated OIDC login to the existing web application protected by Cognito,\n1. Update the authorizer of API Gateway to validate the token issued by OIDC providers.\nThe previous authorizer is using API Gateway Cognito authorizer, it only can validate the token issued by Cognito user pool. Cognito user pool also complies with the OIDC standard, using Lambda authorizer can implement to validate the tokens issued by either Cognito user pool and third party OIDC provider.\nThe CDK code creates a lambda function as Lambda Authorizer of API Gateway, which sets the supported OIDC issuers as environment,\n1 const authFunc = new NodejsFunction(this, `${resourceName}AuthFunc`, { 2 entry: path.join(__dirname, \u0026#39;./lambda.d/authorizer/index.ts\u0026#39;), 3 handler: \u0026#39;handler\u0026#39;, 4 architecture: Architecture.ARM_64, 5 timeout: Duration.seconds(5), 6 memorySize: 128, 7 runtime: Runtime.NODEJS_16_X, 8 tracing: Tracing.ACTIVE, 9 environment: { 10 ISSUERS: issuers, 11 RESOURCE_PREFIX: Arn.format({ 12 service: \u0026#39;execute-api\u0026#39;, 13 resource: api.restApiId, 14 }, Stack.of(this)), 15 }, 16 }); The custom lambda authorizer uses the Auth0's jwt-decode and AWS JWT Verify to verify the ID tokens issued by OIDC provider. See source for detail implementation.\n2. Add the third party OIDC provider to Cognito user pool. It involves the client information with secrets generated by OIDC provider, we use the AWS Secrets Manager to securely store the credentials.\nAs prerequisites of this step, you must create an application in your OIDC provider. For example, creating an application in Auth0, then configure the allowed callback URLs to the pool domain. The next saving the issuer domain, client id, client secret and name(will be readable string in UI) to a secret in Secrets Manager. Todolist app in Auth0 The code snippet of CDK creates the external OIDC provider looks like below,\n1 const oidcSecretArn = this.node.tryGetContext(\u0026#39;OIDCSerectArn\u0026#39;); 2 var oidcProvider: UserPoolIdentityProviderOidc | undefined; 3 if (oidcSecretArn) { 4 const secret = Secret.fromSecretAttributes(this, \u0026#39;OIDCSecret\u0026#39;, { 5 secretCompleteArn: oidcSecretArn, 6 }); 7 oidcProvider = new UserPoolIdentityProviderOidc(this, \u0026#39;FedarationOIDC\u0026#39;, { 8 clientId: secret.secretValueFromJson(\u0026#39;clientId\u0026#39;).toString(), 9 clientSecret: secret.secretValueFromJson(\u0026#39;clientSecret\u0026#39;).toString(), 10 issuerUrl: secret.secretValueFromJson(\u0026#39;issuerUrl\u0026#39;).toString(), 11 name: secret.secretValueFromJson(\u0026#39;name\u0026#39;).toString(), 12 userPool: userpool, 13 scopes: [ 14 \u0026#39;profile\u0026#39;, 15 \u0026#39;openid\u0026#39;, 16 \u0026#39;email\u0026#39;, 17 ], 18 }); 19 userpool.registerIdentityProvider(oidcProvider); 20 } 3. Update the amplify configuration file with OIDC provider information.\n1 const amplifyConfFile = \u0026#39;aws-exports.json\u0026#39;; 2 const body = 3`{ 4 \u0026#34;aws_project_region\u0026#34;: \u0026#34;${Aws.REGION}\u0026#34;, 5 \u0026#34;Auth\u0026#34;: { 6 \u0026#34;region\u0026#34;: \u0026#34;${Aws.REGION}\u0026#34;, 7 \u0026#34;userPoolId\u0026#34;: \u0026#34;${poolInfo.userpool.userPoolId}\u0026#34;, 8 \u0026#34;userPoolWebClientId\u0026#34;: \u0026#34;${poolInfo.client.userPoolClientId}\u0026#34;, 9 \u0026#34;authenticationFlowType\u0026#34;: \u0026#34;USER_SRP_AUTH\u0026#34;, 10 \u0026#34;oauth\u0026#34;: { 11 \u0026#34;name\u0026#34;: \u0026#34;${poolInfo.oidc.name}\u0026#34;, 12 \u0026#34;domain\u0026#34;: \u0026#34;${poolInfo.poolDomain.domainName}.auth.${Aws.REGION}.amazoncognito.com\u0026#34;, 13 \u0026#34;scope\u0026#34;: [\u0026#34;email\u0026#34;, \u0026#34;openid\u0026#34;, \u0026#34;aws.cognito.signin.user.admin\u0026#34;, \u0026#34;profile\u0026#34;], 14 \u0026#34;redirectSignIn\u0026#34;: \u0026#34;${poolInfo.oidc.signinUrl}\u0026#34;, 15 \u0026#34;redirectSignOut\u0026#34;: \u0026#34;${poolInfo.oidc.signinUrl}\u0026#34;, 16 \u0026#34;responseType\u0026#34;: \u0026#34;code\u0026#34; 17 } 18 }, 19 \u0026#34;API\u0026#34;: { 20 \u0026#34;endpoints\u0026#34;: [ 21 { 22 \u0026#34;name\u0026#34;: \u0026#34;backend-api\u0026#34;, 23 \u0026#34;endpoint\u0026#34;: \u0026#34;https://${cloudFrontS3.cloudFrontWebDistribution.distributionDomainName}/prod/\u0026#34; 24 } 25 ] 26 } 27}`; 4. Customize the Amplify's React Authenticator component to add the federated OIDC login entrance.\n1 SignIn: { 2 Footer() { 3 const { toResetPassword } = useAuthenticator(); 4 5 return ( 6 \u0026lt;View textAlign=\u0026#34;center\u0026#34;\u0026gt; 7 \u0026lt;Divider orientation=\u0026#34;horizontal\u0026#34; /\u0026gt; 8 \u0026lt;Text\u0026gt; 9 { 10 !isAuthenticated \u0026amp;\u0026amp; ( 11 \u0026lt;View 12 as=\u0026#34;div\u0026#34; 13 backgroundColor=\u0026#34;var(--amplify-colors-white)\u0026#34; 14 borderRadius=\u0026#34;6px\u0026#34; 15 color=\u0026#34;var(--amplify-colors-blue-60)\u0026#34; 16 height=\u0026#34;4rem\u0026#34; 17 maxWidth=\u0026#34;100%\u0026#34; 18 padding=\u0026#34;1rem\u0026#34; 19 \u0026gt; 20 \u0026lt;Button 21 variation=\u0026#34;primary\u0026#34; 22 onClick={ 23 () =\u0026gt; { 24 Auth.federatedSignIn({ customProvider: oidcProviderName }); 25 }} 26 \u0026gt; 27 Sign In with {oidcProviderName} 28 \u0026lt;/Button\u0026gt; 29 \u0026lt;/View\u0026gt; 30 ) 31 } 32 \u0026lt;/Text\u0026gt; 33 \u0026lt;/View\u0026gt; 34 ); 35 }, 36 }, The new look of Amplify's authoricator component looks like below with both self-managed user pool and federated OIDC login, Todolist federated OIDC login As usual, all AWS resources are orchestrated by a AWS CDK project, it's easliy to be deployed to any account and any region of AWS!\nHappying logging your website with externl OIDC provider \u0026#x1f512; \u0026#x1f606;\u0026#x1f606;\u0026#x1f606;\n","link":"https://kane.mx/posts/2022/build-serverless-app-on-aws/federated-oidc-login-with-cognito-and-amplify/","section":"posts","tags":["Serverless","AWS","AWS CDK","API Gateway","Cognito","Amplify","OpenID Connect","Authentication"],"title":"Federated OIDC login with Cognito and Amplify"},{"body":"","link":"https://kane.mx/tags/openid-connect/","section":"tags","tags":null,"title":"OpenID Connect"},{"body":"","link":"https://kane.mx/tags/authorization/","section":"tags","tags":null,"title":"Authorization"},{"body":"Previous post we demonstrated how distributing and securely deploying the website to global end users. The authentication and authorization are always mandatory features of web application. Amazon Cognito is a managed AWS serverless service helping the applications to implement AuthN and AuthZ, with Cognito the applications securely scales to millions of users(up to 50,000 free users) supporting identity and access management standards, such as OAuth 2.0, SAML 2.0, and OpenID Connect.\nThe web application uses AWS Amplify to integrate with AWS services, such as Cognito and API Gateway. Below the procedures how integrating Cognito as AuthN via Amplify in Todolist project,\nadd amplify JS libraries into your project's dependencies 1{ 2 \u0026#34;name\u0026#34;: \u0026#34;todo-list\u0026#34;, 3 \u0026#34;dependencies\u0026#34;: { 4 \u0026#34;@aws-amplify/ui-react\u0026#34;: \u0026#34;^3.5.0\u0026#34;, 5 \u0026#34;aws-amplify\u0026#34;: \u0026#34;^4.3.34\u0026#34;, 6 \u0026#34;axios\u0026#34;: \u0026#34;^0.27.2\u0026#34;, 7 \u0026#34;react\u0026#34;: \u0026#34;^18.2.0\u0026#34;, 8 \u0026#34;react-dom\u0026#34;: \u0026#34;^18.2.0\u0026#34;, 9 \u0026#34;react-icons\u0026#34;: \u0026#34;^4.4.0\u0026#34;, 10 \u0026#34;sweetalert2\u0026#34;: \u0026#34;^11.4.24\u0026#34;, 11 \u0026#34;uuid\u0026#34;: \u0026#34;^8.3.2\u0026#34; 12 } 13} load the configuration file from server side and configure the Amplify categories 1 useEffect(() =\u0026gt; { 2 setLoadingConfig(true); 3 Axios.get(\u0026#34;/aws-exports.json\u0026#34;).then((res) =\u0026gt; { 4 const configData = res.data; 5 const tokenHeader = async () =\u0026gt; { return { Authorization: `Bearer ${(await Auth.currentSession()).getIdToken().getJwtToken()}` }; }; 6 configData.API.endpoints[0].custom_header = tokenHeader; 7 Amplify.configure(configData); 8 apiEndpointName = configData.API.endpoints[0].name; 9 setApiEndpoint(configData.API.endpoints[0].name); 10 11 Hub.listen(\u0026#39;auth\u0026#39;, ({ payload }) =\u0026gt; { 12 const { event } = payload; 13 switch (event) { 14 case \u0026#39;signIn\u0026#39;: 15 case \u0026#39;signUp\u0026#39;: 16 case \u0026#39;autoSignIn\u0026#39;: 17 getTasks(); 18 break; 19 } 20 }); 21 22 getTasks(); 23 24 setLoadingConfig(false); 25 }); 26 }, []); use [Authenticator component][authenticator] adding complete authentication flows with minimal boilerplate 1 return ( 2 \u0026lt;Authenticator components={components} loginMechanisms={[\u0026#39;email\u0026#39;]}\u0026gt; 3 {({ signOut, user }) =\u0026gt; ( 4 \u0026lt;Flex 5 direction=\u0026#34;column\u0026#34; 6 justifyContent=\u0026#34;flex-start\u0026#34; 7 alignItems=\u0026#34;center\u0026#34; 8 alignContent=\u0026#34;flex-start\u0026#34; 9 wrap=\u0026#34;nowrap\u0026#34; 10 gap=\u0026#34;1rem\u0026#34; 11 textAlign=\u0026#34;center\u0026#34; 12 \u0026gt; 13 \u0026lt;View width=\u0026#34;100%\u0026#34;\u0026gt; 14 ... 15 \u0026lt;/View\u0026gt; 16 \u0026lt;/Flex\u0026gt; 17 )} 18 \u0026lt;/Authenticator\u0026gt; 19 ) update TODO CRUD methods to use Amplify's API catagory to make HTTP requests to API Gateway 1 const getTasks = async () =\u0026gt; { 2 const canEnter = await ionViewCanEnter(); 3 if (canEnter) { 4 try { 5 setLoadingData(true); 6 7 const initData = { 8 headers: { \u0026#34;content-type\u0026#34;: \u0026#34;application/json\u0026#34; }, // OPTIONAL 9 response: true, // OPTIONAL (return the entire Axios response object instead of only response.data) 10 }; 11 API 12 .get(apiEndpointName || apiEndpoint, \u0026#34;/todo\u0026#34;, initData) 13 .then(res =\u0026gt; { 14 setLoadingData(false); 15 const tasksData = res.data; 16 if ((typeof tasksData === \u0026#34;string\u0026#34;)) { 17 Swal.fire(\u0026#34;Ops..\u0026#34;, tasksData); 18 } else { 19 setTasks(tasksData); 20 } 21 }) 22 .catch(error =\u0026gt; { 23 setLoadingData(false); 24 console.error(error); 25 Swal.fire( 26 `${error.message}`, 27 `${error?.response?.data?.message}`, 28 undefined 29 ); 30 }); 31 } catch (error) { 32 console.info(error); 33 } 34 } 35 }; All above changes are implemented Cognito authN with the web react application.\nIn the server-side the Cognito user pool will be provisioned, the API Gateway endpoint is authorized by Cognito user pool authorizer. The Amplify configuration file aws-exports.json will be created on the air when provisioning the stack with the user pool and API information.\nAs usual, all AWS resources are orchestrated by AWS CDK project, it's easliy to be deployed to any account and any region of AWS!\nHappying protecting the website with Cognito \u0026#x1f512; \u0026#x1f606;\u0026#x1f606;\u0026#x1f606;\n","link":"https://kane.mx/posts/2022/build-serverless-app-on-aws/protect-website-with-cognito/","section":"posts","tags":["Serverless","AWS","AWS CDK","API Gateway","Cognito","Amplify","Authentication","Authorization"],"title":"Protect website with Cognito"},{"body":"","link":"https://kane.mx/tags/cloudfront/","section":"tags","tags":null,"title":"CloudFront"},{"body":"It's a well known pattern to distribute the website via CDN globally, it reduces the latency of the site and improve the availibity and security leveraging the infrastructure of cloud provider.\nUsing CDN service CloudFront and simple storage S3 on AWS hosts the static website. It well fits the SPA(single page application) framework technologies, for example, React, Vue and Angularjs. There are lots of existing project and code snippets to sharing this pattern, such as CloudFront to S3 and API Gateway and AWS S3 / React Website Pattern.\nIn the TODO application it reuses an existing project Todolist built by React. The original Todolist application is a pure client application without communicating the backend service. In this demo the Todolist application is updated to communicate with Restful TODO APIs created by Amazon API Gateway. Also the restful backend API is distributed by CDN CloudFront to reduce the latency and protect the origin service without crossing domain request.\nTodolist app The demo uses the aws-cloudfront-s3 construct from AWS Solutions Constructs to simplify orchestrating the CloudFront to S3/API Gateway pattern. And use AWS S3 Deployment Construct Library to publish the static web page to S3 bucket. See below code snippet how archive it in CDK.\nAs usual, all AWS resources are orchestrated by AWS CDK project, it's easliy to be deployed to any account and any region of AWS!\nHappying distributing the website \u0026#x1f310; \u0026#x1f606;\u0026#x1f606;\u0026#x1f606;\n","link":"https://kane.mx/posts/2022/build-serverless-app-on-aws/static-website/","section":"posts","tags":["Serverless","AWS","AWS CDK","CloudFront","S3"],"title":"Distribute the website globally"},{"body":"","link":"https://kane.mx/tags/s3/","section":"tags","tags":null,"title":"S3"},{"body":"Most web applications are using Restful APIs to interactive with the backend services. In the TODO application, it's the straight forward to get, update and delete the items from backend database. Amazon DynamoDB is a key-value database, it fits for this scenario with scalability and optimized pay-as-you-go cost. Also Amazon API Gateway has built-in integration with AWS serivces, the restful API can be transformed to the request to DynamoDB APIs. Using this combination you can provide the restful APIs only provisioning AWS resources without writing the CRUD code!\nLet's assume the TODO application having below model to represent the TODO items,\n1{ 2\u0026#34;subject\u0026#34;: \u0026#34;my-memo\u0026#34;, // some subject of TODO item 3\u0026#34;description\u0026#34;: \u0026#34;the great idea\u0026#34;, // some description for the TODO item 4\u0026#34;dueDate\u0026#34;: 1661926828, // the timestamp of sceonds for the due date of TODO item 5} Then define below restful APIs for list, fetch, update and delete TODO item/items.\nCreate new TODO item 1PUT /todo Update a TODO item 1POST /todo/\u0026lt;todo id\u0026gt; Delete a TODO item 1DELETE /todo/\u0026lt;todo id\u0026gt; List TODO items 1GET /todo All magic with no code restful API of API Gateway is setting up data transformations for REST API.\nBelos is using the Apache VTL to transform the request JSON payload to DynamoDB UpdateItem API request.\nAlso using API Gateway's transformation feature of the response of integration(DynamoDB API in this case) to shape the response like below,\nThere are few best practise of using API Gateway and AWS services integration to simplify the CRUD operations,\nuse request validator to validate the request payload use integration response to handle with the error cases of integration services. Below is an example checking the error message of DynamoDB API then reshape the error message 1#if($input.path(\u0026#39;$.__type\u0026#39;) == \u0026#34;com.amazonaws.dynamodb.v20120810#ConditionalCheckFailedException\u0026#34;) 2{ 3 \u0026#34;message\u0026#34;: \u0026#34;the todo id already exists.\u0026#34; 4} 5#end sanity all string inputs from client via API Gateway built-in $util method $util.escapeJavaScript() to avoid NoSQL injection attack response valid json if the string contains signle quotes(') 1\u0026#34;subject\u0026#34;: \u0026#34;$util.escapeJavaScript($input.path(\u0026#39;$.Attributes.subject.S\u0026#39;)).replaceAll(\\\u0026#34;\\\\\\\\\u0026#39;\\\u0026#34;,\\\u0026#34;\u0026#39;\\\u0026#34;)\u0026#34; As usual, all AWS resources are orchestrated by AWS CDK project, it's easliy to be deployed to any account and any region of AWS!\nHappying ðŸ‘¨â€ðŸ’» API \u0026#x1f606;\u0026#x1f606;\u0026#x1f606;\n","link":"https://kane.mx/posts/2022/build-serverless-app-on-aws/restful-api/","section":"posts","tags":["Serverless","AWS","API Gateway","DynamoDB","AWS CDK"],"title":"Build no code restful HTTP API with API Gateway and DynamoDB"},{"body":"","link":"https://kane.mx/tags/dynamodb/","section":"tags","tags":null,"title":"DynamoDB"},{"body":"Building web application is a common use case, leveraging cloud services could accelerate the builders to develop and deploy the services. With AWS serverless services, the application can easily get the capabilities like security, highly availability, scalability, resiliency and cost optimized.\nThis is a series posts to demonstrate how building a serverless TODO web application on AWS with AWS serverless services and AWS CDK, it consists of,\nRestful HTTP APIs, use Amazon API Gateway and Amazon DynamoDB Securely and accelerately distribute the static website via Amazon CloudFront and Amazon S3 Authentication and Authorization via Amazon Cognito and AWS Amplify Federated OIDC authentication with Amazon Cognito CI/CD DevOps pipeline source code written by AWS CDK to archive above features ","link":"https://kane.mx/posts/2022/build-serverless-app-on-aws/intro/","section":"posts","tags":["Serverless","AWS"],"title":"Build serverless web application with AWS Serverless"},{"body":"","link":"https://kane.mx/tags/cd/","section":"tags","tags":null,"title":"CD"},{"body":"","link":"https://kane.mx/tags/continuous-delivery/","section":"tags","tags":null,"title":"Continuous Delivery"},{"body":"","link":"https://kane.mx/tags/debugging/","section":"tags","tags":null,"title":"Debugging"},{"body":"","link":"https://kane.mx/tags/flux/","section":"tags","tags":null,"title":"Flux"},{"body":"After enabling E2E testing of FluxCD powered GitOps continuous deployment, the feedback of new commits are quite slow. Because you have to wait for the E2E testing result, lots of time cost on setuping the environment and provisioning your development from scrath.\nInspired by E2E testing in Github actions, the DevOps engineers can build local debugging environment in Kind or minikube.\nBelow is a script how using Kind to provision FluxCD then reconciling the latest commits by FluxCD.\n","link":"https://kane.mx/posts/gitops/fluxcd-local-debug-tip/","section":"posts","tags":["Flux","GitOps","Kubernetes","Git","CD","Continuous Delivery","Debugging"],"title":"FluxCD GitOps debugging tip"},{"body":"","link":"https://kane.mx/tags/git/","section":"tags","tags":null,"title":"Git"},{"body":"","link":"https://kane.mx/series/gitops/","section":"series","tags":null,"title":"Gitops"},{"body":"","link":"https://kane.mx/tags/gitops/","section":"tags","tags":null,"title":"GitOps"},{"body":"","link":"https://kane.mx/tags/kubernetes/","section":"tags","tags":null,"title":"Kubernetes"},{"body":"","link":"https://kane.mx/categories/kubernetes/","section":"categories","tags":null,"title":"Kubernetes"},{"body":"","link":"https://kane.mx/tags/aws-secrets-manager/","section":"tags","tags":null,"title":"AWS Secrets Manager"},{"body":"","link":"https://kane.mx/tags/eks/","section":"tags","tags":null,"title":"EKS"},{"body":"","link":"https://kane.mx/tags/external-secrets-operator/","section":"tags","tags":null,"title":"External Secrets Operator"},{"body":"èƒŒæ™¯ å¯†é’¥çš„ç®¡ç†å¯¹äºŽä½¿ç”¨ GitOps æ–¹å¼åšæŒç»­å‘å¸ƒæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ï¼Œç‰¹åˆ«æ˜¯å½“ç›®æ ‡éƒ¨ç½²å¹³å°æ˜¯ Kubernetes çš„æ—¶å€™ã€‚ K8S ä½¿ç”¨å£°æ˜Žå¼é…ç½®ç®¡ç†æœ€ç»ˆçŠ¶æ€ï¼Œè€ŒK8Sä¸­çš„å¯†é’¥ä»…ä»…æ˜¯å°†å¯†é’¥å†…å®¹åšäº†base64æ ¼å¼çš„ç¼–ç ã€‚ åœ¨åŸºäºŽ Flux çš„ GitOps å®žæˆ˜ä»‹ç»äº†ä½¿ç”¨Bitnami Sealed SecretsåŠ å¯†å¯†é’¥å†…å®¹ï¼Œ å¯ä»¥å®‰å…¨çš„å°†åŠ å¯†åŽçš„Kubernetes Manifestæ–‡ä»¶æäº¤åˆ°Gitä»£ç ä»“åº“ï¼Œç”±Sealed Secretså‘çŽ°è¿™äº›SealedSecretçš„å¯†ç ï¼Œ å¹¶è§£å¯†åŽåŠ¨æ€çš„åˆ›å»ºK8SåŽŸç”ŸSecretså¯¹è±¡ã€‚\nSealedSecret è§£å†³äº†å¦‚ä½•åœ¨ Git ä»£ç ä»“åº“ä¸­å®‰å…¨çš„ä¿å­˜å¯†é’¥çš„ç—›ç‚¹ï¼Œä½†æ˜¯è¯¥æ–¹å¼ä»ç„¶éœ€è¦ç³»ç»Ÿç®¡ç†å‘˜è‡ªè¡Œçš„å¦¥å–„ä¿å­˜ SealedSecret ä½¿ç”¨çš„ç§é’¥ï¼Œä»¥åŠå¦‚ä½•ä»Žç¾éš¾ä¸­æ¢å¤çš„åœºæ™¯ã€‚æ­¤å¤–ï¼Œæ•´ä¸ªå¯†é’¥çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†åœ¨K8Sé›†ç¾¤å†…éƒ¨ï¼Œ æ— æ³•è®©é›†ç¾¤å¤–çš„å·¥ä½œè´Ÿè½½å®‰å…¨æœ‰æ•ˆçš„ä½¿ç”¨è¿™äº›å¯†é’¥ï¼Œä¾‹å¦‚ï¼Œäº‘åŽ‚å•†ä¸Šæ‰˜ç®¡çš„ RDS ç±»åž‹æ•°æ®åº“ã€‚\nä½¿ç”¨å¤–éƒ¨å¯†é’¥æœåŠ¡ç®¡ç†K8Så¯†é’¥ åœ¨ CNCF åŸºé‡‘ä¼šåœ¨2021å¹´åšçš„ä¸€ä»½å…³äºŽå¯†é’¥ç®¡ç†çš„æŠ€æœ¯é›·è¾¾æŠ¥å‘Šä¸ŠæŒ‡å‡ºï¼Œ AWS Secrets Manager, HashiCorp Vault è¢«åˆ—ä¸ºæˆç†Ÿçš„å¯†é’¥ç®¡ç†æœåŠ¡æˆ–æ–¹æ¡ˆã€‚ å¦‚æžœå¯ä»¥åœ¨ Kubernetes ä¸­ä½¿ç”¨è¿™äº›æˆç†Ÿçš„å¯†é’¥æœåŠ¡æˆ–æ–¹æ¡ˆæ¥ç®¡ç†å¯†é’¥å°†å¯ä»¥åŒæ—¶èŽ·å¾—å¯†é’¥æœåŠ¡å®‰å…¨åŠŸèƒ½å¼ºå¤§å’Œ Kubernetes ä»»åŠ¡ç¼–æŽ’çš„å¤šé‡æ”¶ç›Šã€‚\nå›¾1ï¼šCNCF End User Technology Radar, Secret Management, February 2021 External Secrets Operator(ESO) é’ˆå¯¹ä»¥ä¸Šä¸è¶³ä¹‹å¤„ï¼ŒæŽ¥ä¸‹æ¥ä»‹ç»çš„ External Secrets Operator å°†æŒ‰è¿™ä¸ªæ€è·¯è§£å†³è¿™äº›é—®é¢˜ã€‚\nExternal Secrets Operator æ˜¯ä¸€ä¸ª Kubernetes Operatorï¼Œå®ƒé›†æˆäº†å¤–éƒ¨å¯†é’¥ç®¡ç†ç³»ç»Ÿï¼Œ ä¾‹å¦‚ AWS Secrets Managerã€HashiCorp Vaultã€Google Secrets Managerã€Azure Key Vault ç­‰ç­‰ã€‚ ä»–ä½¿ç”¨å¤–éƒ¨å¯†é’¥ç®¡ç†æœåŠ¡çš„ API è¯»å–ä¿¡æ¯å¹¶è‡ªåŠ¨å°†å€¼æ³¨å…¥ Kubernetes Secretã€‚\nä»¥ä¸Šæ˜¯ External Secrets Operator çš„ç®€ä»‹ï¼Œçœ‹äº†ä»¥åŽæ˜¯ä¸æ˜¯è§‰å¾—ç‰¹åˆ«çœ¼ç†Ÿã€‚ä»–è·ŸåŒæ—¶ CNCF ä¸‹å¦ä¸€ä¸ª DNS è§£æžæœåŠ¡External DNSéžå¸¸çš„ç±»ä¼¼ï¼Œä¸º Kubernetes å†…çš„åŸŸåè§£æžæ³¨å†Œæä¾›ç»Ÿä¸€çš„å®žçŽ°ä½“éªŒï¼Œ åŒå…¶ä»–ä¼—å¤šç¬¬ä¸‰æ–¹æˆç†Ÿçš„ DNS è§£æžé›†æˆã€‚\nä¸‹é¢å°†ä»‹ç»å¦‚ä½•åœ¨ä½¿ç”¨ FluxCD ç®¡ç† External Secrets Operatorï¼Œä»¥åŠåœ¨ EKS ä¸­ä½¿ç”¨ AWS Secrets Manager ç®¡ç†çš„å¯†é’¥ã€‚\nFluxCD éƒ¨ç½² External Secrets Operator External Secrets Operator æ”¯æŒä½¿ç”¨ Helm å®‰è£…ï¼ŒFlux éƒ¨ç½² ESO åŒå®‰è£…å…¶ä»– Helm Chart ç±»ä¼¼ã€‚\nåŠ å…¥ ESO çš„ Helm ä»“åº“ 1apiVersion: source.toolkit.fluxcd.io/v1beta1 2kind: HelmRepository 3metadata: 4 name: external-secrets 5spec: 6 interval: 10m 7 url: https://charts.external-secrets.io é€šè¿‡ HelmRelease éƒ¨ç½² ESO 1apiVersion: helm.toolkit.fluxcd.io/v2beta1 2kind: HelmRelease 3metadata: 4 name: external-secrets 5spec: 6 # Override Release name to avoid the pattern Namespace-Release 7 # Ref: https://fluxcd.io/docs/components/helm/api/#helm.toolkit.fluxcd.io/v2beta1.HelmRelease 8 releaseName: external-secrets 9 targetNamespace: kube-system 10 interval: 10m 11 chart: 12 spec: 13 chart: external-secrets 14 sourceRef: 15 kind: HelmRepository 16 name: external-secrets 17 namespace: kube-system 18 values: 19 installCRDs: true 20 serviceAccountName: helm-controller 21 timeout: 5m 22 test: 23 enable: true 24 ignoreFailures: true 25 install: 26 crds: CreateReplace 27 remediation: 28 retries: 3 29 upgrade: 30 crds: CreateReplace 31 remediation: 32 remediateLastFailure: false ä¸º ESO åˆ›å»ºé…ç½® IRSA EKS é€šè¿‡IRSAå°† K8S å†… RBAC çš„ ServiceAccount åŒ IAM role ç»Ÿä¸€åœ¨ä¸€èµ·ï¼Œ å¯ä»¥è®©K8Så†…çš„å·¥ä½œè´Ÿè½½é€šè¿‡åŽŸç”Ÿçš„ ServiceAccount ç»‘å®š IAM Roleï¼Œæ— éœ€æ˜¾ç¤ºçš„æŒ‡å®š AccessKey/Secret æ¥è®¿é—® AWS APIã€‚\nå› ä¸º ESO å¿…é¡»é€šè¿‡ AWS API è®¿é—®è¯»å–ä¿å­˜åœ¨ AWS Secrets Manager ä¸­çš„å¯†é’¥ã€‚æ‰€ä»¥éœ€è¦ä¸º ESO é…ç½® AWS è®¿é—®å¯†é’¥æˆ–ä½¿ç”¨ IRSA æ”¯æŒã€‚\næ ¹æ® ESO æ–‡æ¡£å»ºè®®çš„ AWS Secrets Manager æƒé™åˆ›å»º IAM Policy 1{ 2 \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, 3 \u0026#34;Statement\u0026#34;: [ 4 { 5 \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, 6 \u0026#34;Action\u0026#34;: [ 7 \u0026#34;secretsmanager:GetResourcePolicy\u0026#34;, 8 \u0026#34;secretsmanager:GetSecretValue\u0026#34;, 9 \u0026#34;secretsmanager:DescribeSecret\u0026#34;, 10 \u0026#34;secretsmanager:ListSecretVersionIds\u0026#34; 11 ], 12 \u0026#34;Resource\u0026#34;: [ 13 \u0026#34;arn:aws:secretsmanager:us-west-2:111122223333:secret:dev/*\u0026#34; # æ›¿æ¢ region, accountid, å¯†é’¥çš„åç§°å‰ç¼€ 14 ] 15 } 16 ] 17} ä½¿ç”¨eksctlå·¥å…·ä¸º EKS é›†ç¾¤åˆ›å»ºESOéœ€è¦çš„ Role åŠç»‘å®š ESO éœ€è¦çš„æƒé™ï¼Œä¾‹å¦‚ï¼Œ 1eksctl create iamserviceaccount --cluster=gitops-cluster --name=external-secrets \\ 2--role-only --role-name=gitops-cluster-dev-external-secrets-role --region ap-southeast-1 \\ 3--namespace=kube-system --attach-policy-arn=arn:aws:iam::123456789012:policy/gitops-dev-external-secrets-sm \\ 4--approve namespaceéœ€è¦è·ŸESOéƒ¨ç½²çš„å‘½ä»¤ç©ºé—´ä¿æŒä¸€è‡´\nname éœ€è¦è·Ÿéƒ¨ç½² ESO Chart æŒ‡å®šçš„ ServiceAccount åç§°ä¸€è‡´ï¼Œé»˜è®¤ä¸º external-secrets\nä½¿ç”¨ Kustomization patch ä¸º ESO Chart åˆ›å»ºçš„ ServiceAccount æŒ‡å®š IAM role 1apiVersion: kustomize.config.k8s.io/v1beta1 2kind: Kustomization 3resources: 4 - ../../base 5 - ./secrets.yaml 6patches: 7 - patch: | 8 - op: add 9 path: /spec/patches/- 10 value: 11 patch: | 12 - op: add 13 path: /spec/values/serviceAccount/annotations/eks.amazonaws.com~1role-arn 14 value: arn:aws:iam::845861764576:role/gitops-cluster-dev-external-secrets-role 15 target: 16 kind: HelmRelease 17 name: external-secrets 18 target: 19 group: kustomize.toolkit.fluxcd.io 20 version: v1beta2 21 kind: Kustomization 22 name: external-secrets åˆ›å»º SecretStore æˆ– ClusterSecretStore é…ç½®è®¿é—® AWS Secrets Manager 1apiVersion: external-secrets.io/v1beta1 2kind: ClusterSecretStore 3metadata: 4 name: secretstore 5 namespace: kube-system 6spec: 7 provider: 8 aws: 9 service: SecretsManager 10 region: ap-southeast-1 11 auth: 12 jwt: 13 serviceAccountRef: 14 name: external-secrets 15 namespace: kube-system ä¸Šé¢çš„é…ç½®ä½¿ç”¨äº† ServiceAccount çš„çŸ­æ—¶é—´æœ‰æ•ˆæœŸ JWT token è®¿é—® AWS APIï¼Œé¿å…äº†åœ¨é›†ç¾¤å†…ç®¡ç†ä¿å­˜ AWS è®¿é—®å‡­è¯ã€‚\nåˆ›å»º ExternalSecret å¯¹è±¡ä»Ž Secrets Manager èŽ·å–å¯†é’¥å¹¶é…ç½®åˆ° K8S çš„ Secret å¯¹è±¡ 1apiVersion: external-secrets.io/v1beta1 2kind: ExternalSecret 3metadata: 4 name: slack-url 5 namespace: kube-system 6spec: 7 refreshInterval: 1h 8 secretStoreRef: 9 name: secretstore 10 kind: ClusterSecretStore 11 target: 12 name: slack-url 13 creationPolicy: Owner 14 deletionPolicy: Delete 15 data: 16 - secretKey: address 17 remoteRef: 18 key: dev/slackurl å¦‚ä¸Šçš„ ExternalSecret å¯¹è±¡å£°æ˜Žäº†åœ¨ kube-system å‘½ä»¤ç©ºé—´åˆ›å»ºåä¸º slack-url çš„å¯†é’¥ã€‚ESOä¼šé€šè¿‡åä¸º secretstore çš„ ClusterSecretStore å¯¹è±¡èŽ·å– AWS Secrets Manager è®¿é—®å‡­è¯ï¼Œå°†åä¸º dev/slackurl çš„ AWS Secrets Manager å¯†é’¥å†…å®¹è®¾ç½®åˆ° K8S Secret slack-url çš„ address é”®å€¼ã€‚\nç¡®ä¿ FluxCD åˆ›å»º ESO èµ„æºçš„é¡ºåº å¦‚ä¸Šéƒ¨ç½²é€šè¿‡ Helm éƒ¨ç½²äº† ESOï¼Œé€šè¿‡ ESO è‡ªå®šä¹‰èµ„æºåˆ›å»ºäº† ClusterSecretStore å’Œ ExternalSecret åˆ›å»ºå¯†é’¥ã€‚ è¿™äº›èµ„æºé€šè¿‡ä¸åŒçš„ Flux æŽ§åˆ¶å™¨(Kustomizationæˆ–Helm)æ‰€åˆ›å»ºï¼Œè¿™äº›èµ„æºå¯ç”¨çš„é¡ºåºæ²¡æœ‰åŠžæ³•ä¿è¯å…ˆåŽé¡ºåºã€‚ä½†æ˜¯ ESO çš„è‡ªå®šä¹‰èµ„æºå¯¹è±¡å£°æ˜Žï¼ˆå¦‚ClusterSecretStoreï¼‰ä¾èµ– ESO å®Œæ•´çš„éƒ¨ç½²åˆ›å»ºè‡ªå®šä¹‰èµ„æºå£°æ˜Žã€‚è¿™é‡Œé€šè¿‡åµŒå¥—çš„ Flux Kustomization å¯¹è±¡æ¥ç®¡ç†ä¸åŒå¯¹è±¡é—´çš„ä¾èµ–ã€‚ç¤ºä¾‹å®žçŽ°å¦‚ä¸‹ï¼Œ\n1apiVersion: kustomize.toolkit.fluxcd.io/v1beta2 2kind: Kustomization 3metadata: 4 name: secrets 5 namespace: flux-system 6spec: 7 interval: 10m0s 8 path: ./infrastructure/overlays/development/secrets 9 prune: true 10 dependsOn: 11 - name: sealed-secrets 12 - name: external-secrets 13 sourceRef: 14 kind: GitRepository 15 name: flux-system ESO Examples æ–‡æ¡£ä¹Ÿè¯¦ç»†è§£é‡Šäº† FluxCD ä¸­çš„è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”ç¤ºä¾‹äº†è§£å†³æ–¹æ³•ã€‚\nå°ç»“ æœ¬æ–‡ä»‹ç»äº† External Secrets Operator å°†æˆç†Ÿä¸”ç»è¿‡éªŒè¯çš„å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆå¦‚ AWS Secrets Managerï¼‰å¼•å…¥åˆ° Kubernetes åŽŸç”Ÿç”Ÿæ€ã€‚ ç”¨æˆ·å¯ä»¥ä¿ç•™ä½¿ç”¨è¿™äº›å¯†é’¥æœåŠ¡çš„æœ€ä½³å®žè·µå’Œç»éªŒï¼ŒåŒæ—¶è®© K8S ç¼–æŽ’çš„ä»»åŠ¡ä¹Ÿæ— éœ€æ”¹åŠ¨ä»ç„¶ä½¿ç”¨äº‘åŽŸç”Ÿçš„æ–¹å¼è®¿é—®å¯†é’¥ã€‚ æ•´ä¸ªæ–¹æ¡ˆå…¼å®¹äº†å®‰å…¨æˆç†Ÿçš„å¯†é’¥ç®¡ç†åŒ K8S å†…ç¨‹åºè®¿é—®å¯†é’¥çš„éœ€æ±‚ã€‚\néšåŽç®€çŸ­çš„ç¤ºä¾‹äº†å¦‚ä½•åœ¨ EKS çŽ¯å¢ƒæœ€ä½³å®žè·µçš„ç®¡ç† ESO éƒ¨ç½²ï¼ŒåŒæ—¶ç¤ºä¾‹äº†å¦‚ä½•ä½¿ç”¨ FluxCD GitOps æ–¹å¼åŒæ—¶ç®¡ç† ESO éƒ¨ç½²å’Œå¤–éƒ¨å¯†é’¥ã€‚ å®Œæ•´çš„ä»£ç ç¤ºä¾‹å¯ä»¥è¿™ä¸ªä»“åº“èŽ·å–ã€‚\nå¦‚æžœç”¨æˆ·æœ‰éœ€æ±‚é€šè¿‡æ–‡ä»¶è®¿é—® AWS Secrets Manager çš„å¯†é’¥ï¼Œå¯ä»¥ä½¿ç”¨ AWS å¼€æºçš„ AWS Secrets Manager and Config Provider for Secret Store CSI Driver, è¿™ä¸ªé¡¹ç›®å°† Secrets Manager/Parameter Store é€šè¿‡ CSI Driver æŒ‚è½½åˆ°å®¹å™¨ï¼Œæä¾›æ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®ã€‚\n","link":"https://kane.mx/posts/gitops/manage-k8s-secrets-in-external-secrets-manager/","section":"posts","tags":["External Secrets Operator","AWS Secrets Manager","Flux","GitOps","Kubernetes","Git","EKS","CD","Continuous Delivery"],"title":"ä½¿ç”¨å¤–éƒ¨Secrets Managerç®¡ç†Kuberneteså¯†é’¥"},{"body":"","link":"https://kane.mx/tags/crossplane/","section":"tags","tags":null,"title":"Crossplane"},{"body":"èƒŒæ™¯ åœ¨Flux éƒ¨ç½²å®žæˆ˜çš„æ€»ç»“å±•æœ›ä¸­æœ‰ä¸€ä¸ªæ–¹å‘æ˜¯å¦‚ä½•å°†äº‘ä¸ŠåŸºç¡€è®¾æ–½èµ„æºåŒKuberneteså†…èµ„æºç»Ÿä¸€ç®¡ç†ï¼Œ è€ŒCrossplaneæä¾›äº†ä¸€ä¸ªé«˜åº¦å¯æ‰©å±•çš„åŽç«¯ï¼Œä½¿ç”¨å£°æ˜Žå¼ç¨‹åºåŒæ—¶ç¼–æŽ’åº”ç”¨ç¨‹åºå’ŒåŸºç¡€è®¾æ–½ï¼Œä¸ç”¨å…³å¿ƒå®ƒä»¬åœ¨å“ªé‡Œè¿è¡Œã€‚\nè¿‘æœŸ AWS å®˜æ–¹åšå®¢å®£å¸ƒäº† AWS Blueprints for Crossplaneï¼Œä¸ºå®¢æˆ·æä¾›äº†åœ¨ Amazon EKS ä¸Šåº”ç”¨ Crossplane çš„å‚è€ƒå®žçŽ°ã€‚\nAWS Blueprints for Crossplane AWS Blueprints for Crossplane æ˜¯ä¸€ä¸ª Github ä¸Šå¼€æºé¡¹ç›®ï¼Œå®ƒæä¾›äº†å¦‚ä¸‹å‚è€ƒæž¶æž„åŠåŠŸèƒ½ï¼Œ\nâœ… ä½¿ç”¨Terraform åˆ›å»º Amazon EKS é›†ç¾¤å¹¶éƒ¨ç½²Crossplane âœ… ä½¿ç”¨eksctl åˆ›å»º Amazon EKS é›†ç¾¤å¹¶éƒ¨ç½²Crossplane âœ… AWS Provider- Crossplane Compositions for AWS Services âœ… Terrajet AWS Provider - Another Crossplane Compositions for AWS Services âœ… AWS IRSA on EKS - AWS Provider Config with IRSA enabled âœ… ä½¿ç”¨ AWS Provider å’Œ Terrajet AWS Provider çš„ Composite Resources (XRs)ç¤ºä¾‹éƒ¨ç½²æ¨¡å¼ âœ… ä½¿ç”¨Crossplane Managed Resources (MRs) çš„ç¤ºä¾‹éƒ¨ç½² éƒ¨ç½² Crossplane EKS Crossplane å‚è€ƒè“å›¾ç¤ºä¾‹äº†å¦‚ä½•ä½¿ç”¨ Terraform(é€šè¿‡Amazon EKS Blueprints for Terraform) å’Œ eksctl éƒ¨ç½² EKS é›†ç¾¤åŠéƒ¨ç½² Crossplaneï¼Œ æœ¬æ–‡å°†æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Flux æŒ‰ç…§ GitOps æ–¹å¼éƒ¨ç½²ç®¡ç† Crossplaneï¼Œæ¼”ç¤ºå°†æ²¿ç”¨ Flux å®žæˆ˜ æ‰€ä½¿ç”¨çš„ç¤ºä¾‹repoã€‚\næ‰‹åŠ¨éƒ¨ç½² Crossplane æŒ‰ç…§ Crossplane éƒ¨ç½²æ–‡æ¡£ï¼ŒCrossplane åœ¨ EKS ä¸Šçš„éƒ¨ç½²åˆ†ä¸ºä¸‹é¢ä¸‰æ­¥ï¼Œ\né€šè¿‡ Helm éƒ¨ç½² Crossplane chart ç”±äºŽ Crossplane å¤§é‡é€šè¿‡ CRD ä½¿ç”¨æ‰©å±•æ€§ï¼Œéœ€è¦åœ¨ Crossplane ç»„ä»¶éƒ¨ç½²æˆåŠŸåŽï¼Œ é€šè¿‡ Crossplane pkg CRD éƒ¨ç½²åŠé…ç½®å¯¹åº”çš„ Providerï¼Œå¦‚åœ¨ AWS ä¸Šç®¡ç† AWS Provider æˆ– Terrajet AWS Provider AWS Provider æˆ– Terrajet AWS Provider æ˜¯é€šè¿‡ pkg CRD å¼‚æ­¥éƒ¨ç½²çš„ï¼Œéœ€è¦ç­‰ Provider CRD å¯ç”¨åŽï¼Œæ‰å¯éƒ¨ç½²å¯¹åº”çš„ Provider Config é€šè¿‡ Flux å®žçŽ° GitOps éƒ¨ç½² Crossplane é‰´äºŽ Crossplane éƒ¨ç½²ä¸‰ä¸ªæ­¥éª¤çš„å¼ºä¾èµ–æ€§ï¼Œæ‰€ä»¥ä½¿ç”¨ Flux éƒ¨ç½²é€šè¿‡ Kustomization dependencies åŠŸèƒ½å®žçŽ°ä¸‰éƒ¨åˆ†èµ„æºåˆ›å»ºçš„å…ˆåŽä¾èµ–ã€‚\n1. éƒ¨ç½² Crossplane Helm chart å¦‚ä¸‹ manifest åˆ›å»º Crossplane helm release kustomizationï¼Œ é€šè¿‡healthChecksæ£€æŸ¥ç¡®ä¿ Crossplane ç»„ä»¶éƒ¨ç½²æˆåŠŸåŽæ‰å°† kustomization è®¾ç½®ä¸º reconcilation æˆåŠŸã€‚\n1apiVersion: kustomize.toolkit.fluxcd.io/v1beta2 2kind: Kustomization 3metadata: 4 name: crossplane 5 namespace: flux-system 6spec: 7 interval: 10m0s 8 path: ./infrastructure/base/crossplane/release 9 targetNamespace: crossplane-system 10 prune: true 11 sourceRef: 12 kind: GitRepository 13 name: flux-system 14 namespace: flux-system 15 timeout: 5m 16 healthChecks: 17 - apiVersion: apps/v1 18 kind: Deployment 19 name: crossplane 20 namespace: crossplane-system é€šè¿‡ Flux Helm æ”¯æŒéƒ¨ç½² Crossplane helm release\n1apiVersion: helm.toolkit.fluxcd.io/v2beta1 2kind: HelmRelease 3metadata: 4 name: crossplane 5 namespace: crossplane-system 6spec: 7 releaseName: crossplane 8 targetNamespace: crossplane-system 9 chart: 10 spec: 11 chart: crossplane 12 version: \u0026#34;1.8.0\u0026#34; 13 sourceRef: 14 kind: HelmRepository 15 name: crossplane-stable 16 namespace: crossplane-system 17 serviceAccountName: helm-controller 18 timeout: 5m 19 test: 20 enable: true 21 ignoreFailures: true 22 interval: 1h0m0s 23 install: 24 crds: CreateReplace 25 remediation: 26 retries: 3 27 upgrade: 28 crds: CreateReplace 29 remediation: 30 remediateLastFailure: false 2. åˆ›å»º Crossplane AWS Provider Kustomization crossplane-provider å°†ä¾èµ– kustomization crossplaneï¼Œ å¹¶æ£€æŸ¥ Crossplane AWS provider è‡ªå®šä¹‰èµ„æº providerconfigs.aws.crossplane.io åˆ›å»ºæˆåŠŸä¸Žå¦ã€‚\n1apiVersion: kustomize.toolkit.fluxcd.io/v1beta2 2kind: Kustomization 3metadata: 4 name: crossplane-provider 5 namespace: flux-system 6spec: 7 interval: 10m0s 8 path: ./infrastructure/base/crossplane/provider 9 prune: true 10 sourceRef: 11 kind: GitRepository 12 name: flux-system 13 namespace: flux-system 14 dependsOn: 15 - name: crossplane 16 targetNamespace: crossplane-system 17 healthChecks: 18 - apiVersion: apiextensions.k8s.io/v1 19 kind: CustomResourceDefinition 20 name: providerconfigs.aws.crossplane.io 21 timeout: 5m 22 patches: 23 - patch: | 24 - op: replace 25 path: /metadata/annotations/eks.amazonaws.com~1role-arn 26 value: arn:aws:iam::845861764576:role/crossplane-provider-aws 27 target: 28 group: pkg.crossplane.io 29 version: v1alpha1 30 kind: ControllerConfig 3. åˆ›å»º Provider Config åŒæ ·æ–¹å¼åˆ›å»ºéƒ¨ç½² ProviderConfig èµ„æºçš„ kustomization å¯¹è±¡ï¼Œä¾èµ– crossplane-provider kustomization éƒ¨ç½²ã€‚\n1apiVersion: kustomize.toolkit.fluxcd.io/v1beta2 2kind: Kustomization 3metadata: 4 name: crossplane-provider-config 5 namespace: flux-system 6spec: 7 interval: 10m0s 8 path: ./infrastructure/base/crossplane/provider-config 9 prune: true 10 sourceRef: 11 kind: GitRepository 12 name: flux-system 13 dependsOn: 14 - name: crossplane-provider 15 timeout: 5m ä½¿ç”¨ Crossplane åˆ›å»º AWS åŸºç¡€è®¾æ–½ Crossplane æä¾›äº†ä¸¤ç§æ–¹å¼è¡¨ç¤ºå¤–éƒ¨ç³»ç»Ÿèµ„æºï¼Œ\næ‰˜ç®¡èµ„æº (MR) æ˜¯ Crossplane å¯¹å¤–éƒ¨ç³»ç»Ÿä¸­èµ„æºçš„è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼Œæœ€å¸¸è§çš„æ˜¯äº‘æä¾›å•†ã€‚å¦‚ä¸‹èµ„æºç”³æ˜Žç”± AWS Provider æ”¯æŒï¼Œåˆ›å»º AWS ä¸Šçš„ RDS æ•°æ®åº“å®žä¾‹ã€‚ 1apiVersion: database.aws.crossplane.io/v1beta1 2kind: RDSInstance Crossplane å¤åˆèµ„æº (XR)æ˜¯ç”±æ‰˜ç®¡èµ„æºç»„æˆçš„å°è£…çš„ Kubernetes è‡ªå®šä¹‰èµ„æºã€‚ å¤åˆèµ„æºæ—¨åœ¨è®©ç”¨æˆ·ä½¿ç”¨è‡ªå·±çš„è§‚ç‚¹å’Œ API æž„å»ºè‡ªå·±çš„å¹³å°ï¼Œè€Œæ— éœ€ä»Žå¤´å¼€å§‹ç¼–å†™ Kubernetes æŽ§åˆ¶å™¨ã€‚ ç›¸åï¼Œç”¨æˆ·å®šä¹‰çš„ XR æž¶æž„æ•™ä¼š Crossplane å½“æœ‰ä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„ XR æ—¶å®ƒåº”è¯¥ç»„æˆï¼ˆå³åˆ›å»ºï¼‰å“ªäº›æ‰˜ç®¡èµ„æºã€‚ AWS Blueprints for Crossplane æä¾›äº† Compositions ç¤ºä¾‹ï¼Œæ¶µç›–äº† VPCï¼ŒS3ï¼ŒIAMï¼ŒRDSï¼ŒDynamoDBï¼ŒEKS ç­‰æœåŠ¡ã€‚ å¦‚å‰é¢ä»‹ç» Crossplane Compositions(XRs) æ˜¯å¯¹åŸºç¡€è®¾æ–½çš„æ¨¡å¼å°è£…å’Œç»„åˆï¼Œå¹¶ä¸ä¼šç›´æŽ¥åˆ›å»ºäº‘åŽŸç”Ÿèµ„æºã€‚\nAWS Blueprints for Crossplane åŒæ—¶æä¾›äº† Examples ç¤ºä¾‹ ç›´æŽ¥ä½¿ç”¨ AWS Provider æä¾›çš„æ‰˜ç®¡èµ„æº (MR) å’Œç¤ºä¾‹çš„å¤åˆèµ„æº (XR)ï¼Œå¦‚ä¸ŠCompositionsä¸­ç¤ºä¾‹VPCï¼ŒS3, DynamoDBç­‰AWSèµ„æºã€‚\nå°ç»“åŠå±•æœ› Crossplane ç›®å‰æ˜¯ CNCF åŸºé‡‘ä¼šä¸‹å­µåŒ–ä¸­é¡¹ç›®ï¼Œä¸€å®šç¨‹åº¦å¯ä»¥å®žçŽ°äº‘ä¸ŠåŸºç¡€è®¾æ–½èµ„æºå’Œ Kubernetes å†…èµ„æºç»Ÿä¸€ä½¿ç”¨å£°æ˜Žå¼æ–¹å¼ç®¡ç†ã€‚ å¤åˆèµ„æº (Composite Resources) æ”¯æŒäº†å¯¹ä¸šåŠ¡éœ€æ±‚çš„é«˜å±‚æ¬¡æŠ½è±¡ï¼Œç†å¿µåŒ Construct Hub ç±»ä¼¼ã€‚ åŸºç¡€å®žæ–½å›¢é˜Ÿå¯ä»¥é€šè¿‡å¤åˆèµ„æºæä¾›é«˜é˜¶æŠ½è±¡ï¼Œå¤ç”¨ç»è¿‡éªŒè¯ä¸”ç¬¦åˆç®¡ç†éœ€æ±‚çš„æŠ½è±¡ç»„åˆï¼Œç®€åŒ–ä¸‹æ¸¸å›¢é˜Ÿç®¡ç†èµ„æºçš„å¤æ‚åº¦ã€‚\nCrossplane è‡ªèº«åˆ©ç”¨ K8S CRD åˆ›å»ºç®¡ç† Composite Resourcesï¼Œé¦–å…ˆéœ€è¦ç”¨æˆ·ç†Ÿæ‚‰ CRD çš„å®žçŽ°ã€‚ XRs æœ¬è´¨æ˜¯é€šè¿‡å£°æ˜Žå¼æ–¹å¼ç®¡ç†äº‘åŽŸç”ŸåŸºç¡€è®¾æ–½ï¼ŒåŒæ · AWS CloudFormation æ˜¯ç”± AWS åŽŸç”Ÿæä¾›çš„é€šè¿‡å£°æ˜Žå¼æ–¹å¼ç®¡ç† AWS ä¸Šèµ„æºã€‚ ç”±äºŽäº‘åŽŸç”Ÿèµ„æºçš„åŠŸèƒ½å¤æ‚æ€§ï¼ŒCloudFormation é¢ä¸´çš„ç¼–å†™å¤æ‚å£°æ˜Žå¼ä»£ç ï¼Œä¸æ˜“äºŽæµ‹è¯•å’Œå¤ç”¨çš„é—®é¢˜åŒæ ·åœ¨ Crossplane XRs ä¸Šå­˜åœ¨ã€‚ åŒæ—¶é¢å¯¹æ•°é‡åºžå¤§çš„ AWS æˆ–å…¶ä»–äº‘åŽ‚å•†åŽŸç”ŸæœåŠ¡èµ„æºï¼Œéœ€è¦å¤§é‡çš„ç¤¾åŒºèµ„æºæ¥åˆ›å»ºç®¡ç† AWS å¯å¤ç”¨çš„å¤åˆèµ„æºæ¨¡å¼ï¼Œ å¯ä»¥é¢„è§åœ¨ç›¸å½“ä¸€æ®µæ—¶é—´å†…äº‘åŽ‚å•†æ‰˜ç®¡èµ„æºè¦†ç›–çŽ‡åŠé«˜é˜¶çš„å¤åˆèµ„æºæ•°é‡éƒ½æ˜¯è¯¥æŠ€æœ¯è¢«å¹¿æ³›é‡‡çº³çš„ä¸€ä¸ªéšœç¢ã€‚\nå¯¹æ¯” AWS CDK/Pulumi ç¼–ç¨‹æ–¹å¼ç®¡ç†åˆ›å»ºçš„å¤ç”¨èµ„æºå’Œæ›´é«˜é˜¶çš„æŠ½è±¡ï¼Œ Crossplane åœ¨å¼€å‘å’Œå¤ç”¨æ•ˆçŽ‡ä¸Šå¹¶æ²¡æœ‰ä¼˜åŠ¿ã€‚ Crossplane æœ€å¤§çš„ä¼˜åŠ¿æ˜¯å¯é€šè¿‡ç»Ÿä¸€ Kubernetes å£°æ˜Žå¼æ–¹å¼æ¥ç®¡ç†äº‘ä¸Šèµ„æºå’Œ Kubernetes é›†ç¾¤å†…èµ„æºã€‚ ä½†å¯¹ç”¨æˆ·è€Œè¨€é‡‡ç”¨ Crossplane çš„å­¦ä¹ æˆæœ¬å’Œå¼€å‘å¤æ‚åº¦è¾ƒé«˜ï¼ŒCrossplane åŠç±»ä¼¼æŠ€æœ¯å¯åˆ—ä¸ºæŒç»­è¯„ä¼°è°ƒç”¨ä¸­ï¼Œå°é‡è°¨æ…Žç”¨äºŽç”Ÿäº§çŽ¯å¢ƒã€‚\n","link":"https://kane.mx/posts/gitops/crossplane-meets-gitops/","section":"posts","tags":["Crossplane","Flux","GitOps","Kubernetes","Git","EKS","CD","Continuous Delivery"],"title":"åŸºäºŽ Flux çš„ GitOps ç®¡ç† Crossplane éƒ¨ç½²åŠèµ„æº"},{"body":"AWS CDK is a great abstract to accelerate managing the cloud infrastructure as code. The journey will be enjoyful with leveraging the Construct Hub to use the high level contributions from AWS partners and commnunity.\nUse Case AWS CloudFormation is one of the underly technologies of AWS CDK to manage the cloud infrastructure. It easily to enable the IT administrators even business operators whom has no/limited developer skills to develop the end-to-end solutions with one-click user experience.\nSo it's a use case for effectively developing the Cloud Application via AWS CDK, then publishing it as CloudFormation template with better user experimental experience.\ncdk synth command CDK has a built-in capability to synthesize its application to CloudFormation templates, as known as the cdk synth command. You can upload the syntheized output templates to Amazon S3 bucket, then deploy it via AWS CloudFormation. Looks like it's quite easy to publish the CDK application as CloudFormation templates.\nWhy cdk synth does not work However above procedure is not working in most case while orchestrating a large application in cloud. Due to the CDK applications probably contains assets which need be uploaded to S3 and ECR before deploying the application. For example, a CDK application with using Node.js Function, Python Function, S3 Deployment, Docker Image Assets and so on will be synthesized to the templates that are not deployable directly. It requires to publish those assets(both S3 and ECR assets) firstly, then deploy the templates with parameters pointing to the assets. This step is difficult to be completed manually, because the assets are named with its content hash are not readable by human being in CDK V1. CDK v2 uses the modern bootstrapping template which uses deterministic name for resources to remove the parameters, but it still depends on the assets published priorly before deploying the CloudFormation template.\ncdk-assets command Hence there is another experimental tool provided with CDK project, it's cdk-assets. cdk-assets command use the outputs of cdk synth, then publish the assets of application to S3 and ECR, and update the templates to refer to the assets in S3 and ECR. Looks like the utility perfectly fits the requirement of my use case.\ncdk-assets drawbacks But it still has some drawbacks for this solution. For some AWS services, the assets are mandatorily required from same region. It means that the Lambda code packages(reside on S3) must be from same region S3 bucket, the container images(reside on ECR) must be from same region of SageMaker training job / inference endpoint. For the applications with multiple regions support, we have to replicate above procedure in multiple times and provide multiple CloudFormation links per region like below. It means the users can not switch to another region via region selector after opening one of the links.\nCloudFormation link per region the solution cdk-bootstrapless-synthesizer There is another commnuity tool cdk-bootstrapless-synthesizer to resolve above painful perfectly. It can help synthesize a single CloudFormation template entrypoint, then deploy it to any supported regions. Also it provides a pipeline example(based on AWS CodePipeline) to publish a CDK application to CloudFormation template with multiple regions supported.\n","link":"https://kane.mx/posts/2022/publish-cdk-app-via-cloudformation/","section":"posts","tags":["AWS CDK","AWS CloudFormation","AWS","Tip"],"title":"Publish your AWS CDK applications via AWS CloudFormation templates"},{"body":"åœ¨ä¸Šç¯‡ä»‹ç»åŸºäºŽ CNCF ä¸‹çš„ GitOps å·¥å…· FluxCD v2 å®žçŽ°äº†ç®¡ç†å¤šè´¦æˆ·çš„ Kubernetes é›†ç¾¤çš„å…±äº«ç»„ä»¶ï¼ŒSecrets ä½¿ç”¨çš„æœ€ä½³å®žè·µï¼Œ GitOps æµæ°´çº¿äº‹ä»¶åŒ IM(Slack) çš„é›†æˆï¼Œä»¥åŠå¯¹ GitOps ä»£ç çš„ CI æµç¨‹ã€‚\næœ¬æ–‡å°†å›´ç»•å¦‚ä½•ä½¿ç”¨ Flux çš„å¤šç§Ÿæˆ·ç®¡ç†æœ€ä½³å®žè·µï¼Œæ‰“é€ åŸºäºŽ GitOps å·¥ä½œæµç¨‹çš„å…±äº«æœåŠ¡å¹³å°ï¼Œ å®žçŽ°ç§Ÿæˆ·(ä¸šåŠ¡/åº”ç”¨å›¢é˜Ÿ)å¯è‡ªåŠ©çš„æŒç»­éƒ¨ç½²ã€‚\nä¸€ã€åŸºäºŽ GitOps çš„å…±äº«æœåŠ¡å¹³å°è®¾å®š Kubernetes æä¾›äº†å‘½åç©ºé—´ä½œä¸ºä¸€ç§æœºåˆ¶å°†åŒä¸€é›†ç¾¤ä¸­çš„èµ„æºåˆ’åˆ†ä¸ºç›¸äº’éš”ç¦»çš„ç»„ã€‚ åŒä¸€ä¸ªé›†ç¾¤ä¸­å¤šç§Ÿæˆ·å¤šå›¢é˜Ÿçš„åº”ç”¨ç®¡ç†å°†æ²¿ç”¨ Kubernetes å†…ç½®çš„å„ç§æœºåˆ¶æ¥ä¸ºä¸åŒçš„ç§Ÿæˆ·ã€å›¢é˜Ÿæˆ–åº”ç”¨è¿›è¡Œéš”ç¦»ï¼ŒåŒ…æ‹¬ä¸”ä¸é™äºŽï¼Œ\nå‘½åç©ºé—´(Namespaces) èµ„æºé…é¢(Resource Quotas)ï¼Œé™åˆ¶åº”ç”¨çš„èµ„æºæ€»é‡ RBAC é‰´æƒï¼Œé™åˆ¶åº”ç”¨çš„æƒé™ï¼Œå¦‚å¯åˆ›å»º Ingressï¼Œä¸å¯åˆ›å»ºå¯†é’¥å¯è¯»å–æŒ‡å®šåç§°çš„å¯†é’¥ï¼Œä¸å¯åˆ›å»ºæŒä¹…å·ç­‰ ç½‘ç»œç­–ç•¥(Network Policies) åŸºäºŽ Kubernetes ä»¥ä¸Šèƒ½åŠ›ï¼Œä¸ºåŸºäºŽ GitOps çš„å…±äº«æœåŠ¡å¹³å°è®¾å®šå¦‚ä¸‹ï¼Œ\nå¹³å°å›¢é˜Ÿé€šè¿‡ä¸€ä¸ª Git ä»“åº“æ¥ç®¡ç†å¤šä¸ªè·¨ç½‘ç»œè·¨è´¦æˆ·è·¨äº‘å¹³å°çš„ Kubernetes é›†ç¾¤ï¼Œå¹³å°å›¢é˜Ÿé€šè¿‡ GitOps ç®¡ç†å¦‚ä¸‹èµ„æºï¼Œ GitOps Toolkit ç»„ä»¶ï¼Œå¦‚ Flux é›†ç¾¤å…±äº«ç»„ä»¶ï¼Œå¦‚ CNI, CSI Driver, Ingress Classï¼ŒService Accounts, CRD, DNS ç­‰ å¯è§‚æµ‹æ€§çš„å…±äº«ç»„ä»¶ï¼Œå¦‚ Log, Metrics, Trace æ¯ä¸ªç§Ÿæˆ·/å›¢é˜Ÿ/åº”ç”¨çš„åŸºç¡€èµ„æºï¼Œå¦‚ Namespaces, Resource Quotas, Open Policyï¼ŒService Accountsï¼Œå¯†é’¥ç­‰ ä¸ºé›†ç¾¤ä¸­çš„æ¯ä¸ªç§Ÿæˆ·/å›¢é˜Ÿ/åº”ç”¨ä½¿ç”¨ç‹¬ç«‹çš„ Git ä»“åº“æ¥éš”ç¦»å…¶æŒç»­éƒ¨ç½²ï¼Œå‡è®¾æœ‰åº”ç”¨åä¸º app-aï¼Œ åº”ç”¨ app-a ç›¸å…³çš„èµ„æºéƒ½å°†éƒ¨ç½²åœ¨å‘½åç©ºé—´ app-a é™åˆ¶åº”ç”¨ä½¿ç”¨çš„æ€»èµ„æºï¼Œå¦‚ä¸è¶…è¿‡ 2 vCPU, 4 GiB å†…å­˜ åº”ç”¨å›¢é˜Ÿä½¿ç”¨ç‹¬ç«‹çš„ Git ä»“åº“æ¥ç®¡ç†åº”ç”¨ç¼–æŽ’ï¼Œåº”ç”¨å›¢é˜Ÿå°†è´Ÿè´£åº”ç”¨å‘å¸ƒåˆ°ä¸åŒ stage çŽ¯å¢ƒçš„èŠ‚å¥ åº”ç”¨å›¢é˜Ÿå¯ä»¥ä½¿ç”¨ Kustomizationã€Helm éƒ¨ç½²åº”ç”¨ åº”ç”¨å›¢é˜Ÿæ— æ³•åˆ›å»ºé›†ç¾¤ç›¸å…³çš„ç»„ä»¶ï¼Œå¦‚æŒä¹…å·ã€CRD ç­‰èµ„æº åº”ç”¨å›¢é˜Ÿæ— æ³•åˆ›å»ºå¯†é’¥ã€Service Accountç­‰èµ„æºï¼Œä½†ä»…å¯ä½¿ç”¨ infra å›¢é˜Ÿæå‰ä¸ºåº”ç”¨åˆ›å»ºçš„è¿™ç±»èµ„æº äºŒã€Flux å¤šç§Ÿæˆ·çš„å®‰å…¨è®¾ç½® å¯¹äºŽä¸€ä¸ªä½¿ç”¨å‘½åç©ºé—´åœ¨éš”ç¦»å¤šç§Ÿæˆ·çš„é›†ç¾¤ï¼ŒFlux æä¾›äº†é€‰é¡¹æ¥ç¦æ­¢è·¨å‘½ä»¤ç©ºé—´çš„å¼•ç”¨ï¼Œ ä¾‹å¦‚ï¼ŒFlux çš„ Kustomization æˆ– Helm Releases ç¦æ­¢å¼•ç”¨å…¶ä»–å‘½åç©ºé—´å®šä¹‰çš„ Sourceã€‚ åŒæ—¶ï¼Œå¯ç”¨å¼ºåˆ¶æ¨¡æ‹ŸåŠŸèƒ½ï¼Œå°† Kustomization æˆ– Helm Releases èµ„æºçš„éƒ¨ç½²é»˜è®¤é™åˆ¶åˆ°æœ€å°æ¥æ˜¾ç¤ºçš„æå‡éƒ¨ç½²çš„å®‰å…¨æ€§ã€‚\néµå¾ªä»¥ä¸Š Flux çš„å¤šç§Ÿæˆ·å®‰å…¨æœ€ä½³å®žè·µï¼Œè¿›è¡Œå¦‚ä¸‹ Flux Toolkits é…ç½®ï¼ˆ./cluster/cluster-dev/kustomization.yamlï¼‰ æ¥ç¦ç”¨è·¨å‘½åç©ºé—´å¼•ç”¨å’Œå¼ºåˆ¶æ¨¡æ‹Ÿé™åˆ¶ Kustomization å’Œ Helm éƒ¨ç½²çš„é»˜è®¤æƒé™ï¼Œ\n1apiVersion: kustomize.config.k8s.io/v1beta1 2kind: Kustomization 3resources: 4 - gotk-components.yaml 5 - gotk-sync.yaml 6patches: 7 - patch: | 8 - op: add 9 path: /spec/template/spec/containers/0/args/0 10 value: --no-cross-namespace-refs=true 11 target: 12 kind: Deployment 13 name: \u0026gt;- 14 (kustomize-controller|helm-controller|notification-controller|image-reflector-controller|image-automation-controller) 15 - patch: | 16 - op: add 17 path: /spec/template/spec/containers/0/args/0 18 value: --default-service-account=default 19 target: 20 kind: Deployment 21 name: (kustomize-controller|helm-controller) 22 - patch: | 23 - op: add 24 path: /spec/serviceAccountName 25 value: kustomize-controller 26 target: 27 kind: Kustomization 28 name: flux-system 29 - patch: | 30 - op: add 31 path: /spec/serviceAccountName 32 value: helm-controller 33 target: 34 kind: HelmRelease 35 name: flux-system åŒæ—¶ä¸º infra å›¢é˜Ÿç®¡ç†çš„å…±äº« Kustomization/Helm ç»„ä»¶éƒ¨ç½²æ˜¾ç¤ºçš„æŒ‡å®šéƒ¨ç½²æƒé™ï¼Œ ä¾‹å¦‚ï¼ŒDEVçŽ¯å¢ƒ infrastructure é…ç½®çš„å…¥å£./clusters/cluster-dev/infrastructure.yaml\n1apiVersion: kustomize.toolkit.fluxcd.io/v1beta2 2kind: Kustomization 3metadata: 4 name: infrastructure 5 namespace: flux-system 6spec: 7 interval: 10m0s 8 serviceAccountName: kustomize-controller 9 path: ./infrastructure/overlays/product 10 prune: true 11 sourceRef: 12 kind: GitRepository 13 name: flux-system æˆ–é€šè¿‡ Kustomize çš„è¡¥ä¸æœºåˆ¶ä¸ºæ‰€æœ‰çš„ Kustomization/Helm Flux è‡ªå®šä¹‰èµ„æºæŒ‡å®šéƒ¨ç½²æƒé™ï¼Œ ä¾‹å¦‚DEVçŽ¯å¢ƒçš„overlayçš„å…¥å£./infrastructure/overlays/development/kustomization.yamlé…ç½®ï¼Œ\n1apiVersion: kustomize.config.k8s.io/v1beta1 2kind: Kustomization 3resources: 4 - ../../base 5 - ./secrets.yaml 6patches: 7 - path: ./aws-load-balancer-controller-patch.yaml 8 - path: ./aws-load-balancer-serviceaccount-patch.yaml 9 - path: ./dns-patch.yaml 10 - path: ./dns-sa-patch.yaml 11 - path: ./slack-patch.yaml 12 - patch: | 13 - op: add 14 path: /spec/serviceAccountName 15 value: kustomize-controller 16 target: 17 kind: Kustomization 18 namespace: (flux-system|kube-system|mariadb) 19 - patch: | 20 - op: add 21 path: /spec/serviceAccountName 22 value: helm-controller 23 target: 24 kind: HelmRelease 25 namespace: (flux-system|kube-system|mariadb) æœ€ä½³å®žè·µ é€šè¿‡åœ¨å¹³å°å›¢é˜Ÿç®¡ç†çš„ Kustomization é…ç½®ä¸­ï¼Œå¼ºåˆ¶ä¸ºåº”ç”¨å›¢é˜Ÿ Git ä»“åº“çš„ Kustomization, HelmRelease ç­‰éƒ¨ç½²å¯¹è±¡æŒ‡å®šéƒ¨ç½²æ—¶ä½¿ç”¨çš„ Service Accountã€‚\nä¸‰ã€ç§Ÿæˆ·çš„é›†ç¾¤èµ„æºç®¡ç† åŸºäºŽå‰é¢çš„ç®¡ç†éœ€æ±‚å‡è®¾ï¼Œåœ¨ infrastructure Git ä»“åº“ä¸­ï¼Œä¸“é—¨ä¸ºå¤šç§Ÿæˆ·/å¤šå›¢é˜Ÿ/å¤šåº”ç”¨åˆ›å»ºå¦‚ä¸‹ç›®å½•ç»“æž„ï¼Œ å…±äº« apps é€šå¸¸çš„ç§Ÿæˆ·é…ç½®ï¼Œä¾‹å¦‚ï¼Œå‘½åç©ºé—´ï¼ŒRBAC(é€šè¿‡ Service Account)åŠ ä¸Š Policy å®žçŽ°ç­‰ã€‚\n1apps 2|-- base 3| |-- app-a 4| | |-- bitnami.yaml 5| | |-- kustomization.yaml 6| | |-- namespace.yaml 7| | |-- policies.yaml 8| | `-- rbac.yaml 9| `-- kustomization.yaml 10`-- overlays 11 `-- development 12 |-- app-a 13 | |-- kustomization.yaml 14 | `-- prestashop-sealed-secrets.yaml 15 `-- kustomization.yaml åŒæ—¶åˆ›å»ºä¸€ä¸ª apps çš„ Kustomization å…¥å£é…ç½®åŒé›†ç¾¤é›†æˆï¼Œä¾‹å¦‚ ./clusters/cluster-dev/apps.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼Œ\n1apiVersion: kustomize.toolkit.fluxcd.io/v1beta2 2kind: Kustomization 3metadata: 4 name: apps 5 namespace: flux-system 6spec: 7 dependsOn: 8 - name: infrastructure 9 interval: 3m0s 10 serviceAccountName: kustomize-controller 11 path: ./apps/overlays/development 12 prune: true 13 sourceRef: 14 kind: GitRepository 15 name: flux-system æœ€ä½³å®žè·µ Kubernetes åŽŸç”Ÿçš„ RBAC æƒé™æŽ§åˆ¶æ— æ³•ç»†ç²’åº¦çš„æŽ§åˆ¶èµ„æºæƒé™ï¼Œå¦‚èµ„æºåˆ›å»ºå¿…é¡»æŒ‡å®šæŸäº› Label ç­‰ã€‚ ä½†ç»“åˆ Policy as Codeï¼Œå¦‚ Gatekeeper, Kyverno å¯ä»¥æ»¡è¶³ç»†ç²’åº¦çš„ç®¡ç†éœ€æ±‚ã€‚\nä¸ºåº”ç”¨ app-a åˆ›å»ºäº†å¦‚ä¸‹ Policyï¼Œä»…å…è®¸åº”ç”¨é€šè¿‡è‡ªåŠ©çš„ Git ä»“åº“åœ¨éƒ¨ç½²æ—¶ä»…å¯åˆ›å»º Helm Chart éƒ¨ç½²å¿…é¡»çš„ Secretsã€‚\n1apiVersion: kyverno.io/v1 2kind: Policy 3metadata: 4 name: restrict-secrets-by-type 5 namespace: app-a 6 annotations: 7 policies.kyverno.io/title: Restrict Secrets by Name 8 policies.kyverno.io/category: security 9 policies.kyverno.io/subject: Secret 10 policies.kyverno.io/description: \u0026gt;- 11 Disallow creating/deleting secrets in namespace \u0026#39;app-a\u0026#39; beside the helm 12 storage. 13spec: 14 background: false 15 validationFailureAction: enforce 16 rules: 17 - name: safe-secrets-for-helm-storage 18 match: 19 resources: 20 kinds: 21 - Secret 22 preconditions: 23 all: 24 - key: \u0026#39;{{request.operation}}\u0026#39; 25 operator: In 26 value: 27 - CREATE 28 - UPDATE 29 - DELETE 30 - key: \u0026#39;{{serviceAccountName}}\u0026#39; 31 operator: Equals 32 value: app-a-reconciler 33 validate: 34 message: Only Secrets are created by Helm v3+ 35 pattern: 36 type: helm.sh/release.v1 å››ã€ç§Ÿæˆ·éš”ç¦»ä¸”è‡ªæœåŠ¡çš„åº”ç”¨æŒç»­éƒ¨ç½² ä¸Šä¸€æ­¥ä¸ºç§Ÿæˆ·/åº”ç”¨ app-a é…ç½®äº†ç‹¬ç«‹çš„å‘½ä»¤ç©ºé—´ï¼Œéƒ¨ç½²æƒé™ï¼Œç­–ç•¥ç­‰ã€‚åŒæ—¶ä¸ºåº”ç”¨ app-a åˆ›å»ºäº†ç‹¬ç«‹çš„ GitOps ä»“åº“ï¼Œ åº”ç”¨å›¢é˜Ÿå¯ä»¥é€šè¿‡ç‹¬ç«‹çš„ Git ä»“åº“è‡ªä¸»çš„å‘å¸ƒå…¶åº”ç”¨ç¨‹åºåˆ°ä¸åŒçš„ STAGING é›†ç¾¤ã€‚ å¦‚ç¤ºä¾‹ä¸­çš„ä»“åº“ï¼Œåº”ç”¨å›¢é˜Ÿä½¿ç”¨ Kustomize ç®¡ç†ä¸åŒ STAGING çŽ¯å¢ƒçš„éƒ¨ç½²ï¼Œä¸”é€šè¿‡ Helm æ–¹å¼éƒ¨ç½²äº†ç”µå•†åº”ç”¨ Prestashopã€‚ åº”ç”¨å›¢é˜Ÿçš„éƒ¨ç½²å¯ä»¥ä½¿ç”¨ç”± infrastructure å›¢é˜Ÿç»Ÿä¸€ç®¡ç†çš„ External DNS, Ingress Class, åº”ç”¨æ‰€åœ¨å‘½åç©ºé—´çš„ Secretsã€‚\næœ€ç»ˆå¹³å°å›¢é˜Ÿå°†åº”ç”¨ app-a ç‹¬ç«‹çš„ä»“åº“ä½œä¸ºä¸€ä¸ªæ–°çš„ GitOps æ¥æºï¼Œé€šè¿‡å¦‚ä¸‹é…ç½®å°†åº”ç”¨ä»“åº“çš„éƒ¨ç½²åŒé›†ç¾¤å…³è”ä¸Šï¼Œ\n1apiVersion: source.toolkit.fluxcd.io/v1beta1 2kind: GitRepository 3metadata: 4 name: app-a-tenant 5spec: 6 interval: 1m 7 url: https://github.com/zxkane/eks-gitops-app-a.git 8 ref: 9 branch: main 10--- 11apiVersion: kustomize.toolkit.fluxcd.io/v1beta2 12kind: Kustomization 13metadata: 14 name: app-a-tenant 15spec: 16 serviceAccountName: app-a-reconciler 17 interval: 5m0s 18 retryInterval: 5m0s 19 prune: true 20 sourceRef: 21 kind: GitRepository 22 name: app-a-tenant 23 namespace: app-a 24 patches: 25 - patch: |- 26 - op: replace 27 path: /spec/serviceAccountName 28 value: app-a-reconciler 29 - op: replace 30 path: /metadata/namespace 31 value: app-a 32 target: 33 group: helm.toolkit.fluxcd.io 34 version: v2beta1 35 kind: HelmRelease 36 - patch: |- 37 - op: replace 38 path: /spec/serviceAccountName 39 value: app-a-reconciler 40 - op: replace 41 path: /metadata/namespace 42 value: app-a 43 target: 44 group: kustomize.toolkit.fluxcd.io 45 version: v1beta2 46 kind: Kustomization 47 - patch: |- 48 - op: replace 49 path: /namespace 50 value: app-a 51 target: 52 group: kustomize.config.k8s.io 53 version: v1beta1 54 kind: Kustomization åº”ç”¨ app-a å›¢é˜Ÿå°†è‡ªåŠ©çš„é€šè¿‡ç‹¬ç«‹çš„åº”ç”¨ GitOps ä»“åº“æŒç»­å‘å¸ƒå›¢é˜Ÿçš„åº”ç”¨ã€‚ å¦‚ä¸‹ç¤ºä¾‹ app-a åœ¨å…¶è‡ªåŠ©çš„ Git ä»“åº“é€šè¿‡ HelmRelease éƒ¨ç½²äº† Web åº”ç”¨ã€‚\n1apiVersion: helm.toolkit.fluxcd.io/v2beta1 2kind: HelmRelease 3metadata: 4 name: prestashop 5spec: 6 releaseName: prestashop 7 chart: 8 spec: 9 chart: prestashop 10 sourceRef: 11 kind: HelmRepository 12 name: bitnami 13 namespace: app-a 14 version: 14.0.10 15 values: 16 existingSecret: prestashop 17 service: 18 type: ClusterIP 19 ingress: 20 enabled: true 21 path: \u0026#39;/*\u0026#39; 22 annotations: 23 alb.ingress.kubernetes.io/scheme: internet-facing 24 alb.ingress.kubernetes.io/inbound-cidrs: \u0026#39;0.0.0.0/0\u0026#39; 25 alb.ingress.kubernetes.io/auth-type: none 26 alb.ingress.kubernetes.io/target-type: ip 27 kubernetes.io/ingress.class: alb 28 alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS-1-2-Ext-2018-06 29 alb.ingress.kubernetes.io/listen-ports: \u0026#39;[{\u0026#34;HTTP\u0026#34;: 80}]\u0026#39; 30 alb.ingress.kubernetes.io/backend-protocol: HTTP 31 alb.ingress.kubernetes.io/healthcheck-path: \u0026#39;/\u0026#39; 32 persistence: 33 enabled: false 34 storageClass: gp2 35 # for mariadb 36 mariadb: 37 enabled: false 38 externalDatabase: 39 host: mariadb.kube-system.svc.cluster.local 40 user: prestashop 41 database: prestashop 42 existingSecret: prestashop-db-secrets 43 allowEmptyPassword: false 44 interval: 1h0m0s 45 install: 46 remediation: 47 retries: 3 äº”ã€è‡ªåŠ¨å‘å¸ƒé•œåƒæ›´æ–° åœ¨æœ¬èŠ‚å®žè·µä¸­æˆ‘ä»¬å°†ä½¿ç”¨ Sock Shopï¼ˆä¸€ä¸ªä½¿ç”¨ Spring Boot, Go kit, Node.js å®¹å™¨åŒ–çš„å¾®æœåŠ¡ç¤ºä¾‹åº”ç”¨ï¼‰ã€‚ åŒåœ¨ç¬¬ä¸‰ï¼Œç¬¬å››ç« èŠ‚é…ç½®åº”ç”¨ app-a ä¸€æ ·ï¼Œä¸º sock-shop åº”ç”¨åœ¨ infrastructure GitOps ä»“åº“ä¸­åˆ›å»ºäº†å•ç‹¬çš„å‘½åç©ºé—´ã€RBACã€ç‹¬ç«‹çš„ Git ä»“åº“æ¥ç®¡ç†åº”ç”¨çš„å‘å¸ƒï¼Œ å…·ä½“å®žçŽ°å¯å‚è€ƒ commit1, commit2ã€‚\n1. éƒ¨ç½²å¾®æœåŠ¡åº”ç”¨ç¨‹åº Sock Shop åœ¨æˆ‘ä»¬åˆ†å‰çš„ Sock Shop é€šè¿‡ Kustomization å®žçŽ°äº†å¤šé›†ç¾¤éƒ¨ç½²çš„æ”¯æŒï¼Œ åŒæ—¶å°† front-end æœåŠ¡é€šè¿‡ LoadBalancer ç±»åž‹å¯¹å¤–æš´éœ²å‡ºæ¥ï¼Œåˆ©ç”¨ Amazon EKS åŒ Amazon Elastic Load Balancing çš„é›†æˆæ¥è´Ÿè½½å‡è¡¡ Sock Shop åº”ç”¨çš„å…¥å£ front-end æœåŠ¡ã€‚\n1apiVersion: kustomize.config.k8s.io/v1beta1 2kind: Kustomization 3resources: 4 - ./complete-demo.yaml 5patchesStrategicMerge: 6 - delete-ns.yaml 7patches: 8 - patch: |- 9 - op: replace 10 path: /spec/type 11 value: LoadBalancer 12 - op: replace 13 path: /metadata/annotations/service.beta.kubernetes.io~1aws-load-balancer-type 14 value: external 15 - op: replace 16 path: /metadata/annotations/service.beta.kubernetes.io~1aws-load-balancer-nlb-target-type 17 value: ip 18 - op: replace 19 path: /metadata/annotations/service.beta.kubernetes.io~1aws-load-balancer-scheme 20 value: internet-facing 21 target: 22 version: v1 23 kind: Service 24 name: front-end é€šè¿‡å®šåˆ¶åŒ– front-end å¾®æœåŠ¡ä¸ºæˆ‘ä»¬çš„ Sock Shop åº”ç”¨æŒç»­æ”¹è¿›ï¼Œæœ€æ–°çš„ front-end é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•åŽæ‰“åŒ…çš„é•œåƒç‰ˆæœ¬é€šè¿‡ Github packages å®¹å™¨é•œåƒä»“åº“å¯¹å¤–å‘å¸ƒã€‚ æˆ‘ä»¬åœ¨ DEV çŽ¯å¢ƒå°†ä½¿ç”¨ Kustomization overlays å°† front-end å¾®æœåŠ¡æ›¿æ¢ä¸ºå®šåˆ¶åŒ–æ›´æ–°çš„ç‰ˆæœ¬ã€‚\n1apiVersion: kustomize.config.k8s.io/v1beta1 2kind: Kustomization 3resources: 4 - ../../base 5patches: 6 - patch: |- 7 - op: replace 8 path: /metadata/annotations/external-dns.alpha.kubernetes.io~1hostname 9 value: socks-dev.test.kane.mx 10 target: 11 version: v1 12 kind: Service 13 name: front-end 14images: 15- name: weaveworksdemos/front-end 16 newName: ghcr.io/zxkane/weaveworksdemos/front-end 17 newTag: 0.3.13-rc0 åœ¨ DEV ç­‰å¯æŒç»­é›†æˆçš„æ•æ·çŽ¯å¢ƒï¼Œåœ¨æž„å»ºæ–°æœåŠ¡é•œåƒä¸”å‘å¸ƒåŽï¼Œé€šè¿‡äººå·¥æˆ–è„šæœ¬æ›´æ–° GitOps ä»£ç ä»“åº“æ˜¾å¾—è¿‡äºŽç¹çã€‚ Flux è‡ªèº«æä¾›äº†å®Œå–„ä¸”å¼ºå¤§çš„ Git ä»“åº“é•œåƒè‡ªåŠ¨å‡çº§åŠŸèƒ½ã€‚ä¸‹é¢åœ¨æˆ‘ä»¬çš„ GitOps éƒ¨ç½²ä»“åº“æ¥å®žçŽ°è¯¥èƒ½åŠ›ã€‚\næ³¨æ„ é•œåƒè‡ªåŠ¨æ›´æ–°åŠŸèƒ½éœ€è¦ç¡®ä¿ Flux åœ¨å®‰è£…é…ç½®æ—¶å·²å¯ç”¨é•œåƒè‡ªåŠ¨æ›´æ–°ç»„ä»¶ã€‚å¦‚æœªå¯ç”¨ï¼Œå¯é‡å¤ bootstrap Flux æ—¶åŠ ä¸Š --components-extra=image-reflector-controller,image-automation-controller å‚æ•°æ¥å¯ç”¨ã€‚\n2. æ³¨å†Œ front-end å¾®æœåŠ¡çš„é•œåƒä»“åº“ 1apiVersion: image.toolkit.fluxcd.io/v1beta1 2kind: ImageRepository 3metadata: 4 name: sock-shop-front-end 5spec: 6 image: ghcr.io/zxkane/weaveworksdemos/front-end 7 interval: 1m0s 3. è®¾ç½®é•œåƒæ›´æ–°ç­–ç•¥ å¦‚ä¸‹è§„åˆ™ ^0.3.x-0 å°†åŒ¹é… 0.3.13-rc0, 0.3.13-rc1, 0.3.13 ç­‰é•œåƒç‰ˆæœ¬ã€‚\n1apiVersion: image.toolkit.fluxcd.io/v1beta1 2kind: ImagePolicy 3metadata: 4 name: sock-shop-front-end 5spec: 6 imageRepositoryRef: 7 name: sock-shop-front-end 8 policy: 9 semver: 10 range: \u0026#39;^0.3.x-0\u0026#39; 4. åˆ›å»ºè‡ªåŠ¨é•œåƒæ›´æ–°é…ç½® Flux è‡ªåŠ¨é•œåƒé…ç½®ä¼šæŒ‡å®šåº”ç”¨é…ç½®çš„ Git ä»“åº“ï¼ŒåŒ…æ‹¬åˆ†æ”¯ã€è·¯å¾„ç­‰ä¿¡æ¯ã€‚\n1apiVersion: image.toolkit.fluxcd.io/v1beta1 2kind: ImageUpdateAutomation 3metadata: 4 name: sock-shop-front-end 5spec: 6 git: 7 checkout: 8 ref: 9 branch: gitops 10 commit: 11 author: 12 email: fluxcdbot@users.noreply.github.com 13 name: fluxcdbot 14 messageTemplate: \u0026#39;{{range .Updated.Images}}{{println .}}{{end}}\u0026#39; 15 push: 16 branch: gitops 17 interval: 1m0s 18 sourceRef: 19 kind: GitRepository 20 name: sock-shop-tenant 21 namespace: sock-shop 22 update: 23 path: ./deploy/kubernetes/overlays/development 24 strategy: Setters 5. ä¸ºåº”ç”¨ GitOps ä»“åº“é…ç½®è¯»å†™å‡­è¯ ç”±äºŽ Flux éœ€è¦å°†æ›´æ–°åŽçš„é•œåƒç‰ˆæœ¬ä¿¡æ¯æäº¤å›žåº”ç”¨ä»“åº“ï¼Œéœ€è¦ä¸º Flux ä¸­é…ç½®çš„åº”ç”¨ GitRepository æŒ‡å®šå¯è¯»å†™çš„è®¿é—®å‡­è¯ã€‚ ä¸‹é¢æä¾›å‚è€ƒæ­¥éª¤åˆ›å»º Git ä»“åº“è®¿é—®å‡­è¯å¹¶é…ç½®ã€‚\n1. åˆ›å»º Sealed Secret ä¿å­˜ Git ä»“åº“è¯»å†™æƒé™çš„ç§é’¥ 1kubectl -n sock-shop create secret generic flux-image-automation \\ 2--from-file=identity=/path/gitops-image-update-id-ecdsa \\ 3--from-file=identity.pub=/path/gitops-image-update-id-ecdsa.pub \\ # ç¡®ä¿æ­¤å…¬é’¥å·²é…ç½®åœ¨ Git ä»“åº“ä¸”å…·æœ‰è¯»å†™æƒé™ï¼Œå¦‚ Github ä»“åº“çš„ `Deploy Keys` 4--from-literal=known_hosts=\u0026#34;github.com ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg=\u0026#34; \\ 5--dry-run=client \\ 6-o yaml \u0026gt; flux-image-automation-secrets.yaml 7 8kubeseal --format=yaml --cert=pub-sealed-secrets-dev.pem \\ 9\u0026lt; flux-image-automation-secrets.yaml \u0026gt; ./apps/overlays/development/sock-shop/sealed-git-token.yaml 2. é€šè¿‡ Kustomize ä¸º DEV çŽ¯å¢ƒçš„ GitRepository é…ç½®æŒ‡å®šè®¿é—®å‡­è¯ 1apiVersion: kustomize.config.k8s.io/v1beta1 2kind: Kustomization 3namespace: sock-shop 4resources: 5 - ../../../base/sock-shop 6 - ./sealed-slack-secrets.yaml 7 - ./sealed-git-token.yaml 8 - ./registry.yaml 9 - ./policy.yaml 10 - ./image-automation.yaml 11patches: 12 - patch: |- 13 - op: replace 14 path: /spec/path 15 value: ./deploy/kubernetes/overlays/development 16 target: 17 group: kustomize.toolkit.fluxcd.io 18 version: v1beta2 19 kind: Kustomization 20 name: sock-shop-tenant 21 - patch: | 22 - op: replace 23 path: /spec/channel 24 value: gitops-flux 25 target: 26 group: notification.toolkit.fluxcd.io 27 version: v1beta1 28 kind: Provider 29 name: slack 30 - patch: | 31 - op: replace 32 path: /spec/url 33 value: git@github.com:zxkane/microservices-demo.git 34 - op: replace 35 path: /spec/secretRef 36 value: {} 37 - op: replace 38 path: /spec/secretRef/name 39 value: flux-image-automation 40 target: 41 group: source.toolkit.fluxcd.io 42 version: v1beta1 43 kind: GitRepository 44 name: sock-shop-tenant 6. éªŒè¯é•œåƒè‡ªåŠ¨æ›´æ–° æ›´æ–°å¾®æœåŠ¡ front-end ä»£ç ä¸”tagç‰ˆæœ¬åŽï¼Œæ–°çš„é•œåƒç‰ˆæœ¬è¢«å‘å¸ƒåˆ°é•œåƒä»“åº“ã€‚ é€šè¿‡å‰é¢é…ç½®çš„ ImageRepository å’Œ ImagePolicy æ‰«æåˆ° front-end é•œåƒç¬¦åˆç­–ç•¥çš„æ–°ç‰ˆæœ¬å‘å¸ƒï¼Œ æ ¹æ® ImageUpdateAutomation é…ç½®çš„ Sock Shop åº”ç”¨ä»“åº“ï¼ŒæŸ¥æ‰¾æŒ‡å®šçš„é•œåƒå˜é‡ï¼Œ Flux çš„ image-automation-controller è‡ªåŠ¨å°†æ›´æ–°çš„é•œåƒä¿¡æ¯æäº¤åˆ°åº”ç”¨ä»“åº“å®žçŽ°æŒç»­éƒ¨ç½²ã€‚\nå›¾1ï¼šé•œåƒè‡ªåŠ¨æ›´æ–°æ¶ˆæ¯é€šçŸ¥ å…­ã€å°ç»“åŠå±•æœ› æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ GitOps å·¥å…· FluxCD v2 æž„å»ºä¼ä¸šå†…éƒ¨åœ¨ Kubernetes ä¸ŠæŒç»­äº¤ä»˜å…±äº«æœåŠ¡å¹³å°ï¼Œ å°†å¹³å°å›¢é˜Ÿå’Œåº”ç”¨/ä¸šåŠ¡å›¢é˜Ÿç»Ÿä¸€åœ¨åŒæ ·çš„ Git å·¥ä½œæµç¨‹ä¸‹ï¼ŒåŒæ—¶æŽˆæƒåº”ç”¨/ä¸šåŠ¡å›¢é˜Ÿç”¨è‡ªæœåŠ¡çš„æ–¹å¼æŒç»­äº¤ä»˜åº”ç”¨çš„æ•æ·éƒ¨ç½²ã€‚ æ­¤æ–¹æ¡ˆå°†å®‰å…¨å’Œæ•ˆçŽ‡æœ‰æ•ˆçš„ç»“åˆåœ¨ä¸€èµ·ã€‚å‰è¿°çš„ç¤ºä¾‹å¯åœ¨æ­¤ä»“åº“èŽ·å–å®Œæ•´çš„ GitOps ä»£ç ã€‚\nåŒæ—¶é¢å¯¹å¤æ‚çš„ä¼ä¸šåœºæ™¯ï¼Œè¿˜æœ‰ä¸€äº›æ–¹é¢è¿˜å¯ä»¥æŒç»­çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚ï¼Œ\né¢å¯¹å…³é”®çš„çº¿ä¸Šç”Ÿäº§ç³»ç»Ÿï¼Œå¦‚ä½•å®‰å…¨å¢žé‡çš„ç°åº¦å‘å¸ƒï¼Ÿ Sealed Secrets å¼•å…¥äº†é¢å¤–çš„ç§é’¥ç®¡ç†éœ€æ±‚ï¼Œåœ¨äº‘è®¡ç®—çŽ¯å¢ƒå¦‚ä½•æ”¹å–„ GitOps å¯†é’¥çš„ç®¡ç†ï¼Ÿ å¦‚ä½•å°†äº‘å¹³å°çš„èµ„æº IaC åŒ Kubernetes å†…èµ„æº GitOps ååŒç®¡ç†ï¼Ÿ å¦‚ä½•æ›´åŠ é«˜æ•ˆçš„å¼€å‘ Kubernetes manifests(YAML)ï¼Ÿ å°†åœ¨åŽç»­çš„æ–‡ç« ä¸­é€ä¸ªæŽ¢è®¨è¿™äº›é—®é¢˜ã€‚\n","link":"https://kane.mx/posts/gitops/flux-in-action-2/","section":"posts","tags":["GitOps","Kubernetes","Flux","Git","EKS","CD","Continuous Delivery"],"title":"åŸºäºŽ Flux çš„ GitOps å®žæˆ˜ï¼ˆä¸‹ï¼‰"},{"body":"åœ¨å‰æ–‡ä»‹ç»äº† GitOps çš„æ¦‚å¿µï¼ŒKubernetes ä¸Š GitOps æœ€ä½³å®žè·µä»¥åŠå¯¹æ¯”äº† CNCF åŸºé‡‘ä¼šä¸‹ äº‘åŽŸç”Ÿçš„ GitOps å·¥å…·ï¼ˆArgoCD å’Œ Fluxï¼‰ã€‚æœ¬ç¯‡å°†å¸¦ä½ æŒ‰ç…§ Flux çš„æœ€ä½³å®žè·µåœ¨è·¨VPCè·¨è´¦æˆ·çš„ Kubernetes ä¸Šå®žè·µ GitOps çš„æŒç»­é›†æˆï¼Œè½»æ¾ç®¡ç†æ•°åæ•°ç™¾ä¹ƒè‡³æ›´å¤šçš„é›†ç¾¤åŠéƒ¨ç½²åœ¨ä¸Šé¢çš„åº”ç”¨ã€‚\n0. å¿…å¤‡æ¡ä»¶ å‡è®¾ä¸šåŠ¡å¯¹ç¨³å®šæ€§çš„éœ€æ±‚ï¼Œä½¿ç”¨3ä¸ª Kubernetes é›†ç¾¤åˆ†åˆ«å¯¹åº” DEV, STAGING å’Œ PRODUCT çŽ¯å¢ƒã€‚è¿™äº›é›†ç¾¤çŽ¯å¢ƒæ ¹æ®ä¼ä¸šçš„éœ€æ±‚ å¯èƒ½ä¼šåˆ†å¸ƒåœ¨ä¸åŒçš„äº‘è´¦æˆ·å’ŒVPCç½‘ç»œä¸­ã€‚è¯»è€…å¯æ ¹æ®å®žé™…ä¼ä¸šæƒ…å†µåˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªé›†ç¾¤ã€‚æœ¬æ–‡ä»¥ Amazon EKS ä¸ºä¾‹ï¼ŒEKSé›†ç¾¤çš„åˆ›å»ºè¯·å‚é˜…å…¶æ–‡æ¡£ã€‚ Git ä»“åº“ç”¨äºŽä¿å­˜é›†ç¾¤çš„å£°æ˜Žå¼é…ç½®ã€‚Flux æ”¯æŒ Git åœ¨çº¿æœåŠ¡ï¼ˆåŒ…æ‹¬ Github, Gitlab, Bitbucketï¼‰å’Œå…¶ä»–ä»»æ„ Git æœåŠ¡ã€‚æœ¬æ–‡å°†ä½¿ç”¨ Github æ‰˜ç®¡ Git ä»“åº“ä¸ºä¾‹ã€‚ å®‰è£… Flux CLI 1. Kubernetes é›†ç¾¤å®‰è£…é…ç½® Flux Github repo ä¸ºä¾‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œ\n1export GITHUB_TOKEN=\u0026lt;your-token\u0026gt; 2 3flux bootstrap github \\ 4 --components-extra=image-reflector-controller,image-automation-controller \\ 5 --owner=zxkane \\ 6 --repository=eks-gitops \\ 7 --path=clusters/cluster-dev \\ 8 --personal é‡è¦ è¯·ç¡®ä¿ Flux CLI æ‰§è¡ŒçŽ¯å¢ƒå¯ä»¥é€šè¿‡ kubectl è¿žæŽ¥åˆ° Kubernetes é›†ç¾¤ï¼Œä¸”ç”¨æˆ·å…·å¤‡ admin æƒé™ã€‚\né‡è¦ åˆ›å»ºçš„ Github Personal Accesss Token éœ€è¦è‡³å°‘åŒæ—¶é€‰ä¸­å…¨éƒ¨ repo å’Œ user çš„æƒé™ã€‚\næ³¨æ„ å¦‚éœ€åœ¨ DEV çŽ¯å¢ƒ å¯ç”¨é•œåƒè‡ªåŠ¨æ›´æ–°åŠŸèƒ½ï¼Œbootstrap Flux æ—¶éœ€è¦åŠ ä¸Š --components-extra=image-reflector-controller,image-automation-controller å‚æ•°ã€‚\né€šè¿‡ç±»ä¼¼çš„æ­¥éª¤åœ¨ STAGING å’Œ PRODUCT é›†ç¾¤å®‰è£…é…ç½® Flux ã€‚\n1export KUBECONFIG=$HOME/.kube/config-cluster-staging 2flux bootstrap github \\ 3 --owner=zxkane \\ 4 --repository=eks-gitops \\ 5 --path=clusters/cluster-staging \\ 6 --personal 7 8export KUBECONFIG=$HOME/.kube/config-cluster-product 9flux bootstrap github \\ 10 --owner=zxkane \\ 11 --repository=eks-gitops \\ 12 --path=clusters/cluster-product \\ 13 --personal ä»¥ä¸Šæ­¥éª¤æ˜¯æ‰‹åŠ¨å®‰è£…åŠé…ç½® Flux ï¼ŒFlux ä¹Ÿæ”¯æŒåŒçŽ°æœ‰çš„ IaC ä»£ç é›†æˆï¼Œå¦‚ eksctl, Terraformã€‚\næœ€ä½³å®žè·µ ä¸Šé¢ç¤ºä¾‹å¯¹å¤šçŽ¯å¢ƒé›†ç¾¤çš„æ”¯æŒå¹¶æ²¡æœ‰é‡‡ç”¨å¤šä»“åº“/å¤šåˆ†æ”¯çš„ç­–ç•¥ï¼Œè€Œæ˜¯ç”¨çš„ä½¿ç”¨ä¸åŒè·¯å¾„æ¥ç®¡ç†ä¸åŒçš„é›†ç¾¤ã€‚ è¿™ä¹Ÿæ˜¯ Flux æŽ¨èçš„ç­–ç•¥ï¼Œå¯ä»¥å‡å°‘ä»£ç ç»´æŠ¤å’Œåˆå¹¶çš„éš¾åº¦ã€‚\n1./clusters/ 2â”œâ”€â”€ cluster-dev [é›†ç¾¤åç§°] 3â”‚Â â”œâ”€â”€ flux-system [å‘½åç©ºé—´] 4â”‚Â â”œâ”€â”€ gotk-components.yaml [é»˜è®¤ Flux é…ç½®ï¼Œè¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹] 5â”‚Â â”œâ”€â”€ gotk-sync.yaml [é»˜è®¤ Flux é…ç½®ï¼Œè¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹] 6â”‚Â â””â”€â”€ kustomize.yaml [Kustomize é…ç½®å…¥å£æ–‡ä»¶ï¼Œå°†é€šè¿‡æ­¤å…¥å£èšåˆäº†é›†ç¾¤çš„å…¨éƒ¨é…ç½®] 7â”œâ”€â”€ cluster-product 8â”‚Â â”œâ”€â”€ flux-system 9â”‚Â â”œâ”€â”€ gotk-components.yaml 10â”‚Â â”œâ”€â”€ gotk-sync.yaml 11â”‚Â â””â”€â”€ kustomize.yaml 12â”œâ”€â”€ cluster-staging 13â”‚Â â”œâ”€â”€ flux-system 14â”‚Â â”œâ”€â”€ gotk-components.yaml 15â”‚Â â”œâ”€â”€ gotk-sync.yaml 16â”‚Â â””â”€â”€ kustomize.yaml åœ¨å®Œæˆåˆå§‹åŒ–ä¸åŒçš„çŽ¯å¢ƒé›†ç¾¤åŽï¼Œå°†åœ¨æˆ‘ä»¬çš„Gitä»“åº“ä¸­æŸ¥çœ‹åˆ°å¦‚ä¸Šç›®å½•ç»“æž„ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Flux è‡ªèº«çš„é…ç½®ä¹Ÿæ˜¯é€šè¿‡ GitOps çš„æ–¹å¼æ¥ç®¡ç†çš„ã€‚\n2. ç®¡ç†é›†ç¾¤å…±äº«çš„ç»„ä»¶ åœ¨ä¼ä¸šä¸­é€šå¸¸ä¼šç”± Infrastructure å›¢é˜Ÿç»Ÿä¸€ç®¡ç†é›†ç¾¤çš„å…±äº«ç»„ä»¶ï¼Œä¾‹å¦‚ï¼ŒNamespace, CSI Driver, Ingress Class, Persist Volume, Service Account, Secret, DaemonSet, NetworkPolicyï¼ŒCustomResource ç­‰ç­‰ Kubernetes å¯¹è±¡ã€‚ æŽ¥ä¸‹æ¥å°†æ¼”ç¤ºå¦‚ä½•åœ¨å¤šé›†ç¾¤ä¸­åˆ›å»ºé›†ç¾¤å†…å…±äº«ç»„ä»¶ï¼Œä¾‹å¦‚ï¼ŒAWS Load Balancer Controller å’Œ External DNSï¼Œ å¹¶ä¸”é€æ­¥å°†è¿™äº›ç»„ä»¶éƒ¨ç½²åœ¨ä¸åŒçš„çŽ¯å¢ƒä¸­ã€‚\nFlux è‡ªèº«å¤§é‡ä¾èµ–äº† Kustomizeï¼Œé€šè¿‡ Flux çš„ Kustomize Controller æ¥æ¸²æŸ“æœ€ç»ˆçš„ Kubernetes å£°æ˜Žå¼é…ç½®ï¼Œå¹¶é›†æˆäº† Hookï¼ŒServiceAccountï¼Œè¶…æ—¶ç­‰é¢å¤–é…ç½®ã€‚\né€šè¿‡å¦‚ä¸‹Flux Kustomizeå¯¹è±¡å£°æ˜Žä¸ºDEVçŽ¯å¢ƒå£°æ˜Žäº†å…±äº« Infrastructure é…ç½®æ‰€åœ¨çš„è·¯å¾„ï¼ˆè¯¥é…ç½®æ–‡ä»¶æ”¾ç½®åœ¨cluster/cluster-devç›®å½•ä¸‹ï¼‰ï¼Œ\n1apiVersion: kustomize.toolkit.fluxcd.io/v1beta2 2kind: Kustomization 3metadata: 4 name: infrastructure 5 namespace: flux-system 6spec: 7 interval: 10m0s 8 path: ./infrastructure/overlays/development 9 prune: true 10 sourceRef: 11 kind: GitRepository 12 name: flux-system ä»¥ External DNS(ä¸€ä¸ª CNCF åŸºé‡‘ä¼šé¡¹ç›®ï¼Œä¸º K8S Service LoadBalancer / Ingress å¯¹è±¡æä¾› DNS åŸŸåè§£æžæ³¨å†Œ) ä¸ºå®Œæ•´ç¤ºä¾‹ã€‚\nä½¿ç”¨ Flux çš„ Helm Repositories è‡ªå®šä¹‰å¯¹è±¡ï¼Œæ³¨å†Œ bitnami çš„ Helm Charts ä»“åº“ã€‚\n1apiVersion: source.toolkit.fluxcd.io/v1beta1 2kind: HelmRepository 3metadata: 4 name: bitnami 5spec: 6 interval: 30m 7 url: https://charts.bitnami.com/bitnami æŒ‰ç…§ External DNS for Amazon Route 53 çš„æ–‡æ¡£ä¸º external-dns POD åˆ›å»ºæ‰§è¡Œ IAM è§’è‰²ï¼Œ å¯ä»¥é€šè¿‡ Route 53 API æ¥åˆ›å»ºä¿®æ”¹ç›¸åº”çš„åŸŸåè§£æžã€‚é’ˆå¯¹ External DNS éƒ¨ç½²çš„åœ¨ K8S é›†ç¾¤é…ç½®å¦‚ä¸‹ï¼Œ\nä¸º External DNS åˆ›å»ºç‹¬ç«‹çš„ service accountï¼ŒåŒå¯¹åº”çš„ AWS IAM Role ç»‘å®šï¼Œé™åˆ¶è¯¥ Pod ä»…æ‹¥æœ‰å¿…éœ€çš„æœ€å°æƒé™ã€‚ å…³äºŽ EKS ä¸Šå¦‚ä½•ç»‘å®šæœ€å° AWS æƒé™åˆ° pod ä¸Šè¯·å‚è€ƒIAM roles for service accountsã€‚ 1apiVersion: v1 2kind: ServiceAccount 3metadata: 4 name: external-dns 5 annotations: 6 # create IAM role via following docs, 7 # https://docs.aws.amazon.com/eks/latest/userguide/specify-service-account-role.html 8 # https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/aws.md#iam-permissions 9 # the role specified by kustomize 10 # eks.amazonaws.com/role-arn: arn:aws:iam::123456789012:role/external-dns-role 11 eks.amazonaws.com/sts-regional-endpoints: true å®šä¹‰ HelmRelease Flux å¯¹è±¡ ä»Ž Bitnami çš„ Helm Charts ä»“åº“å®‰è£… external-dns ã€‚ 1apiVersion: helm.toolkit.fluxcd.io/v2beta1 2kind: HelmRelease 3metadata: 4 name: external-dns 5spec: 6 releaseName: external-dns 7 targetNamespace: kube-system 8 chart: 9 spec: 10 chart: external-dns 11 version: \u0026#39;\u0026gt;=6.2.1 \u0026lt;7\u0026#39; 12 sourceRef: 13 kind: HelmRepository 14 name: bitnami 15 namespace: kube-system 16 interval: 1h0m0s 17 install: 18 remediation: 19 retries: 3 20 values: 21 provider: aws 22 aws: 23 zoneType: public 24 serviceAccount: 25 create: false 26 name: external-dns 27 podSecurityContext: 28 fsGroup: 65534 29 runAsUser: 0 ä½¿ç”¨ Kustomization å°†ç›¸å…³çš„é…ç½®æ•´åˆã€‚ 1apiVersion: kustomize.config.k8s.io/v1beta1 2kind: Kustomization 3namespace: kube-system 4resources: 5 - serviceaccount.yaml 6 - release.yaml ç”¨ Kustomization æ•´åˆå¤šä¸ªç»„ä»¶çš„é…ç½®ã€‚ 1apiVersion: kustomize.config.k8s.io/v1beta1 2kind: Kustomization 3resources: 4 - sources 5 - aws-load-balancer-controller 6 - dns ä»¥ä¸Šæ‰€æœ‰é…ç½®éƒ½ä¿å­˜åœ¨Gitä»“åº“infrastructure/baseä¸‹ï¼ˆè¯¦è§ä¸‹å›¾ï¼‰ä½œä¸ºå¤šå¥—çŽ¯å¢ƒé€šç”¨çš„é…ç½®ï¼ŒæŒ‰ç…§ Kustomize çš„ Overlays å¸ƒå±€ã€‚\n1./infrastructure/ 2|-- base 3| |-- aws-load-balancer-controller 4| | |-- kustomization.yaml 5| | |-- release.yaml 6| | `-- serviceaccount.yaml 7| |-- dns 8| | |-- kustomization.yaml 9| | |-- release.yaml 10| | `-- serviceaccount.yaml 11| |-- kustomization.yaml 12| `-- sources 13| |-- bitnami.yaml 14| |-- eks-charts.yaml 15| `-- kustomization.yaml 16`-- overlays 17 |-- development 18 | |-- aws-load-balancer-controller-patch.yaml 19 | |-- aws-load-balancer-serviceaccount-patch.yaml 20 | |-- dns-patch.yaml 21 | |-- dns-sa-patch.yaml 22 | `-- kustomization.yaml åœ¨DEVçŽ¯å¢ƒå¯¹åº”çš„ overlay ä¸‹é¢åˆ›å»ºå¦‚ä¸‹çš„è¡¥ä¸æ¥è¦†ç›–è·ŸDEVçŽ¯å¢ƒç›¸å…³çš„ä¿¡æ¯å£°æ˜Žï¼Œå¦‚é›†ç¾¤åç§°ã€åŸŸåã€ ä¸ºExternal DNS podæ‰€åˆ›å»ºAWS IAM Roleçš„ARNã€‚\n1apiVersion: helm.toolkit.fluxcd.io/v2beta1 2kind: HelmRelease 3metadata: 4 name: external-dns 5spec: 6 values: 7 txtOwnerId: gitops-cluster 8 domainFilters[0]: test.kane.mx 9 policy: sync 10--- 11apiVersion: v1 12kind: ServiceAccount 13metadata: 14 name: external-dns 15 annotations: 16 eks.amazonaws.com/role-arn: \u0026gt;- 17 arn:aws:iam::845861764576:role/gitops-cluster-external-dns-role æœ€ä½³å®žè·µ å……åˆ†åˆ©ç”¨ Kustomize çš„ Overlays æœºåˆ¶æ¥æŠ½è±¡é€šç”¨çš„é…ç½®å’Œè¦†ç›–æ¯ä¸ªçŽ¯å¢ƒæ‰€å¯¹åº”çš„ç‰¹æ®Šéƒ¨åˆ†ã€‚\næœ€ä½³å®žè·µ å°†å…±äº«ç»„ä»¶éƒ¨ç½²åœ¨éž Flux å‘½åç©ºé—´(é»˜è®¤flux-system)ï¼Œé¿å…æ¸…ç† Flux æ—¶å½±å“è¿è¡Œä¸­çš„éƒ¨ç½²ã€‚\nåŒæ ·åœ¨DEVçŽ¯å¢ƒéªŒè¯External DNSç»„ä»¶éƒ¨ç½²æˆåŠŸåŽï¼Œå°†ç›¸ä¼¼çš„é…ç½®åº”ç”¨åˆ°STAGINGå’ŒPRODUCTçŽ¯å¢ƒã€‚ é€šè¿‡Kustomizeçš„Overlaysåˆ†åˆ«è®¾ç½®STAGINGå’ŒPRODUCTçŽ¯å¢ƒç›¸å…³çš„é…ç½®ã€‚å†å°†å˜æ›´æŽ¨é€åˆ°Gitä»“åº“ï¼Œ Fluxå°†ä¼šä¸ºæˆ‘ä»¬éƒ¨ç½²è¿™äº›å£°æ˜Žåœ¨Gitä»“åº“ä¸­çš„ç»„ä»¶ï¼å¯æŸ¥é˜…DEV, STAGING, PRODUCTè¿™ä¸‰ä¸ªæäº¤æŸ¥çœ‹å®Œæ•´å®žçŽ°ã€‚\n3. å¯†é’¥çš„ç®¡ç† æœ€ä½³å®žè·µ 2022/06æ›´æ–°ï¼šä½¿ç”¨æˆç†Ÿçš„K8Sé›†ç¾¤å¤–ç½®çš„å¯†é’¥ç®¡ç†æœåŠ¡å¯ä»¥å¾ˆå¥½çš„å°†æˆç†Ÿå¯†é’¥ç®¡ç†æœ€ä½³å®žè·µå’ŒK8SåŽŸç”Ÿç”Ÿæ€é›†æˆåœ¨ä¸€èµ·ã€‚ è¯¦è§åšæ–‡ä½¿ç”¨å¤–éƒ¨Secrets Managerç®¡ç†Kuberneteså¯†é’¥ã€‚\nGitOps çš„ç†å¿µæ˜¯å°†ä¸€åˆ‡é…ç½®ä»¥å£°æ˜Žå¼æ–‡æœ¬æ–¹å¼ä¿å­˜åœ¨ä»“åº“ä¸­ã€‚è€Œå¯¹ä¿å­˜ Kubernetes Secrets æ˜¯ä¸ªæŒ‘æˆ˜ï¼Œ å› ä¸º Git ä»“åº“å¯¹æ‰€æœ‰è¯»æƒé™çš„ç”¨æˆ·å…¬å¼€ï¼Œç”šè‡³é¡¹ç›®çš„ä»“åº“æ˜¯å¼€æºã€‚Flux é€šè¿‡æ”¯æŒ Bitnami Sealed Secrets å’Œ Mozilla SOPS å®‰å…¨çš„åœ¨ Git ä»“åº“ä¸­ç®¡ç†å¯†é’¥ã€‚æŽ¥ä¸‹æ¥å°†ç¤ºä¾‹å¦‚ä½•ä½¿ç”¨ Sealed Secrets ä¸º MariaDB åˆ›å»ºå¯†ç ã€‚\né¦–å…ˆä½¿ç”¨ HelmRelease éƒ¨ç½² Bitnami Sealed Secretsã€‚ç±»ä¼¼ä¸Šé¢éƒ¨ç½² External DNSï¼Œå°† sealed secrets æ·»åŠ åˆ° infrastructure/base é‡Œä½œä¸ºå…±äº«ç»„ä»¶ã€‚ 1apiVersion: helm.toolkit.fluxcd.io/v2beta1 2kind: HelmRelease 3metadata: 4 name: sealed-secrets 5 namespace: kube-system 6spec: 7 chart: 8 spec: 9 chart: sealed-secrets 10 sourceRef: 11 kind: HelmRepository 12 name: sealed-secrets 13 version: \u0026#34;\u0026gt;=1.15.0-0\u0026#34; 14 interval: 1h0m0s 15 releaseName: sealed-secrets-controller 16 targetNamespace: kube-system 17 install: 18 crds: Create 19 upgrade: 20 crds: CreateReplace æŒ‰ç…§ Flux çš„ Sealed Secrets æ–‡æ¡£ï¼Œå®‰è£… kubesealã€‚ ä½¿ç”¨ kubeseal ä»Žé›†ç¾¤ä¸­ä¸‹è½½å…¬é’¥ã€‚ 1kubeseal --fetch-cert \\ 2--controller-name=sealed-secrets-controller \\ 3--controller-namespace=kube-system \\ 4\u0026gt; pub-sealed-secrets-dev.pem ä¸º Bitnami MariaDB ç”Ÿæˆå¯†é’¥ã€‚ 1kubectl -n kube-system create secret generic prestashop-mariadb \\ 2--from-literal=mariadb-root-password=\u0026lt;put the ariadb root password here\u0026gt; \\ 3--from-literal=mariadb-replication-password=\u0026lt;put the replication password here\u0026gt; \\ 4--from-literal=mariadb-password=\u0026lt;put the mariadb password here\u0026gt; \\ 5--dry-run=client \\ 6-o yaml \u0026gt; /tmp/mariadb-secrets.yaml ä»Ž K8S å†…ç½®çš„ Opaque Secrets æ ¼å¼æ–‡ä»¶ç”Ÿæˆ sealed secretã€‚ 1kubeseal --format=yaml --cert=pub-sealed-secrets-dev.pem \\ 2\u0026lt; /tmp/mariadb-secrets.yaml \u0026gt; infrastructure/overlays/development/prestashop-mariadb-secrets.yaml éƒ¨ç½² Bitnami Helm Chart MariaDBï¼Œä½¿ç”¨æå‰åˆ›å»ºçš„å¯†é’¥ä½œä¸º DB çš„å¯†é’¥ã€‚ 1apiVersion: helm.toolkit.fluxcd.io/v2beta1 2kind: HelmRelease 3metadata: 4 name: prestashop-mariadb 5spec: 6 releaseName: mariadb 7 chart: 8 spec: 9 chart: mariadb 10 sourceRef: 11 kind: HelmRepository 12 name: bitnami 13 namespace: kube-system 14 version: 10.4.0 15 interval: 1h0m0s 16 install: 17 remediation: 18 retries: 3 19 valuesFrom: 20 - kind: ConfigMap 21 name: prestashop-values 22--- 23auth: 24 existingSecret: prestashop-mariadb 25primary: 26 persistence: 27 enabled: false 28 storageClass: standard æœ€ä½³å®žè·µ åˆ‡è®°ä½¿ç”¨ Sealed Secrets, SOPS ç­‰å·¥å…·ä»…å°†åŠ å¯†åŽçš„å¯†é’¥æäº¤åˆ° Git ä»“åº“ï¼Œé¿å…å¯†é’¥çš„æ³„éœ²ï¼\næŸ¥é˜…DEV, STAGING, PRODUCTè¿™ä¸‰ä¸ªæäº¤æŸ¥çœ‹å®Œæ•´ sealed secrets ä½¿ç”¨ã€‚\n4. é€šçŸ¥é›†æˆ åœ¨è¿ç»´é›†ç¾¤çš„æ—¶å€™ï¼Œä¸åŒçš„å›¢é˜Ÿæœ‰è®¢é˜…ä¸åŒçš„ GitOps æµæ°´çº¿é€šçŸ¥çš„éœ€æ±‚ã€‚ ä¾‹å¦‚ï¼Œoncall å›¢é˜Ÿå°†æ”¶åˆ°æœ‰å…³é›†ç¾¤ä¸­åè°ƒå¤±è´¥çš„è­¦æŠ¥ï¼Œ è€Œå¼€å‘å›¢é˜Ÿå¯èƒ½å¸Œæœ›åœ¨éƒ¨ç½²æ–°ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºä»¥åŠéƒ¨ç½²æ˜¯å¦å¥åº·æ—¶æ”¶åˆ°è­¦æŠ¥ã€‚\nFlux å†…ç½®äº†åŒ Slack, MS Teams, Discord ç­‰çŸ¥å IM å·¥å…·çš„é›†æˆï¼Œä¹Ÿæ”¯æŒå°†æ¶ˆæ¯å‘é€åˆ° webhook æŽ¥å£ï¼Œ ç”±ç”¨æˆ·è‡ªè¡Œå®žçŽ°æ¶ˆæ¯é€šçŸ¥ã€‚\nä¸‹é¢ä»¥ Slack ä¸ºä¾‹ï¼Œç¤ºä¾‹å¦‚ä½•é›†æˆ GitOps æµæ°´çº¿æ¶ˆæ¯ã€‚\nå®šä¹‰ä¸€ä¸ªåä¸º slack çš„ Flux è‡ªå®šä¹‰èµ„æº Provider 1apiVersion: notification.toolkit.fluxcd.io/v1beta1 2kind: Provider 3metadata: 4 name: slack 5 namespace: kube-system 6spec: 7 type: slack 8 secretRef: 9 name: slack-url å› ä¸º Slack WebHook å¹¶æ²¡æœ‰é¢å¤–çš„é‰´æƒä¿æŠ¤ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸Šä¸€èŠ‚çš„å¯†é’¥ç®¡ç†æœºåˆ¶åŠ å¯†ä¿å­˜åœ¨ Git ä»“åº“çš„ slack webhook urlï¼Œ åŒæ—¶ Provider å¼•ç”¨ Secrets å¯¹è±¡ä¸­ä¿å­˜çš„ urlã€‚ 2. åˆ›å»º Flux Alert å¯¹è±¡è®¢é˜…å‘½åç©ºé—´çš„å„ç±» Flux å¯¹è±¡äº‹ä»¶ï¼Œå¹¶ä¸”åŒç¬¬ä¸€æ­¥å®šä¹‰çš„ Provider å…³è”ã€‚ 3. å½“åˆ›å»ºå¤šä¸ª Alert å’Œä¸åŒçš„ Provider å…³è”ï¼Œå¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„ Slack channel ç”šè‡³æ˜¯ä¸åŒçš„ IMã€‚\n1apiVersion: notification.toolkit.fluxcd.io/v1beta1 2kind: Alert 3metadata: 4 name: flux-alert 5 namespace: kube-system 6spec: 7 providerRef: 8 name: slack 9 eventSeverity: info 10 eventSources: 11 - kind: GitRepository 12 name: \u0026#39;*\u0026#39; 13 - kind: Kustomization 14 name: \u0026#39;*\u0026#39; 15 - kind: HelmRelease 16 name: \u0026#39;*\u0026#39; 17--- 18apiVersion: notification.toolkit.fluxcd.io/v1beta1 19kind: Alert 20metadata: 21 name: kube-system-alert 22 namespace: kube-system 23spec: 24 providerRef: 25 name: slack 26 eventSeverity: info 27 eventSources: 28 - kind: Kustomization 29 name: \u0026#39;*\u0026#39; 30 namespace: \u0026#39;kube-system\u0026#39; 31 - kind: HelmRelease 32 name: \u0026#39;*\u0026#39; 33 namespace: \u0026#39;kube-system\u0026#39; æŸ¥é˜…DEV, STAGING, PRODUCTè¿™ä¸‰ä¸ªæäº¤æŸ¥çœ‹å®Œæ•´ commits å¦‚ä½•åœ¨ä¸åŒçŽ¯å¢ƒé›†ç¾¤ä¸­éƒ¨ç½²äº† Slack é€šçŸ¥é›†æˆã€‚\nå›¾1ï¼šSlack channel è®¢é˜… GitOps æµæ°´çº¿æ¶ˆæ¯é€šçŸ¥ æœ€ä½³å®žè·µ é’ˆå¯¹è®¢é˜…ä¸åŒå‘½åç©ºé—´(éžAlertå¯¹è±¡å®šä¹‰çš„å‘½ä»¤ç©ºé—´)çš„äº‹ä»¶é€šçŸ¥ï¼Œéœ€è¦æ˜¾ç¤ºæŒ‡å®šå‘½åç©ºé—´å±žæ€§ã€‚\n5. GitOps ä»£ç çš„ CI GitOps æ¨¡å¼å¸¦æ¥çš„åˆä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥ä½¿ç”¨ä¼ä¸šæˆç†Ÿä¸”æƒ¯ç”¨çš„ä»£ç ç®¡ç†å·¥ä½œæµæ¥è‡ªåŠ¨åŒ–éªŒè¯å˜æ›´åŠä»£ç å®¡æ ¸å®¡æ‰¹ã€‚ é’ˆå¯¹ GitOps ä»£ç å¯ä»¥å¼•å…¥å¦‚ä¸‹ CI æ­¥éª¤ï¼Œ\nç”±äºŽ Flux å¤§é‡ä½¿ç”¨ Kustomize æ¥ç”Ÿæˆæœ€ç»ˆçš„å£°æ˜Žå¼é…ç½®ï¼Œå¯ä»¥å®žçŽ°åœ¨æ¯æ¬¡æäº¤ Pull Request/Merge Request åŽçš„éªŒè¯é˜¶æ®µå¼•å…¥ kustomize CLI éªŒè¯ GitOps é…ç½®æ˜¯å¦å¯ä»¥æ­£ç¡®çš„è¢«ç”Ÿæˆã€‚åŒæ—¶ï¼Œä½¿ç”¨ Flux OpenAPI ç»“åˆ kubeconform éªŒè¯ Kubernetes å†…ç½®èµ„æºå’Œ Flux CRD ç±»åž‹æ˜¯å¦é…ç½®æ­£ç¡®ã€‚ å€ŸåŠ© KIND(Kubernetes in Docker) å®žçŽ°å®Œæ•´çš„ç«¯åˆ°ç«¯æµ‹è¯•ã€‚KIND å®žçŽ°äº† Docker å®¹å™¨æ‰“åŒ…çš„ Kubernetes çŽ¯å¢ƒï¼Œ å¯ä»¥æ¯æ¬¡ PR éªŒè¯é˜¶æ®µå¯åŠ¨æ–°çš„ KIND çŽ¯å¢ƒä¸”å®‰è£… Flux åŽï¼Œæ‰§è¡Œ GitOps ä»£ç çš„ reconciliationï¼Œ éªŒè¯ GitOps ä»£ç é…ç½®çš„èµ„æºæ˜¯å¦å¯ä»¥è¢«åˆ›å»ºä¸”çŠ¶æ€ä¸ºREADYã€‚ å€ŸåŠ© Git æœåŠ¡çš„ CI èƒ½åŠ›ï¼Œå¦‚ Github Actions, Gitlab CI/CD ç­‰ï¼Œ å®žçŽ° GitOps ä»£ç çš„ä¸Šè¿°ä¸¤ç§è‡ªåŠ¨åŒ–æ£€æŸ¥ï¼Œä»¥åŠåŒä»£ç å®¡æ ¸å®¡æ‰¹é›†æˆã€‚ æŸ¥é˜…æ­¤ Github Actions workflow é…ç½®å®žçŽ°åœ¨ KIND çŽ¯å¢ƒ End-To-End éªŒè¯ GitOps é…ç½®ï¼Œå’Œ å£°æ˜Žå¼é…ç½® Manifests éªŒè¯ã€‚\næœ€ä½³å®žè·µ åˆ©ç”¨ Github Actions æˆ– Gitlab CI/CD éžå¸¸å®¹æ˜“çš„å°† GitOps ä»£ç é›†æˆåˆ° CI çŽ¯å¢ƒï¼Œ é€šè¿‡ KIND/Kubeconform éªŒè¯ä»£ç çš„æ­£ç¡®æ€§ã€‚\n6. å°ç»“ æœ¬æ–‡ä»‹ç»ä½¿ç”¨ GitOps å·¥å…· FluxCD v2 å®žçŽ°äº†ç®¡ç†å¤šè´¦æˆ·å¤š VPC çŽ¯å¢ƒä¸‹çš„ Kubernetes é›†ç¾¤çš„å…±äº«ç»„ä»¶ï¼Œå®žè·µäº† Secrets ä½¿ç”¨çš„æœ€ä½³å®žè·µï¼Œ CD éƒ¨ç½²äº‹ä»¶åŒ IM(Slack) çš„é›†æˆï¼Œæœ€ç»ˆç¤ºä¾‹äº†é€šè¿‡ GitOps ä»£ç çš„ CI æµç¨‹æ¥æé«˜ GitOps ä»£ç çš„è´¨é‡ï¼Œå‡å°‘éƒ¨ç½²ä¸­æ–­äº‹æ•…ã€‚ å¯åœ¨æ­¤ä»“åº“èŽ·å–å®Œæ•´çš„ GitOps ä»£ç ã€‚\nä¸‹ç¯‡å°†ä»‹ç»åŸºäºŽ Flux å®žçŽ° GitOps å·¥ä½œæ¨¡åž‹ä¸‹çš„å…±äº«æœåŠ¡å¹³å°ã€‚\n","link":"https://kane.mx/posts/gitops/flux-in-action-1/","section":"posts","tags":["GitOps","Kubernetes","Flux","Git","EKS","CD","Continuous Delivery"],"title":"åŸºäºŽ Flux çš„ GitOps å®žæˆ˜ï¼ˆä¸Šï¼‰"},{"body":"","link":"https://kane.mx/tags/argocd/","section":"tags","tags":null,"title":"ArgoCD"},{"body":"ä»Šå¤© Kuberentes å·²ç»æˆä¸ºITåŸºç¡€è®¾æ–½çš„é‡è¦çŽ©å®¶ï¼Œå®¹å™¨ç¼–æŽ’é¢†åŸŸçš„äº‹å®žæ ‡å‡†ã€‚å†™äºŽ3å¹´å‰çš„æ–‡ç« ä¸è¦è‡ªå»º Kuberentes çš„è§‚ç‚¹å·²ç»è¢«ç»å¤§å¤šæ•°çš„ä¼ä¸šæ‰€è®¤å¯å’ŒæŽ¥å—ã€‚\nç„¶è€ŒåŒä¼—å¤šä¼ä¸šæŽ¥è§¦ä¸­å‘çŽ°ï¼Œä¼ä¸šæœ‰å¾ˆé«˜çš„æ„æ„¿é‡‡ç”¨ Kuberentes ç®¡ç†å·¥ä½œè´Ÿè½½ï¼Œå¹¶ä¸”å·²æœ‰å¤§é‡çš„ä¼ä¸šå·²ç»å°† Kuberentes ç”¨äºŽç”Ÿäº§çŽ¯å¢ƒã€‚ ä½†å¦‚ä½•å¯¹å¤šå¥—ä¸åŒé˜¶æ®µçš„ Kuberentes é›†ç¾¤æ¥åšæŒç»­éƒ¨ç½²ï¼Œåšåˆ°é«˜å®‰å…¨æ€§ã€æƒé™åˆ†ç¦»ã€å¯å®¡è®¡ã€ä¿è¯ä¸šåŠ¡å›¢é˜Ÿçš„æ•æ·ç­‰éœ€æ±‚æ„Ÿåˆ°å›°æƒ‘ã€‚ ç›®å‰å®¢æˆ·å®žçŽ°æ–¹å¼éžå¸¸å¤šæ ·ï¼Œå¹¶æ²¡æœ‰å¾ˆå¥½çš„éµå¾ªä¸šç•Œçš„æœ€ä½³å®žè·µã€‚\nGitOps æ˜¯ç›®å‰æœ€ä½³çš„ä¸€ç§æ–¹æ³•æ¥å®žçŽ°åŸºäºŽ Kuberentes é›†ç¾¤çš„æŒç»­éƒ¨ç½²ï¼Œä¸”åŒæ—¶æ»¡è¶³å®‰å…¨æ€§ã€æƒé™åˆ†ç¦»ç­‰ä¼ä¸šçº§éœ€æ±‚ã€‚\nä»€ä¹ˆæ˜¯ GitOps GitOps æ˜¯ä¸€ç§ä¸ºäº‘åŽŸç”Ÿåº”ç”¨ç¨‹åºå®žæ–½æŒç»­éƒ¨ç½²çš„æ–¹æ³•ã€‚ å®ƒé€šè¿‡ä½¿ç”¨å¼€å‘äººå‘˜å·²ç»ç†Ÿæ‚‰çš„å·¥å…·ï¼ŒåŒ…æ‹¬ Git å’ŒæŒç»­éƒ¨ç½²å·¥å…·ï¼Œ ä¸“æ³¨äºŽåœ¨æ“ä½œåŸºç¡€æž¶æž„æ—¶ä»¥å¼€å‘äººå‘˜ä¸ºä¸­å¿ƒçš„ä½“éªŒã€‚\nGitOps çš„æ ¸å¿ƒæ€æƒ³åŒ…æ‹¬ï¼Œ\næ‹¥æœ‰ä¸€ä¸ª Git å­˜å‚¨åº“ï¼Œè¯¥å­˜å‚¨åº“å§‹ç»ˆåŒ…å«å¯¹ç”Ÿäº§çŽ¯å¢ƒä¸­å½“å‰æ‰€éœ€åŸºç¡€è®¾æ–½çš„å£°æ˜Žæ€§æè¿°ï¼Œä»¥åŠä¸€ä¸ªä½¿ç”Ÿäº§çŽ¯å¢ƒä¸Žå­˜å‚¨åº“ä¸­æè¿°çš„çŠ¶æ€ç›¸åŒ¹é…çš„è‡ªåŠ¨åŒ–è¿‡ç¨‹ æœŸæœ›çš„çŠ¶æ€ä»¥å¼ºåˆ¶ä¸å˜æ€§å’Œç‰ˆæœ¬æŽ§åˆ¶çš„æ–¹å¼å­˜å‚¨ï¼Œå¹¶ä¿ç•™å®Œæ•´çš„ç‰ˆæœ¬åŽ†å² å¦‚æžœæ‚¨æƒ³éƒ¨ç½²ä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºæˆ–æ›´æ–°ä¸€ä¸ªçŽ°æœ‰çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨åªéœ€è¦æ›´æ–°å­˜å‚¨åº“ï¼Œè½¯ä»¶ä»£ç†è‡ªåŠ¨ä»Žæºä¸­æå–æ‰€éœ€çš„çŠ¶æ€å£°æ˜Žï¼Œè‡ªåŠ¨åŒ–è¿‡ç¨‹ä¼šå¤„ç†å…¶ä»–æ‰€æœ‰äº‹æƒ… è½¯ä»¶ä»£ç†æŒç»­è§‚å¯Ÿå®žé™…ç³»ç»ŸçŠ¶æ€å¹¶å°è¯•åº”ç”¨æ‰€éœ€çŠ¶æ€ åŒä¼ ç»Ÿçš„æŒç»­éƒ¨ç½²ç³»ç»Ÿå¯¹æ¯”å¦‚ä¸‹ï¼Œ\nä¼ ç»Ÿ CD ç³»ç»Ÿ GitOps ç³»ç»Ÿ ç”±æŽ¨é€äº‹ä»¶è§¦å‘ï¼Œå¦‚ä»£ç æäº¤ã€å®šæ—¶ä»»åŠ¡ã€æ‰‹åŠ¨ç­‰ ç³»ç»Ÿä¸æ–­è½®è¯¢å˜æ›´ ä»…éƒ¨ç½²å˜æ›´çš„éƒ¨åˆ† ä¸ºä»»ä½•éƒ¨ç½²å£°æ˜Žäº†æ•´ä¸ªç³»ç»Ÿ ç³»ç»Ÿå¯èƒ½ä¼šåœ¨éƒ¨ç½²ä¹‹é—´æ¼‚ç§» ç³»ç»Ÿå°†çº æ­£ä»»ä½•æ¼‚ç§» CD ç¨‹åºå¿…é¡»æœ‰æƒè®¿é—®éƒ¨ç½²çŽ¯å¢ƒ éƒ¨ç½²ç®¡é“åœ¨ç³»ç»ŸèŒƒå›´å†…è¢«æŽˆæƒè¿è¡Œ GitOps ä¸ä¼šå¤„ç†å¦‚ä¸‹å£°æ˜Žï¼Œ\næŒä¹…åŒ–çš„åº”ç”¨æ•°æ®ï¼Œä¾‹å¦‚æ¥è‡ªç”¨æˆ·ä¸Šä¼  åŸºäºŽ Schema çš„éƒ¨ç½²ï¼Œä¾‹å¦‚æ•°æ®åº“ schema å³ä½¿é‡‡ç”¨äº† GitOps éƒ¨ç½²ï¼Œå¯¹äºŽä»¥ä¸Šæ•°æ®çš„å¤‡ä»½å’Œæ¢å¤åŒæ ·å¾ˆé‡è¦ã€‚\nå£°æ˜Žå¼é…ç½®æ˜¯ Kuberentes ä»Ž Day 1 å¼€å§‹æä¾›æ”¯æŒçš„ï¼Œ å¯ä»¥è¯´ Kuberentes å£°æ˜Žå¼é…ç½®å¾ˆå¥½çš„åŒ¹é…äº† GitOps åŽŸç†ä¸­çš„å£°æ˜Žæ€§æè¿°éœ€æ±‚ã€‚ ç»“åˆè‡ªå®šä¹‰èµ„æºå®šä¹‰å°†å£°æ˜Žå¼é…ç½®æ‰©å±•åˆ°äº†è‡ªå®šä¹‰èµ„æºï¼ŒK8S ä¸­çš„è‡ªå®šä¹‰èµ„æºä¹Ÿå¯ä»¥ æ— ç¼çš„é€‚é… GitOps éƒ¨ç½²æ–¹æ³•ã€‚\nKuberentes ä¸Š GitOps æœ€ä½³å®žè·µ GitOps æ–¹æ³•ä¸‹ï¼ŒGit æˆä¸ºç³»ç»Ÿæ‰€éœ€çŠ¶æ€çš„å”¯ä¸€äº‹å®žæ¥æºï¼Œæ”¯æŒå¯é‡å¤çš„è‡ªåŠ¨åŒ–éƒ¨ç½²ã€é›†ç¾¤ç®¡ç†å’Œç›‘æŽ§ã€‚ å¤ç”¨ä¼ä¸šä¸­å·²ç»éžå¸¸æˆç†Ÿçš„ Git å·¥ä½œæµç¨‹æ¥å®Œæˆç¼–è¯‘ã€æµ‹è¯•ã€æ‰«æç­‰æŒç»­é›†æˆæ­¥éª¤ï¼Œ å½“ç³»ç»Ÿæœ€ç»ˆçŠ¶æ€çš„å£°æ˜Žä»£ç è¿›å…¥ Git ä»“åº“ä¸»çº¿åˆ†æ”¯åŽï¼Œä¾æ‰˜ GitOps å·¥å…·é“¾æ¥å®ŒæˆéªŒè¯éƒ¨ç½²ï¼Œåˆ°è§‚æµ‹å‘Šè­¦ï¼Œ åˆ°æ“ä½œä¿®å¤è¾¾åˆ°ç³»ç»Ÿæœ€ç»ˆçŠ¶æ€çš„é—­çŽ¯(è§å›¾1)ã€‚\nå›¾1ï¼šGitOps -- ä¸€ä¸ªæŒç»­è¿ç»´çš„æ¨¡åž‹ ä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹çœ‹ç†æƒ³ä¸­çš„ Kuberentes ä¸Šçš„ GitOps æœ€ä½³å®žè·µã€‚\nåŸºäºŽ GitOps çš„æŒç»­éƒ¨ç½² ä»¥ä¸‹æ˜¯åŸºäºŽ GitOps çš„ Kuberentes éƒ¨ç½²æµç¨‹ï¼Œ\nå¼€å‘è€…æäº¤åº”ç”¨ä»£ç å’Œé…ç½®åˆ°æºä»£ç ä»“åº“ã€‚ æŒç»­é›†æˆæœåŠ¡å™¨ç¼–è¯‘ã€æµ‹è¯•ã€æ‰«æå¹¶ä¸”æŽ¨é€æ–°ç‰ˆæœ¬çš„é•œåƒåˆ°é•œåƒä»“åº“ï¼ŒåŒæ—¶æ›´æ–° K8S manifests åˆ° Git ä»“åº“ã€‚ GitOps ä»£ç†(å¦‚ ArgoCD/Flux) æ£€æµ‹åˆ° Git ä»“åº“å˜æ›´å¹¶è‡ªåŠ¨å˜åŠ¨åˆ° K8S é›†ç¾¤ã€‚ å›¾2ï¼šåŸºäºŽ GitOps çš„æŒç»­éƒ¨ç½²åž‹ åŸºäºŽ GitOps çš„å¤šé›†ç¾¤ç®¡ç† å½“ Pull Request è¢«åˆå¹¶åˆ°å¹³å°ä»“åº“ï¼Œé…ç½®åœ¨å¤šé›†ç¾¤ä¸Šçš„ GitOps ä»£ç†å°†ç›‘æŽ§è¿™ä¸ªä»“åº“ï¼Œ å¹¶ä¸”éƒ¨ç½²è¿™äº›æ›´æ–°åˆ° kube-system æˆ–è€…å¹³å°å‘½åç©ºé—´ã€‚ æ¯ä¸ªé›†ç¾¤æœ‰ä¸€ä¸ªé›†ç¾¤ä»“åº“ç”¨äºŽå­˜å‚¨é…ç½®ï¼Œä¾‹å¦‚è®¿é—®æŽ§åˆ¶ã€DNSç­‰ã€‚åŒæ—¶æ¯ä¸ªé›†ç¾¤é€šè¿‡å¹³å°ä»“åº“ åŒä¸Šæ¸¸å¹³å°åŒæ­¥ã€‚ å›¾3ï¼šåŸºäºŽ GitOps çš„å¤šé›†ç¾¤ç®¡ç† GitOps ä¸‹çš„åº”ç”¨å¼€å‘ä½“éªŒ ä¸šåŠ¡å›¢é˜Ÿè´Ÿè´£é•œåƒçš„ç¼–è¯‘ã€æµ‹è¯•å’Œæ‰«æç­‰ã€‚å£°æ˜Žé…ç½®è¢«æäº¤åˆ°ä¸šåŠ¡/åº”ç”¨ç‰¹å®šçš„é…ç½®ä»“åº“ã€‚ GitOps ä»£ç†è¿è¡Œåœ¨ç‰¹å®šçš„ç§Ÿæˆ·å‘½åç©ºé—´ï¼Œåº”ç”¨çš„çŠ¶æ€ä»Žåº”ç”¨å›¢é˜Ÿçš„ä»“åº“åŒæ­¥åˆ°ç‰¹å®šçš„ç§Ÿæˆ·å‘½åç©ºé—´ã€‚ å›¾4ï¼šGitOps ä¸‹çš„åº”ç”¨å¼€å‘ æ”¯æŒå¤šç§Ÿæˆ·çš„é›†ç¾¤ åŒä¸Šï¼Œä¸åŒçš„ä¸šåŠ¡/åº”ç”¨å›¢é˜Ÿæœ‰å„è‡ªçš„é…ç½®ä»“åº“ã€‚åœ¨é›†ç¾¤ä¸­ï¼Œä¸åŒçš„ä¸šåŠ¡/åº”ç”¨ç”±ä¸åŒçš„å‘½åç©ºé—´éš”ç¦»ï¼Œ è¢« GitOps ä»£ç†æŒç»­éƒ¨ç½²åœ¨å„è‡ªä¸åŒçš„å‘½åç©ºé—´ä¸­ã€‚\nå›¾5ï¼šGitOps å¤šç§Ÿæˆ·æ”¯æŒ ä½¿ç”¨ Helm ç®¡ç†åº”ç”¨ç¨‹åº Helm æ˜¯ Kuberentes ç”Ÿæ€ä¸‹çš„åŒ…ç®¡ç†å™¨ï¼Œç±»ä¼¼ Debian ä¸‹çš„ aptã€‚ å¯¹ Helm æä¾›æ— ç¼çš„æ”¯æŒå°†å¯ä»¥åˆ©ç”¨åˆ°çŽ°æœ‰æˆç†Ÿçš„K8Såº”ç”¨æ‰“åŒ…ç”Ÿæ€ï¼Œæ— è®ºæ˜¯éƒ¨ç½²ä¸‰æ–¹ç»„ä»¶è¿˜æ˜¯ä¼ä¸šå·²ç»å­˜åœ¨çš„åº”ç”¨ã€‚\nå¯¹å¤šçŽ¯å¢ƒçš„éƒ¨ç½²ç®¡ç† åœ¨ä¼ä¸šåº”ç”¨ä¸­å¤šå¥—çŽ¯å¢ƒã€å¤šäº‘ã€æ··åˆäº‘çš„åœºæ™¯æ˜¯éžå¸¸å¸¸è§çš„ï¼Œå¯¹åº”ç”¨çš„éƒ¨ç½²éœ€è¦é€šè¿‡åŸºç¡€æ¸…å•åŠ ä¸Šå„ä¸ªçŽ¯å¢ƒä¸ªæ€§åŒ–çš„æ¸…å•æ¥ ç®€åŒ–å¯¹å¤šå¥—çŽ¯å¢ƒçš„éƒ¨ç½²ç®¡ç†ã€‚\nKustomize æ­£æ˜¯ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜è€Œåˆ›å»ºï¼Œå¹¶ä¸”å·²ç»æˆä¸º K8S åŽŸç”Ÿå·¥å…·é“¾ä¸­çš„ä¸€éƒ¨åˆ†ã€‚å¯¹ Kustomize æä¾›æ”¯æŒï¼Œ å°†å¾ˆå¥½çš„åœ¨ GitOps ä¸­æ»¡è¶³æ­¤ç±»éœ€æ±‚ã€‚\nå›¾6ï¼šGitOps å¤šçŽ¯å¢ƒæ”¯æŒ ç»¼ä¸Šï¼Œä»ŽæŒç»­éƒ¨ç½²ï¼Œå¤šé›†ç¾¤ç®¡ç†ï¼Œå¤šç§Ÿæˆ·æ”¯æŒå’ŒçŽ°æœ‰å·¥å…·é“¾ã€ç”Ÿæ€é›†æˆæ–¹é¢ï¼Œæè¿°äº†å¯¹ Kubernetes ä¸Š GitOps çš„ç†æƒ³çŠ¶æ€ã€‚æŽ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥è®¨è®ºä¸‹çŽ°æœ‰çš„ GitOps å·¥å…·ï¼Œ æ˜¯å¦å¯ä»¥å¾ˆå¥½çš„æ”¯æŒå‰é¢æç»˜çš„ GitOps çš„ç†æƒ³çŠ¶æ€ã€‚\näº‘åŽŸç”Ÿçš„ GitOps å·¥å…· ç”±äºŽ Kubernetes æ˜¯ CNCF åŸºé‡‘ä¼šçš„æ ¸å¿ƒé¡¹ç›®ï¼Œæ•´ä¸ªç”Ÿæ€ä¼šé¦–å…ˆå…³æ³¨ CNCF åŸºé‡‘ä¼šä¸‹çš„é¡¹ç›®ï¼Œå¯¹ GitOps æ¥è¯´åŒæ ·å¦‚æ­¤ã€‚\nCNCF åœ¨2020å¹´å‘å¸ƒäº† Continuous Delivery æŠ€æœ¯é›·è¾¾ï¼ŒFlux å’Œ Helm ä¸¤ä¸ªé¡¹ç›®è¢«å½’ç±»ä¸º é‡‡ç”¨ï¼ŒKustomize æ˜¯è¢«å½’ç±»ä¸ºè¯•ç”¨ï¼ŒArgo CD åœ¨é›·è¾¾ä¸­ä¸ºæŠ€æœ¯è¯„ä¼°ã€‚\nCNCF åœ¨2021å¹´å‘å¸ƒçš„ Multicluster Management æŠ€æœ¯é›·è¾¾ ä¸­çš„ Core Services and Add-ons ç®¡ç†é›·è¾¾ï¼ŒFlux, Kustomize, Argo å’Œ Helm ç­‰é¡¹ç›®éƒ½è¢«è¯„ä¸ºå¯é‡‡ç”¨ã€‚\nåŸºäºŽå‰é¢å¯¹ GitOps çš„æ ¸å¿ƒå®šä¹‰ï¼ŒCNCF çš„æŠ€æœ¯é›·è¾¾è±¡é™ä»¥åŠç¤¾åŒºçš„å¯¹æ¯”ï¼Œç›®å‰æ•´ä¸ªç¤¾åŒºä¸­æœ€ä¸º æ™®åŠçš„ GitOps å·¥å…·æ˜¯ Argo CD å’Œ Fluxã€‚\nPush è¿˜æ˜¯ Poll? GitOps åœ¨å®žè·µä¸­é¢ä¸´æ˜¯é‡‡ç”¨æŽ¨(push)è¿˜æ˜¯æ‹‰(pull)çš„éƒ¨ç½²é£Žæ ¼é€‰æ‹©ã€‚\né‡‡ç”¨æŽ¨éƒ¨ç½²é£Žæ ¼ä¼šæœ‰å¦‚ä¸‹å¥½å¤„ï¼Œ\nç®€å•æ˜“ç†è§£ã€‚è¿™ç§éƒ¨ç½²æ–¹å¼å·²ç»è¢«ä¼—å¤šçŸ¥åçš„ CI/CD å·¥å…·æ‰€é‡‡ç”¨ï¼Œä¾‹å¦‚ Jenkins CIï¼ŒAWS Codeç³»åˆ—ã€‚ çµæ´»ã€‚æ˜“äºŽåŒå…¶ä»–çš„è„šæœ¬æˆ–å·¥å…·é›†æˆã€‚æ‹‰(pull)é£Žæ ¼çš„ GitOps ä»£ç†åªèƒ½è¿è¡Œåœ¨ Kuberentes ä¸­ã€‚ é‡‡ç”¨æ‹‰éƒ¨ç½²é£Žæ ¼ä¼šæœ‰å¦‚ä¸‹å¥½å¤„ï¼Œ\næ›´åŠ å®‰å…¨ã€‚å› ä¸º GitOps ä»£ç†è¿è¡Œåœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œå› æ­¤ä»…éœ€è¦æœ€å°çš„æƒé™ç”¨äºŽéƒ¨ç½²ã€‚ç®€åŒ–ç½‘ç»œé…ç½®ä¸éœ€è¦è¯¥é›†ç¾¤åŒ CD ç¨‹åºå»ºç«‹ç½‘ç»œè¿žæŽ¥ï¼Œå°¤å…¶åœ¨ç®¡ç†å¤šé›†ç¾¤æ—¶å°¤ä¸ºç®€æ´ã€‚ ä¸€è‡´æ€§ã€‚ç®¡ç†å¤šé›†ç¾¤æ—¶ï¼Œç¡®ä¿äº†æ¯ä¸ªé›†ç¾¤çš„ç®¡ç†æ–¹å¼éƒ½æ˜¯ä¸€æ ·çš„ã€‚ éš”ç¦»æ€§ã€‚æ¯ä¸ªé›†ç¾¤çš„éƒ¨ç½²ä¸ä¾èµ–äºŽé›†ä¸­çš„æµæ°´çº¿ CD ç¨‹åºã€‚ å¯ä¼¸ç¼©æ€§ã€‚è¯¥æ–¹å¼å¯ä»¥å®¹æ˜“çš„æ‰©å±•åˆ°åŒæ—¶ç®¡ç†æˆç™¾ä¸Šåƒçš„é›†ç¾¤ã€‚ ä»Žä»¥ä¸Šå¯¹æ¯”å¯è§ï¼Œé‡‡ç”¨æ‹‰(pull)çš„éƒ¨ç½²é£Žæ ¼ä»Žå®‰å…¨æ€§ã€å¯ä¼¸ç¼©æ€§ã€éš”ç¦»æ€§ã€ä¸€è‡´æ€§éƒ½æ›´ä¼˜ï¼ŒGitOps éƒ¨ç½²æ–¹å¼åº”è¯¥é¦–é€‰æ‹‰éƒ¨ç½²é£Žæ ¼ã€‚\nä¸»æµäº‘åŽŸç”Ÿ GitOps å¯¹æ¯” ä¸‹è¡¨è¯¦ç»†å¯¹æ¯”äº† Argo CD / Flux v2ï¼Œä¾›å‚è€ƒã€‚\nArgoCD Flux v2 å®‰è£…/é…ç½® ä¸€ä¸ªå‘½ä»¤å®‰è£…ï¼Œä½†æ²¡æœ‰åŽŸç”Ÿçš„æœºåˆ¶å®žçŽ°é…ç½®ã€‚éœ€è¦é€šè¿‡ UI æˆ–åˆ›å»ºå¤§é‡æ¸…å• ä¸€ä¸ªå‘½ä»¤å®Œæˆå®‰è£…å’Œé…ç½® éƒ¨ç½²é£Žæ ¼ æŽ¨(push) / æ‹‰(pull) æ‹‰(pull) ç§˜é’¥ç®¡ç†[1] Sealed secrets Sealed secrets / Mozilla SOPS Webhook æŽ¥æ”¶[2] æ”¯æŒ æ”¯æŒ å‘Šè­¦å’Œé€šçŸ¥ å†…ç½®é›†æˆ slackï¼Œemailï¼ŒGoogle Chat ç­‰ã€‚ å†…ç½®é›†æˆ slackï¼Œdiscordï¼ŒMS Teams ç­‰ã€‚ é•œåƒæ›´æ–°è‡ªåŠ¨åŒ– æ”¯æŒ æ”¯æŒ Reconciliation å¯é…ç½®æ€§ æœ‰é™æ”¯æŒï¼ˆåªèƒ½å…¨å±€è®¾ç½® reconciliation æ—¶é—´ï¼Œä¸èƒ½ä¸ºæ¯ä¸ªåº”ç”¨è®¾ç½®ä¸åŒçš„ reconciliation æ—¶é—´ã€‚ï¼‰ æ”¯æŒè®¾ç½® sync(åŒæ­¥) å’Œ reconciliation é—´éš” åº”ç”¨äº¤ä»˜ -- åŽŸç”Ÿ Kuberentes æ¸…å•(YAML) æ˜¯çš„ï¼ŒArgo CD åº”ç”¨ç¨‹åºçš„å‰¯ä½œç”¨æ˜¯éœ€è¦åœ¨é‡è¯•ä¸­é‡æ–°åº”ç”¨èµ„æºã€‚ æ”¯æŒï¼Œè¢«è§†åŒä¸º kustomization yaml åº”ç”¨äº¤ä»˜ -- Kustomization æ”¯æŒ æ”¯æŒï¼Œè¿˜æä¾› GitOps ç»„ä»¶é—´çš„ä¾èµ– åº”ç”¨äº¤ä»˜ -- Helm charts æ”¯æŒï¼Œä½†æ²¡æœ‰ä½¿ç”¨ Helm Go è¯­è¨€ç¨‹åºåº“ã€‚ Helm chart é’©å­è¢«è½¬ä¸º Argo CD syncwaves/hooksã€‚å› æ­¤ï¼Œä¸æ”¯æŒ Helm cliã€‚ æ”¯æŒï¼ŒåŽŸç”Ÿæ”¯æŒ chart é’©å­ï¼Œå¯ä½œä¸ºç»„ä»¶ç›¸äº’ä¾èµ–ã€‚æ”¯æŒ Helm cliã€‚ Web UI æ”¯æŒï¼Œæä¾›äº†å®Œæ•´çš„ UI æ“ä½œã€‚ æ²¡æœ‰å®˜æ–¹ UI å®žçŽ°ã€‚å¼€æºå¹³å° Weave GitOps åŸºäºŽ Flux æä¾› UIã€‚ å¤šç§Ÿæˆ·æƒé™ç®¡ç† æ”¯æŒï¼Œå®žçŽ°äº†ç‹¬ç«‹äºŽ Kubernetes åŸºäºŽè®¿é—®æŽ§åˆ¶åˆ—è¡¨çš„ RBACï¼Œå…·æœ‰ç»†ç²’åº¦æŽ§åˆ¶ã€‚ æ˜¯çš„ï¼Œå®ƒä¸¥æ ¼åŸºäºŽ Kubernetes çš„ RBAC èƒ½åŠ›ï¼Œéœ€è¦ç»“åˆå…¶ä»– CNCF é¡¹ç›®åšç²’åº¦æŽ§åˆ¶ï¼Œæ¯”å¦‚ Kyvernoã€‚ å¤šé›†ç¾¤ç®¡ç† -- å¤šé›†ç¾¤ç®¡ç†å’Œéƒ¨ç½² æ”¯æŒï¼Œå¯¹é›†ç¾¤åšäº†åŽŸç”ŸæŠ½è±¡ã€‚ æ”¯æŒã€‚ç†è®ºä¸Šæ”¯æŒä½¿ç”¨ KubeConfig è®¾ç½®é€šè¿‡ Kustomziation å’Œ Helm åœ¨ä¸€ä¸ª Flux ä¸­ç®¡ç†å¤šä¸ªé›†ç¾¤ä¸Šçš„å·¥ä½œè´Ÿè½½ã€‚ å¤šé›†ç¾¤ç®¡ç† -- åˆ›å»ºé›†ç¾¤ ä¸æ”¯æŒï¼Œéœ€è¦é€šè¿‡ç¬¬ä¸‰æ–¹å·¥å…·ã€‚ä¾‹å¦‚ï¼ŒCAPI, Crossplane, Open Cluster Management ç­‰ã€‚ ä¸æ”¯æŒï¼Œéœ€è¦é€šè¿‡ç¬¬ä¸‰æ–¹å·¥å…·ã€‚ä¾‹å¦‚ï¼ŒCAPI, Crossplane, Open Cluster Management ç­‰ã€‚ GitOps å·¥å…·è‡ªèº«çš„å¯è§‚æµ‹æ€§ é€šè¿‡ Prometheus + Grafana æä¾›ã€‚ é€šè¿‡ Prometheus + Grafana æä¾›ã€‚ é€šè¿‡ä¸Šè¡¨ä»Ž GitOps æ ¸å¿ƒç†å¿µæ¥çœ‹ï¼Œæ— è®º ArgoCD è¿˜æ˜¯ Flux éƒ½æ»¡è¶³ GitOps çš„ç†å¿µã€‚ä¸”æ»¡è¶³äº†ä¼ä¸šçº§éœ€æ±‚ï¼Œå¦‚å¤šç§Ÿæˆ·æƒé™ã€å¤šé›†ç¾¤ç®¡ç†ã€ ç§˜é’¥ç®¡ç†ã€å‘Šè­¦é€šçŸ¥ã€æ”¯æŒ Helm å’Œ Kustomizationã€‚ä»Žè‡ªèº«çš„å®žçŽ°ä¸Šè¯´ï¼ŒArgoCD æä¾›äº†å®Œæ•´çš„æŠ½è±¡ï¼ŒåŒ…æ‹¬ä¸”ä¸é™äºŽ Clusterã€RBACã€Applicationã€Hook ç­‰ã€‚ è¿™æ ·çš„åšæ³•å…·å¤‡äº†æ›´åŠ å¹¿æ³›çš„åŠŸèƒ½é›†çš„å¯èƒ½ï¼Œä½†åŒæ—¶å¢žåŠ äº†è‡ªèº«ç¨‹åºçš„å¤æ‚åº¦ï¼Œä¹Ÿæé«˜äº†ç”¨æˆ·çš„å­¦ä¹ é—¨æ§›ã€‚Flux è‡ªèº«æž¶æž„æ›´åŠ ç®€æ´ï¼Œé»˜è®¤ç»„ä»¶ä»…æœ‰ Source, Kustomize, Helm, Notification, Image automation è¿™5ä¸ªç»„ä»¶ï¼Œå°½é‡å¤ç”¨ Kuberentes åŽŸç”Ÿèƒ½åŠ›ï¼Œä¾‹å¦‚ä½¿ç”¨ ServiceAccount å®žçŽ°å¤šç§Ÿæˆ·çš„ RBAC æŽ§åˆ¶ï¼Œ é™ä½Žäº†ç”¨æˆ·çš„å­¦ä¹ é—¨æ§›ï¼ŒåŒäº‘åŽŸç”Ÿç¤¾åŒºå…¶ä»–é¡¹ç›®çš„å…¼å®¹æ€§æ›´å¼ºã€‚\n[1]: Gitä»“åº“å¯èƒ½å…¬å¼€è¯»ä¸”æ˜Žæ–‡ä¿å­˜ Secrets å¯¹è±¡ï¼Œéœ€è¦å°†å…¶åŠ å¯†åŽå†æäº¤åˆ° Git\n[2]: é»˜è®¤é‡‡ç”¨ Poll è½®è¯¢æ‹‰å– Git ä»“åº“å˜æ›´ï¼Œæä¾› Webhook æŽ¥å£å¯è¢« Git ä»“åº“æäº¤äº‹ä»¶è§¦å‘\nå°ç»“ æœ¬æ–‡ä»‹ç»äº†ä»€ä¹ˆæ˜¯ GitOpsï¼ŒKuberentes ä¸ŠåŸºäºŽ GitOps å®žçŽ°æŒç»­éƒ¨ç½²çš„æœ€ä½³å®žè·µï¼Œä»¥åŠ CNCF ä¸‹ GitOps æ–¹å‘æœ€ä¸ºæµè¡Œé¡¹ç›® Argo CD å’Œ Flux çš„å¯¹æ¯”ã€‚åŽç»­å°†ä»¥ Flux v2 ä¸ºå®žæˆ˜ï¼Œæ·±å…¥ä»‹ç»å¦‚ä½•å®žçŽ° GitOps æŒç»­éƒ¨ç½²ä¸”åŒæ—¶æ»¡è¶³å„ç±»ä¼ä¸šçº§éœ€æ±‚ã€‚\nå‚è€ƒèµ„æ–™ GitOps: Cloud-native Continuous Deployment The CNCF End User Technology Radar Continuous Delivery, June 2020 The CNCF End User Technology Radar Multicluster Management, June 2021 Push vs. Pull in GitOps: Is There Really a Difference? Why is a PULL vs a PUSH pipeline important? GitOps on Kubernetes: Deciding Between Argo CD and Flux ","link":"https://kane.mx/posts/gitops/the-best-practise-of-gitops-in-kubernetes/","section":"posts","tags":["GitOps","Kubernetes","Flux","ArgoCD","Git","CD","Continuous Delivery"],"title":"Kuberentes ä¸Š GitOps æœ€ä½³å®žè·µ"},{"body":"","link":"https://kane.mx/tags/athena/","section":"tags","tags":null,"title":"Athena"},{"body":"","link":"https://kane.mx/tags/cost/","section":"tags","tags":null,"title":"Cost"},{"body":"As a builder in cloud, you might feel confused about which resources cost mostly in your account.\nIn AWS, you can quickly find out which services even functionality cost a lot via AWS Billing or AWS Cost Explorer. However sometimes it sucks on finding out which functions cost mostly if you have hundreds of Lambda functions, or which metrics/log groups cost mostly in Amazon CloudWatch.\nAWS Cost and Usage Reports should be helpful in above scenairos. The AWS Cost and Usage Reports (AWS CUR) contains the most comprehensive set of cost and usage data available, including product and product resource, and tags that you define yourself. You can use Cost and Usage Reports to publish your AWS billing reports to an Amazon S3 bucket that you own. The CUR reports are plain CSV text file, you still need analysis the report to find out the insight what you want. So Amazon Athena is one of simplest and effcientst ways to analyze your cost on demand. See the doc to how set up the Athea to analyze your AWS cost.\nAthena is out-of-the-box integrated with AWS Glue Data Catalog, allowing you to create a unified metadata repository across various services. With Amazon Athena, you pay only for the queries that you run. See my post how using Glue and Athena to analyze images in Docker repository.\nBelow are few samples to find out the mostly cost resources in your AWS account,\n1SELECT line_item_resource_id as resource, sum(line_item_unblended_cost) as total_cost FROM \u0026#34;athenacurcfn_main_account\u0026#34;.\u0026#34;main_account\u0026#34; 2WHERE year=\u0026#39;2022\u0026#39; and month=\u0026#39;1\u0026#39; and product_product_name = \u0026#39;AmazonCloudWatch\u0026#39; 3GROUP BY line_item_resource_id 4ORDER BY total_cost DESC 5LIMIT 10 Sample 1: find out the top 10 costly resources in CloudWatch, including Log Groups, Metrics, Synthetics and so on\n1SELECT line_item_resource_id, sum(line_item_usage_amount) as usage_amount, sum(line_item_blended_cost) as paid_amount FROM \u0026#34;athenacurcfn_main_account\u0026#34;.\u0026#34;main_account\u0026#34; 2 WHERE line_item_product_code=\u0026#39;AWSLambda\u0026#39; and product_group=\u0026#39;AWS-Lambda-Duration\u0026#39; 3 and year=\u0026#39;2022\u0026#39; and month=\u0026#39;1\u0026#39; 4 GROUP BY line_item_resource_id 5 ORDER BY usage_amount desc 6 LIMIT 10; Sample 2: find out the top 10 costly Lambda functions\nYou can refer to Data dictionary of CUR to understand the field definitions of report.\n","link":"https://kane.mx/posts/2022/find-out-most-costly-resource-in-your-aws-account/","section":"posts","tags":["AWS","Cost","Athena","Glue","Tip"],"title":"Find out the most costly resources in your AWS account"},{"body":"","link":"https://kane.mx/tags/glue/","section":"tags","tags":null,"title":"Glue"},{"body":"","link":"https://kane.mx/tags/aws-eks/","section":"tags","tags":null,"title":"AWS EKS"},{"body":"Though you're administrator of your AWS account, you probably see below warnings when viewing your cluster in EKS console.\nYour current user or role does not have access to Kubernetes objects on this EKS cluster.\nIt's caused by the Kuberentes has itself RBAC authorization. And AWS uses IAM to grant permissions to users. You have to map your IAM user or role to K8S RBAC authorization to grant the permissions to access K8S resources in EKS cluster.\nAbove documentation demonstrate how adding IAM roles/users to EKS cluster to grant the roles/users to access K8S resources. However the documentation is not clear to how adding federated users to EKS cluser.\nI'm facing two scenarios of federated AWS users to access K8S resources in EKS console,\nUse corp SSO to access internal system, then logging into AWS account via assuming existing role of the AWS account Use tool like AWS Vault/Alfred workflow to login AWS console via ak/sk of an IAM user Finally turn out below configuration to grant both federated users to access K8S resources in EKS console,\n1apiVersion: v1 2data: 3 mapRoles: | 4 - groups: 5 - system:bootstrappers 6 - system:nodes 7 rolearn: arn:aws:iam::123456789012:role/cluster-nodegroup-n-NodeInstanceRole-1OQT1WT84WVS8 # created by eksctl when bootrapping cluster 8 username: system:node:{{EC2PrivateDNSName}} 9 - groups: 10 - eks-console-dashboard-full-access-group 11 rolearn: arn:aws:iam::123456789012:role/Admin # granting the federated user via assuming role 12 username: Admin/kane 13 mapUsers: | 14 - userarn: arn:aws:sts::123456789012:federated-user/kane # granting the federated user via aws-vault 15 username: ops-user 16 groups: 17 - eks-console-dashboard-full-access-group ","link":"https://kane.mx/posts/2022/grant-federated-users-accessing-k8s-resources-in-eks-console/","section":"posts","tags":["Kubernetes","AWS EKS","Tip","AWS"],"title":"Grant federated users accessing kubernetes resources in EKS console"},{"body":"","link":"https://kane.mx/tags/construct-hub/","section":"tags","tags":null,"title":"Construct Hub"},{"body":"","link":"https://kane.mx/tags/npm/","section":"tags","tags":null,"title":"Npm"},{"body":"","link":"https://kane.mx/tags/projen/","section":"tags","tags":null,"title":"Projen"},{"body":"Construct Hub is a web portal to collect the constructs for AWS CDK, CDK8s and CDKtf. The construct could support multiple programming languages, such as Javascript/TypeScript, Python, Java and C#. Actually the construct is developed by TypeScript, then it's compiled as across languages library by jsii! Any npm/pypi package with certain tags will be discovered by Construct Hub, the package will be automatically recognized as construct package and listed in Construct Hub.\nProjen is a project generator to create project with simplifying the project configuration to support dependencies management, building, unit testing, code style linting, CI/CD via Github actions PR and actions. So projen supports the construct project out of box, which configures construct project with jsii configuration that build the construct to across languages library, though publish the packages to kinds of package registries, such as npmjs, pypi and maven central.\nProjen provides a Publishing capability to publish construct library to supported package managers. For example, npm for JavaScript/TypeScript, it could publish the package to several npm registries, for example, npm public registry, Github packages, AWS CodeArtifact and any public accessible private npm registry.\nHowever the projen only supports publishing the package to single npm registry by default, how about you would like to publish your package to both npm public registry and Github packages?\nThere is no mature way to archive it, but projen is a flexible tool, we can hack it like below to add multiple npm registries support to publish the package to both npm public registry and Github packages,\n1const target = \u0026#39;js\u0026#39;; 2const REPO_TEMP_DIRECTORY = \u0026#39;.repo\u0026#39;; 3const options = { 4 registry: \u0026#39;npm.pkg.github.com\u0026#39;, 5 prePublishSteps: [ 6 { 7 name: \u0026#39;Prepare Repository\u0026#39;, 8 run: `mv ${project.artifactsDirectory} ${REPO_TEMP_DIRECTORY}`, 9 }, 10 { 11 name: \u0026#39;Install Dependencies\u0026#39;, 12 run: `cd ${REPO_TEMP_DIRECTORY} \u0026amp;\u0026amp; ${project.package.installCommand}`, 13 }, 14 { 15 // remove this if your package name already has scope 16 name: \u0026#39;Update package name\u0026#39;, 17 run: `cd ${REPO_TEMP_DIRECTORY} \u0026amp;\u0026amp; sed -i \u0026#34;1,5s/\\\\\u0026#34;packagename\\\\\u0026#34;/\\\\\u0026#34;@scope\\\\/packagename\\\\\u0026#34;/g\u0026#34; package.json`, 18 }, 19 { 20 name: `Create ${target} artifact`, 21 run: `cd ${REPO_TEMP_DIRECTORY} \u0026amp;\u0026amp; npx projen package:js`, 22 }, 23 { 24 name: `Collect ${target} Artifact`, 25 run: `mv ${REPO_TEMP_DIRECTORY}/${project.artifactsDirectory} ${project.artifactsDirectory}`, 26 }, 27 ], 28}; 29project.release.publisher.addPublishJob((_branch, branchOptions) =\u0026gt; { 30 return { 31 name: \u0026#39;npm_github\u0026#39;, 32 publishTools: {}, 33 prePublishSteps: options.prePublishSteps ?? [], 34 run: project.release.publisher.publibCommand(\u0026#39;publib-npm\u0026#39;), 35 registryName: \u0026#39;npm-github\u0026#39;, 36 env: { 37 NPM_DIST_TAG: branchOptions.npmDistTag ?? options.distTag ?? \u0026#39;latest\u0026#39;, 38 NPM_REGISTRY: options.registry, 39 }, 40 permissions: { 41 contents: github.workflows.JobPermission.READ, 42 packages: github.workflows.JobPermission.WRITE, 43 }, 44 workflowEnv: { 45 NPM_TOKEN: \u0026#39;${{ secrets.YOUR_GITHUB_REGISTRY_TOKEN }}\u0026#39;, 46 // if we are publishing to AWS CodeArtifact, pass AWS access keys that will be used to generate NPM_TOKEN using AWS CLI. 47 AWS_ACCESS_KEY_ID: undefined, 48 AWS_SECRET_ACCESS_KEY: undefined, 49 AWS_ROLE_TO_ASSUME: undefined, 50 }, 51 }; 52}); Above code snippet adds an additonal step in release workflow of Github action that is managed by projen, which publishes the package to Github packages.\nHAPPY Projen!\n","link":"https://kane.mx/posts/2022/publishing-npm-packages-to-multiple-registries-with-projen/","section":"posts","tags":["CDK Construct","AWS CDK","npm","projen","continuous delivery","construct hub"],"title":"Publishing npm packages to multiple registries with Projen"},{"body":"è¿‘æœŸåœ¨ä¸€ä¸ª Webinar åˆ†äº«äº†å¦‚ä½•åœ¨ AWS ä¸ŠæœåŠ¡åŽ»ä¸­å¿ƒåŒ–ç ”å‘å›¢é˜Ÿæž„å»ºå…±äº«æœåŠ¡å¹³å°ï¼Œæ ¸å¿ƒè§‚ç‚¹æ€»ç»“å¦‚ä¸‹ï¼Œ\nè¿™é‡Œçš„åŽ»ä¸­å¿ƒåŒ–å›¢é˜Ÿæ˜¯åŒç†æƒ³çš„å®Œå…¨åŒ–çš„ DevOps å›¢é˜Ÿ(è´Ÿè´£è®¾è®¡ã€å¼€å‘ã€æµ‹è¯•ã€è¿ç»´ä»¥åŠè¿è¥ç­‰æ‰€æœ‰çŽ¯èŠ‚)ç›¸å¯¹ç«‹çš„ã€‚ åœ¨è¾ƒå¤§åž‹çš„ç»„ç»‡ä¸­ï¼Œè´¦æˆ·ç®¡ç†ã€ç½‘ç»œè§„åˆ’ã€æœåŠ¡å®¡è®¡ç­‰æ¨¡å—ä¼šç”±å¹³å°ï¼ŒåŸºç¡€è®¾æ–½æˆ–å®‰å…¨å›¢é˜Ÿæ‰€è´Ÿè´£ï¼Œ å¤šä¸ªç ”å‘å›¢é˜Ÿä¼šè´Ÿè´£å„ä¸ªä¸šåŠ¡ç³»ç»Ÿçš„å¼€å‘ã€æµ‹è¯•ã€è¿ç»´ç­‰ã€‚\nå¦‚ä»Šç»„ç»‡çš„å¥åº·è¿è¥å¯¹å®‰å…¨æ€§åˆè§„æ€§è¦æ±‚è¶Šæ¥è¶Šé«˜ï¼Œé€šå¸¸åŸºç¡€è®¾æ–½å›¢é˜Ÿå¤–åŠ å®‰å…¨å›¢é˜Ÿè´Ÿè´£æ‰¿æ‹…å®‰å…¨ã€åˆè§„éœ€æ±‚çš„æ•´ä½“ç­–ç•¥è§„åˆ’åŠå®žæ–½ã€‚ ä½†æ˜¯æ»¡è¶³å®‰å…¨ã€åˆè§„éœ€æ±‚é€šå¸¸æ˜¯åŒä¸šåŠ¡äº¤ä»˜é€Ÿåº¦æœŸæœ›æ˜¯ç›¸æ‚–çš„ã€‚ä¸€æ–¹é¢ï¼Œå¹³å°ã€å®‰å…¨å›¢é˜Ÿè¦ä¸ºåº”ç”¨ä¸Šçº¿æˆ–å˜æ›´è¿›è¡Œå®‰å…¨æ€§ä¸Žåˆè§„æ€§å®¡æŸ¥ï¼Œ è€Œç ”å‘å›¢é˜Ÿéœ€è¦æŠ•å…¥æ›´å¤šçš„èµ„æºåŽ»æ»¡è¶³å®‰å…¨ã€åˆè§„çš„éœ€æ±‚ï¼Œè¿™å¿…ç„¶ä¼šæŽ¨è¿Ÿäº¤ä»˜ã€‚å¦ä¸€æ–¹é¢ï¼Œç ”å‘å›¢é˜Ÿçš„äº¤ä»˜å˜æ›´è¿˜éœ€è¦å†…éƒ¨æµç¨‹ä»¥åŠ äººå·¥æ“ä½œçš„è¯ï¼Œè·¨å›¢é˜Ÿçš„æ²Ÿé€šã€åä½œå¿…ç„¶ä¹Ÿä¼šå»¶ç¼“äº¤ä»˜é€Ÿåº¦ã€‚æ‰€ä»¥åŸºäºŽå®‰å…¨ã€åˆè§„éœ€æ±‚çš„æŠ½è±¡ï¼Œå¤–åŠ è‡ªåŠ©æœåŠ¡çš„å…±äº«æœåŠ¡å¹³å°ï¼Œ é’ˆå¯¹è¿™ç§åœºæ™¯è€Œç”Ÿï¼Œå¯ä»¥å¤§å¹…æ”¹å–„äº¤ä»˜é€Ÿåº¦åŒæ—¶æ»¡è¶³å®‰å…¨ã€åˆè§„è¦æ±‚ã€‚\nAWS ä¸ŠæŠ½è±¡çš„åŠ©åŠ› åœ¨äºšé©¬é€Šè½¯ä»¶å¼€å‘ä¸­çš„æŠ½è±¡åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼Œ\næ¡†æž¶ æ¡†æž¶ä¸ºåº”ç”¨ç¨‹åºç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œä¸ºäº†ç¼–å†™æ›´å°æ›´é«˜æ•ˆçš„ä»£ç ï¼Œä»£ç è¢«æ‰©å±•æˆæˆ–è¢«å»ºæˆæ›´å®žè´¨æ€§çš„è½¯ä»¶éƒ¨åˆ†ã€‚ å¼€å‘äººå‘˜å¯¹æ¡†æž¶åº”è¯¥éžå¸¸ç†Ÿæ‚‰äº†ï¼Œæ— è®ºæ˜¯Webå¼€å‘çš„Springã€Djangoã€VueJSã€Reactè¿˜æ˜¯MLæ¨¡åž‹è®­ç»ƒçš„TesnorFlowå’ŒPyTorchéƒ½æ˜¯ æ¡†æž¶ï¼Œå¸®åŠ©å¼€å‘è€…é™ä½Žå¼€å‘é—¨æ§›ï¼Œä¸“æ³¨åœ¨æ ¸å¿ƒä¸šåŠ¡ä¸Šã€‚ä»Žç»„ç»‡çš„å®‰å…¨ã€åˆè§„è§’åº¦å‡ºå‘ï¼ŒåŸºç¡€è®¾æ–½æˆ–å®‰å…¨å›¢é˜Ÿå¯ä»¥é€šè¿‡æ¨¡æ¿æˆ–è€…æ¨¡å¼æ¥ å¼ºåˆ¶å®žæ–½ä¼ä¸šè§„èŒƒæ¥è¾¾åˆ°å®‰å…¨æ€§å’Œåˆè§„æ€§éœ€æ±‚ã€‚\nAWS ç›®å‰æä¾›çš„æ¡†æž¶ç±»å·¥å…·æˆ–æœåŠ¡æœ‰ AWS SAM, AWS CDKä»¥åŠAWS CloudFormationã€‚ åŸºäºŽè¿™äº›æ¡†æž¶ç±»å·¥å…·å’ŒæœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥å¿«é€Ÿæž„å»ºäº‘ä¸Šåº”ç”¨ï¼Œæˆ–è€…æ˜¯åˆ›å»ºäº‘ä¸Šåº”ç”¨çš„ç»„ä»¶ä¸”åŒæ—¶æ»¡è¶³ä¼ä¸šå®‰å…¨åˆè§„éœ€æ±‚ã€‚\nå‘½ä»¤è¡Œ CLI æ¡†æž¶çš„å‘½ä»¤è¡Œ CLI è®©å¼€å‘å›¢é˜Ÿç”¨ä»–ä»¬ç†Ÿç»ƒçš„è¯­è¨€æ ¹æ®å®ƒæž„å»ºè‡ªåŠ¨åŒ–ã€‚CLI èƒ½å¤Ÿç®€åŒ–æ¡†æž¶çš„ä½¿ç”¨éš¾åº¦ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨æœ€ç†Ÿæ‚‰çš„å¼€å‘è¯­è¨€ (ä¾‹å¦‚ Shell è„šæœ¬/Python)æ¥è°ƒç”¨ CLIï¼Œå®žçŽ°ä¸šåŠ¡é€»è¾‘çš„å°è£…ã€‚\nAWS Copilotï¼ŒAWS SAM CLIæ˜¯ AWS æä¾›çš„ CLI å·¥å…·ã€‚\néƒ¨ç½²æœåŠ¡ æœ€åŽéƒ¨ç½²æœåŠ¡æ‹¿åº”ç”¨è½¯ä»¶æ¥è¯´ï¼Œç”±å¼€å‘å›¢é˜Ÿç¼–å†™å¹¶å®šä¹‰äº†å¦‚ä½•ä½¿ç”¨é‚£ä¸ªè½¯ä»¶ï¼Œå¹¶è®©å®ƒåœ¨çœŸå®žçš„åŸºç¡€è®¾æ–½çŽ¯å¢ƒè¿è¡Œã€‚å¼€å‘å›¢é˜Ÿéœ€è¦åŠ å¿« åº”ç”¨äº¤ä»˜é€Ÿåº¦æ¥æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼Œè€ŒåŸºç¡€è®¾æ–½å’Œå®‰å…¨å›¢é˜Ÿéœ€è¦ä½œä¸ºä¼ä¸šå®‰å…¨åˆè§„æ–¹é¢çš„ GateKeeperã€‚ä¸€å¥—åˆç†çš„åä½œæ¨¡å¼å°†ä¼šåŠ é€Ÿ å¼€å‘å›¢é˜Ÿçš„äº¤ä»˜ä¸”æ»¡è¶³å®‰å…¨éœ€æ±‚ï¼Œä¾‹å¦‚å…±äº«è‡ªæœåŠ¡å¹³å°ã€‚\nAWS æä¾›äº†å¾ˆå¤šå¼€ç®±å³ç”¨çš„äº§å“å¼€å¯å»ºç«‹ä¸€ä¸ªå…±äº«æœåŠ¡å¹³å°ï¼Œä¾‹å¦‚ï¼ŒAWS Protonï¼ŒAWS CodeDeployã€‚\nå¹³å°æ‰€æœ‰æƒæ¨¡å¼çš„æ€è€ƒ ä½œä¸ºä¸€ä¸ªå…±äº«æœåŠ¡å¹³å°ï¼Œä¸åŒçš„ç®¡ç†éœ€æ±‚/æ¨¡å¼æˆ–åº”ç”¨è´Ÿè½½ç±»åž‹ï¼Œä¼šæœ‰ä¸åŒçš„æœåŠ¡æ‰®æ¼”ä¸åŒçš„è§’è‰²ã€‚ä¸‹é¢æ˜¯ä¸€äº›å®¢æˆ·å®žè·µçš„å¹³å°æ¨¡å¼ã€‚\nAWS è´¦æˆ·ä½œä¸º\u0026quot;å¹³å°\u0026quot; ç»„ç»‡å°† AWS è´¦æˆ·ä½œä¸ºå¹³å°ï¼Œè‡ªåŠ¨åŒ–åˆ›å»ºï¼Œå…¶ç‰¹ç‚¹å¦‚ä¸‹ï¼Œ\nAWS è´¦æˆ·å±žäºŽåº”ç”¨å›¢é˜Ÿä¸”ç”±ä»–ä»¬è¿è¥ åŸºç¡€è®¾æ–½å›¢é˜Ÿä¸ºåº”ç”¨è´¦æˆ·æä¾›å·¥å…·ï¼ŒåŒ…æ‹¬ä¸”ä¸é™äºŽï¼Œ æ”¯æ’‘åž‹çš„åŸºç¡€è®¾æ–½(ä¾‹å¦‚ï¼Œç½‘ç»œï¼Œå®‰å…¨ï¼ŒåŸŸåï¼Œå…¬å¸æ ‡å‡†ç­‰) AWS Proton çŽ¯å¢ƒå’Œåº”ç”¨ AWS Service Catalog äº§å“ æ­¤å¤– [AWS Control Tower][control-towner], AWS Organizations, CloudFormation StackSets, AWS Config ä¸€è‡´æ€§åŠŸèƒ½ï¼Œ éƒ½æ˜¯ä¸€äº›æœåŠ¡æˆ–åŠŸèƒ½å¯ä»¥æ”¯æŒä»¥è´¦æˆ·ä¸ºç®¡ç†å•ä½çš„å…±äº«å¹³å°ã€‚\næ‰˜ç®¡å®¹å™¨é›†ç¾¤ä½œä¸º\u0026quot;å¹³å°\u0026quot; AWS è´¦æˆ·ç”±å¹³å°/åŸºç¡€è®¾æ–½å›¢é˜Ÿè¿è¥ï¼Œä»–ä»¬å°†ç®¡ç†å®¹å™¨é›†ç¾¤çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¾‹å¦‚æ‰˜ç®¡çš„ EKS(Kubernentes) é›†ç¾¤ã€‚åº”ç”¨å›¢é˜Ÿè´Ÿè´£å°† åº”ç”¨éƒ¨ç½²åˆ°åŸºç¡€è®¾æ–½å›¢é˜Ÿç®¡ç†çš„å¤šç§Ÿæˆ·é›†ç¾¤ï¼Œåº”ç”¨å›¢é˜Ÿå°†æ‰¿æ‹…å¦‚ä¸‹èŒè´£(åŒ…æ‹¬ä¸”ä¸é™äºŽ)ï¼Œ\nåº”ç”¨ç¨‹åºæŒç»­é›†æˆ å…¥å£æµé‡æŽ§åˆ¶ è®¿é—®ç®¡ç† è¿è¥å¯è§æ€§ æœåŠ¡äºŽåº”ç”¨ç¨‹åºçš„å‘¨è¾¹åŸºç¡€è®¾æ–½(ä¾‹å¦‚ï¼Œæ•°æ®åº“ã€é˜Ÿåˆ—æˆ–ç¼“å­˜ç­‰)çš„éƒ¨ç½²å¯ä»¥é€šè¿‡æŒç»­é›†æˆçš„ AWS CloudFormation/AWS CDK æ¨¡æ¿ï¼ŒAWS Proton çŽ¯å¢ƒ/åº”ç”¨æ¥å®žçŽ°ã€‚\nå¯éƒ¨ç½²çš„åº”ç”¨ç¨‹åºæ¨¡å¼ä½œä¸º\u0026quot;å¹³å°\u0026quot; è¿™ç§æ¨¡å¼ä¸‹é€šå¸¸ä¼šç”±åŸºç¡€è®¾æ–½å›¢é˜Ÿæ‹¥æœ‰å…±äº«è´¦æˆ·ï¼Œè´Ÿè´£ç½‘ç»œã€åŸŸåã€å®¡è®¡ç­‰èµ„æºã€‚åº”ç”¨å›¢é˜Ÿè´Ÿè´£åº”ç”¨è´¦æˆ·ã€‚åŸºç¡€è®¾æ–½å›¢é˜Ÿåˆ›å»ºçŽ°æˆçš„ åº”ç”¨ç¨‹åºã€éƒ¨ç½²æœºåˆ¶ã€æŠ½è±¡åº“ä¾›åº”ç”¨ç¨‹åºå›¢é˜Ÿä½¿ç”¨æˆ–è‡ªå®šä¹‰ï¼Œå¦‚ä¸‹ä¸€äº›æœåŠ¡æˆ–åŠŸèƒ½å¯ä»¥å®žçŽ°è¯¥æ¨¡å¼ï¼Œ\nAWS Proton AWS CloudFormation / AWS Service Catalog AWS CDK constructs äº§å“åŒ–è¿è¥å…±äº«è‡ªæœåŠ¡å¹³å° å…±äº«è‡ªæœåŠ¡å¹³å°é™¤äº†æ ¹æ®ç»„ç»‡ç®¡ç†å’ŒæŠ€æœ¯æ ˆé€‰æ‹©åˆé€‚çš„å®žçŽ°æ¨¡å¼å¤–ï¼Œæ˜¯å¦èƒ½å¤Ÿåœ¨ä¸€ä¸ªç»„ç»‡å†…çœŸæ­£çš„ä¼˜åŒ–æ•ˆçŽ‡ï¼Œæå‡ç ”å‘äº¤ä»˜é€Ÿåº¦å–å†³äºŽ å¦‚ä½•è¿è¥è¿™ä¸ªå¹³å°ã€‚è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°çš„æˆåŠŸæ¡ˆä¾‹éƒ½æ˜¯å°†è¯¥å¹³å°äº§å“åŒ–ï¼ŒæŒ‰ç»è¥äº§å“çš„æ–¹å¼æ¥è¿è¥ä»–ã€‚é€šå¸¸æˆåŠŸçš„å…±äº«è‡ªæœåŠ¡å¹³å° åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤æ¥å®žçŽ°è‡ªèº«ä»·å€¼ï¼Œå½¢æˆå¢žé•¿é£žè½®ã€‚\n1. å°è¯•ï¼Œè¯æ˜Žä»·å€¼ æ‰€è°“ä¸‡äº‹å¼€å¤´éš¾ï¼Œæž„å»ºå…±äº«æœåŠ¡å¹³å°éœ€è¦æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„åº”ç”¨å›¢é˜Ÿä½œä¸ºç§å­ç”¨æˆ·ã€‚è¯¥å›¢é˜Ÿçš„åº”ç”¨åœºæ™¯åº”è¯¥æ˜¯ä¸€ä¸ªå…¸åž‹ç”¨ä¾‹ï¼Œåº”ç”¨å›¢é˜Ÿ éœ€è¦é¢‘ç¹å‘å¸ƒæ¥äº¤ä»˜ä¸šåŠ¡ä»·å€¼ï¼Œè€Œè¯¥åº”ç”¨å°†æ¶‰åŠåˆ°åŸºç¡€è®¾æ–½å›¢é˜Ÿè´Ÿè´£çš„æ¨¡å—ï¼Œä¸”è¦ç¬¦åˆç»„ç»‡å¯¹å®‰å…¨æ€§å’Œåˆè§„æ€§çš„å®¡æŸ¥ã€‚ç”±åŒæ–¹å›¢é˜Ÿå…±åŒ å®šä¹‰äº¤äº’æ¨¡åž‹ï¼Œä¾‹å¦‚ï¼Œå¦‚ä½•å¼€å‘åŸºç¡€è®¾æ–½å³ä»£ç ï¼Œå¹³å°åŸºç¡€æž¶æž„ï¼Œåº”ç”¨éƒ¨ç½²æ–¹å¼ã€‚å¹¶ä¸”åº”ç”¨å›¢é˜Ÿæ–¹éœ€è¦è®¤å¯è¯¥å¹³å°çš„ä»·å€¼ï¼Œåœ¨ç§å­åº”ç”¨ æˆåŠŸè½åœ°å…±äº«æœåŠ¡å¹³å°åŽï¼Œä¼šé€æ¸å°†æ›´å¤šåº”ç”¨è½åœ°åˆ°å…±äº«å¹³å°æ¨¡å¼ä¸Šã€‚\nåŒæ—¶ï¼Œå¹³å°çš„æŠ€æœ¯é€‰é¡¹ä¹Ÿéžå¸¸é‡è¦ï¼Œè¦é€‚åº”ä¼ä¸šè‡ªèº«çš„ç»„ç»‡ç®¡ç†ç»“æž„å’ŒæŠ€æœ¯æ ˆèƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œ\nAWS CloudFormation / AWS CDK: é€šç”¨ä¸”æœ€çµæ´»çš„å®žçŽ°ï¼›åŒæ—¶ä¹Ÿæ˜¯åŒåˆƒå‰‘ï¼Œç»´æŠ¤å¤§åž‹çš„ CloudFormation æ¨¡æ¿æ˜¯éžå¸¸å›°éš¾çš„ï¼Œé‡‡ç”¨ AWS CDK éœ€è¦å­¦ä¹ æ–°çš„æŠ€èƒ½ï¼Œä¸”æœ‰æ—¶éœ€è¦æ·±å…¥ç ”ç©¶æ‰å¯èƒ½ Hack æŸäº›å†…éƒ¨å®žçŽ°ï¼›æ˜¯å¦‚æžœéœ€è¦å®Œå…¨æŽŒæ¡å®žçŽ°ç»†èŠ‚æ—¶çš„é€‰æ‹©ï¼Œ AWS Copilot: ä»…é€‚ç”¨äºŽ ECS ä¸Šéƒ¨ç½²çš„å®¹å™¨åº”ç”¨ï¼›å¼€å‘åº”ç”¨çš„å›¢é˜Ÿä¸å…³å¿ƒæˆ–ä¸éœ€è¦ç®¡ç†åŸºç¡€è®¾æ–½ï¼Œ AWS Proton: é€‚ç”¨äºŽå°†åº”ç”¨å’ŒåŸºç¡€è®¾æ–½æƒé™åˆ†ç¦»çš„åœºæ™¯ï¼›æ»¡è¶³åº”ç”¨å›¢é˜Ÿéœ€è¦è‡ªæœåŠ¡çš„æ¨¡å¼ã€‚ 2. å¤åˆ¶æŽ¨å¹¿ åœ¨æ»¡è¶³äº†ç§å­åº”ç”¨çš„éœ€æ±‚åŽï¼Œè®©å…±äº«æœåŠ¡å¹³å°èµ°å‘æˆåŠŸçš„å…³é”®æ˜¯å¦‚ä½•è¿è¥æŽ¨å¹¿ä»–ã€‚äº§å“åŒ–çš„è¿è¥éœ€è¦åšçš„ä»¥ä¸‹å‡ ç‚¹ï¼Œ\næ–‡æ¡£åŒ–ä½ æž„å»ºçš„å¹³å°ï¼ŒåŒ…æ‹¬ è‡ªæœåŠ¡/è‡ªåŠ¨åŒ–çš„é‡‡ç”¨æ­¥éª¤ ç”¨æˆ·æ‰‹å†Œã€API æ–‡æ¡£ æ”¯æŒçš„æœºåˆ¶ï¼Œå¦‚ä½•ä¸ºé‡‡ç”¨å¹³å°çš„å†…éƒ¨ç”¨æˆ·æä¾›æŠ€æœ¯æ”¯æŒ å…¬å¼€ä»£ç ï¼Œè‡³å°‘æ˜¯å†…éƒ¨å¼€æºï¼Œè®©æ›´å¤šçš„ç”¨æˆ·å‚ä¸Žå…±äº« å†…éƒ¨è¥é”€å¹³å° åˆ©ç”¨æˆåŠŸæ¡ˆä¾‹èµ¢å¾—é¢†å¯¼ä»¬çš„æ”¯æŒï¼Œè¾¾åˆ°é‡åŒ–å¹³å°ä»·å€¼ï¼Œè§„é¿é£Žé™©ï¼Œæå‡ä¸šåŠ¡ç ”å‘æ•ˆçŽ‡ å†…éƒ¨\u0026quot;è·¯æ¼”\u0026quot;æ‹›å‹Ÿå›¢é˜Ÿå¹¶èŽ·å¾—åé¦ˆ è¯æ˜Žä½ çš„å…±äº«æœåŠ¡å¹³å°æ–¹å¼å¯æ‰©å±• è€ƒè™‘æ”¯æŒå‡ åä¸Šç™¾çš„å›¢é˜Ÿ å¯è·¨è¶Šå„ç§åœºæ™¯ï¼Œä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºä¸­æ–­ï¼ŒAWS æœåŠ¡äº‹ä»¶ï¼Œè¿ç§»ï¼Œ0-day è¡¥ä¸ è€ƒè™‘å¹³å°å¤åˆ¶çš„ç“¶é¢ˆåœ¨å“ªé‡Œï¼Ÿä¾‹å¦‚ï¼Œé‡‡ç”¨éš¾åº¦ï¼Œå­¦ä¹ æ›²çº¿ï¼Œéƒ¨ç½²ï¼Œæ”¯æŒ / on call ç­‰ç­‰ 3. å½¢æˆé£žè½® å…±äº«è‡ªæœåŠ¡å¹³å°æœ€ç»ˆå½¢æˆäº§ç”Ÿè‡ªèº«å¢žé•¿åŠ¿å¤´çš„è‰¯æ€§å¾ªçŽ¯ï¼Œä¾‹å¦‚ï¼Œ\næŠ•èµ„å¹³å°å›¢é˜Ÿ --\u0026gt; æ·»åŠ å¹³å°åŠŸèƒ½ --\u0026gt; åº”ç”¨å¼€å‘è€…æ›´å¿«ä¹ --\u0026gt; å¢žåŠ å¹³å°ä½¿ç”¨ --\u0026gt; æå‡ç»„ç»‡çš„æ•ˆçŽ‡ --\u0026gt; æŠ•èµ„å¹³å°å›¢é˜Ÿ --\u0026gt; ...\né€šè¿‡ä»¥ä¸Šä¸€ä¸ªé£žè½®é—­çŽ¯ï¼Œè¾¾æˆé•¿æœŸæˆåŠŸã€‚\n","link":"https://kane.mx/posts/2021/shared-service-platform-for-decentralized-developer-teams/","section":"posts","tags":["SSP","DevOps","GitOps","Infrastructure as Code","AWS","Proton","Service Catalog"],"title":"AWSä¸Šæž„å»ºå…±äº«è‡ªæœåŠ¡å¹³å°æœåŠ¡åŽ»ä¸­å¿ƒåŒ–ç ”å‘å›¢é˜Ÿ"},{"body":"","link":"https://kane.mx/tags/infrastructure-as-code/","section":"tags","tags":null,"title":"Infrastructure as Code"},{"body":"","link":"https://kane.mx/tags/proton/","section":"tags","tags":null,"title":"Proton"},{"body":"","link":"https://kane.mx/tags/service-catalog/","section":"tags","tags":null,"title":"Service Catalog"},{"body":"","link":"https://kane.mx/tags/ssp/","section":"tags","tags":null,"title":"SSP"},{"body":"","link":"https://kane.mx/tags/amazon-builders-library/","section":"tags","tags":null,"title":"Amazon Builders' Library"},{"body":"","link":"https://kane.mx/series/amazon-builders-library/","section":"series","tags":null,"title":"Amazon-Builders-Library"},{"body":"","link":"https://kane.mx/tags/resilience-engineering/","section":"tags","tags":null,"title":"Resilience Engineering"},{"body":"","link":"https://kane.mx/tags/system-design/","section":"tags","tags":null,"title":"System Design"},{"body":"AWSæž¶æž„çš„å®Œå–„(AWS Well-Architected)æ¡†æž¶æ¶‰åŠäº†äº”å¤§æ”¯æŸ±ï¼Œ å…¶ä¸­å¯é æ€§æ”¯æŸ±è¦æ±‚ä¾§é‡äºŽç¡®ä¿å·¥ä½œè´Ÿè½½åœ¨é¢„æœŸçš„æ—¶é—´å†…æ­£ç¡®ã€ä¸€è‡´åœ°æ‰§è¡Œå…¶é¢„æœŸåŠŸèƒ½ã€‚ è¿™è¦æ±‚åº”ç”¨ç¨‹åºç³»ç»Ÿå…·å¤‡å¼¹æ€§è®¾è®¡ï¼Œå¯ä»Žæ•…éšœä¸­å¿«é€Ÿæ¢å¤ï¼Œä»¥ä¾¿æ»¡è¶³ä¸šåŠ¡å’Œå®¢æˆ·éœ€æ±‚ã€‚ ç„¶è€Œè®¾è®¡ã€å¼€å‘ã€ä¸”éªŒè¯å…·å¤‡å¼¹æ€§è®¾è®¡çš„åº”ç”¨ç¨‹åºï¼Œå¯¹ç»éªŒå’Œå®žè·µèƒ½åŠ›éƒ½æœ‰å¾ˆé«˜çš„è¦æ±‚ã€‚ åˆ©ç”¨æˆç†Ÿçš„ç»éªŒå’Œè‰¯å¥½çš„å·¥å…·å°†åŠ å¿«æž„å»ºç¬¦åˆé¢„æœŸçš„å¼¹æ€§åº”ç”¨ç¨‹åºã€‚\nApplication Resilience Workshopæ˜¯ä¸€å¥—è¯¾ç¨‹å’ŒåŠ¨æ‰‹å®žè·µå­¦ä¹ å¦‚ä½•è¿›è¡Œå®žéªŒæ¥è§‚å¯Ÿç³»ç»Ÿçš„è¡Œä¸ºï¼Œ ä¾‹å¦‚ï¼Œæžç«¯ç³»ç»Ÿè´Ÿè½½å’Œç½‘ç»œä¸­æ–­æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¸åŒçš„è½¯ä»¶æ¨¡å¼æ¥å‡è½»è¿™äº›å®žéªŒå¯¹ç³»ç»Ÿç¨³æ€çš„å½±å“ã€‚ æ•´ä¸ªå®žéªŒä¹Ÿæ˜¯åˆ†ä¸ºå‡è®¾ã€æ–¹æ³•ã€è§‚æµ‹å’Œç¼“è§£ç­‰æ­¥éª¤ï¼ŒåŒæ··æ²Œå·¥ç¨‹æœ‰å¼‚æ›²åŒå·¥ä¹‹å¤„ã€‚\nåº”ç”¨ç¨‹åºå¼¹æ€§å®žéªŒå‡è®¾äº†ä¸€ä¸ªå¾®æœåŠ¡æž„å»ºçš„åº”ç”¨ç¨‹åºï¼Œé€šè¿‡åŽ‹åŠ›æµ‹è¯•å·¥å…·æ³¨å…¥æžç«¯çš„ç³»ç»Ÿè´Ÿè½½ï¼Œ é€šè¿‡åº”ç”¨ç¨‹åºå„æœåŠ¡çš„å¯è§‚æµ‹æ€§æ¥ç†è§£ç›®æ ‡åº”ç”¨çš„å»¶è¿Ÿï¼Œåžåã€å®¹é‡ã€RTOç­‰æŒ‡æ ‡ã€‚\nå½“å‘çŽ°æœ€åˆè®¾è®¡çš„åº”ç”¨ç¨‹åºåœ¨æžç«¯åŽ‹åŠ›ä¸‹ä¼šæœ‰ç¾éš¾æ€§çš„æ•…éšœï¼Œæ•™ç¨‹ä¸­ç»™å‡ºäº†é˜Ÿåˆ—ï¼Œè´Ÿè½½å¸è½½ï¼Œ é€šè¿‡é™ä½ŽæœåŠ¡QoSçš„Client Deadline Cutoffï¼Œæ–­è·¯å™¨ï¼Œä»¤ç‰Œæ¡¶ç­‰ç¨‹åºè®¾è®¡æ¨¡å¼æ¥ç¼“è§£æžç«¯åŽ‹åŠ›å¯¹ç³»ç»Ÿé€ æˆçš„ç¾éš¾æ€§çš„æ•…éšœã€‚\nä½†æ˜¯æ— è®ºä½¿ç”¨é˜Ÿåˆ—è§£è€¦è¿˜æ˜¯è´Ÿè½½å¸è½½éƒ½ä¸æ˜¯ç»å¯¹å®Œç¾Žçš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨Amazon Builders' Library ä¸­çš„å‡ ç¯‡æ–‡ç« ä¸ºæˆ‘ä»¬åˆ†äº«äº†Amazonä»Žè¿è¡Œå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å­¦ä¹ åˆ°çš„å®è´µä¸”æˆç†Ÿçš„ç»éªŒï¼Œ\né¿å…æ— æ³•å…‹æœçš„é˜Ÿåˆ—ç§¯åŽ‹ é€šè¿‡å¸é™¤è´Ÿè½½æ¥é¿å…è¿‡è½½ è¶…æ—¶ã€é‡è¯•å’ŒæŠ–åŠ¨å›žé€€ åˆ©ç”¨è¿™äº›æˆç†Ÿçš„ç»éªŒæˆ‘ä»¬å¯ä»¥æƒè¡¡ç³»ç»Ÿçš„éœ€æ±‚å’ŒæŠ€æœ¯å®žçŽ°ï¼Œé€‰æ‹©å½“ä¸‹æœ€åˆç†ä¸”å¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚\nåœ¨ä»Šå¹´çš„Pre-re:Inventä¹‹é™…ï¼ŒAWSå‘å¸ƒäº†AWS Resilience HubæœåŠ¡ï¼Œå°†åº”ç”¨ç¨‹åºäº‘ä¸Šèµ„æºçŠ¶æ€çš„æ‰«æï¼Œ ç³»ç»Ÿå¼¹æ€§çš„è¯„ä¼°ï¼Œç¬¦åˆRPO/RTOçš„é…ç½®å»ºè®®ï¼Œä»¥åŠåŸºäºŽæ··æ²Œå·¥ç¨‹çš„å®žéªŒè¿è¡Œé›†æˆä¸ºä¸€ä¸ªæ•´ä½“çš„æœåŠ¡ï¼Œé€šè¿‡ä¸€ä¸ªæŽ§åˆ¶é¢æ¿å®žçŽ°äº†åº”ç”¨ç¨‹åºå¼¹æ€§çš„ç®¡ç†ã€‚\næ­¤å¤–ï¼Œå¦‚æžœä½ çš„åº”ç”¨åˆšå¥½æ˜¯ä¸€ä¸ªç”µå•†æˆ–åœ¨çº¿ç¥¨åŠ¡ç³»ç»Ÿï¼Œç³»ç»Ÿæ­£åœ¨é¢å¯¹ç§’æ€ã€é»‘äº”ç­‰å¤§è§„æ¨¡è´Ÿè½½åŽ‹åŠ›çš„è€ƒéªŒï¼Œå¯ä»¥å‚è€ƒç”šè‡³ç›´æŽ¥å°è¯•AWSè§£å†³æ–¹æ¡ˆ AWS Virtual Waiting Roomæ¥ç›´æŽ¥æž„å»ºä¸€ä¸ªå¼¹æ€§ç³»ç»Ÿã€‚\n","link":"https://kane.mx/posts/2021/application-resilience/","section":"posts","tags":["AWS","resilience engineering","Amazon Builders' Library","System Design"],"title":"åº”ç”¨ç¨‹åºå¼¹æ€§è®¾è®¡"},{"body":"","link":"https://kane.mx/tags/metaverse/","section":"tags","tags":null,"title":"Metaverse"},{"body":"","link":"https://kane.mx/tags/nft/","section":"tags","tags":null,"title":"Nft"},{"body":"","link":"https://kane.mx/tags/%E5%85%83%E5%AE%87%E5%AE%99/","section":"tags","tags":null,"title":"å…ƒå®‡å®™"},{"body":"å…ƒå®‡å®™æ˜¯è¿‘æœŸçš„çƒ­ç‚¹è¯é¢˜ï¼Œè¿‘æœŸåšäº†äº›å­¦ä¹ äº†è§£ï¼Œå°†ä¸€äº›å­¦ä¹ å†…å®¹æ€»ç»“ä¸ºä¸€ä¸ªdeckã€‚åˆ†äº«å¦‚ä¸‹ï¼Œ\n","link":"https://kane.mx/posts/2021/metaverse/","section":"posts","tags":["metaverse","nft","å…ƒå®‡å®™"],"title":"å…ƒå®‡å®™é£Žå£ä¸‹çš„æœºä¼š"},{"body":"","link":"https://kane.mx/tags/aws-fault-injection-simulator/","section":"tags","tags":null,"title":"AWS Fault Injection Simulator"},{"body":"","link":"https://kane.mx/tags/aws-fis/","section":"tags","tags":null,"title":"AWS FIS"},{"body":"æ··æ²Œå·¥ç¨‹æ˜¯ä¸€ç§å¸®åŠ©ç³»ç»Ÿæ»¡è¶³å¼¹æ€§éœ€æ±‚çš„æŠ€æœ¯ï¼Œå®ƒèµ·æºäºŽNetflixçš„å·¥ç¨‹å®žè·µï¼Œè‘—åçš„çŒ´å­å†›å›¢ã€‚\nAWSä¸€ç›´æå€¡æž¶æž„çš„å®Œå–„(AWS Well-Architected)ï¼Œæ··æ²Œå·¥ç¨‹æ­£æ˜¯å“è¶Šè¿è¥å’Œå¯é æ€§æ”¯æŸ±çš„å®žè·µã€‚ å› æ­¤åœ¨ re:Invent 2020 AWSå‘å¸ƒäº†Fault Injection SimulatoræœåŠ¡æ¥ç®€åŒ–å¼€å‘è€…åœ¨AWSä¸Šçš„æ··åŠ¨å·¥ç¨‹å®žè·µã€‚\nAWS FISä½œä¸ºAWSä¸ŠåŽŸç”Ÿçš„æ··æ²Œå·¥ç¨‹æœåŠ¡ï¼Œç›®å‰å·²åŒEC2ï¼ŒECSï¼ŒEKSï¼ŒRDSï¼ŒCloudWatchï¼Œç”šè‡³æ˜¯IAM Role APIé›†æˆï¼Œå¯ä»¥è§¦å‘è¿™äº›æœåŠ¡ä¸­èµ„æºçš„å˜æ›´æ¥å‡è®¾æ•…éšœï¼Œ ä¾‹å¦‚ï¼Œé‡å¯æˆ–ç»ˆæ­¢EC2å®žä¾‹ï¼Œé‡å¯RDSå®žä¾‹ç­‰ã€‚\nChaos Engineering on AWSæ˜¯ä¸€ä»½éžå¸¸è¯¦ç»†çš„æ··æ²Œå·¥ç¨‹åœ¨AWSä¸ŠåŠ¨æ‰‹å®žéªŒã€‚ è¯¥å®žéªŒå°†æŒ‡å¯¼å‚ä¸Žè€…å¿«é€Ÿè®¾ç½®å®žéªŒåˆå§‹çŽ¯å¢ƒï¼Œé€šè¿‡å¯è§‚æµ‹æ€§å·¥å…·äº†è§£ç³»ç»ŸçŠ¶æ€ï¼Œç„¶åŽå¸¦é¢†å®žéªŒå‚ä¸Žè€…é€šè¿‡è¯¦ç»†çš„å®žéªŒæ­¥éª¤å­¦ä¹ å¦‚ä½•ä½¿ç”¨FISæœåŠ¡æ¥è¾¾åˆ°å¯¹ç³»ç»Ÿå¯é æ€§çš„éªŒè¯å’Œä¼˜åŒ–ã€‚ å®žéªŒé¡¹ç›®é™¤äº†è¦†ç›–FISæ”¯æŒé›†æˆçš„EC2ï¼ŒECSï¼ŒRDSç­‰æœåŠ¡å¤–ï¼Œè¿˜æ¼”ç¤ºäº†SSMé›†æˆï¼Œå¹¶ä¸”é€šè¿‡FISå†…ç½®çš„SSMæ–‡æ¡£æˆ–è‡ªå®šä¹‰çš„SSMæ–‡æ¡£æ¥å‡è®¾ç³»ç»Ÿæ•…éšœã€‚ æ··æ²Œå·¥ç¨‹ä½œä¸ºä¸€ç§æå‡ç³»ç»Ÿå¼¹æ€§çš„è´¨é‡æ‰‹æ®µï¼Œéœ€è¦é‡å¤æ€§çš„åœ¨ç³»ç»Ÿä¸­å®žéªŒï¼ŒåŠ¨æ‰‹å®žéªŒä¹Ÿä¸ºå‚ä¸Žè€…è®¾è®¡äº†CI/CDå®žéªŒï¼Œé€šè¿‡Gitopsæ–¹å¼å°†æ··åŠ¨å·¥ç¨‹æŒç»­å®žéªŒåˆ°ç³»ç»ŸçŽ¯å¢ƒä¸­ã€‚ æ€»ä¹‹ï¼Œå¯¹æ··æ²Œå·¥ç¨‹æœ‰å…´è¶£çš„å¼€å‘è€…ï¼ŒChaos Engineering on AWSéžå¸¸å€¼å¾—ä¸€åšçš„åŠ¨æ‰‹å®žéªŒï¼Œå¯ä»¥å¿«é€Ÿçš„å¸®åŠ©æ‚¨äº†è§£æ··æ²Œå·¥ç¨‹ï¼ŒåŠFISåœ¨AWSä¸Šçš„å®žè·µã€‚\næœ€åŽå†å¼ºè°ƒä¸‹æœ€é‡è¦çš„äº‹ï¼Œæ··æ²Œå·¥ç¨‹ä¸æ˜¯ä¸€ä¸ªå­¤ç«‹çš„ç³»ç»Ÿå¼¹æ€§å®žéªŒï¼Œå®ƒéœ€è¦ç³»ç»Ÿæœ¬èº«çš„å¼¹æ€§ã€å¯é æ€§è®¾è®¡ä»¥åŠå¯è§‚æµ‹æ€§çš„å®žçŽ°ï¼Œæ˜¯ä¸€ä¸ªç³»ç»Ÿæ•´ä½“çš„è®¾è®¡å®žè·µã€‚\n","link":"https://kane.mx/posts/2021/chaos-engineering-on-aws/","section":"posts","tags":["AWS","chaos engineering","AWS Fault Injection Simulator","AWS FIS"],"title":"AWSä¸Šçš„æ··æ²Œå·¥ç¨‹"},{"body":"","link":"https://kane.mx/tags/chaos-engineering/","section":"tags","tags":null,"title":"Chaos Engineering"},{"body":"","link":"https://kane.mx/tags/filevault/","section":"tags","tags":null,"title":"Filevault"},{"body":"","link":"https://kane.mx/tags/macos-monterey/","section":"tags","tags":null,"title":"MacOS Monterey"},{"body":"","link":"https://kane.mx/tags/macosx/","section":"tags","tags":null,"title":"MacOSX"},{"body":"I'm trying to upgrade my Macbook Pro to macOS Monterey, however the installation can not be started due to the disk is encrypted by Filevault \u0026#x1f615; I have to turn off Filevault to disable disk encrpytion before installing macOS Monterey.\nI found this support article on how turning off Filevault, but it does not work at all. There is nothing hint or error message after clicking the option Turn off Filevault.\nAfter researching it for a while, I found this post via CLI command,\n1sudo fdesetup disable But above command also does not work, it exits with error code -69594.\n1sudo fdesetup disable 2Enter the user name:kane 3Enter the password for user \u0026#39;kane\u0026#39;: 4FileVault was not disabled (-69594). I found some articles said that the Filevault only can be disabled by the user whom enables it. I found below command to show the user whom enabled the Filevault, it's enabled by an unknown user! I don't have idea how enabling it.\n1sudo fdesetup list -extended 2ESCROW UUID TYPE USER 3 2D3F7CA5-4ED4-4537-8DA2-98B1E3637954 Unknown User Finally I found below command line to disable Filevault though I don't know which user enabled it.\n1diskutil apfs disableFileVault disk1s1 -user disk Input the disk password when booting the macOS. The disabling Filevault will be processed in backgroud, you can retrieve the progress by below command,\n1diskutil apfs list Happy Monterey!\n","link":"https://kane.mx/posts/2021/turn-off-filevault-on-macosx/","section":"posts","tags":["MacOSX","macOS Monterey","filevault","Tip"],"title":"Turn off Filevault on macOS"},{"body":"","link":"https://kane.mx/tags/aws-ecr/","section":"tags","tags":null,"title":"AWS-ECR"},{"body":"","link":"https://kane.mx/tags/helm/","section":"tags","tags":null,"title":"Helm"},{"body":"I met a case to mirror existing Helm charts to another repository. It might be caused by network availability or compliance requirements.\nThere are multiple ways to host a Helm repository, for example, Nexus OSS Repository, Github Pages, AWS ECR and so on.\nAmazon Elastic Container Registry (Amazon ECR) is a fully managed container registry that makes it easy to store, manage, share, and deploy your container images and artifacts anywhere. It's built with scale and secure. In my case I'm using this existing service to mirror the Helm charts.\nI created a script to mirror existing Helm chart to AWS ECR based on the official guide in ECR doc.\nFor example, below code snippet mirrors eks-charts/aws-load-balancer-controller with version 1.2.7 to Amazon ECR,\n1helm repo add eks-charts https://aws.github.io/eks-charts 2helm pull eks-charts/aws-load-balancer-controller --version 1.2.7 3./push-helm-chart-to-all-ecr-regions.sh aws-load-balancer-controller 1.2.7","link":"https://kane.mx/posts/2021/mirror-helm-chart-to-aws-ecr/","section":"posts","tags":["AWS","AWS-ECR","Helm","Kubernetes"],"title":"Mirror Helm Charts to AWS ECR"},{"body":"","link":"https://kane.mx/tags/amazon-neptune/","section":"tags","tags":null,"title":"Amazon Neptune"},{"body":"","link":"https://kane.mx/tags/graph-database/","section":"tags","tags":null,"title":"Graph Database"},{"body":"Amazon Neptune is a managed Graph database on AWS, whose compute and storage is decoupled like Amazon Aurora. Neptune leverages popular open-source APIs such as Gremlin and SPARQL, and easily migrate existing applications.\nAfter exploring Neptune few months in solution, I have below few learnings,\nBulk loading Always meet the ConcurrentModificationExceptions when concurrently loading vertices/edges into Neptune. Using neptune-python-utils with retry backoff can improve it, however it requires the expensive large Neptune instance.\nThe best way of batch loading the large vertices/edges into Neptune is using the bulk load feature, it works fine though the instance of Neptune is small. The loading time depends on the instance size of Neptune.\nproperties of vertice In my use case, I store the embedding as properties of vertices like relation database. There are almost 400 properties for every vertices, the query performance is bad with large number of properties. Due to the embedding properties will not be queried, consolidating the 400 properties as a single one properties to improve the query performance.\nstreams Neptune Streams logs every change to the graph. It's a Lab feature in 2019, and GA in 2020. However there is no Lambda integration now! It means you can not process the Neptune streams in Lambda functions!\nTools Neptune Tools Amazon Neptune Tools is a toolkit maintained by Neptune service team.\nNeptune sigv4 The script can connect Neptune to call control plane APIs with aswauthsigv4 and proxy support.\n","link":"https://kane.mx/posts/2021/the-practise-of-amazon-neptune/","section":"posts","tags":["graph database","Amazon Neptune","AWS"],"title":"The practise of Amazon Neptune"},{"body":"","link":"https://kane.mx/tags/amazon-eks/","section":"tags","tags":null,"title":"Amazon EKS"},{"body":"","link":"https://kane.mx/tags/sonatype-nexus/","section":"tags","tags":null,"title":"Sonatype Nexus"},{"body":"Last year I shared the production-ready, cloud native solution to deploy Sonatype Nexus Repository OSS on AWS.\nThe solution has an update with below notable changes,\nsupport specifying EKS version, v1.20, v1.19, and v1.18 are supported versions support provisioning to existing VPC support provisioning to existing EKS(require EKS v1.17+) update aws-efs-csi-driver to 1.3.1 update aws-load-balancer-controller to 2.2.0 See the solution page for detail usage.\n","link":"https://kane.mx/posts/2021/nexus-oss-on-aws-v110-update/","section":"posts","tags":["Amazon EKS","Kubernetes","Helm","AWS CDK","AWS","Sonatype Nexus"],"title":"The update of Sonatype Nexus repository OSS on AWS solution"},{"body":"","link":"https://kane.mx/tags/nat/","section":"tags","tags":null,"title":"NAT"},{"body":"","link":"https://kane.mx/tags/network/","section":"tags","tags":null,"title":"Network"},{"body":"æœ¬æ–¹æ¡ˆçš„èµ·å› æ˜¯ï¼Œä¸€ä¸ªæºä»£ç æ‰˜ç®¡åœ¨Githubä¸Šçš„é¡¹ç›®fixä¸€ä¸ªé‡è¦çš„bugåŽï¼Œåœ¨AWSä¸Šçš„æŒç»­éƒ¨ç½²æµæ°´çº¿ä¸€ç›´å¤±è´¥ã€‚åˆ†æžæ—¥å¿—åŽï¼Œå‘çŽ°æµæ°´çº¿ä¸­çš„æ•°ä¸ªæ­¥éª¤éœ€è¦å…‹éš†æºä»£ç ï¼Œä½†æ˜¯è®¿é—®Githubçš„ç½‘ç»œéžå¸¸ä¸ç¨³å®šï¼Œè¿™æ•°ä¸ªæµæ°´çº¿ä»»åŠ¡æŒç»­å› è¿žæŽ¥è¶…æ—¶ï¼Œè¿žæŽ¥æ‹’ç»ç­‰ç½‘ç»œé”™è¯¯è€Œå¤±è´¥ã€‚è€Œæµæ°´çº¿ä»»åŠ¡å¤§é‡ä½¿ç”¨äº†CodeBuild, Lambdaç­‰AWSæ‰˜ç®¡æœåŠ¡ï¼Œæ— æ³•ä¸ºæ‰§è¡ŒçŽ¯å¢ƒé…ç½®å¯é çš„ç½‘ç»œè¿žæŽ¥ã€‚\næœ¬æ–¹æ¡ˆæ€è·¯å¦‚ä¸‹ï¼Œ\nåœ¨ VPC public subnets ä¸­åˆ›å»º NAT instance å³ EC2 è™šæ‹Ÿæœºï¼Œ é…ç½® NAT instanceï¼Œä½¿ç”¨ tunnel ç½‘ç»œè®¿é—® githubï¼Œ ä¿®æ”¹ private subnets çš„è·¯ç”±è¡¨ï¼Œæ·»åŠ  github æœåŠ¡çš„ IP CIDRsï¼Œå°†å¯¹è¿™äº›IPåœ°å€çš„è¯·æ±‚é€šè¿‡ NAT instance è½¬å‘ã€‚ ç»¼ä¸Šï¼Œå®žçŽ°äº†ä¸ç”¨å¯¹çŽ°æœ‰æŒç»­éƒ¨ç½²æµæ°´çº¿åšä»»ä½•ä¿®æ”¹ï¼Œæµæ°´çº¿ä¸­è¿è¡Œåœ¨ VPC private subnet å†…çš„ä»»åŠ¡(åŒ…æ‹¬ä½†ä¸é™äºŽCodeBuild, Fargate, Lambda, Glueç­‰)ï¼Œå¯¹å¤–ç½‘çš„è¯·æ±‚ç›®æ ‡åœ°å€å¦‚åœ¨è·¯ç”±è¡¨çš„ç‰¹æ®Šè§„åˆ™(IP CIDRs)ä¸­ï¼Œç½‘ç»œè¯·æ±‚å°†ä¼šé€šè¿‡ NAT instance æ¥è½¬å‘ã€‚\nä¸ºæ­¤ï¼Œåˆ›å»ºäº†ä¸€ä¸ªåŸºäºŽ AWS CDK construct çš„å¼€æºé¡¹ç›® SimpleNAT æ¥å°è£…å’Œå¤ç”¨åˆ›å»ºé…ç½® NAT instancesï¼Œå¹¶ä¸”å°†æŒ‡å®šçš„IPåœ°å€æ®µæ›´æ–°åˆ°è·¯ç”±è¡¨è®¾ç½®è·¯ç”±è§„åˆ™ã€‚\nè¯¥é¡¹ç›®åŒæ—¶æä¾›äº†ä¸€ä¸ªå®Œæ•´ç¤ºä¾‹åº”ç”¨ï¼Œæ¼”ç¤ºäº†å¦‚ä½•é…ç½® NAT instance ä½¿ç”¨ sshuttle å»ºç«‹ç½‘ç»œéš§é“ï¼Œå¹¶ä¸”å°†æŒ‡å®šçš„IPåœ°å€æ®µè¯·æ±‚é€šè¿‡ NAT instance æ¥è½¬å‘ã€‚\n","link":"https://kane.mx/posts/2021/simple-nat-on-aws/","section":"posts","tags":["AWS","Tip","network","NAT","CDK Construct","AWS CDK"],"title":"åœ¨AWSä¸Šå¿«é€Ÿéƒ¨ç½²ä¸“ç”¨çš„NATå®žä¾‹"},{"body":"So, Who Am I? Iâ€™m the father of three boys. Live in Beijing. Also I'm the *uix user, a full stack software engineer, devops and cloud native evangelist.\nCurious about me? Use the social links above to check out my profiles.\n","link":"https://kane.mx/about/","section":"","tags":null,"title":"About"},{"body":"Infrastructure as Code is the trend to manage the resources of application. AWS CloudFormation is the managed service offering the IaC capability on AWS since 2011. CloudFormation uses the declarative language to manage your AWS resources with the style what you get is what you declare.\nHowever there are cons of CloudFormation as a declarative language,\nthe readability and maintenance for applications involving lots of resources the reuseable of code, CloudFormation modules released in re:Invent 2020 might help mitigate it AWS CDK provides the programming way to define the infra in code by your preferred programming languages, such as Typescript, Javascript, Python, Java and C#. AWS CDK will synthesis the code to CloudFormation template, then deploying the stack via AWS CloudFormation service. It benefits the Devops engineers manage the infra on AWS as programming application, having version control, code review, unit testing, integration testing and CI/CD pipelines, the deployment still depends on the mature CloudFormation service to rolling update the resources and rollback when failing.\nFor solution development, using CDK indeed improves the productivity then publish the deployment assets as CloudFormation templates.\nThough CDK application can be synthesized to CloudFormation template, there are still some differences blocking the synthesized templates to be deployed across multiple AWS regions.\nThis post will share the tips on how effectively writing AWS CDK application then deploying the application by CloudFormation across multiple regions.\nGeneral Environment-agnostic stack Donâ€™t specify env with account and region like below that will generate account/region hardcode in CloudFormation template.\n1new MyStack(app, \u0026#39;Stack1\u0026#39;, { 2 env: { 3 account: \u0026#39;123456789012\u0026#39;, 4 region: \u0026#39;us-east-1\u0026#39; 5 }, 6}); use CfnMapping/CfnCondition instead of if-else clause CloudFormation does not have logistic processing like programming language. Use CfnMapping or CfnCondition instead.\nNote: the CfnMapping does not support default value, you have to list all supported regions like below code snippet,\n1getAwsLoadBalancerControllerRepo() { 2 const albImageMapping = new cdk.CfnMapping(this, \u0026#39;ALBImageMapping\u0026#39;, { 3 mapping: { 4 \u0026#39;me-south-1\u0026#39;: { 5 2: \u0026#39;558608220178\u0026#39;, 6 }, 7 \u0026#39;eu-south-1\u0026#39;: { 8 2: \u0026#39;590381155156\u0026#39;, 9 }, 10 \u0026#39;ap-northeast-1\u0026#39;: { 11 2: \u0026#39;602401143452\u0026#39;, 12 }, 13 \u0026#39;ap-northeast-2\u0026#39;: { 14 2: \u0026#39;602401143452\u0026#39;, 15 }, 16 ... 17 \u0026#39;ap-east-1\u0026#39;: { 18 2: \u0026#39;800184023465\u0026#39;, 19 }, 20 \u0026#39;af-south-1\u0026#39;: { 21 2: \u0026#39;877085696533\u0026#39;, 22 }, 23 \u0026#39;cn-north-1\u0026#39;: { 24 2: \u0026#39;918309763551\u0026#39;, 25 }, 26 \u0026#39;cn-northwest-1\u0026#39;: { 27 2: \u0026#39;961992271922\u0026#39;, 28 }, 29 } 30 }); 31 return `${albImageMapping.findInMap(cdk.Aws.REGION, \u0026#39;2\u0026#39;)}.dkr.ecr.${cdk.Aws.REGION}.${cdk.Aws.URL_SUFFIX}/amazon/aws-load-balancer-controller`; 32 } never use Stack.region Donâ€™t rely on stack.region to do the logistic for China regions. Use additional context parameter or CfnMapping like below snippet,\n1const partitionMapping = new cdk.CfnMapping(this, \u0026#39;PartitionMapping\u0026#39;, { 2 mapping: { 3 aws: { 4 nexus: \u0026#39;quay.io/travelaudience/docker-nexus\u0026#39;, 5 nexusProxy: \u0026#39;quay.io/travelaudience/docker-nexus-proxy\u0026#39;, 6 }, 7 \u0026#39;aws-cn\u0026#39;: { 8 nexus: \u0026#39;048912060910.dkr.ecr.cn-northwest-1.amazonaws.com.cn/quay/travelaudience/docker-nexus\u0026#39;, 9 nexusProxy: \u0026#39;048912060910.dkr.ecr.cn-northwest-1.amazonaws.com.cn/quay/travelaudience/docker-nexus-proxy\u0026#39;, 10 }, 11 } 12 }); 13partitionMapping.findInMap(cdk.Aws.PARTITION, \u0026#39;nexus\u0026#39;); Use core.Aws.region token referred to the region which region of the stack is deployed.\nexplicitly add dependencies on resources to control the creation/deletion order of resources For example, when deploying a solution with creating a new VPC with NAT gateway, then deploying EMR cluster in private subnets of VPC. The EMR cluster might fail on creation due to network issue. Itâ€™s caused by the NAT gateway is not ready when initializing the EMR cluster, you have to manually create the dependencies among EMR cluster and NAT gateway.\nAlways override the logical ID of CloudFormation resource when creating AWS resources with unique name UPDATED: 2023/10/24\nWhen creating an AWS resource via CDK with a friendly name, for example, you create a Glue Table named my-table in CDK. The logical ID will be generated by CDK constructs' name inheritance, however, you might refactor your constructs in the system design level. The default logical ID of the resource will be changed after your refactor or renaming the ID of construct. After the logical ID changes, the resource will be replaced when updating the CloudFormation stack to a new template. In the updating process of CloudFormation stack, a new resource will be created firstly, however, the resource creation will fail due to the conflict resource name. Currently, the workaround is that explicitly overriding the logical ID of the AWS resource created by CDK to avoid the replacement in stack updating. Explicitly override the logical ID will maintain the code readability and avoid the unintended the failure of stack update.\n1(table.node.defaultChild as CfnResource).overrideLogicalId(tableLogicId); EKS module(@aws-cdk/aws-eks) specify kubectl layer when creating EKS cluster NOTE: This tricky only applies for AWS CDK prior to 1.81.0. CDK will bundle kubectl, helm and awscli as lambda layer instead of SAR application since 1.81.0, it resolves below limitation.\nEKS uses a lambda layer to run kubectl/helm cli as custom resource, the @aws-cdk/aws-eks module depends on the Stack.region to check the region to be deployed in synthesizing phase. It violates the principle of Environment-agnostic stack! Use below workaround to create the EKS cluster,\n1const partitionMapping = new cdk.CfnMapping(this, \u0026#39;PartitionMapping\u0026#39;, { 2 mapping: { 3 aws: { 4 // see https://github.com/aws/aws-cdk/blob/60c782fe173449ebf912f509de7db6df89985915/packages/%40aws-cdk/aws-eks/lib/kubectl-layer.ts#L6 5 kubectlLayerAppid: \u0026#39;arn:aws:serverlessrepo:us-east-1:903779448426:applications/lambda-layer-kubectl\u0026#39;, 6 }, 7 \u0026#39;aws-cn\u0026#39;: { 8 kubectlLayerAppid: \u0026#39;arn:aws-cn:serverlessrepo:cn-north-1:487369736442:applications/lambda-layer-kubectl\u0026#39;, 9 }, 10 } 11}); 12 13const kubectlLayer = new eks.KubectlLayer(this, \u0026#39;KubeLayer\u0026#39;, { 14 applicationId: partitionMapping.findInMap(cdk.Aws.PARTITION, \u0026#39;kubectlLayerAppid\u0026#39;), 15}); 16const cluster = new eks.Cluster(this, \u0026#39;MyK8SCluster\u0026#39;, { 17 vpc, 18 defaultCapacity: 0, 19 kubectlEnabled: true, 20 mastersRole: clusterAdmin, 21 version: eks.KubernetesVersion.V1_16, 22 coreDnsComputeType: eks.CoreDnsComputeType.EC2, 23 kubectlLayer, 24}); If you're interested on this issue, see cdk issue for detail.\nmanage the lifecycle of helm chart deployment The k8s helm chart might create AWS resources out of CloudFormation scope. You have to manage the lifecycle of those resources by yourself.\nFor example, there is an EKS cluster with AWS load balancer controller, then you deploy a helm chart with ingress that will create ALB/NLB by the chart, you must clean those load balancers in deletion of the chart. Also the uninstall of Helm chart is asynchronous, you have to watch the deletion of resource completing before continuing to clean other resources.\nTHE END The tips will be updated when something new is found or the one is deprecated after CDK is updated.\nHAPPY CDK \u0026#x1f606;\n","link":"https://kane.mx/posts/2020/effective-aws-cdk-for-aws-cloudformation/","section":"posts","tags":["Infrastructure as Code","AWS CloudFormation","AWS CDK","AWS"],"title":"Effective AWS CDK for AWS CloudFormation"},{"body":"è¿‘æœŸAmazon Builders Libraryå‘å¸ƒäº†æ•°ç¯‡æ–‡ç« ä»‹ç»äºšé©¬é€Šå¦‚ä½•å®žè·µæŒç»­éƒ¨ç½²ï¼ŒåŒæ—¶åˆ†äº«äº†äºšé©¬é€Šåœ¨éƒ¨ç½²æ–¹é¢çš„æœ€ä½³å®žè·µã€‚\nè¿™é‡Œå°†è¿™ä¸‰ç¯‡æ–‡ç« æ ¸å¿ƒå†…å®¹åšä¸ªæ¦‚è¿°ï¼Œæ–¹ä¾¿å¤§å®¶æŒ‰éœ€ç»†è¯»ã€‚\nGoing faster with continuous delivery è¿™ç¯‡æ–‡ç« å…ˆæ˜¯åˆ†äº«äº†äºšé©¬é€ŠæŒç»­æ”¹è¿›å’Œè½¯ä»¶è‡ªåŠ¨åŒ–çš„æ–‡åŒ–(Amazonianéšæ—¶éƒ½æƒ¦è®°ç€çš„é¢†å¯¼åŠ›å‡†åˆ™)ï¼Œç„¶åŽä»‹ç»äº†äºšé©¬é€Šå†…éƒ¨çš„æŒç»­éƒ¨ç½²å·¥å…·Pipelinesã€‚ä»Žä¸€ä¸ªè¯•ç‚¹å·¥å…·è¿›åŒ–ä¸ºäºšé©¬é€Šæ ‡å‡†ã€ä¸€è‡´ä¸”ç®€æ´çš„å‘å¸ƒå·¥å…·ã€‚å¹¶ä¸”å°†æž„å»ºå’Œå‘å¸ƒè½¯ä»¶çš„æœ€ä½³å®žè·µæ£€æŸ¥ä¹Ÿèžå…¥åˆ°Pipelinesä¸­ã€‚\næŽ¥ä¸‹æ¥æ˜¯åˆ†äº«å¦‚ä½•å‡å°æ•…éšœå½±å“åˆ°å®¢æˆ·çš„é£Žé™©ã€‚æœ‰è¿‡è½¯ä»¶å¼€å‘ç»éªŒçš„éƒ½çŸ¥é“ï¼Œè½¯ä»¶å˜æ›´å¼•å…¥æ•…éšœæ˜¯ä¸å¯é¿å…çš„ï¼Œå¦‚ä½•å°†æ•…éšœå¯¹å®¢æˆ·çš„å½±å“æŽ§åˆ¶åˆ°æœ€å°æ˜¯éžå¸¸é‡è¦çš„ã€‚è¯¥æ–‡ä»Žä¸‹é¢å‡ ä¸ªæ–¹é¢ç»™å‡ºäº†å»ºè®®ï¼Œ\néƒ¨ç½²å«ç”Ÿï¼Œå¦‚å¯¹æ–°éƒ¨ç½²ç¨‹åºçš„å¥åº·æ£€æŸ¥ ä¸Šç”Ÿäº§ç³»ç»Ÿä¹‹å‰çš„æµ‹è¯•ï¼Œè‡ªåŠ¨åŒ–å•å…ƒã€é›†æˆã€é¢„ç”Ÿäº§æµ‹è¯• ç”Ÿäº§ç³»ç»Ÿä¸Šçš„éªŒè¯ï¼Œåˆ†æ‰¹çš„éƒ¨ç½²ï¼ŒæŽ§åˆ¶æ•…éšœå½±å“åŠå¾„ æŽ§åˆ¶ä½•æ—¶å‘å¸ƒè½¯ä»¶ æœ€åŽä½œè€…ä»‹ç»äº†äºšé©¬é€Šå¦‚ä½•å¿«é€Ÿæ‰§è¡Œä¸šåŠ¡åˆ›æ–° -- é€šè¿‡è‡ªåŠ¨åŒ–ä¸€åˆ‡äº‹æƒ…ã€‚\nAutomating safe, hands-off deployments è¿™ç¯‡æ–‡ç« å¾ˆå¥½çš„å‘¼åº”äº†Going faster with continuous deliveryä¸€æ–‡ä¸­å¦‚ä½•é¿å…æ–°çš„éƒ¨ç½²å¯¼è‡´æ•…éšœå½±å“ï¼Œéžå¸¸è¯¦ç»†çš„ä»‹ç»äº†äºšé©¬é€Šå…³äºŽè‡ªåŠ¨åŒ–å®‰å…¨éƒ¨ç½²çš„å®žè·µã€‚\nå¯¹äºŽæŒç»­éƒ¨ç½²ï¼Œæºç  -\u0026gt; æž„å»º -\u0026gt; æµ‹è¯• -\u0026gt; ç”Ÿäº§ è¿™ä¸ªæµç¨‹å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰ã€‚\nä»Žä¸‹å›¾çœ‹ï¼Œäºšé©¬é€Šå¯¹äºŽæºç å’Œæž„å»ºçš„ç†è§£æ˜¯éžå¸¸æ·±å…¥å’Œå…¨é¢çš„ã€‚\næºç å¹¶ä¸ä»…ä»…æ˜¯åº”ç”¨ç¨‹åºæºä»£ç ï¼Œè¿˜å¯ä»¥åŒ…æ‹¬è¿ç»´å·¥å…·ä»£ç ã€æµ‹è¯•ä»£ç ã€åŸºç¡€æž¶æž„ä»£ç ã€é™æ€èµ„æºã€ä¾èµ–åº“ã€é…ç½®å’Œæ“ä½œç³»ç»Ÿè¡¥ä¸ã€‚\nä»£ç å®¡æ ¸æ˜¯å¿…é¡»çš„ã€‚å¯¹äºŽå…¨è‡ªåŠ¨çš„æµæ°´çº¿ï¼Œä»£ç å®¡æ ¸æ˜¯æœ€åŽä¸€é“äººå·¥æ ¸éªŒã€‚ä»£ç å®¡æ ¸ä¸ä»…ä»…æ˜¯å®¡æ ¸ä»£ç çš„æ­£ç¡®æ€§ï¼Œè¿˜åº”è¯¥æ£€æŸ¥ä»£ç æ˜¯å¦åŒ…æ‹¬è¶³å¤Ÿçš„æµ‹è¯•ï¼Œæ˜¯å¦æœ‰å®Œå–„çš„å·¥å…·æ¥ç›‘æµ‹éƒ¨ç½²ä»¥åŠèƒ½å¦å®‰å…¨çš„å›žé€€ã€‚\nåŒæ—¶æž„å»ºä¹Ÿä¸å…‰æ˜¯ç¼–è¯‘æºä»£ç ï¼Œæ‰“åŒ…å¹¶å­˜å‚¨æž„ä»¶ã€‚ä¹ŸåŒ…å«å•å…ƒæµ‹è¯•ï¼Œé™æ€ä»£ç åˆ†æžï¼Œä»£ç è¦†ç›–çŽ‡æ£€æŸ¥ï¼Œä»£ç å®¡æ ¸æ£€æŸ¥ã€‚\næµ‹è¯•åœ¨äºšé©¬é€Šæ˜¯ä¸€ä¸ªå¤šé˜¶æ®µçš„é¢„ç”Ÿäº§çŽ¯å¢ƒï¼Œè¯¦è§ä¸‹å›¾ã€‚\né›†æˆæµ‹è¯•æ˜¯è‡ªåŠ¨åŒ–çš„æ¨¡æ‹Ÿå®¢æˆ·ä¸€æ ·ä½¿ç”¨æœåŠ¡ï¼Œå®žçŽ°ç«¯åˆ°ç«¯çš„æµ‹è¯•ã€‚éƒ¨ç½²åˆ°ç”Ÿäº§ä¹‹å‰ï¼Œè¿˜éœ€è¦æ‰§è¡Œå‘åŽå…¼å®¹æ€§æµ‹è¯•ä»¥åŠå€ŸåŠ©è´Ÿè½½å‡è¡¡å®žçŽ°one-boxæµ‹è¯•ã€‚\nAWSæœåŠ¡æ˜¯éƒ¨ç½²åœ¨å…¨çƒå¤šä¸ªåŒºåŸŸå†…çš„å¤šä¸ªå¯ç”¨åŒºï¼Œä¸ºäº†å‡å°‘éƒ¨ç½²æ•…éšœå¯¹å®¢æˆ·çš„å½±å“ï¼Œç”Ÿäº§é€šè¿‡æ³¢æ¬¡éƒ¨ç½²æ¥åˆ†æ‰¹åˆ†é˜¶æ®µçš„å®‰å…¨éƒ¨ç½²ã€‚\né¦–å…ˆéƒ¨ç½²æ˜¯åœ¨å•åŒºåŸŸçš„å•å¯ç”¨åŒºåšone-boxéƒ¨ç½²ï¼Œå¦‚æžœå¼•èµ·è´Ÿé¢é—®é¢˜ï¼Œä¼šè‡ªåŠ¨å›žé€€å¹¶åœæ­¢ç”Ÿäº§åŽç»­çš„éƒ¨ç½²ã€‚ç³»ç»ŸæŒ‡æ ‡çš„ç›‘æŽ§æ˜¯å®žçŽ°è‡ªåŠ¨åŒ–å®‰å…¨éƒ¨ç½²çš„æ ¸å¿ƒï¼Œéœ€è¦é€šè¿‡ç›‘æŽ§çš„æŒ‡æ ‡æ¥è‡ªåŠ¨è§¦å‘éƒ¨ç½²å›žé€€ã€‚\nBake timeä¹Ÿæ˜¯å®žè·µç»éªŒæ€»ç»“å‡ºæ¥çš„ç²¾é«“ã€‚æœ‰æ—¶æ•…éšœä¸æ˜¯åœ¨éƒ¨ç½²åŽé©¬ä¸Šæ˜¾çŽ°çš„ï¼Œéœ€è¦æ—¶é—´æ‰ä¼šé€æ¸æ˜¾çŽ°ã€‚è®¾ç½®åˆç†çš„Bake timeï¼Œèƒ½å¤Ÿè®©æ•…éšœæœ‰è¶³å¤Ÿæ—¶é—´è¢«æš´éœ²å‡ºæ¥ï¼Œä¸è‡³äºŽç…§æˆå¤§èŒƒå›´å½±å“ã€‚\nEnsuring rollback safety during deployments å› ä¸ºæ•…éšœæ˜¯ä¸å¯é¿å…çš„ï¼Œéƒ¨ç½²èƒ½å¤Ÿè¢«å®‰å…¨å›žé€€æ˜¯éžå¸¸å¿…è¦çš„ã€‚è¿™ç¯‡æ–‡ç« å°±è¯¦ç»†ä»‹ç»äº†å¦‚ä½•å®žçŽ°å¯å®‰å…¨å›žé€€çš„éƒ¨ç½² -- é€šè¿‡ä¸¤é˜¶æ®µéƒ¨ç½²çš„æŠ€æœ¯ï¼Œä»¥åŠåºåˆ—åŒ–çš„æœ€ä½³å®žè·µã€‚\nè¿™ä¸‰ç¯‡æ–‡ç« åˆ†åˆ«ä»Žæœ¯å’Œå™¨çš„è§’åº¦åˆ†äº«äº†äºšé©¬é€Šåœ¨è½¯ä»¶éƒ¨ç½²çš„å®žè·µç»éªŒï¼Œå¼€å‘è€…ä»¬å¯ä»¥ç»“åˆè‡ªèº«ä¸šåŠ¡æƒ…å†µé›†æˆé€‚åˆçš„æœ€ä½³å®žè·µã€‚\n","link":"https://kane.mx/posts/2020/the-best-practise-of-deployment-at-amazon/","section":"posts","tags":["DevOps","Continuous Deployment","Amazon Builders' Library","System Design"],"title":"äºšé©¬é€Šçš„éƒ¨ç½²æœ€ä½³å®žè·µ"},{"body":"","link":"https://kane.mx/tags/aws-step-functions/","section":"tags","tags":null,"title":"AWS Step Functions"},{"body":"AWS CDKæ˜¯ç¼–æŽ’éƒ¨ç½²AWSäº‘ä¸Šèµ„æºæœ€ä½³çš„å·¥å…·ä¹‹ä¸€ã€‚åŸºäºŽAWS CDKçš„åº”ç”¨åº”è¯¥å¦‚ä½•å®žè·µDevOpsæŒç»­é›†æˆå’Œéƒ¨ç½²å‘¢ï¼Ÿ\né€šå¸¸æˆ‘ä»¬æœ‰ä¸‹é¢å‡ ç§æ–¹æ³•ï¼Œ\nä½¿ç”¨AWS CodePipelineæ¥å®ŒæˆDevOps pipelineæ­å»ºã€‚CodePipelineæ˜¯AWS Codeç³»åˆ—æœåŠ¡ä¸­çš„æŒç»­é›†æˆç¼–æŽ’å·¥å…·ï¼Œå®ƒå¯ä»¥é›†æˆCodeBuildé¡¹ç›®ï¼Œåœ¨CodeBuildé¡¹ç›®buildä¸­å®‰è£…cdkï¼Œå¹¶æ‰§è¡Œcdk deployå‘½ä»¤æ¥å®žçŽ°åº”ç”¨éƒ¨ç½²ã€‚ è¿™ç§æ–¹æ³•ç®€å•ç›´æŽ¥çš„å®žçŽ°äº†DevOpséƒ¨ç½²æµæ°´çº¿ã€‚ä½†ç¼ºå°‘stagingï¼Œå°†æœ€æ–°æäº¤ç›´æŽ¥éƒ¨ç½²åˆ°ç”Ÿäº§æ˜¯ä¸€ç§éžå¸¸é«˜é£Žé™©çš„åšæ³•ã€‚\nCDKè¿‘æœŸå‘å¸ƒäº†ä½“éªŒæ€§çš„æ–°ç‰¹æ€§CDK Pipelinesæ¥å°è£…CDKåº”ç”¨æŒç»­éƒ¨ç½²æµæ°´çº¿çš„é…ç½®ã€‚CDK Pipelinesä¹Ÿæ˜¯åŸºäºŽAWS CodePipelineæœåŠ¡ï¼Œæä¾›å¿«é€Ÿåˆ›å»ºå¯è·¨è´¦å·åŒºåŸŸçš„æŒç»­éƒ¨ç½²æµæ°´çº¿ï¼ŒåŒæ—¶æ”¯æŒéƒ¨ç½²æµæ°´çº¿é¡¹ç›®çš„è‡ªå‡çº§æ›´æ–°ã€‚æ•´ä¸ªæµæ°´çº¿æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ CDK Pipelinesæ˜¯éžå¸¸é«˜æ•ˆä¸”çµæ´»çš„æŒç»­éƒ¨ç½²æµæ°´çº¿åˆ›å»ºçš„æ–¹å¼ï¼Œä½†ç”±äºŽæ˜¯ä½“éªŒæ€§ç‰¹æ€§ï¼Œåœ¨ç”Ÿäº§åº”ç”¨ä¸­è¿˜æœ‰ä¸€äº›å±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œ\nä¸æ”¯æŒcontext provideræŸ¥æ‰¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ— æ³•æ”¯æŒCDKåº”ç”¨æŸ¥æ‰¾è´¦æˆ·ä¸­å­˜åœ¨çš„VPCï¼ŒR53 HostedZoneç­‰ã€‚ ç”±äºŽCDK Pipelineså®žé™…æ˜¯ä½¿ç”¨CodePipelineæ¥ç¼–æŽ’éƒ¨ç½²æµæ°´çº¿ï¼ŒCodePipelineçš„å±€é™æ€§ï¼ŒCDK PipelinesåŒæ ·å­˜åœ¨ã€‚ CodePipelineåœ¨æŸäº›åˆ†åŒºå’ŒåŒºåŸŸè¿˜ä¸å¯ç”¨ã€‚ä¾‹å¦‚ï¼ŒAWSä¸­å›½åŒºæš‚æ—¶è¿˜æ²¡æœ‰CodePipelineæœåŠ¡ï¼ŒCDK Pipelinesåœ¨AWSä¸­å›½åŒºä¹Ÿå°±æ— æ³•ä½¿ç”¨ã€‚ ä½¿ç”¨AWS Step Functionsæ¥ç¼–æŽ’CDKåº”ç”¨éƒ¨ç½²çš„æµæ°´çº¿ã€‚åœ¨Step Functionsç¼–è¯‘çš„éƒ¨ç½²æµæ°´çº¿ä¸­ï¼Œå¯ç”¨é€šè¿‡CodeBuildé¡¹ç›®æ¥å®Œæˆcdk deployæ‰§è¡Œåšåˆ°å®Œæ•´çš„æ”¯æŒCDKçš„æ‰€æœ‰åŠŸèƒ½ã€‚åŒæ—¶Step Functionså…·å¤‡æœ€å¤§çš„çµæ´»æ€§æ¥æ”¯æŒæŒç»­éƒ¨ç½²è¿‡ç¨‹ä¸­çš„å„ç§ç¼–æŽ’éœ€æ±‚ï¼Œä¾‹å¦‚ï¼Œè·¨è´¦æˆ·éƒ¨ç½²åº”ç”¨çš„ä¸åŒstageï¼Œå¼•å…¥äººå·¥å®¡æ‰¹æµç¨‹ï¼Œé€šè¿‡Slackç­‰chatopså·¥å…·æ¥å®Œæˆå®¡æ‰¹ã€‚ Opentunaé¡¹ç›®å°±å®žè·µäº†ç”¨Step Functionsæ¥ç¼–æŽ’æŒç»­éƒ¨ç½²æµæ°´çº¿ã€‚æ•´ä¸ªéƒ¨ç½²æµç¨‹å¦‚ä¸‹å›¾ï¼Œ\nå¦‚æžœå¯¹åŸºäºŽStep Functionså®žçŽ°çš„CDKåº”ç”¨æŒç»­éƒ¨ç½²æ„Ÿå…´è¶£ï¼Œå¯ä»¥è®¿é—®OpenTUNAé¡¹ç›®å®žçŽ°çš„æºç äº†è§£æ›´å¤šç»†èŠ‚ã€‚\n","link":"https://kane.mx/posts/2020/deploy-aws-cdk-applications-cross-accounts/","section":"posts","tags":["AWS","AWS CDK","DevOps","AWS Step Functions"],"title":"è·¨è´¦å·è·¨åŒºåŸŸéƒ¨ç½²AWS CDKç¼–æŽ’çš„åº”ç”¨"},{"body":"Sonatype Nexus repository OSS is an artifact repository that supports most software repositories such as Maven, Pypi, Npmjs, Rubygems, Yum, Apt, Docker registry and etc. In the enterprise Nexus repository is widely used for storing proprietary artifacts and caching the artifacts for speeding up the devops.\nBuilding a production ready Nexus repository always is a requirement for devops team, it should satisfy below criterias at least,\nartifacts storage management It's difficult to predicate the storage usage of artifacts, allocating large volume is not cost optimized. the durability of nexus3 data storage We need a way to make sure data storage of nexus when updating Nexus OSS to newer version or recover the service from unhealthy status. self healing capability when the service is down A reliable way recovers the Nexus repository OSS when it's unhealth. There is a well-architected solution(maintained by AWS team) to quickly(~10 minutes) deploy Nexus OSS leveraging below capabilities,\nHost on EKS cluster using managed EC2 nodes with IRSA Expose service via AWS Application load balancer managed by AWS load balancer controller(former ALB Ingress Controller) Use dedicated S3 bucket for storing Nexus OSS blobstore with ulimited and on-demand storage Use EFS, EFS CSI Driver, PV and PVC storing nexus data Use Helm to deploy Sonatype Nexus chart Optional Use External DNS to registry the domain record of Nexus repository to Route 53 Optional Use AWS Certificate Manager to create SSL certificate of domain name of Nexus repository Enjoy it\u0026#x1f60f;\n","link":"https://kane.mx/posts/2020/deploy-sonatype-nexus-oss-on-eks/","section":"posts","tags":["Amazon EKS","Kubernetes","Helm","AWS CDK","AWS","Sonatype Nexus"],"title":"Deploy Sonatype Nexus repository OSS on EKS"},{"body":"","link":"https://kane.mx/tags/aws-athena/","section":"tags","tags":null,"title":"AWS Athena"},{"body":"","link":"https://kane.mx/tags/big-data/","section":"tags","tags":null,"title":"Big Data"},{"body":"","link":"https://kane.mx/tags/cloud-native/","section":"tags","tags":null,"title":"Cloud Native"},{"body":"","link":"https://kane.mx/tags/data-lakes/","section":"tags","tags":null,"title":"Data Lakes"},{"body":"","link":"https://kane.mx/tags/docker/","section":"tags","tags":null,"title":"Docker"},{"body":"","link":"https://kane.mx/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/","section":"tags","tags":null,"title":"äº‘è®¡ç®—"},{"body":"è¿‘æœŸå¯¹Dockeré•œåƒåšäº†äº›æ•°æ®åˆ†æžï¼Œè¿™é‡Œåˆ†äº«ä¸€ä¸‹åˆ©ç”¨äº‘åŽŸç”ŸæŠ€æœ¯å¿«é€Ÿä¸”ä½Žæˆæœ¬çš„å®žçŽ°ä»»æ„æ•°é‡çš„æ•°æ®åˆ†æžã€‚\nä¹‹å‰é€šè¿‡æ–‡ç« ä»‹ç»äº†ä¸ç”¨æ‹‰å–Dockeré•œåƒå°±å¯èŽ·å–é•œåƒçš„å¤§å°çš„ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡å…¶ä¸­çš„ç¤ºä¾‹è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥èŽ·å–åˆ°å¾…åˆ†æžçš„åŽŸå§‹æ•°æ®ã€‚\næ¯”å¦‚nginxé•œåƒçš„éƒ¨åˆ†åŽŸå§‹æ•°æ®(csvæ ¼å¼)å¦‚ä¸‹ï¼Œ\n1 2 3 4 5 6 7 8 9 10 11 12 1.18.0-alpine,sha256:676b8117782d9e8c20af8e1b19356f64acc76c981f3a65c66e33a9874877892a,amd64,linux,null,null,\u0026#34;sha256:cbdbe7a5bc2a134ca8ec91be58565ec07d037386d1f1d8385412d224deafca08\u0026#34;,2813316 1.18.0-alpine,sha256:676b8117782d9e8c20af8e1b19356f64acc76c981f3a65c66e33a9874877892a,amd64,linux,null,null,\u0026#34;sha256:6ade829cd166df9b2331da48e3e60342aef9f95e1e45cde8d20e6b01be7e6d9a\u0026#34;,6477096 1.18.0-alpine,sha256:70feed62d5204358ed500463c0953dce6c269a0ebeef147a107422a2c78799a9,arm,linux,v6,null,\u0026#34;sha256:b9e3228833e92f0688e0f87234e75965e62e47cfbb9ca8cc5fa19c2e7cd13f80\u0026#34;,2619936 1.18.0-alpine,sha256:70feed62d5204358ed500463c0953dce6c269a0ebeef147a107422a2c78799a9,arm,linux,v6,null,\u0026#34;sha256:a03f81873d278ad248976b107883f0452d33c6f907ebcdd832a6041f1d33118a\u0026#34;,6080562 1.18.0-alpine,sha256:2ba714ccbdc4c2a7b5a5673ebbc8f28e159cf2687a664d540dcb91d325934f32,arm64,linux,v8,null,\u0026#34;sha256:29e5d40040c18c692ed73df24511071725b74956ca1a61fe6056a651d86a13bd\u0026#34;,2724424 1.18.0-alpine,sha256:2ba714ccbdc4c2a7b5a5673ebbc8f28e159cf2687a664d540dcb91d325934f32,arm64,linux,v8,null,\u0026#34;sha256:806787fcd4f9e2f814506fb53e81b6fb33f9eea04e5b537b31fa5fb601a497ee\u0026#34;,6423816 1.18.0-alpine,sha256:6d6f19360150548bbb568ecd3e1affabbdce0fcc39156e70fbae8a0aa656541a,386,linux,null,null,\u0026#34;sha256:2826c1e79865da7e0da0a993a2a38db61c3911e05b5df617439a86d4deac90fb\u0026#34;,2808418 1.18.0-alpine,sha256:6d6f19360150548bbb568ecd3e1affabbdce0fcc39156e70fbae8a0aa656541a,386,linux,null,null,\u0026#34;sha256:f2ab0e3b0ff04d1695df322540631708c42b0a68925788de2290c9497e44fef3\u0026#34;,6845295 1.18.0-alpine,sha256:c0684c6ee14c7383e4ef1d458edf3535cd62b432eeba6b03ddf0d880633207da,ppc64le,linux,null,null,\u0026#34;sha256:9a8fdc5b698322331ee7eba7dd6f66f3a4e956554db22dd1e834d519415b4f8e\u0026#34;,2821843 1.18.0-alpine,sha256:c0684c6ee14c7383e4ef1d458edf3535cd62b432eeba6b03ddf0d880633207da,ppc64le,linux,null,null,\u0026#34;sha256:30a37aac8b54a38e14e378f5122186373cf233951783587517243e342728a828\u0026#34;,6746511 1.18.0-alpine,sha256:714439fec7e1f55c29b57552213e45c96bbfeefddea2b3b30d7568591966c914,s390x,linux,null,null,\u0026#34;sha256:7184c046fdf17da4c16ca482e5ede36e1f2d41ac8cea9c036e488fd149d6e8e7\u0026#34;,2582859 1.18.0-alpine,sha256:714439fec7e1f55c29b57552213e45c96bbfeefddea2b3b30d7568591966c914,s390x,linux,null,null,\u0026#34;sha256:214dff8a034aad01facf6cf63613ed78e9d23d9a6345f1dee2ad871d6f94b689\u0026#34;,6569410 å„åˆ—çš„å«ä¹‰åˆ†åˆ«æ˜¯ï¼Œé•œåƒtag, é•œåƒDigest, é•œåƒå¯¹åº”å¹³å°çš„Architecture, é•œåƒå¯¹åº”å¹³å°çš„OS, é•œåƒå¯¹åº”å¹³å°çš„å˜ç§ï¼ˆä¾‹å¦‚ï¼ŒARMçš„v7, v8ç­‰ï¼‰, é•œåƒå¯¹åº”å¹³å°çš„OSç‰ˆæœ¬, é•œåƒç»„æˆå±‚çš„Digest, é•œåƒç»„æˆå±‚çš„å¤§å°ã€‚\nä¸Šé¢nginxé•œåƒçš„ç¤ºä¾‹æ•°æ®ï¼Œå‘Šè¯‰æˆ‘ä»¬é•œåƒånginxä¸”tagä¸º1.18.0-alpineçš„é•œåƒåŒ…å«äº†amd64-linux, arm-linux-v6, arm64-linux-v8, 386-linux, ppc64le-linuxä»¥åŠs390x-linuxå…±5ç§Archåˆè®¡6ä¸ªç‰ˆæœ¬çš„é•œåƒã€‚ä¸”æ¯ä¸ªå¹³å°çš„å¯¹åº”é•œåƒåŒ…å«äº†ä¸¤ä¸ªå±‚ä»¥åŠè¿™ä¸¤ä¸ªå±‚çš„å¤§å°ã€‚\nå½“æˆ‘ä»¬æœ‰äº†æˆç™¾æ•°åƒç”šè‡³æµ·é‡é•œåƒçš„åŽŸå§‹æ•°æ®åŽï¼Œå¦‚ä½•èƒ½å¿«é€Ÿä¸”ä½Žæˆæœ¬çš„åˆ†æžè¿™äº›æ•°æ®å‘¢ï¼Ÿ\nåœ¨AWSä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ•°æ®æ¹–ç›¸å…³çš„ç³»åˆ—äº§å“æ¥å®žçŽ°ä½Žæˆæœ¬çš„äº¤äº’å¼åˆ†æžã€‚\nåœ¨Dockeré•œåƒåˆ†æžè¿™ä¸ªåœºæ™¯ä¸‹ï¼Œæˆ‘å·²ç»èŽ·å–åˆ°äº†å¾…åˆ†æžé•œåƒçš„å¹³å°ã€å±‚ç­‰æ•°æ®ã€‚æˆ‘å°†è¿™äº›æ•°æ®ä¸Šä¼ åˆ°Amazon S3ä½œä¸ºæ•°æ®æ¹–çš„æ•°æ®æºã€‚ æŽ¥ä¸‹æ¥ä½¿ç”¨AWS Glueä»¥S3ä¸­çš„æ•°æ®åˆ›å»ºTableå¹¶ä¸”ä»Žä¸­æå‰æ•°æ®çš„metadataã€‚åŒæ—¶åšæ•°æ®åˆ†åŒºï¼Œä¸ºæŽ¥ä¸‹æ¥çš„æŸ¥è¯¢åšæ€§èƒ½å’Œæˆæœ¬ä¼˜åŒ–ã€‚ æ‰“å¼€Amazon Athenaï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€šè¿‡SQLè¯­å¥æŸ¥è¯¢åˆ†æžDockeré•œåƒæ•°æ®ã€‚ å°±æ˜¯é€šè¿‡ä»¥ä¸Š3ä¸ªç®€å•æ­¥éª¤ï¼Œæˆ‘å°±å¾—åˆ°äº†ä¸€ä¸ªæ— æœåŠ¡å™¨æž¶æž„çš„Dockeré•œåƒæ•°æ®åˆ†æžåº”ç”¨ï¼æ•´ä¸ªåº”ç”¨å®Œå…¨æ˜¯æŒ‰é‡è®¡è´¹çš„ï¼Œä¸»è¦æˆæœ¬åŒ…æ‹¬S3å¯¹è±¡å­˜å‚¨è´¹ç”¨ï¼Œå’ŒAthenaè´¹ç”¨ï¼ˆæ ¹æ®æ¯æ¬¡æŸ¥è¯¢æ‰«ææ•°æ®çš„å¤§å°æ¥è®¡ç®—ï¼‰ã€‚\nä½¿ç”¨è¯¥åˆ†æžåº”ç”¨ï¼Œæˆ‘ç»Ÿè®¡äº†Docker Hubå®˜æ–¹é•œåƒä¸­åŒ…å«å±‚æœ€å¤šçš„10ä¸ªé•œåƒ(åˆ†å¹³å°ç»Ÿè®¡)ï¼Œ æœ€åŽï¼Œå¾—åŠ›äºŽAWS Infra as Codeçš„å¼ºå¤§èƒ½åŠ›ï¼Œæ•´ä¸ªåº”ç”¨ä¹Ÿæ˜¯é€šè¿‡ä»£ç ç®¡ç†çš„ä¸”å¼€æºçš„ï¼Œæœ‰å…´è¶£çš„è¯»è€…ä¹Ÿå¯ä»¥éƒ¨ç½²è‡ªå·±çš„åˆ†æžåº”ç”¨ã€‚\n","link":"https://kane.mx/posts/2020/serverless-docker-images-analytics/","section":"posts","tags":["äº‘è®¡ç®—","AWS","Big Data","Data Lakes","Analytics","AWS Athena","Cloud Native","docker"],"title":"æ— æœåŠ¡å™¨æž¶æž„çš„Dockeré•œåƒæ•°æ®åˆ†æžåº”ç”¨"},{"body":"Recently I had a requirement to stats the size of some Docker images. It would be waste if pulling them all firstly then calculating the size of each image. Also you know the docker image consists of some Docker layers that probably are shared by other images. It's hard to get the disk usage if only sum the size of each image.\nIs there any way to get the size of Docker image without pulling it?\nIt's definitely Yes. The docker images are hosted by Docker Registry, which is defined by a public specification. The latest V2 of Registry has API to fetch the manifest of an image that contains the size of every layer. Looks like it's very cool. Utilitying the manifest API of image will satisfie my requirement!\nOne more thing you should note, the v2 of Docker registry still is compatible with schema specification V1. You have to properly handle with the mixed responses of manifest when you query the manifest of an image.\nI created a simple shell script gracefully handling either v1 or v2 response of the image manifest, which can calculate the total layers size of a Docker image with specific tag, or the size of all tags of a Docker image.\nAbove script was inspired by this post. Hope you enjoy it.\n","link":"https://kane.mx/posts/2020/get-docker-image-size-without-pulling-image/","section":"posts","tags":["docker","Tip"],"title":"Get the size of Docker image without pulling image"},{"body":"","link":"https://kane.mx/tags/oh-my-zsh/","section":"tags","tags":null,"title":"Oh-My-Zsh"},{"body":"Z shellæ­é…oh-my-zshè‡ªå®šä¹‰é…ç½®å·²æˆä¸ºä¼—å¤šLinux/Macosxç”¨æˆ·çš„æ ‡å‡†terminalé…ç½®ã€‚\næœ€è¿‘é‡åˆ°åœ¨zshä¸­æ‰§è¡Œä»»æ„å‘½ä»¤éƒ½å˜å¾—ç‰¹åˆ«æ…¢(å“ªæ€•ç®€å•æ‰§è¡Œlsä¹Ÿè¦èŠ±è´¹è‚‰çœ¼å¯è§çš„1ï¼Œ2ç§’é’Ÿ)ï¼Œè¿™é‡Œè®°å½•ä¸‹å¦‚ä½•æŽ’æŸ¥Z shellä¸‹å¯ç”¨oh-my-zshçš„æ€§èƒ½é—®é¢˜ã€‚\næ€§èƒ½é—®é¢˜ç—‡çŠ¶ çªç„¶æŸå¤©èµ·åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œéƒ½è‡³å°‘è¦èŠ±è´¹1ï¼Œ2ç§’ï¼ˆè‚‰çœ¼è®¡æ•°ï¼‰ï¼Œè¯¥å‘½ä»¤æ‰ä¼šå®Œæˆæ‰§è¡Œå¹¶é€€å‡ºåˆ°ç»ˆç«¯å¼€å§‹æŽ¥å—æ–°çš„è¾“å…¥ã€‚\næˆ‘å½“å‰ä¸»è¦ä½¿ç”¨çš„ç»ˆç«¯æ˜¯iTerm2ï¼Œæ‰§è¡Œå‘½ä»¤åŽï¼Œåœ¨ç»ˆç«¯Tabçš„title barä¸Šèƒ½æ˜¾å¼çš„çœ‹åˆ°gitå‘½ä»¤ä¹Ÿè¢«æ‰§è¡Œäº†ã€‚\nå°è¯•äº†å…¶ä»–çš„shellï¼Œæ¯”å¦‚bashï¼Œæ˜¯æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚åŸºæœ¬æ–­å®šé—®é¢˜åŒzshç›¸å…³ã€‚æ›´å¤šé—®é¢˜æè¿°ä¹ƒè‡³åŠ¨ç”»æˆªå±ï¼Œå¯ä»¥å‚è§è¿™ä¸ªissueã€‚\nzsh + oh-my-zsh æ€§èƒ½é—®é¢˜åˆ†æž oh-my-zshå…¶å®žå°±æ˜¯æä¾›zshçš„å®šåˆ¶åŒ–é…ç½®ï¼Œä¸»è¦åŒ…æ‹¬Themeä¸»é¢˜å’Œå„ç§è½¯ä»¶çš„æ’ä»¶ã€‚\noh-my-zsh æ’ä»¶ é€šå¸¸oh-my-zshä¸­å†…ç½®æˆ–ä¸‰æ–¹ç¤¾åŒºæä¾›çš„æ’ä»¶æ˜¯å¯¼è‡´æ€§èƒ½é™ä½Žç”šè‡³äº’ç›¸å†²çªçš„ä¸»è¦åŽŸå› ã€‚æŽ’æŸ¥æ€è·¯ä¹Ÿå¾ˆç®€å•ï¼Œé€šè¿‡é€ä¸ªç¦ç”¨å·²åŠ è½½çš„æ’ä»¶æ¥æµ‹è¯•æ˜¯å¦å¯ä»¥è§£å†³é—®é¢˜ã€‚\nç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€å½“å‰ç”¨æˆ·çš„~/.zshrcé…ç½®ï¼Œæ‰¾åˆ°pluginså¼€å¤´çš„é…ç½®è¡Œï¼Œä¾‹å¦‚ï¼Œ\n1plugins=( 2 git 3 osx 4## gradle 5 brew 6## command-not-found 7 github 8# gnu-utils 9## mvn 10 python 11 pip 12# screen 13 vi-mode 14 docker 15## docker-compose 16 node 17## spring 18 mosh 19# httpie 20## sudo 21 tmux 22## kubectl 23## helm 24 golang 25 history 26 history-substring-search 27 zsh-autosuggestions 28 zsh-syntax-highlighting 29) é€šè¿‡è¡Œé¦–æ·»åŠ #æ¥ç¦ç”¨oh-my-zshæ’ä»¶ï¼Œå¯åŠ¨æ–°çš„ç»ˆç«¯çª—å£æˆ–tabæ¥éªŒè¯æ˜¯å¦è¯¥æ’ä»¶æ˜¯å¼•èµ·é—®é¢˜çš„æ ¹æºã€‚\nåœ¨æˆ‘çš„é…ç½®ä¸­ï¼Œå‡ºçŽ°è¿‡å› ä¸ºå¯ç”¨è¿‡å¤šæ’ä»¶ï¼Œå¯¼è‡´æ–°å»ºç»ˆç«¯éœ€è¦10æ¥ç§’é’Ÿã€‚ä½†å› ä¸ºåˆ›å»ºç»ˆç«¯ä¸æ˜¯ä¸€ä¸ªé«˜é¢‘çš„éœ€æ±‚ï¼Œè¿™ä¸ªæ€§èƒ½é€šå¸¸æ¥è¯´è¿˜æ˜¯å¯ä»¥å¿å—ã€‚\noh-my-zsh ä¸»é¢˜ åœ¨æˆ‘çš„è¿™ä¸ªé—®é¢˜ä¸­ï¼Œå³ä½¿å°†æ‰€æœ‰æ’ä»¶éƒ½ç¦ç”¨äº†ï¼Œå‘½ä»¤æ‰§è¡ŒåŽé€€å‡ºé€Ÿåº¦è¿˜æ˜¯æ²¡æœ‰æ”¹å–„ï¼Œgitå‘½ä»¤ä»ç„¶æœ‰è¢«æ‰§è¡Œã€‚è¿™æ—¶æˆ‘å°è¯•æ›´æ¢ä¸åŒoh-my-zshå†…ç½®ä¸»é¢˜æ¥æŽ’æŸ¥é—®é¢˜ã€‚ä½†æ˜¯ä½¿ç”¨äº†åŒ…æ‹¬é»˜è®¤ä¸»é¢˜robbyrussellï¼Œæžç®€ä¸»é¢˜ysåœ¨å†…çš„å¤šä¸ªä¸»é¢˜éƒ½æ— æ³•è§£å†³è¯¥é—®é¢˜ã€‚\næœ€åŽç›´æŽ¥ç¦æ­¢oh-my-zshä½¿ç”¨ä¸»é¢˜ï¼Œé—®é¢˜æ²¡æœ‰äº†ï¼\nç„¶è€Œoh-my-zshä¸»é¢˜æ˜¯å¯¹zshçš„æžå¤§å¢žå¼ºï¼Œæ”¹å–„äº†é»˜è®¤çš„ç”¨æˆ·ä½“éªŒï¼Œæ²¡æœ‰ä¸»é¢˜æ‰©å±•ä½¿ç”¨èµ·æ¥ä¼šéžå¸¸ä¸ä¹ æƒ¯ã€‚\nå°ç»“ æœ€ç»ˆè¯•ç”¨äº†å¦ä¸€ä¸ªç¤¾åŒºç»´æŠ¤çš„çŸ¥åzshä¸»é¢˜Pureï¼Œæ€§èƒ½é—®é¢˜å¾—åˆ°äº†è§£å†³\u0026#x270c;\u0026#xfe0f; åŒæ—¶ä¹Ÿæ»¡è¶³äº†ä¸»é¢˜å¯¹zshè¾“å…¥è¾“å‡ºç”¨æˆ·ä½“éªŒçš„å¢žå¼º \u0026#x1f60a;\nå¸Œæœ›è¿™é‡Œåˆ†äº«çš„oh-my-zshæ€§èƒ½çš„è°ƒä¼˜æ€è·¯ï¼Œå¯ä»¥å¸®åŠ©åˆ°æœ‰ç±»ä¼¼éœ€è¦çš„å„ä½ã€‚\nå°†æ¥ç¤¾åŒºå¯¹è¿™ä¸ªé—®é¢˜å¦‚æœ‰è¿›ä¸€æ­¥çš„åé¦ˆï¼Œå°†ä¼šåšæ›´æ–°ã€‚\n","link":"https://kane.mx/posts/2020/zsh-performance-tuning/","section":"posts","tags":["zsh","oh-my-zsh","performance-tuning","trobule-shooting"],"title":"oh-my-zshæ€§èƒ½è°ƒä¼˜æ€è·¯"},{"body":"","link":"https://kane.mx/tags/performance-tuning/","section":"tags","tags":null,"title":"Performance-Tuning"},{"body":"","link":"https://kane.mx/tags/trobule-shooting/","section":"tags","tags":null,"title":"Trobule-Shooting"},{"body":"","link":"https://kane.mx/tags/zsh/","section":"tags","tags":null,"title":"Zsh"},{"body":"","link":"https://kane.mx/tags/codecommit/","section":"tags","tags":null,"title":"CodeCommit"},{"body":"Github/Gitlabå·²ç»æˆä¸ºä¼—å¤šå¼€å‘è€…éžå¸¸ç†Ÿæ‚‰çš„ä»£ç åä½œå¹³å°ï¼Œé€šè¿‡ä»–ä»¬å‚ä¸Žå¼€æºé¡¹ç›®æˆ–å®žæ–½ä¼ä¸šå†…éƒ¨é¡¹ç›®åä½œã€‚\nAWSä¹Ÿæä¾›äº†æ‰˜ç®¡çš„ã€åŸºäºŽGitã€å®‰å…¨ä¸”é«˜å¯ç”¨çš„ä»£ç æœåŠ¡CodeCommitã€‚CodeCommitä¸»è¦é’ˆå¯¹ä¼ä¸šç”¨æˆ·åœºæ™¯ï¼Œæ‰€ä»¥ä»–å¹¶æ²¡æœ‰ç¤¾äº¤åŠŸèƒ½ä»¥åŠä»£ç ä»“åº“forkåŠŸèƒ½ï¼Œæ˜¯å¦CodeCommitå°±æ— æ³•å®žçŽ°GithubåŸºäºŽPull Requestçš„ååŒå·¥ä½œæ¨¡å¼å‘¢ï¼Ÿ\nç­”æ¡ˆæ˜¯ï¼ŒCodeCommitå®Œå…¨å¯ä»¥å®žçŽ°åŸºäºŽPull Requestçš„ä»£ç åä½œã€‚ç”±äºŽGitçš„åˆ†å¸ƒå¼ä»£ç ç®¡ç†ç‰¹æ€§ï¼Œé¦–å…ˆforkä¸Šæ¸¸é¡¹ç›®ä»“åº“ï¼Œå°†ä¿®æ”¹åŽçš„ä»£ç æäº¤åˆ°forkä»“åº“ï¼Œé€šè¿‡Pull Requestç”³è¯·ä¿®æ”¹è¯·æ±‚åˆå¹¶ã€‚Githubå°†è¿™å¥—åä½œæµç¨‹æŽ¨å¹¿å¼€æ¥å¹¶è¢«å¼€æºé¡¹ç›®å¹¿æ³›é‡‡ç”¨ã€‚å…¶å®žè¿˜æœ‰å¦å¤–çš„Gitä»“åº“ååŒæ–¹å¼æ¥å®Œæˆå¤šäººçš„åä½œå¼€å‘ï¼Œä¾‹å¦‚Gerrit Code Reviewã€‚ç›®å‰Androidã€Eclipse Foundationä¸‹é¢çš„å„ç§é¡¹ç›®éƒ½åœ¨ä½¿ç”¨Gerritä½œä¸ºååŒå¼€å‘å·¥å…·ã€‚Gerrité€šè¿‡æŽ§åˆ¶åŒä¸€ä¸ªä»£ç ä»“åº“ä¸­ä¸åŒè§’è‰²çš„ç”¨æˆ·å¯æäº¤ä»£ç åˆ†æ”¯çš„æƒé™æ¥å®žçŽ°ä»£ç è´¡çŒ®ã€Reviewã€æŒç»­é›†æˆä»¥åŠååŒå¼€å‘çš„ã€‚\nCodeCommitä½œä¸ºAWSæ‰˜ç®¡çš„æœåŠ¡ï¼ŒåŒIAMè®¤è¯å’ŒæŽˆæƒç®¡ç†åšäº†å¾ˆå¥½çš„é›†æˆã€‚å®Œå…¨å¯ä»¥é€šè¿‡IAM Policyçš„è®¾ç½®ï¼Œä¸ºåŒä¸€ä¸ªä»£ç ä»“åº“ä¸­ä¸åŒç”¨æˆ·è§’è‰²è®¾ç½®ä¸åŒçš„æƒé™ã€‚ä½¿ç”¨ç±»ä¼¼Gerritçš„æƒé™æŽ§åˆ¶æ€è·¯ï¼Œ\nä»»æ„ä»£ç ä»“åº“åä½œè€…å¯ä»¥æäº¤ä»£ç åˆ°ç‰¹å®šå«ä¹‰çš„åˆ†æ”¯ï¼Œä¾‹å¦‚ï¼Œfeatures/*, bugs/*ã€‚å¯ä»¥å…è®¸å¤šäººååŒå·¥ä½œåœ¨æŸä¸€ç‰¹å®šåˆ†æ”¯ä¸Šã€‚åä½œè€…åŒæ—¶å¯ä»¥åˆ›å»ºæ–°çš„Pull Requestè¯·æ±‚åˆå¹¶ä»£ç åˆ°ä¸»åˆ†æ”¯ï¼Œä¾‹å¦‚masteræˆ–è€…mainlineã€‚ ä»£ç ä»“åº“Master/Owneræœ‰æƒé™åˆå¹¶Pull Requestã€‚ æ‹’ç»ä»»ä½•äººç›´æŽ¥æŽ¨é€ä»£ç åˆ°ä»“åº“ä¸»åˆ†æ”¯ï¼ŒåŒ…æ‹¬ä»“åº“Owner/Adminã€‚ ç›‘å¬ä»“åº“Pull Requeståˆ›å»ºå’ŒPRæºåˆ†æ”¯æ›´æ–°äº‹ä»¶ï¼Œè‡ªåŠ¨è§¦å‘è¯¥PRå¯¹åº”åˆ†æ”¯çš„automation buildï¼Œç¼–è¯‘ã€æµ‹è¯•ç­‰é€šè¿‡åŽï¼Œè‡ªåŠ¨ä¸ºPRçš„é€šè¿‡æŠ•ç¥¨+1ã€‚åä¹‹è‹¥å¤±è´¥ï¼Œåˆ™å–æ¶ˆæŠ•ç¥¨ã€‚ ä¸ºä»£ç ä»“åº“è®¾ç½®PR Reviewè§„åˆ™ï¼Œè‡³å°‘éœ€è¦æ”¶åˆ°PR automation buildå’Œä»“åº“Master/Owneråˆè®¡ä¸¤ç¥¨é€šè¿‡æ‰å…è®¸åˆå¹¶ä»£ç ã€‚ ç›‘å¬ä»£ç ä»“åº“ä¸»åˆ†æ”¯ï¼Œä»»æ„æ–°æäº¤å°†è§¦å‘è‡ªåŠ¨åŒ–å‘å¸ƒBuildã€‚å°†æœ€æ–°å˜æ›´åœ¨æ•´ä¸ªç³»ç»Ÿä¸Šåšé›†æˆã€‚ æ˜¯ä¸æ˜¯å¾ˆæ£’ï¼å®Œå…¨åšåˆ°äº†Githubã€Github Pull Requestã€Github Action/Travis CIæ•´å¥—devopsååŒå¼€å‘çš„æµç¨‹ã€‚\nåä½œæµç¨‹å¦‚ä¸‹å›¾ï¼Œ åŒæ—¶ï¼Œä»¥ä¸Šæ•´å¥—åŸºäºŽCodeCommitä»£ç ç®¡ç†çš„devopså·¥ä½œæµç¨‹å¯ä»¥åˆ©ç”¨CloudFormationå®žçŽ°AWSèµ„æºç¼–æŽ’ï¼Œå°†Devopsä¾èµ–çš„Infraä½¿ç”¨ä»£ç æ¥åšç®¡ç†ï¼è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œä¼ä¸šå†…éƒ¨å³ä½¿æœ‰æ•°ç™¾æ•°åƒç”šè‡³æ›´å¤šä»£ç ä»“åº“éƒ½å¯ä»¥ç»Ÿä¸€ç®¡ç†ï¼Œæ–°ä»“åº“çš„ç”³è¯·ä¹Ÿå¯ä»¥é€šè¿‡Infraä»£ç çš„PRï¼Œåœ¨é€šè¿‡å®¡æ‰¹åˆå¹¶åŽè‡ªåŠ¨ä»ŽAWS provisioningåˆ›å»ºå‡ºç¬¦åˆä¼ä¸šç®¡ç†è¦æ±‚çš„å®‰å…¨ä»£ç ä»“åº“ã€‚å¾ˆé…·å§\u0026#x1f606;\nè¿™é‡Œæœ‰ä¸€å¥—å®Œæ•´çš„åˆ›å»ºä»¥ä¸Šå·¥ä½œæµçš„æ¼”ç¤ºï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥åœ¨è‡ªå·±çš„è´¦æˆ·å†…ä½“éªŒã€‚æ•´å¥—æ–¹æ¡ˆå®Œå…¨ä½¿ç”¨çš„æ˜¯AWSæ‰˜ç®¡æœåŠ¡ï¼Œä»…æŒ‰å®žé™…ä½¿ç”¨é‡(å¦‚ä½¿ç”¨CodeBuildç¼–è¯‘äº†ä»£ç )è®¡è´¹ã€‚\n","link":"https://kane.mx/posts/2020/codecommit-devops-model/","section":"posts","tags":["äº‘è®¡ç®—","AWS","Devops","CodeCommit","Git"],"title":"åŸºäºŽCodeCommitä»£ç ç®¡ç†çš„æ— æœåŠ¡å™¨æž¶æž„Devops"},{"body":"","link":"https://kane.mx/tags/aws-api-gateway/","section":"tags","tags":null,"title":"AWS API Gateway"},{"body":"AWSåœ¨3æœˆ12æ—¥æ­£å¼å‘å¸ƒäº†æ–°ä¸€ä»£çš„APIç½‘å…³ -- HTTP APIsã€‚AWSå‘å¸ƒçš„ç¬¬ä¸€ä»£API GatewayæœåŠ¡å·²ç»å¿«5å¹´äº†ï¼Œé€šè¿‡è¿™äº›å¹´æ¥å¤§è§„æ¨¡æœåŠ¡å®¢æˆ·çš„å¿ƒå¾—ä»¥åŠå®¢æˆ·åé¦ˆï¼Œç”±æ­¤é‡æ–°æž„å»ºäº†æ›´å¿«ï¼ˆç›¸æ¯”ç¬¬ä¸€ä»£ç½‘å…³60%çš„å»¶è¿Ÿå‡å°‘ï¼‰ã€æ›´ä¾¿å®œï¼ˆè‡³å°‘èŠ‚çœ71%çš„è´¹ç”¨ï¼‰ã€æ›´æ˜“ç”¨çš„ç¬¬äºŒä»£ç½‘å…³æœåŠ¡ã€‚\né™¤äº†æ€§èƒ½ã€è´¹ç”¨ã€æ˜“ç”¨æ€§çš„å¤§å¹…åº¦æ”¹è¿›ä¹‹å¤–ï¼Œåœ¨HTTP APIså‘å¸ƒåšå®¢ä¸­ç€é‡ä»‹ç»äº†ä»¥ä¸‹æ–°ç‰¹æ€§ï¼Œ\nHTTP APIsç½‘å…³å¯åŒç§æœ‰VPCå†…çš„è´Ÿè½½å‡è¡¡(ALB/NLB)ï¼ŒæœåŠ¡å‘çŽ°(Cloup Map)é›†æˆã€‚æ„å‘³ç€å¯å°†ç›®å‰æœ€æµè¡Œä¸”æ™®éåº”ç”¨çš„å®¹å™¨æœåŠ¡ä½œä¸ºAPIåŽç«¯ å¯ä»¥å°†è‡ªå®šä¹‰åŸŸåçš„APIè·¯å¾„æ··åˆæ˜ å°„åˆ°ç¬¬ä¸€ä»£çš„REST APIså’Œæœ€æ–°çš„HTTP APIs è¯·æ±‚é™æµçš„æ”¹è¿›ã€‚æ”¯æŒå¯¹ä¸åŒstageä»¥åŠè¯·æ±‚è·¯ç”±åˆ†åˆ«è®¾ç½®ä¸åŒçš„é™æµ Stageå˜é‡ã€‚å¯ä»¥å°†Stageå˜é‡ä¼ é€’ç»™APIç½‘å…³åŽç«¯çš„æœåŠ¡ã€‚åŒæ—¶æ”¯æŒè·¯ç”±åœ¨ä¸åŒçš„stageåŠ¨æ€é›†æˆä¸åŒçš„åŽç«¯Lambdaå‡½æ•° Lambdaé›†æˆæ—¶ä½¿ç”¨Payload version 2.0ã€‚Version 2.0æ ¼å¼æä¾›äº†æ›´å¤šçš„çµæ´»æ€§åŠç®€åŒ–äº†æ•°æ®æ ¼å¼ æ”¯æŒå¯¼å…¥ Swagger / OpenAPI é…ç½®æ–‡ä»¶ å¦‚æžœå¯¹HTTP APIsæ„Ÿå…´è¶£ï¼Œå¯ä»¥å°è¯•åœ¨è‡ªå·±çš„è´¦æˆ·å†…éƒ¨ç½²è¿™ä¸ªç¤ºä¾‹ã€‚è¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•æŒ‰éœ€ä½¿ç”¨AWS BatchæœåŠ¡è¿›è¡Œæ‰¹é‡ä»»åŠ¡è®¡ç®—ï¼ŒåŒæ—¶å°†ä»»åŠ¡æäº¤å’ŒæŸ¥è¯¢çŠ¶æ€é€šè¿‡HTTPæŽ¥å£æä¾›å‡ºæ¥ã€‚è¯¥ç¤ºä¾‹æ”¯æŒéƒ¨ç½²æ—¶é€‰ç”¨ä¸åŒçš„AWSæœåŠ¡ï¼ˆALBã€REST APIsæˆ–HTTP APIsï¼‰æ¥æä¾›è¿™äº›APIæŽ¥å£è®¿é—®ã€‚æ•´ä¸ªç¤ºä¾‹éƒ½æ˜¯åŸºäºŽæ— æœåŠ¡å™¨æž¶æž„å®žçŽ°çš„ï¼Œä¸è¿›è¡Œæ‰¹é‡è®¡ç®—æ˜¯ä¸äº§ç”Ÿä»»ä½•è´¹ç”¨çš„å“¦\u0026#x1f604;ã€‚\n","link":"https://kane.mx/posts/2020/new-http-apis-of-api-gateway/","section":"posts","tags":["äº‘è®¡ç®—","FaaS","AWS","AWS API Gateway","Serverless Computing"],"title":"AWSå‘å¸ƒæ›´å¿«ã€æ›´ä¾¿å®œã€æ›´æ˜“ç”¨çš„HTTP APIs"},{"body":"","link":"https://kane.mx/tags/faas/","section":"tags","tags":null,"title":"FaaS"},{"body":"åœ¨re:Invent 2019ä¹‹å‰ï¼ŒAWS Toolkitå‘å¸ƒäº†Cloud Debugging betaåŠŸèƒ½ã€‚è¯¥åŠŸèƒ½æ”¯æŒåœ¨IntelliJ IDEs(IntelliJ, PyCharm, Webstorm, ä»¥åŠ Rider)ä¸­è¿œç¨‹è°ƒè¯• ECS Fargate å®¹å™¨ä¸­æ‰§è¡Œçš„åº”ç”¨ç¨‹åºã€‚\n\bå¯¹ECS Fargate demoå¯ç”¨äº†è¿œç¨‹è°ƒè¯•å¹¶è°ƒè¯•æˆåŠŸåŽï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹è¯¥åŠŸèƒ½çš„ä½¿ç”¨ä½“éªŒå¹¶ä¸”åˆ†äº«ä½“éªŒè¿‡ç¨‹ä¸­æŽ‰è¿›åŽ»è¿‡çš„ä¸€äº›å‘ã€‚\nè¯•ç”¨ä½“éªŒ é¦–å…ˆï¼Œè¯¥åŠŸèƒ½ä¸é€‚ç”¨äºŽç”Ÿäº§çŽ¯å¢ƒã€‚å› ä¸ºå¯¹ECS Fargateç±»åž‹çš„Serviceå¯ç”¨Cloud DebuggingåŠŸèƒ½ä¼šå°†åŽŸå§‹çš„ECS Servicesæ”¶ç¼©ä¸º0ä¸ªtaskå‰¯æœ¬ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„Serviceå¹¶å¯ç”¨æ–°çš„Task Definitionï¼Œæ–°çš„Task Definitionä¸­ä¼šåŠ å…¥Cloud Debug Sidecarå®¹å™¨æ¥è¾…åŠ©å®žçŽ°è¿œç¨‹è°ƒè¯•ã€‚æ•´ä¸ªè¿‡ç¨‹ä¼šå¯¹ç”Ÿäº§çŽ¯å¢ƒé€ æˆå˜æ›´ã€‚ å¦‚æžœECSé›†ç¾¤æ˜¯é€šè¿‡CI/CDæŒç»­éƒ¨ç½²ï¼Œå¹¶ä¸”æ˜¯å¤šäººååŒä½¿ç”¨çš„çŽ¯å¢ƒï¼Œè¯¥åŠŸèƒ½ä¹Ÿä¸é€‚ç”¨ã€‚å› ä¸ºï¼Œå¯¹æŸäº›å®¹å™¨æœåŠ¡å¯ç”¨Cloud Debuggingå°†å¯¼è‡´ä»–äººçš„æŒç»­éƒ¨ç½²å¤±è´¥æˆ–ä¸ç”Ÿæ•ˆã€‚ å¯ç”¨Cloud Debuggingæ“ä½œæ¯”è¾ƒéº»çƒ¦ï¼Œä¸”å¯ç”¨çŠ¶æ€ä¸‹æ— æ³•æ›´æ–°ECSä¸­éƒ¨ç½²çš„ç‰ˆæœ¬ã€‚éœ€è¦å…ˆåœç”¨Cloud Debuggingï¼Œéƒ¨ç½²æ–°ç‰ˆæœ¬ä»£ç ï¼Œç„¶åŽå†æ¬¡å¯ç”¨Cloud Debuggingæ‰èƒ½è°ƒè¯•æ–°ä»£ç ã€‚å°½å¯èƒ½çš„ä¸è¦ä¾èµ–Cloud Debuggingæ¥è°ƒè¯•ç¨‹åºï¼ŒèŠ±åŠŸèƒ½åšå¥½å•å…ƒæµ‹è¯•ï¼Œé›†æˆæµ‹è¯•ä»¥åŠE2Eæµ‹è¯•æ¥é¿å…è°ƒè¯•äº‘ç«¯çŽ¯å¢ƒã€‚ è¯•ç”¨ç»éªŒ æŒ‰ç…§å®˜æ–¹æ–‡æ¡£å¯ç”¨Cloud DebuggingåŽï¼Œåˆ›å»ºCloud Debugging Launch Configurationå¹¶æ‰§è¡Œè°ƒè¯•ï¼Œé‡åˆ°**Retrieve execution role finished exceptionally**é”™è¯¯ã€‚é”™è¯¯çš„åŽŸå› æ˜¯ï¼Œæ–‡æ¡£ä¸­æ²¡æœ‰æåˆ°Cloud Debug Sidecaréœ€è¦logs:CreateLogStreamæƒé™åˆ›å»ºCloudWatch Logs Streamã€‚è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œä¸ºECS Task Execution Roleæ·»åŠ logs:CreateLogStreamæƒé™ã€‚ åœ¨AWS Toolkit Jetbrainså½“å‰çš„ç‰ˆæœ¬1.9-193ä¸æ”¯æŒå¯ç”¨äº†AppMeshæˆ–X-Rayçš„Taskã€‚è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œå¯¹éœ€è¦å¯ç”¨Cloud Debuggingçš„Taskæš‚æ—¶ç¦ç”¨App Meshå’ŒX-Rayã€‚ Cloud Debuggingæ˜¯ä¸€ä¸ªä¸é”™çš„å¼€å‘å·¥å…·å°è¯•æ€è·¯ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½çš„åšå‡ºCloud Nativeåº”ç”¨ã€‚ä½†æ˜¯è¯¥é¡¹ç›®ä»ç„¶æ˜¯ä¸€ä¸ªæ—©æœŸé¡¹ç›®ï¼Œæœ‰è®¸å¤šé—®é¢˜éœ€è¦ä¿®å¤å’Œæ”¹è¿›ã€‚\n","link":"https://kane.mx/posts/2019/aws-cloud-debugging/","section":"posts","tags":["AWS","AWS Toolkit","AWS ECS","AWS Fargate","IntelliJ IDEs"],"title":"AWS Cloud DebuggingåˆæŽ¢"},{"body":"","link":"https://kane.mx/tags/aws-ecs/","section":"tags","tags":null,"title":"AWS ECS"},{"body":"","link":"https://kane.mx/tags/aws-fargate/","section":"tags","tags":null,"title":"AWS Fargate"},{"body":"","link":"https://kane.mx/tags/aws-toolkit/","section":"tags","tags":null,"title":"AWS Toolkit"},{"body":"","link":"https://kane.mx/tags/intellij-ides/","section":"tags","tags":null,"title":"IntelliJ IDEs"},{"body":"AWS Batchæ˜¯ä¸€ä¸ªå…¨æ‰˜ç®¡çš„æ‰¹å¤„ç†è°ƒåº¦æœåŠ¡ï¼Œå®ƒå¯ä¸ºç”¨æˆ·ç®¡ç†æ‰€æœ‰åŸºç¡€è®¾æ–½ï¼Œä»Žè€Œé¿å…äº†é¢„ç½®ã€ç®¡ç†ã€ç›‘æŽ§å’Œæ‰©å±•æ‰¹å¤„ç†è®¡ç®—ä½œä¸šæ‰€å¸¦æ¥çš„å¤æ‚æ€§ã€‚å½“ç„¶AWS Batchå·²ä¸Ž AWS å¹³å°åŽŸç”Ÿé›†æˆï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿåˆ©ç”¨ AWS çš„æ‰©å±•ã€è”ç½‘å’Œè®¿é—®ç®¡ç†åŠŸèƒ½ã€‚è®©ç”¨æˆ·è½»æ¾è¿è¡Œèƒ½å¤Ÿå®‰å…¨åœ°ä»Ž AWS æ•°æ®å­˜å‚¨ï¼ˆå¦‚ Amazon S3 å’Œ Amazon DynamoDBï¼‰ä¸­æ£€ç´¢æ•°æ®å¹¶å‘å…¶ä¸­å†™å…¥æ•°æ®çš„ä½œä¸šã€‚AWS Batchå¯æ ¹æ®æ‰€æäº¤çš„æ‰¹å¤„ç†ä½œä¸šçš„æ•°é‡å’Œèµ„æºè¦æ±‚é¢„ç½®è®¡ç®—èµ„æºå¹¶ä¼˜åŒ–ä½œä¸šåˆ†é…ã€‚èƒ½å¤Ÿå°†è®¡ç®—èµ„æºåŠ¨æ€æ‰©å±•è‡³è¿è¡Œæ‰¹å¤„ç†ä½œä¸šæ‰€éœ€çš„ä»»ä½•æ•°é‡ï¼Œä»Žè€Œä¸å¿…å—å›ºå®šå®¹é‡é›†ç¾¤çš„é™åˆ¶ã€‚AWS Batchè¿˜å¯ä»¥åˆ©ç”¨ Spot å®žä¾‹ï¼Œä»Žè€Œè¿›ä¸€æ­¥é™ä½Žè¿è¡Œæ‰¹å¤„ç†ä½œä¸šäº§ç”Ÿçš„è´¹ç”¨ã€‚\nAWS BatchæœåŠ¡æœ¬èº«æ˜¯å…è´¹çš„ï¼Œä»…æ”¶å–å®žé™…ä½¿ç”¨çš„ EC2 å®žä¾‹è´¹ç”¨ã€‚\næˆ‘åˆ›å»ºäº†ä¸€ä¸ªBatch App demoæ¥æ¼”ç¤ºAWS Batchç›¸å…³ä½¿ç”¨æ–¹æ³•ã€‚è¯¥ç¤ºä¾‹é€šè¿‡ä¸€ä¸ªRestful APIæŽ¥å£æ¥æäº¤æ‰¹å¤„ç†ä»»åŠ¡ï¼ŒRestful APIé€šè¿‡ALB + Lambdaå‡½æ•°æ¥æš´éœ²æœåŠ¡ã€‚Lambdaå‡½æ•°è¢«è§¦å‘åŽï¼Œå°†æ–°ä»»åŠ¡è¯·æ±‚å‘é€åˆ°SQSæœåŠ¡ã€‚éšåŽå¦ä¸€ä¸ªLambdaå°†æ¶ˆè´¹è¿™ä¸ªSQSï¼Œå¹¶å°†è°ƒç”¨AWS Batch APIæ¥æäº¤æ–°çš„æ‰¹å¤„ç†ä»»åŠ¡ï¼ŒåŒæ—¶å°†ä»»åŠ¡ä¿¡æ¯å‚¨å­˜åˆ°DynamoDBä¸­ã€‚åŒæ—¶Demoåˆ›å»ºäº†Batchä»»åŠ¡ä¼šä½¿ç”¨åˆ°çš„Docker Imageï¼Œå¹¶ä¸”é¢„å…ˆæäº¤åˆ°ECRä¸­ã€‚åŒæ—¶Batchä»»åŠ¡å®šä¹‰äº†ä½¿ç”¨çš„EC2å®žä¾‹ç±»åž‹(c5ç³»åˆ—å®žä¾‹ï¼Œä¸”åŒ…æ‹¬Spotå’ŒæŒ‰éœ€ä¸¤ç§è®¡è´¹æ–¹å¼çš„å®žä¾‹ï¼Œä¸”ä¼˜å…ˆä½¿ç”¨Spotå®žä¾‹)ï¼Œå®žä¾‹é»˜è®¤ä¼¸ç¼©æ•°é‡ä¸º0(æ²¡æœ‰å¯æ‰§è¡Œä»»åŠ¡æ—¶å°†ä¸­æ­¢å®žä¾‹)ã€‚å¹¶ä¸”æäº¤çš„ä»»åŠ¡åˆ†ä¸ºè®¡ç®—ä»»åŠ¡å’Œç»Ÿè®¡å½’å¹¶ä»»åŠ¡ï¼Œç»Ÿè®¡å½’å¹¶ä»»åŠ¡ä¼šä¾èµ–æ‰€ä»¥è®¡ç®—ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ‰å¼€å§‹æ‰§è¡Œã€‚æœ€åŽé€šè¿‡å¦ä¸€RestfulæŽ¥å£æŸ¥è¯¢è®¡ç®—ä»»åŠ¡çš„æœ€ç»ˆç»“æžœï¼Œè¯¥æŽ¥å£åŒæ ·ä½¿ç”¨ALB + Lambdaå‡½æ•°æ¥å®žçŽ°ã€‚\nEnjoy this Batch App demo orchestrated by AWS CDK.\n","link":"https://kane.mx/posts/2019/aws-batch/","section":"posts","tags":["AWS","Batch","Infrastructure as Code"],"title":"AWS Batchç®€ä»‹"},{"body":"","link":"https://kane.mx/tags/batch/","section":"tags","tags":null,"title":"Batch"},{"body":"åœ¨æ‹¥æœ‰åŸŸååŽï¼Œé€šå¸¸å¸Œæœ›åˆ›å»ºä¸€äº›è‡ªæœ‰åŸŸåä¸‹çš„é‚®ç®±æ¥æ”¶å–ä¸åŒç”¨é€”çš„é‚®ä»¶ï¼ŒåŒæ—¶ä¸å¸Œæœ›ä¸ºè¿™éƒ¨åˆ†åŠŸèƒ½ä»˜è´¹\u0026#x1f603;ã€‚ä½¿ç”¨å…è´¹çš„ä¼ä¸šé‚®ç®±(æ¯”å¦‚ç½‘æ˜“ä¼ä¸šé‚®ç®±ã€é˜¿é‡Œäº‘ä¼ä¸šé‚®ç®±)æ˜¯ä¸€ç§é€‰æ‹©ã€‚è¿™æ—¶å°±éœ€è¦é…ç½®é‚®ä»¶åœ°å€å’Œé‚®ä»¶å®¢æˆ·ç«¯æ¥æ”¶å–é‚®ä»¶ï¼Œå¦‚æžœæœ‰å¤šä¸ªé‚®ç®±åœ°å€ï¼Œé…ç½®ä¼šç‰¹åˆ«éº»çƒ¦ã€‚æœ‰æ—¶ï¼Œè¿™äº›ä¼ä¸šé‚®ç®±çš„æ”¶ä»¶æœåŠ¡ä¼šèŽ«åå…¶å¦™çš„ä¸¢å¤±ä¸€äº›é‚®ä»¶ã€‚\nè¿™ç§åœºæ™¯ä¸‹ï¼Œé‚®ä»¶è½¬å‘æœåŠ¡æ˜¯ä¸€ç§éžå¸¸å¥½çš„è§£å†³æ–¹æ¡ˆã€‚æ— éœ€æ­å»ºé‚®ä»¶æœåŠ¡å™¨æˆ–ç”³è¯·å…è´¹é‚®ä»¶æœåŠ¡ï¼Œåªéœ€è¦é…ç½®åŸŸåçš„é‚®ä»¶MXè§£æžåˆ°è½¬å‘é‚®ä»¶æ”¶å‘ä»¶æœåŠ¡ï¼ŒåŒæ—¶ä½¿ç”¨DNS TXT recordé…ç½®è½¬å‘è§„åˆ™ï¼Œå³å¯å°†æ‰€ä»¥å‘é€çš„è‡ªæœ‰åŸŸåä¸‹çš„é‚®ä»¶è½¬å‘åˆ°å·²æœ‰çš„é‚®ç®±åœ°å€ï¼\u0026#x1f192;\nç‰¹åˆ«å®‰åˆ©Forward EmailæœåŠ¡ï¼Œä¸€ä¸ªå…è´¹è€Œä¸”æ˜¯å¼€æºçš„é‚®ä»¶è½¬å‘æœåŠ¡ã€‚\nå¦‚ä¸Šé¢ä»‹ç»çš„ï¼Œåªéœ€è¦ä¸ºåŸŸåmydomain.comåˆ›å»ºå¦‚ä¸‹3æ¡DNSè§£æžè®°å½•ï¼Œ\nåç§° TTL è®°å½•ç±»åž‹ ä¼˜å…ˆçº§ è®°å½•çš„å†…å®¹ @ æˆ–è€… ç©ºç™½ 3600 MX 10 mx1.forwardemail.net @ æˆ–è€… ç©ºç™½ 3600 MX 20 mx2.forwardemail.net @ æˆ–è€… ç©ºç™½ 3600 TXT 20 forward-email=niftylettuce@gmail.com æ‰€æœ‰å‘å¾€@mydomain.comçš„é‚®ä»¶å°†è¢«è½¬å‘åˆ°é‚®ç®±niftylettuce@gmail.comã€‚\u0026#x270c;\u0026#xfe0f;\næ›´å¤šé…ç½®é€‰é¡¹è¯·æŸ¥çœ‹æ–‡æ¡£ã€‚\n","link":"https://kane.mx/posts/2019/email-forwarding/","section":"posts","tags":["é‚®ä»¶è½¬å‘","æŠ€å·§"],"title":"å…è´¹é‚®ä»¶è½¬å‘æœåŠ¡"},{"body":"","link":"https://kane.mx/tags/%E6%8A%80%E5%B7%A7/","section":"tags","tags":null,"title":"æŠ€å·§"},{"body":"","link":"https://kane.mx/tags/%E9%82%AE%E4%BB%B6%E8%BD%AC%E5%8F%91/","section":"tags","tags":null,"title":"é‚®ä»¶è½¬å‘"},{"body":"","link":"https://kane.mx/tags/edas/","section":"tags","tags":null,"title":"EDAS"},{"body":"","link":"https://kane.mx/tags/microservice/","section":"tags","tags":null,"title":"Microservice"},{"body":"","link":"https://kane.mx/tags/migration/","section":"tags","tags":null,"title":"Migration"},{"body":"è¿‘æœŸå®žè·µäº†å°†é˜¿é‡Œäº‘EDASå¾®æœåŠ¡åº”ç”¨è¿ç§»åˆ°AWSä¸Šï¼Œåœ¨è¿™é‡Œåˆ†äº«ä¸€ä¸‹è¿ç§»æ–¹æ¡ˆã€‚\nè¯¥æ–¹æ¡ˆæ¶‰åŠäº†ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼Œ\nå¾®æœåŠ¡åº”ç”¨é›†ç¾¤ã€‚åœ¨AWSä¸Šé‡‡ç”¨çš„ECSé›†ç¾¤éƒ¨ç½²å¾®æœåŠ¡åº”ç”¨ï¼Œé€šè¿‡Cloudmapå®žçŽ°æœåŠ¡æ³¨å†Œå‘çŽ°ï¼ŒApp Meshå®žçŽ°æœåŠ¡é—´æµé‡æŽ§åˆ¶ã€‚æ›´åŠ è¯¦å°½çš„å¾®æœåŠ¡è¿ç§»è¦ç‚¹å’Œå¯¹åº”æ–¹æ¡ˆï¼Œè¯¦è§ä¸‹é¢çš„deckã€‚ Devops pipelineã€‚ä½¿ç”¨æ‰˜ç®¡çš„CodePipelineï¼ŒCodeBuildå®žçŽ°CI/CDã€‚ Infra as Codeã€‚åˆ©ç”¨AWSå¼ºå¤§çš„Infra as Codeèƒ½åŠ›ï¼Œå°†äº‘ä¸Šçš„åŸºç¡€è®¾æ–½å’Œå¾®æœåŠ¡åº”ç”¨ç¼–æŽ’é€šè¿‡CDKä»£ç å®žçŽ°ã€‚ ä¸‹é¢æ˜¯è¿ç§»æ–¹æ¡ˆçš„deckã€‚å®Œæ•´ä¸”å¯éƒ¨ç½²çš„PoCä»£ç ï¼Œç‚¹è¿™é‡Œã€‚\n","link":"https://kane.mx/posts/2019/aliyun-edas-migration-in-action/","section":"posts","tags":["AWS","EDAS","Migration","Microservice","Infrastructure as Code"],"title":"å®žæˆ˜Aliyun EDASåº”ç”¨è¿ç§»AWS"},{"body":"","link":"https://kane.mx/tags/analysis/","section":"tags","tags":null,"title":"Analysis"},{"body":"æ‰˜ç®¡çš„RDSæ•°æ®åº“å·²ç»æ˜¯äº‘è®¡ç®—æœåŠ¡ä¸­éžå¸¸æˆç†Ÿçš„æœåŠ¡ï¼Œç»å¤§éƒ¨åˆ†çš„äº‘è®¡ç®—ç”¨æˆ·ä¼šé‡‡ç”¨RDSæœåŠ¡æ¥æå‡æ•°æ®åº“æœåŠ¡çš„å¯ç”¨æ€§åŒæ—¶å‡å°‘æ•°æ®åº“çš„å„ç±»è¿ç»´äº‹åŠ¡ã€‚\nAWS RDSæœåŠ¡æ”¯æŒå¼€å¯å’ŒæŸ¥è¯¢å„ç±»çš„æ•°æ®åº“æ—¥å¿—ï¼ŒåŒ…æ‹¬å¸¸è§„æ—¥å¿—ã€æ…¢æ—¥å¿—ã€é”™è¯¯æ—¥å¿—å’Œå®¡è®¡æ—¥å¿—ã€‚ä½†RDSæœåŠ¡é»˜è®¤æä¾›çš„æ—¥å¿—æŸ¥çœ‹å·¥å…·ä»…ä»…ç±»ä¼¼æ–‡æœ¬æŸ¥çœ‹å™¨ï¼Œæ— æ³•é’ˆå¯¹æ—¥å¿—æ•°æ®åšç»Ÿè®¡å’ŒæŸ¥çœ‹åŽ†å²æ»šåŠ¨çš„å­˜æ¡£ã€‚\næœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨AWSä¸Šäº‘åŽŸç”Ÿçš„æœåŠ¡æ­å»ºæ— æœåŠ¡æž¶æž„çš„å®žæ—¶æ—¥å¿—åˆ†æžæŠ¥è¡¨ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿçš„å®žçŽ°æ€è·¯æ¥è‡ªäºŽAWSä¸­å›½çš„ä¸€ç¯‡åšå®¢ï¼Œè¯¥æ–‡ä»‹ç»äº†ä½¿ç”¨ CloudWatch Logsï¼ŒKinesis Firehoseï¼ŒAthena å’Œ Quicksight å®žçŽ°å®žæ—¶åˆ†æž Amazon Aurora æ•°æ®åº“å®¡è®¡æ—¥å¿—ã€‚\nè¿™é‡Œæä¾›äº†ä¸€ä¸ªå®Œæ•´çš„AWS CDKåº”ç”¨å®žçŽ°äº†åšå®¢ä¸­ä»‹ç»çš„æœåŠ¡æ­å»ºæ€è·¯ï¼ŒRDSå®¡è®¡æ—¥å¿—é€šè¿‡ CloudWatch Log -\u0026gt; Kinesis Firehose -\u0026gt; S3 è¿™æ ·ä¸€ä¸ªæ•°æ®ç®¡é“è¢«è¿‡æ»¤ï¼Œè½¬æ¢ï¼ŒåŽ‹ç¼©æœ€ç»ˆä¿å­˜åˆ°S3ä¸Šï¼Œå¯è¢«æ— æœåŠ¡åˆ†æžæœåŠ¡Athenaä½¿ç”¨ã€‚åŒæ—¶åˆ›å»ºäº†ä¸€ä¸ªLambdaå‡½æ•°æ¨¡æ‹Ÿåº”ç”¨è®¿é—®æ•°æ®åº“ï¼Œå®ƒå‘¨æœŸæ€§çš„è¿žæŽ¥ä¸Šåº”ç”¨ä¸­åˆ›å»ºçš„RDS Auroraæ•°æ®åº“å¹¶æ‰§è¡ŒæŸ¥è¯¢æˆ–å˜æ›´Sqlã€‚åœ¨æ•´ä¸ªåº”ç”¨åœ¨è¢«éƒ¨ç½²æˆåŠŸåŽæ•°åˆ†é’Ÿï¼ŒåŠå¯é€šè¿‡Athenaæ•°æ®è¡¨æŸ¥è¯¢ç»Ÿè®¡Auroraå®¡è®¡æ—¥å¿—ã€‚Enjoy it\u0026#x1f606;\u0026#x1f606;\n","link":"https://kane.mx/posts/2019/rds-log-analysis/","section":"posts","tags":["AWS","Serverless","Analysis"],"title":"AWS RDSæ•°æ®åº“æ—¥å¿—åˆ†æžåŠå±•ç¤º"},{"body":"","link":"https://kane.mx/tags/aws-vpn/","section":"tags","tags":null,"title":"AWS VPN"},{"body":"","link":"https://kane.mx/tags/openswan/","section":"tags","tags":null,"title":"Openswan"},{"body":"","link":"https://kane.mx/tags/site-to-site-vpn/","section":"tags","tags":null,"title":"Site-to-Site VPN"},{"body":"ä¸šåŠ¡ä¸Šäº‘ä¹‹åŽï¼Œç»å¸¸ä¹Ÿæœ‰éœ€æ±‚å°†å¤šäº‘ã€æ•°æ®ä¸­å¿ƒæˆ–åŠžå…¬å®¤çš„ç§æœ‰ç½‘ç»œåŒäº‘ç«¯çš„ç§æœ‰ç½‘ç»œå»ºç«‹è¿žæŽ¥ã€‚AWS Site-to-Site VPNæ­£æ˜¯AWSæä¾›çš„æ‰˜ç®¡VPNæœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¦ä¸€ç«¯çš„ç§æœ‰ç½‘ç»œé€šè¿‡OpenswanåŒAWS VPCç½‘ç»œå»ºç«‹åŸºäºŽIPSecåè®®çš„å®‰å…¨è¿žæŽ¥ã€‚\nä¸‹é¢æ˜¯é…ç½®çš„è¯¦ç»†æ­¥éª¤ï¼Œ\nå¦‚æžœæ˜¯åˆ›å»ºæ•°æ®ä¸­å¿ƒæˆ–åŠžå…¬å®¤çš„è¿žæŽ¥ï¼Œæ•°æ®ä¸­å¿ƒæˆ–åŠžå…¬å®¤éœ€è¦æœ‰å…¬ç½‘IPã€‚å¦‚æžœæ˜¯åœ¨å…¶ä»–å…¬æœ‰äº‘ä¸Šï¼Œéœ€è¦åˆ›å»ºå¸¦å…¬ç½‘IPçš„EC2ï¼Œæˆ–ä½¿ç”¨EIPã€‚ å¦‚æžœä½¿ç”¨AWS EC2é…ç½®Openswanï¼Œéœ€è¦ç¦ç”¨ EC2 çš„ Source/Destination Checkã€‚ åœ¨AWSä¸Šåˆ›å»ºVirtual Private Gateway å’Œ Customer Gateway(æŒ‡å®šå¯¹ç«¯çš„å…¬ç½‘IPä½œä¸ºé™æ€è·¯ç”±)ã€‚ åœ¨AWSä¸Šåˆ›å»ºSite-to-Site VPNè¿žæŽ¥ï¼Œä½¿ç”¨ç¬¬ä¸€æ­¥å’Œç¬¬äºŒæ­¥åˆ›å»ºçš„Virtual Private Gatewayå’ŒCustomer Gatewayã€‚ åœ¨å¯¹ç«¯æœºå™¨ä¸Šå®‰è£…openswanã€‚ 1sudo yum install openswan ç¼–è¾‘/etc/sysctl.confæ–‡ä»¶ï¼Œç¡®ä¿æœ‰ä»¥ä¸‹é…ç½®ï¼Œ 1net.ipv4.ip_forward = 1 2net.ipv4.conf.default.rp_filter = 0 3net.ipv4.conf.default.accept_source_route = 0 é‡æ–°åŠ è½½sysctlé…ç½®å¹¶é‡å¯networkæœåŠ¡ã€‚ 1sudo sysctl -p 2sudo service network restart ç¼–è¾‘/etc/ipsec.confç¡®ä¿include /etc/ipsec.d/*.confæ²¡æœ‰è¢«æ³¨é‡Šã€‚ åˆ›å»º/etc/ipsec.d/aws.confæ–‡ä»¶ï¼Œå†…å®¹æ‹·è´æ¥è‡ªç¬¬ä¸‰æ­¥åˆ›å»ºçš„è¿žæŽ¥Openswanå»ºè®®é…ç½®ã€‚ åˆ›å»º/etc/ipsec.d/aws.secretsæ–‡ä»¶ï¼Œå†…å®¹æ‹·è´æ¥è‡ªç¬¬ä¸‰æ­¥åˆ›å»ºçš„è¿žæŽ¥Openswané…ç½®ã€‚ å¯åŠ¨ipsecæœåŠ¡ã€‚ 1# Start the ipsec service. 2sudo service ipsec start 3 4# Check the logs. 5sudo service ipsec status 6sudo ipsec auto --status ä»¥ä¸Šé…ç½®åœ¨Amazon Linux, Centos 6.9ä¸ŠéªŒè¯é€šè¿‡ã€‚ä½†æ˜¯åœ¨Amazon Linux 2ã€Centos 7ç­‰è¾ƒæ–°çš„Linuxå‘è¡Œç‰ˆæœ¬ä¸Šï¼Œå¯åŠ¨ipsecæœåŠ¡é‡åˆ°å¦‚ä¸‹é”™è¯¯ï¼Œ 1Starting Internet Key Exchange (IKE) Protocol Daemon for IPsec... 2ERROR: /etc/ipsec.d/aws.conf: 12: keyword auth, invalid value: esp è§£å†³æ–¹æ³•æ˜¯ï¼Œä»Ž AWS Site-to-Site VPN ä¸‹è½½çš„ Openswan é…ç½®ä¸­åˆ æŽ‰ä¸æ”¯æŒçš„é…ç½®è¡Œauth=espã€‚\n","link":"https://kane.mx/posts/2019/using-openswan-connect-aws-vpn/","section":"posts","tags":["AWS","AWS VPN","Site-to-Site VPN","Openswan"],"title":"ä½¿ç”¨Openswanè¿žæŽ¥AWS VPC"},{"body":"Infrastructure as Code(æž¶æž„å³ä»£ç )ä¸€ç›´æ˜¯è¡¡é‡å…¬æœ‰äº‘æ˜¯å¦æ”¯æŒè‰¯å¥½è¿ç»´èƒ½åŠ›çš„é‡è¦æŒ‡æ ‡ã€‚ä½œä¸ºäº‘è®¡ç®—é¢†å…ˆçš„AWSï¼Œé€šè¿‡æœåŠ¡CloudFormationæ¥ç¼–æŽ’äº‘çŽ¯å¢ƒä¸­çš„åŸºç¡€è®¾æ–½èµ„æºã€‚ä¸è¿‡ç”±äºŽCloudFormationæ˜¯ä½¿ç”¨YAML/JSONç¼–å†™çš„å£°æ˜Žå¼è¯­è¨€ï¼Œä¸å–„äºŽå¤„ç†é€»è¾‘ï¼Œç¼–å†™ç¹çä¸”ä¸åˆ©äºŽè°ƒè¯•æŽ’é”™ï¼Œå¯¹äºŽæ–°ä¸Šæ‰‹çš„Devopså·¥ç¨‹å¸ˆæ¥è¯´ä¹Ÿæœ‰ä¸å°çš„å­¦ä¹ æ›²çº¿ã€‚ä¸‰æ–¹å¼€æºçš„å·¥å…·TerraformåŒæ ·æ²¡æœ‰å¾ˆå¥½è§£å†³CloudFormationå­˜åœ¨çš„è¿™äº›é—®é¢˜ã€‚\nAWS CDKçš„å‡ºçŽ°è§£å†³äº†ç›®å‰CloudFormationå­˜åœ¨çš„ç»å¤§éƒ¨åˆ†é—®é¢˜ï¼Œæžå¤§çš„æå‡åŸºç¡€è®¾æ–½ç¼–æŽ’ä»£ç çš„å¼€å‘å’Œç»´æŠ¤æ•ˆçŽ‡ã€‚\nAWS CDKæ˜¯ä¸€ç§å¼€æºè½¯ä»¶å¼€å‘æ¡†æž¶ï¼Œå¼€å‘è€…å¯ä»¥ç”¨è‡ªå·±ä½¿ç”¨ç†Ÿæ‚‰çš„ç¼–ç¨‹è¯­è¨€æ¨¡æ‹Ÿå’Œé¢„ç½®äº‘åº”ç”¨ç¨‹åºèµ„æºï¼Œç›®å‰æ”¯æŒTypescript/Javascriptã€Pythonã€Javaå’Œ.Netã€‚AWS CDKå°†äº‘ä¸­èµ„æºæŠ½è±¡å¯¹è±¡åŒ–ï¼Œé€šè¿‡æžå…¶ç®€å•è¯­æ³•æè¿°èµ„æºå¯¹è±¡æˆ–è®¾ç½®å…¶å„ç§å±žæ€§(é‡è½½CDKé»˜è®¤å±žæ€§è®¾ç½®)æ¥åˆ›å»ºæˆ–æ›´æ–°äº‘ä¸­èµ„æºã€‚\nä¾‹å¦‚ï¼Œä¸‹é¢ç®€å•å‡ è¡Œå°†åˆ›å»ºä¸€ä¸ªæ–°çš„åä¸ºGamedayçš„VPCç½‘ç»œï¼Œå¹¶ä¸”è·¨äº†ä¸¤ä¸ªå¯ç”¨åŒºåˆ†åˆ«åˆ›å»ºäº†å…¬æœ‰å­ç½‘å’Œç§æœ‰å­ç½‘ã€‚\n1 this.vpc = new ec2.Vpc(this, \u0026#39;Gameday\u0026#39;, { 2 cidr: \u0026#39;10.0.0.0/16\u0026#39;, 3 maxAzs: 2, 4 subnetConfiguration: [ 5 { 6 cidrMask: 24, 7 name: \u0026#39;Public\u0026#39;, 8 subnetType: SubnetType.PUBLIC 9 }, 10 { 11 cidrMask: 24, 12 name: \u0026#39;Private\u0026#39;, 13 subnetType: SubnetType.PRIVATE 14 } 15 ] 16 }); æˆ‘åˆ›å»ºäº†ä¸¤ä¸ªç¤ºä¾‹é¡¹ç›®ä½¿ç”¨äº†AWS CDKå¿«é€Ÿåˆ›å»ºåº”ç”¨çŽ¯å¢ƒä¸”éƒ¨ç½²åº”ç”¨ï¼Œ\nGameday ä¸ºä¸€ä¸ªECSä¸Šè¿è¡Œçš„Webåº”ç”¨ç¼–æŽ’äº†å®Œæ•´çš„çŽ¯å¢ƒï¼ŒåŒ…æ‹¬VPCã€RDS Auroraã€NAT Gatewayã€å®‰å…¨ç»„ã€ECSé›†ç¾¤ã€ECS Taskå®šä¹‰ã€ALBè´Ÿè½½å‡è¡¡ã€‚ Serverlss Domain Redirect åŸºäºŽAWSæ­å»ºäº†æ— æœåŠ¡å™¨æž¶æž„çš„åŸŸåé‡å®šå‘æœåŠ¡ã€‚åŸºäºŽä¸åŒçš„é…ç½®å‚æ•°ï¼Œæä¾›äº†åŸºäºŽ S3 + CloudFront + Route 53 æˆ–æ˜¯ Lambda + API Gateway + Route 53 ä¸¤ç§è§£å†³æ–¹æ¡ˆã€‚ æ€»ä½“çš„æ¥è¯´ï¼ŒAWS CDKæ˜¯ä¸€ä¸ªéžå¸¸å€¼å¾—é‡‡ç”¨çš„äº‘ä¸­èµ„æºç¼–æŽ’å’Œç®¡ç†æ–¹å¼ï¼Œé«˜æ•ˆçš„ç®¡ç†äº†AWSä¸Šçš„èµ„æºã€‚\nç”±äºŽCDKè¿˜åœ¨ç›¸å¯¹æ—©æœŸï¼Œæˆç†Ÿåº¦è¿˜ä¸æ˜¯é‚£ä¹ˆå®Œç¾Žã€‚æˆ‘åœ¨ä½¿ç”¨ä¸­å‘çŽ°ä¸‹é¢ä¸€äº›å€¼å¾—æ³¨æ„çš„é—®é¢˜ã€‚\nCDKç¨‹åºæœ€ç»ˆè¿˜æ˜¯åˆ›å»ºäº†CloudFormationé…ç½®ï¼Œæäº¤åˆ°CloudFormationå®Œæˆèµ„æºå˜æ›´ã€‚æ ¸å¿ƒçš„ç”¨æˆ·ä½“éªŒï¼Œéœ€è¦ä¾èµ–CloudFormationçš„èƒ½åŠ›ã€‚CloudFormationçš„åˆ›å»ºæˆ–å›žé€€è¶…æ—¶è¿‡é•¿ï¼Œæ—¶å¸¸å½±å“èµ„æºéƒ¨ç½²ä½“éªŒã€‚å¦å¤–ï¼Œæ¸…ç†èµ„æºçš„æ—¶å€™ï¼Œé‡åˆ°éƒ¨åˆ†èµ„æºæ— æ³•æ¸…ç†ä¸”ç¼ºå°‘æ˜Žç¡®æç¤ºã€‚æ¯”å¦‚Auroraé›†ç¾¤ã€‚ CDKç±»åº“ç¼ºå°‘é…ç½®æ ¡éªŒã€‚è¿™ç±»é”™è¯¯åªèƒ½é€šè¿‡CloudFormationéƒ¨ç½²åŽï¼Œæ‰ä¼šè¢«èµ„æºæ–¹å‘çŽ°å¹¶è¿”å›žé”™è¯¯ã€‚å¯¼è‡´æ•´ä¸ªåˆ›å»ºçš„å †æ ˆå›žé€€ï¼Œè°ƒè¯•å¤§åž‹çš„éƒ¨ç½²æ ˆå°†èŠ±è´¹æ¯”è¾ƒé•¿çš„æ—¶é—´ã€‚å»ºè®®å°†æ•´ä¸ªéƒ¨ç½²æ‹†åˆ†ä¸ºå¤šä¸ªå°çš„å †æ ˆï¼Œå‡å°æ¯æ¬¡éƒ¨ç½²æ—¶é—´ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚ æ–‡æ¡£è¿˜æ¯”è¾ƒç®€é™‹ã€‚ç¼ºå°‘è¾ƒä¸ºæ·±å…¥çš„ç¤ºä¾‹ã€‚å¢žåŠ äº†å¼€å‘äººå‘˜çš„å­¦ä¹ æ›²çº¿ã€‚ æ–°ç‰ˆæœ¬å‘åŽå…¼å®¹æ€§ä¸å¤Ÿå¥½ï¼Œæ—¶å¸¸æ–°ç‰ˆæœ¬æœ‰break changesã€‚åœ¨1.0GAä¹‹åŽå‘å¸ƒçš„ç‰ˆæœ¬break changesç›¸å¯¹å‡å°‘ï¼Œä½†ä»ç„¶æœ‰å‡ºçŽ°ã€‚ ","link":"https://kane.mx/posts/2019/aws-cdk/","section":"posts","tags":["AWS","AWS CDK","Infrastructure as Code"],"title":"AWS CDKç®€ä»‹"},{"body":"","link":"https://kane.mx/tags/aws-s3/","section":"tags","tags":null,"title":"AWS S3"},{"body":"ä¸šåŠ¡æ—¶å¸¸æœ‰éœ€æ±‚å°†æŸä¸ªåŸŸå(A)çš„è®¿é—®é‡å®šå‘åˆ°å…¶ä»–åŸŸå(B)ï¼Œå³ä½¿å®žçŽ°è¿™æ ·ä¸€ä¸ªå¾ˆç®€å•çš„éœ€æ±‚é€šå¸¸ä¹Ÿéœ€è¦éƒ¨ç½²WebæœåŠ¡å™¨ï¼ˆä¾‹å¦‚Nginxï¼‰ï¼Œä¸ºåŸŸåAçš„è¯·æ±‚è¿”å›ž302å“åº”ï¼Œå¹¶æä¾›æ–°çš„Locationåœ°å€é‡å®šå‘åˆ°åŸŸåBã€‚çŽ°åœ¨åŸºäºŽäº‘è®¡ç®—æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›æ‰˜ç®¡æœåŠ¡æ¥å®žçŽ°åŒæ ·çš„äº‹æƒ…ï¼Œæ— éœ€ç®¡ç†æœåŠ¡å™¨å’Œç»´æŠ¤åº”ç”¨ï¼ŒåŒæ—¶åšåˆ°æœ€ä½Žæˆæœ¬å®žçŽ°è¯¥éœ€æ±‚ã€‚\næŽ¥ä¸‹æ¥å°†ä»‹ç»å¦‚ä½•åˆ©ç”¨AWSä¸Šçš„æœåŠ¡å®žçŽ°è¯¥éœ€æ±‚ã€‚\nä½¿ç”¨AWS S3å’ŒAWS CloudFrontå®žçŽ°åŸŸåé‡å®šå‘ åˆ›å»ºä¸€ä¸ªæ–°çš„S3 bucketï¼Œä¾‹å¦‚ redirect.domain.com é…ç½®æ–°bucketå±žæ€§ï¼Œå¼€å¯é™æ€ç½‘ç«™æ‰˜ç®¡ï¼ŒåŒæ—¶é…ç½®ä¸ºé‡å®šå‘è¯·æ±‚åˆ°æœŸæœ›çš„åŸŸå redirected-host.domain.com åˆ›å»ºæ–°çš„CloudFrontåˆ†å‘ï¼Œè®¾ç½®ç¬¬ä¸€æ­¥åˆ›å»ºçš„S3 bucketä½œä¸ºè‡ªå®šä¹‰æºç«™(ä¸å¯ä»¥é…ç½®æºç«™ä¸ºS3 bucket)ã€‚å¹¶ä¸”é…ç½®ä½¿ç”¨è‡ªå®šä¹‰åŸŸå redirect.domain.comã€‚æ³¨æ„ï¼Œé…ç½®è‡ªå®šä¹‰CNameséœ€è¦æä¾›åŸŸåå¯¹åº”çš„SSLè¯ä¹¦ï¼Œå¯ä»¥ä½¿ç”¨AWS Certificate Manageråˆ›å»ºå…è´¹çš„SSL/TLSè¯ä¹¦ åœ¨åŸŸådomain.comè§£æžæœåŠ¡å•†ä¸ºåŸŸåredirect.domain.comåˆ›å»ºæ–°çš„è§£æžè®°å½• ä½¿ç”¨AWS Lambdaå’ŒAPI Gatewayå®žçŽ°åŸŸåé‡å®šå‘ åˆ›å»ºä¸€ä¸ªLambdaå‡½æ•°æ¥è¿”å›ž302è¯·æ±‚æˆ–è€…HTMLé¡µé¢ï¼Œåœ¨é¡µé¢ä¸­é€šè¿‡Javascriptå®žçŽ°é‡å®šå‘é¡µé¢ ä¸ºè¯¥Lambdaå‡½æ•°åˆ›å»ºAPI Gatewayè§¦å‘å™¨ ä¸ºè¯¥API GatewayæŽ¥å£åˆ›å»ºè‡ªå®šä¹‰åŸŸå åœ¨åŸŸådomain.comè§£æžæœåŠ¡å•†ä¸ºåŸŸåredirect.domain.comåˆ›å»ºæ–°çš„è§£æžè®°å½• æˆ‘åˆ›å»ºäº†ä¸€ä¸ªåŸºäºŽAWS CDKçš„Githubé¡¹ç›®ï¼Œåˆ©ç”¨AWS Infrastructure as Codeçš„å¼ºå¤§èƒ½åŠ›ä¸€é”®éƒ¨ç½²ä»¥ä¸Šä¸¤ç§æ— æœåŠ¡å™¨çŽ¯å¢ƒï¼Œæœ‰éœ€è¦çš„å¯ä»¥ä½œä¸ºå®žçŽ°å‚è€ƒã€‚\n","link":"https://kane.mx/posts/effective-cloud-computing/serverless-domain-redirect/","section":"posts","tags":["äº‘è®¡ç®—","AWS","AWS S3","AWS Lambda","AWS CDK"],"title":"æ— æœåŠ¡å™¨æž¶æž„çš„åŸŸåé‡å®šå‘æœåŠ¡"},{"body":"","link":"https://kane.mx/tags/amazon-alexa/","section":"tags","tags":null,"title":"Amazon Alexa"},{"body":"è¿‘æœŸéœ€è¦åšä¸€äº›Alexaä¸Šçš„å¼€å‘ï¼Œåœ¨æ‰‹æœºä¸Šå®‰è£…äº†Amazon Alexaï¼Œä¸€ç›´å¾—åˆ°ä¸‹é¢è¿™æ ·çš„é”™è¯¯æç¤ºè€Œæ— æ³•ç™»å½•ã€‚\nConnection Timed Out.\nå…ˆåŽå°è¯•äº†ç¿»å¢™ã€æ›´æ”¹è¯­è¨€ç­‰æ–¹æ³•ä»ç„¶ä¸å¯ç™»å½•ã€‚å¹¶ä¸”åœ¨ç½‘ç»œä¸Šä¹Ÿæ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„æ–¹æ¡ˆï¼Œå†³å®šæŠ“åŒ…ç ”ç©¶ä¸‹ä¸ºä»€ä¹ˆæˆ‘çš„è´¦å·å§‹ç»ˆæ— æ³•ç™»å½•ã€‚\né€šè¿‡æŠ“å–Alexaç™»å½•æ—¶å‘é€çš„æ•°æ®åŒ…ï¼Œå‘çŽ°ä»–è®¿é—®äº†amazon.cnç­‰æ•°ä¸ªcnåŸŸåä¸‹çš„ä¸€ç³»åˆ—æœåŠ¡ï¼Œçœ‹æ¥è¿™äº›æœåŠ¡ä¸­éƒ¨åˆ†å·²æ— æ³•æä¾›æ­£å¸¸æœåŠ¡ï¼Œå¯¼è‡´ç™»å½•ä¸€ç›´å‡ºçŽ°ä¸Šé¢çš„é”™è¯¯ã€‚\nAmazon Alexaä½œä¸ºä¸€ä¸ªæœåŠ¡å…¨çƒç”¨æˆ·çš„appï¼Œåº”è¯¥æ˜¯åˆ¤æ–­æ‰‹æœºç”¨æˆ·åœ¨å¤§é™†åœ°åŒºåŽä½¿ç”¨äº†é…ç½®åœ¨å¤§é™†åœ°åŒºçš„è¿™äº›æœåŠ¡ã€‚\nä¸´æ—¶è§£å†³æ–¹æ¡ˆçš„æ€è·¯å°±æ˜¯è®¾ç½®ç³»ç»Ÿæˆ–appï¼Œè®©ä»–æ— æ³•èŽ·å–åˆ°æ‰‹æœºçœŸå®žæ‰€åœ¨çš„åœ°ç†ä½ç½®ï¼Œé‚£ä¹ˆAlexa appä¼šä½¿ç”¨é»˜è®¤çš„å…¨çƒæœåŠ¡å™¨æ¥è¯·æ±‚æ•°æ®ã€‚\nä»¥ä¸‹æ˜¯ä¸´æ—¶è§£å†³æ–¹æ¡ˆçš„æ­¥éª¤ï¼Œ\nä»ŽPlayå¸‚åœºå®‰è£…Alexa appã€‚å¦‚æžœå·²å®‰è£…æ¸…ç©ºappæ•°æ®ã€‚ ç¦ç”¨app Locationæƒé™(é»˜è®¤å°±æ˜¯ç¦ç”¨çš„)ã€‚ æ›´æ”¹ç³»ç»Ÿè¯­è¨€ä¸ºè‹±æ–‡ï¼Œè®¾ç½®æ—¶åŒºä¸ºä»»æ„ç¾Žå›½æ—¶åŒºã€‚ æ‹”æŽ‰SIMå¡ï¼Œæˆ–è€…ç¦ç”¨æ‰€æœ‰SIMå¡ã€‚ æ‰“å¼€Alexa appï¼Œä½¿ç”¨å·²æœ‰æˆ–æ–°æ³¨å†ŒAmazonè´¦å·å³å¯ç™»å½•ã€‚\n","link":"https://kane.mx/posts/2019/alexa-login-issue/","section":"posts","tags":["AWS","Amazon Alexa","Troubleshoot"],"title":"Amazon Alexa Androidç‰ˆæœ¬å›½å†…ç™»å½•é—®é¢˜"},{"body":"","link":"https://kane.mx/tags/troubleshoot/","section":"tags","tags":null,"title":"Troubleshoot"},{"body":"ä¸ªäººç”µè„‘æ•°æ®å¤‡ä»½ä¸€ç›´éƒ½æ˜¯ä¸€ä¸ªå¼ºçƒˆçš„éœ€æ±‚ã€‚ä½¿ç”¨ç½‘ç›˜ç­‰äº‘å­˜å‚¨äº§å“å¯ä»¥éƒ¨åˆ†æ»¡è¶³æ•°æ®çš„å¤‡ä»½éœ€æ±‚ï¼Œä»ç„¶æ— æ³•åšåˆ°ä½¿ç”¨ä¾¿åˆ©æ€§å’Œå¾ˆé«˜çš„æ•°æ®å®‰å…¨ä¿éšœã€‚\nMacOSXä¸Šç³»ç»Ÿå†…ç½®äº†å¤‡ä»½è§£å†³æ–¹æ¡ˆ -- æ—¶é—´æœºå™¨(Time Machine)ã€‚Time Machineæ”¯æŒAirPort Time Capsuleï¼ŒNASå­˜å‚¨æˆ–è€…å¤–ç½®çš„å­˜å‚¨è®¾å¤‡ã€‚ç„¶è€Œè¿™äº›å¤‡ä»½æ–¹æ¡ˆéƒ½ä¾èµ–äºŽç¡¬ä»¶è®¾å¤‡ï¼Œæœ‰å®¹é‡é™åˆ¶æˆ–ä¸ä¾¿äºŽç§»åŠ¨ã€‚åœ¨äº‘è®¡ç®—å·²ç»å¤§è¡Œå…¶é“çš„ä»Šå¤©ï¼Œæœ‰æ²¡æœ‰ä½¿ç”¨äº‘è®¡ç®—åŽ‚å•†å¯¹è±¡å­˜å‚¨ä½œä¸ºç›®æ ‡å­˜å‚¨çš„å¤‡ä»½æ–¹æ¡ˆï¼Œä¸ºMacOSXæ•°æ®å¤‡ä»½æä¾›æ— é™å®¹é‡ã€é«˜åº¦çš„å®‰å…¨æ€§çš„äº‘æ–¹æ¡ˆï¼Ÿç»è¿‡ä¸€ç•ªæœç´¢ï¼Œæ—¢æ‰¾åˆ°äº†å¼€æºå…è´¹çš„å·¥å…·Resticï¼Œä¹Ÿæœ‰ä»˜è´¹è½¯ä»¶Arqã€‚æ— è®ºResticè¿˜æ˜¯Arqæä¾›çš„æ˜¯ç‹¬ç«‹çš„ä¸‰æ–¹å·¥å…·æ¥å®žçŽ°å¤‡ä»½åˆ°äº‘ç«¯å­˜å‚¨æˆ–ä»Žäº‘ç«¯æ¢å¤ï¼Œæœ‰æ²¡æœ‰å°†Time Machineå’Œäº‘ç«¯å‚¨å­˜ç»“åˆåœ¨ä¸€èµ·çš„æ–¹æ¡ˆå‘¢ï¼Ÿ\nTimeMchineæ”¯æŒå°†å¤–ç½®å­˜å‚¨ä½œä¸ºå¤‡ä»½è®¾å¤‡ï¼Œè¿™é‡Œä»‹ç»çš„æ–¹æ³•å°±æ˜¯å°†è¿œç«¯äº‘è®¡ç®—åŽ‚å•†çš„å¯¹è±¡å­˜å‚¨æŒ‚è½½ä¸ºæœ¬åœ°è®¾å¤‡ï¼Œè®¾ç½®Time Machineå°†å®ƒä½œä¸ºç›®æ ‡å¤‡ä»½è®¾å¤‡ï¼Œå®žçŽ°å°†å¤‡ä»½æ”¾åˆ°äº‘åŽ‚å•†çš„å¯¹è±¡å‚¨å­˜ã€‚\næŽ¥ä¸‹æ¥æˆ‘å°†ä¸€æ­¥æ­¥æ¼”ç¤ºå¦‚ä½•å°†AWS S3å¯¹è±¡å­˜å‚¨çš„bucketä½œä¸ºTime Machineå¤‡ä»½çš„è®¾å¤‡ã€‚\næ­¤æ–¹æ³•é€‚ç”¨äºŽå°†ä»»æ„äº‘åŽ‚å•†çš„å¯¹è±¡å­˜å‚¨ä½œä¸ºå¤‡ä»½å­˜å‚¨ï¼Œåªè¦è¯¥åŽ‚å•†çš„å¯¹è±¡å­˜å‚¨æ”¯æŒè¢«MacOSXæŒ‚è½½ä¸ºæœ¬åœ°ç£ç›˜ã€‚\næœ‰å¾ˆå¤šæˆç†Ÿçš„æ–¹æ¡ˆå°†AWS S3æŒ‚è½½ä¸ºMacOSXç£ç›˜ï¼Œä¾‹å¦‚S3fsã€Goofysã€‚æœ¬æ–‡æŽ¨èçš„æ–¹æ¡ˆæ˜¯Juicefsï¼ŒJuicefsä¸ºå¯¹è±¡å­˜å‚¨çš„å…ƒæ•°æ®æä¾›äº†ç¼“å­˜ï¼Œèƒ½æžå¤§çš„ä¼˜åŒ–å¯¹æŒ‚è½½ç£ç›˜çš„listï¼Œgetç­‰æ“ä½œã€‚\né¦–å…ˆæŒ‰ç…§Juicefs æ–‡æ¡£å®‰è£…å¿…è¦çš„ä¾èµ–å’ŒJuicefså®¢æˆ·ç«¯ã€‚æŽ¥ä¸‹æ¥åœ¨Juicefsæ³¨å†Œå®ŒæˆåŽï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¿å­˜å¤‡ä»½æ•°æ®ã€‚æ³¨æ„ï¼šè¿™é‡Œçš„bucketåç§°éœ€è¦åŒéšåŽåˆ›å»ºæˆ–å·²æœ‰çš„bucketåç§°ä¸€è‡´ã€‚ åˆ›å»ºæ–°çš„AWS S3 bucket(æˆ–è€…ä½¿ç”¨å·²æœ‰çš„bucket)ï¼ŒåŒæ—¶ä¸ºè¯¥bucketä¸“é—¨åˆ›å»ºç”¨äºŽJuicefså®¢æˆ·ç«¯ä½¿ç”¨çš„IAMç”¨æˆ·ã€‚å¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨äº‘å¸å·çš„access tokenç”¨äºŽæŒ‚è½½ï¼Œæœ€ä½³å®žè·µæ˜¯ä¸ºä¸åŒçš„ç”¨é€”åˆ›å»ºå•ç‹¬çš„IAMç”¨æˆ·ã€‚æ›´å¤šIAMç”¨æˆ·å®žè·µï¼Œè¯·å‚è€ƒæ–‡ç« IAMæœ€ä½³å®žè·µã€‚ä¸‹é¢æ˜¯ä½¿ç”¨AWS CLIåˆ›å»ºæ–°S3 bucketåŠIAMç”¨æˆ·çš„å‚è€ƒå‘½ä»¤ï¼Œ 1# åˆ›å»ºS3 bucket 2aws s3 mb s3://my-bucket-for-mac-backup 3 4# åˆ›å»ºIAMç”¨æˆ· 5aws iam create-user --user-name juicefs 6# ä¸ºjuicefsç”¨æˆ·æŽˆäºˆè¯»å†™å¤‡ä»½S3 bucketæƒé™ 7echo \u0026#39;{ 8 \u0026#34;UserName\u0026#34;: \u0026#34;juicefs\u0026#34;, 9 \u0026#34;PolicyName\u0026#34;: \u0026#34;mac-backup-bucket-all-permissions\u0026#34;, 10 \u0026#34;PolicyDocument\u0026#34;: \u0026#34;{ \\\u0026#34;Version\\\u0026#34;: \\\u0026#34;2012-10-17\\\u0026#34;, \\\u0026#34;Statement\\\u0026#34;: [ { \\\u0026#34;Effect\\\u0026#34;: \\\u0026#34;Allow\\\u0026#34;, \\\u0026#34;Action\\\u0026#34;: \\\u0026#34;s3:*\\\u0026#34;, \\\u0026#34;Resource\\\u0026#34;: [ \\\u0026#34;arn:aws-cn:s3:::my-bucket-for-mac-backup/*\\\u0026#34;, \\\u0026#34;arn:aws-cn:s3:::my-bucket-for-mac-backup\\\u0026#34; ] } ] }\u0026#34; 11 1 { 12}\u0026#39; \u0026gt; policy.json 13aws iam put-user-policy --cli-input-json file://policy.json 14# ä¸ºjuicefsç”¨æˆ·åˆ›å»ºaccess tokenç”¨äºŽjuicefså®¢æˆ·ç«¯æŒ‚è½½bucket 15aws iam create-access-key --user-name juicefs 16{ 17 \u0026#34;AccessKey\u0026#34;: { 18 \u0026#34;UserName\u0026#34;: \u0026#34;juicefs\u0026#34;, 19 \u0026#34;AccessKeyId\u0026#34;: \u0026#34;\u0026lt;key id\u0026gt;\u0026#34;, 20 \u0026#34;Status\u0026#34;: \u0026#34;Active\u0026#34;, 21 \u0026#34;SecretAccessKey\u0026#34;: \u0026#34;\u0026lt;access key\u0026gt;\u0026#34;, 22 \u0026#34;CreateDate\u0026#34;: \u0026#34;2019-06-30T15:25:41Z\u0026#34; 23 } 24} æŒ‰ç…§Juicefsæ–‡æ¡£æŒ‚è½½æŒ‚è½½S3 bucketã€‚ è¿›å…¥æŒ‚è½½åŽçš„ç›®å½•(å¦‚/jfs)ï¼Œåˆ›å»ºSparse Imageç”¨äºŽTime Machineå†™å…¥å¤‡ä»½ã€‚ 1cd /jfs 2hdiutil create -size 600g -type SPARSEBUNDLE -fs \u0026#34;HFS+J\u0026#34; Time Machine.sparsebundle ä¸Šé¢å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåä¸ºTimeMachine600 GBå¤§å°çš„é•œåƒ(åˆå§‹ä»…å ç”¨æ•°ç™¾MBï¼Œå®žé™…æ–‡ä»¶ç£ç›˜ç©ºé—´åªæœ‰å½“æ–‡ä»¶å†™å…¥åŽæ‰ä¼šå ç”¨)ã€‚æ ¹æ®ä½ çš„éœ€è¦éšæ„è°ƒæ•´é•œåƒå¤§å°ï¼Œé€šå¸¸å»ºè®®è®¾ç½®ä¸ºMacç£ç›˜å¤§å°çš„ä¸¤å€ã€‚ ä¸ç†Ÿæ‚‰å‘½ä»¤è¡Œçš„ç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç£ç›˜å·¥å…·(Disk Utility)åˆ›å»ºã€‚ é€šè¿‡FinderæŒ‚è½½ä¹‹å‰åˆ›å»ºçš„Sparse Image çŽ°åœ¨æ˜¯é­”æœ¯æ­¥éª¤ï¼Œå‘Šè¯‰Time Machineä½¿ç”¨ä¹‹å‰åˆ›å»ºçš„è™šæ‹Ÿè®¾å¤‡ä½œä¸ºå¤‡ä»½ç£ç›˜ã€‚ 1sudo tmutil setdestination /Volumes/Time MachineDisk ç”±äºŽS3 Bucketç”¨äºŽå¤‡ä»½æ•°æ®ï¼Œå»ºè®®å¼€å¯S3 æ™ºèƒ½åˆ†å±‚å­˜å‚¨æˆ–è€…IAå‚¨å­˜ï¼Œé™ä½ŽèŠ±è´¹ã€‚åŒæ—¶å¯ä»¥å¯ç”¨S3 KMSåŠ å¯†äº‘ç«¯ä¿å­˜çš„æ•°æ®ï¼Œæå‡æ•°æ®å®‰å…¨æ€§ã€‚\n","link":"https://kane.mx/posts/2019/using-s3-as-device-for-mac-time-machine-backup/","section":"posts","tags":["MacOSX","AWS","AWS S3","Tip"],"title":"ä½¿ç”¨AWS S3ä½œä¸ºMacOSXæ—¶é—´æœºå™¨(Time Machine)çš„å¤‡ä»½å­˜å‚¨"},{"body":"","link":"https://kane.mx/tags/dingtalk/","section":"tags","tags":null,"title":"Dingtalk"},{"body":"","link":"https://kane.mx/tags/spring/","section":"tags","tags":null,"title":"Spring"},{"body":"","link":"https://kane.mx/tags/spring-cloud-function/","section":"tags","tags":null,"title":"Spring Cloud Function"},{"body":"åŸºäºŽserverlessæ¡†æž¶çš„é’‰é’‰å›žè°ƒå‡½æ•°ä¸­ä»‹ç»äº†serverless frameworkï¼Œä¸€æ¬¾æ”¯æŒè·¨äº‘åŽ‚å•†/Serverlesså¹³å°çš„éƒ¨ç½²å·¥å…·ã€‚ä½†æ˜¯å‡½æ•°ä»£ç è¿˜æ˜¯éœ€è¦é’ˆå¯¹ä¸åŒçš„serverlesså¹³å°ä½œå¯¹åº”çš„é€‚é…ã€‚è€ŒSpring Clound Functionå°±æ˜¯é’ˆå¯¹è¿™ç§æƒ…å†µä¸“é—¨å¼€å‘çš„è·¨serverlesså¹³å°çš„æ¡†æž¶ï¼Œå®žçŽ°ä¸€å¥—ä»£ç é€šè¿‡ä¸åŒçš„æ‰“åŒ…å®žçŽ°è·¨serverlesså¹³å°ã€‚Spring Clound Functionç›®å‰æ”¯æŒAWS Lambda, Microsoft Azure Functionä»¥åŠApache OpenWhiskã€‚\nè¿™é‡Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨æ— å‡½æ•°ç‰ˆæœ¬çš„é’‰é’‰å›žæŽ‰å‡½æ•°æ¥æ¼”ç¤ºSpring Clound Function for AWSçš„ä½¿ç”¨ã€‚\né¦–å…ˆå°†spring cloud function for aws adapteræ·»åŠ åˆ°é¡¹ç›®ä¾èµ–ï¼Œ\n1implementation(\u0026#34;org.springframework.cloud:spring-cloud-function-adapter-aws:${springCloudFunctionVersion}\u0026#34;) å…¶æ¬¡åˆ›å»ºå‡½æ•°Handlerï¼Œå®žçŽ°Spring Cloud Functionè·¨å‡½æ•°è®¡ç®—å®žçŽ°æŠ½è±¡çš„SpringBootRequestHandlerç±»ï¼Œæˆ–è€…æ˜¯ç»§æ‰¿è‡ªå®ƒçš„triggerç±»ï¼Œä¾‹å¦‚SpringBootApiGatewayRequestHandler\n1import org.springframework.cloud.function.adapter.aws.SpringBootApiGatewayRequestHandler 2 3class Handler : SpringBootApiGatewayRequestHandler() æŽ¥ä¸‹æ¥åˆ›å»ºSpring Bootåº”ç”¨ç¨‹åºï¼Œå¹¶å°†serverlesså®žçŽ°å‡½æ•°æ³¨å†Œä¸ºSpring Beanï¼Œå‡½æ•°çš„å®žçŽ°éƒ¨åˆ†å°±æ˜¯serverlesså‡½æ•°å…·ä½“åšçš„ä¸šåŠ¡é€»è¾‘ã€‚\n1@SpringBootApplication 2open class DingtalkCallbackApplication { 3 4 @Bean 5 open fun dingtalkCallback(): Function\u0026lt;Message\u0026lt;EncryptedEvent\u0026gt;, Map\u0026lt;String, String\u0026gt;\u0026gt; { 6 val callback = Callback() 7 return Function { 8 callback.handleRequest(it) 9 } 10 } 11} 12fun main(args: Array\u0026lt;String\u0026gt;) { 13 SpringApplication.run(DingtalkCallbackApplication::class.java, *args) 14} æœ€åŽå°†å‡½æ•°æ‰“åŒ…ä¸ºfat jarï¼ˆå¦‚æžœå°†ä¾èµ–æ‰“åŒ…ä¸ºlambda layerï¼Œå¯ä¸ç”¨æ‰“åŒ…ä¸ºfat jarï¼‰ä½œä¸ºlambdaçš„ä»£ç ã€‚\nå‡½æ•°çš„éƒ¨ç½²åŒå…¶ä»–çš„lambdaå‡½æ•°æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­æ²¿ç”¨äº†ä¹‹å‰çš„SAM/CloudFormationé…ç½®æˆ–è€…serverless frameworkéƒ¨ç½²é…ç½®ã€‚\nå®Œæ•´çš„å¯è¿è¡Œã€éƒ¨ç½²ä»£ç è¯·è®¿é—®è¿™ä¸ªåˆ†æ”¯ã€‚\næ€»ä½“æ¥è¯´ï¼ŒSpring Clound Functionçš„å®žçŽ°åŽŸç†å¹¶ä¸å¤æ‚ï¼Œå®šä¹‰ç»Ÿä¸€çš„å‡½æ•°å®žçŽ°å…¥å£ï¼Œé€šè¿‡ä¸åŒserverlesså¹³å°çš„adapterå¯¹æŽ¥ä¸åŒå¹³å°çš„APIæŽ¥å£ï¼Œåšåˆ°ç¼–å†™ä¸€æ¬¡å‡½æ•°å®žçŽ°ï¼Œé€šè¿‡æ‰“åŒ…ä¸åŒçš„adapteråšåˆ°è·¨serverlesså¹³å°è¿è¡Œã€‚\nä½†ä¸ªäººè®¤ä¸ºçŽ°å®žä¸­è¿™æ ·çš„åœºæ™¯å¹¶ä¸å¤šã€‚å¹¶ä¸”serverlesså‡½æ•°è§¦å‘æ–¹å¼å¾ˆå¤šï¼Œä¾‹å¦‚AWSä¸Šçš„APIGatewayã€Kinesisã€CloudWatchã€IoTç­‰æœåŠ¡ï¼Œä¸Žè¿™äº›æœåŠ¡å¯¹æŽ¥æˆ–APIè°ƒç”¨å…¶å®žä¹Ÿäº§ç”Ÿäº†è€¦åˆï¼Œå¹¶ä¸èƒ½ç®€å•çš„è¿ç§»åˆ°ä¸‰æ–¹çš„serverlesså¹³å°åŽ»æ‰§è¡Œã€‚åŒæ—¶ï¼Œå¼€å‘è€…éœ€è¦å¼•å…¥spring/spring boot/spring cloudç›¸å…³çš„ä¾èµ–ï¼Œå¢žåŠ äº†ç¨‹åºçš„å¤æ‚åº¦ï¼Œåˆå»¶é•¿äº†lambdaå‡½æ•°clod startéœ€è¦çš„æ—¶é—´ã€‚å¦å¤–ï¼Œå¼€å‘è€…éœ€è¦å­¦ä¹ spring cloud functionç›¸å…³çš„çŸ¥è¯†ï¼Œæ— å½¢ä¸­å¢žåŠ äº†å¤æ‚åº¦ã€‚æ€»ä¹‹ä½¿ç”¨spring cloud functionä½œä¸ºå‡½æ•°è®¡ç®—æ¡†æž¶æ”¶ç›Šå¹¶ä¸é«˜ï¼Œæ•´ä¸ªé¡¹ç›®ç»™äººæ„Ÿè§‰æ¯”è¾ƒé¸¡è‚‹ã€‚\n","link":"https://kane.mx/posts/effective-cloud-computing/spring-cloud-function-for-aws/","section":"posts","tags":["äº‘è®¡ç®—","FaaS","å‡½æ•°è®¡ç®—","AWS","AWS Lambda","é’‰é’‰","dingtalk","Serverless Computing","Spring","Spring Cloud Function"],"title":"Spring Cloud Function -- è·¨Serverlesså¹³å°çš„å‡½æ•°è®¡ç®—æ¡†æž¶"},{"body":"","link":"https://kane.mx/tags/%E5%87%BD%E6%95%B0%E8%AE%A1%E7%AE%97/","section":"tags","tags":null,"title":"å‡½æ•°è®¡ç®—"},{"body":"","link":"https://kane.mx/tags/%E9%92%89%E9%92%89/","section":"tags","tags":null,"title":"é’‰é’‰"},{"body":"AWSæ˜¯å…¨çƒäº‘è®¡ç®—é¢†åŸŸçš„é¢†è·‘è€…ï¼Œå®ƒåœ¨è®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œç­‰æ–¹é¢éƒ½åšå‡ºäº†å¾ˆå¤šåˆ›æ–°ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å…¶ä»–äº‘è®¡ç®—åŽ‚å•†å­¦ä¹ åŠæ¨¡ä»¿çš„å¯¹è±¡ã€‚\né˜¿é‡Œäº‘æ˜¯ç›®å‰å›½å†…å¸‚åœºä»½é¢æœ€å¤§çš„äº‘è®¡ç®—åŽ‚å•†ï¼Œå…¶ä»½é¢è¶…è¿‡äº†ç¬¬äºŒè‡³äº”ä½åŽ‚å•†çš„æ€»å’Œï¼Œä»½é¢é¢†å…ˆä¼˜åŠ¿æ¯”AWSåœ¨å…¨çƒè¿˜è¦æ˜¾è‘—ï¼ŒåŒæ—¶å…¨çƒä»½é¢ä¹Ÿè¶…è¿‡IBMæ¥åˆ°ç¬¬å››ã€‚\næœ¬æ–‡å°†å¯¹AWSå’Œé˜¿é‡Œäº‘æ ¸å¿ƒæœåŠ¡åšä¸€ä¸ªç®€è¦å¯¹æ¯”ï¼Œä»¥åŠè¿™ä¸¤å®¶åŽ‚å•†å‘å±•æ–¹å‘çš„ä¸€äº›ä¸ªäººè§è§£ã€‚\näº‘è®¡ç®—ï¼Œå…¶æ ¸å¿ƒæœåŠ¡å°±æ˜¯è®¡ç®—ã€å­˜å‚¨åŠç½‘ç»œã€‚è¿™äº›åŸºæœ¬èƒ½åŠ›çš„ç¨³å®šæ€§ï¼ŒåŠŸèƒ½å®Œå–„æ€§å†³å®šäº†äº‘è®¡ç®—åŽ‚å•†èƒ½åŠ›çš„ä¸‹é™ã€‚\né™¤äº†ä¸Šé¢æåˆ°çš„ä¸‰å¤§è®¡ç®—æœºæ ¸å¿ƒç»„ä»¶èƒ½åŠ›ï¼Œä¸‹é¢è¿™äº›èƒ½åŠ›ä¹Ÿæ˜¯äº‘è®¡ç®—ä¸­éžå¸¸é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œ\næŒ‰é‡è®¡è´¹ èµ„æºç¼–æŽ’ï¼ˆä¹Ÿå°±æ˜¯å¹³å°ä½œä¸ºä»£ç ï¼‰ äº‘èµ„æºçš„è®¤è¯åŠæŽˆæƒ API åŸºäºŽä¸Šé¢åˆ—ä¸¾çš„äº‘è®¡ç®—æ ¸å¿ƒæœåŠ¡å’Œå…³é”®èƒ½åŠ›ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å“ªäº›æ–¹é¢æ˜¯AWSçš„å¼ºé¡¹ã€‚\nAWSä½œä¸ºäº‘è®¡ç®—çš„é¢†å†›åŽ‚å•†ï¼Œåœ¨è®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œè¿™ä¸‰å¤§æ ¸å¿ƒä¸€ç›´åœ¨ä¸åœçš„åˆ›æ–°ä¸­ï¼Œä¸”è¢«å‹å•†åœ¨ä¸åœçš„æ¨¡ä»¿ã€‚è®¡ç®—æ–¹é¢ï¼ŒAWSé¦–å…ˆæŽ¨å‡ºäº†Lambdaæ— æœåŠ¡å™¨è®¡ç®—å¼•æ“Žå®žçŽ°æŒ‰é‡ä½¿ç”¨çš„å…¨æ‰˜ç®¡æœåŠ¡ï¼Œç”Ÿäº§å¯ç”¨çš„GPUå®žä¾‹(å•è™šæœºå¯é…ç½®æœ€é«˜64å—GPUå¡ï¼Œè€Œé˜¿é‡Œäº‘é»˜è®¤ä»…å”®å–2å—GPUå¡)ï¼ŒåŸºäºŽNitroæž¶æž„çš„EC2å®žä¾‹ä¸ºå®¢æˆ·é€ä¸Šäº†å‡æ€§èƒ½é™ä»·çš„å¥½äº‹ã€‚\nS3ä½œä¸ºAWSæœ€æ—©æŽ¨å‡ºçš„äº‘è®¡ç®—æœåŠ¡ï¼Œä»ç„¶åœ¨ä¸åœçš„åˆ›æ–°æ¼”åŒ–ä¸­ã€‚ç›®å‰S3è¾¾åˆ°äº†11ä¸ª9çš„æŒä¹…æ€§ï¼Œä¸ºæ»¡è¶³å®¢æˆ·ä¸åŒçš„å­˜å‚¨éœ€è¦ï¼ŒåˆæŽ¨å‡ºäº†S3 Glacierã€Glacier Deep Archiveç­‰å­˜å‚¨æ–¹æ¡ˆã€‚æŒç»­æŽ¨å‡ºäº†Amazon Athena, Redshift, S3 selectç­‰æœåŠ¡åŠå·¥å…·è§£å†³æµ·é‡æ•°æ®çš„å¤§æ•°æ®å¤„ç†ã€‚\nAWSä¸€ç›´å°†PAYG(Pay-As-You-Go)çš„æŒ‰é‡è®¡è´¹æ¨¡åž‹è´¯ç©¿åœ¨å„ç§æœåŠ¡ä¸­ã€‚æ— è®ºæ˜¯EC2(åŒ…æ‹¬GPUå®žä¾‹)ï¼ŒELBï¼ŒNATç½‘å…³ç­‰ç­‰éƒ½æä¾›å°æ—¶çº§çš„æŒ‰é‡è®¡è´¹ã€‚é˜¿é‡Œäº‘åœ¨è¿™æ–¹é¢è¿˜æœ‰è¾ƒå¤šçš„æ”¹è¿›ç©ºé—´ï¼Œä¾‹å¦‚GPUå®žä¾‹æœ€å°å”®å–æ—¶é•¿ä¸ºä¸€å‘¨ï¼ŒSLBé¦–å…ˆæŒ‰è§„æ ¼å”®å–ï¼ŒNATç½‘å…³æŒ‰è‡ªç„¶æ—¥è®¡è´¹ã€‚\nIAMä¸ºäº‘ä¸Šçš„èµ„æºæä¾›äº†æœ€ç»†ç²’åº¦çš„æŽˆæƒç®¡ç†ï¼ŒAWSå„ä¸ªæœåŠ¡ä¸¥æ ¼æŒ‰æœ€ç»†ç²’åº¦æŽ§åˆ¶æŽˆæƒï¼Œæ»¡è¶³ä¼ä¸šçš„æƒé™ç®¡ç†ã€‚åœ¨æˆ‘ä½¿ç”¨è¿‡çš„æ•°ä¸ªé˜¿é‡Œäº‘æœåŠ¡ä¸­ï¼Œå¤šæ¬¡é‡åˆ°è¾ƒæ–°çš„æœåŠ¡IAMè®¾è®¡ä¸å‘¨ï¼Œæƒé™ç²’åº¦è¿‡å¤§ï¼Œç”šè‡³åŠŸèƒ½æ— æ³•å·¥ä½œçš„æƒ…å†µä¸‹å°±ä¸Šçº¿å‘å¸ƒäº†ã€‚\nAWS CloudFormationæä¾›äº†äº‘ä¸Šèµ„æºç¼–æŽ’ç®¡ç†ï¼Œå®žçŽ°äº†èµ„æºçš„ä»£ç åŒ–ï¼Œç‰ˆæœ¬åŒ–(é€šå¸¸ç§°ä¸ºçš„Infrastrucure as Code)ã€‚å°†äº‘ç«¯èµ„æºçš„ç®¡ç†è¿ç»´æå‡åˆ°ä¸€ä¸ªæ–°çš„å±‚æ¬¡ã€‚\nAWSæä¾›äº†ä¸‰ç§æ–¹å¼ç®¡ç†äº‘ä¸Šèµ„æºï¼ŒWeb Console, CLIä»¥åŠAPIã€‚è¿™ä¸‰ç§æ–¹å¼ï¼Œå°½æœ€å¤§åŠªåŠ›æä¾›ä¸€è‡´çš„åŠŸèƒ½ã€‚\nAWSåŒæ—¶æ˜¯ä¸€ä¸ªäº‘è®¡ç®—çš„ç”Ÿæ€ï¼Œå„ç±»ä¸‰æ–¹äº‘æœåŠ¡åŽ‚å•†é€šè¿‡Marketplaceå”®å–å„ç±»SaaSï¼ŒPaaSæœåŠ¡ï¼Œå½¢æˆä¸€ä¸ªäº‘è®¡ç®—ç”¨æˆ·ï¼Œä¸‰æ–¹æœåŠ¡Vendorï¼ŒAWSä¸‰æ–¹å…±èµ¢çš„å±€é¢ã€‚\næ€»å¾—è¯´æ¥ï¼ŒAWSæŒç»­çš„åœ¨äº‘è®¡ç®—æ ¸å¿ƒæœåŠ¡å’Œå…³é”®æœåŠ¡æŠ•å…¥ï¼Œä¸åœçš„åˆ›æ–°ï¼Œä¿è¯äº†AWSæ•´ä½“æœåŠ¡çš„é¢†å…ˆã€‚\næŽ¥ä¸‹æ¥çœ‹çœ‹é˜¿é‡Œäº‘çš„å¼ºé¡¹ã€‚\né˜¿é‡Œäº‘åœ¨æä¾›åŸºæœ¬çš„è®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œå¤–ï¼Œé¢å¤–æä¾›äº†å¾ˆå¤šSaaSæœåŠ¡ï¼Œä¾‹å¦‚ï¼ŒApplication Performance Monitorï¼Œ Performance Testing Service, æ—¥å¿—æœåŠ¡ï¼Œé“¾è·¯è¿½è¸ªæœåŠ¡ï¼Œæ•°æ®åº“ç®¡ç†æœåŠ¡ç­‰ã€‚è¿™äº›æœåŠ¡æ˜¾ç„¶åŒé˜¿é‡Œäº‘æœ‰æ›´å¥½çš„é›†æˆï¼Œå¯¹ç”¨æˆ·æ¥è¯´æä¾›äº†å¼€ç®±å³ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚è€Œè¿™ä¹Ÿæ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼Œåˆ©ç”¨å¹³å°æ†ç»‘çš„ä¼˜åŠ¿æŠ¢å åˆä½œå¼€å‘å•†çš„å¸‚åœºï¼Œé•¿æœŸæ¥è¯´åˆ©ç”¨å¹³å°åž„æ–­ä¸åˆ©äºŽåŸºäºŽé˜¿é‡Œäº‘çš„æŠ€æœ¯æœåŠ¡åˆ›ä¸šã€‚\næ€»ä¹‹ï¼Œé˜¿é‡Œäº‘åœ¨äº‘è®¡ç®—æ ¸å¿ƒæœåŠ¡ä¸ŠåŒAWSæ¯”è¿˜æœ‰å·®è·ï¼Œä½†ä»–åœ¨PaaS/SaaSæœåŠ¡ä¸Šå‘å±•ä¸é”™ï¼Œæ›´åŠ å®¹æ˜“æä¾›å…¨å¥—åŸºäºŽé˜¿é‡Œäº‘çš„è§£å†³æ–¹æ¡ˆã€‚ç”±äºŽé˜¿é‡Œäº‘åœ¨å›½å†…æ•°æ®ä¸­å¿ƒæ•°é‡ä¸Šçš„ä¼˜åŠ¿åŠ ä¸Šä»Žä¸‡ç½‘æ”¶è´­çš„BGPèµ„æºï¼Œå…¶æœåŠ¡åœ¨å›½å†…è®¿é—®ç½‘ç»œå»¶è¿Ÿä¼šæ›´ä½Žã€‚\næœ€åŽï¼Œè°ˆä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„è¯é¢˜ï¼Œæ˜¯å¦éœ€è¦è€ƒè™‘äº‘åŽ‚å•†çš„é”å®šã€‚\nKubernetesäº‹å®žä¸Šæˆä¸ºå®¹å™¨ç¼–æŽ’å¹³å°ï¼Œé¦–å…ˆè€ƒè™‘ä½¿ç”¨K8SåŠCNCF landscapeä¸‹çš„é¡¹ç›®ä½œä¸ºåº”ç”¨è¿è¡ŒçŽ¯å¢ƒï¼Œå‡å°‘å¯èƒ½çš„è¿ç§»å’Œå­¦ä¹ æˆæœ¬ã€‚\nå¯¹ä¸åŒç”¨é‡çš„å…¬å¸æ¥è¯´ï¼Œè€ƒè™‘äº‘åŽ‚å•†é”å®šçš„ç»´åº¦å®Œå…¨ä¸ä¸€æ ·ã€‚åˆ›ä¸šåž‹å…¬å¸æˆ–ä»åœ¨å¿«é€Ÿå‘å±•ä¸šåŠ¡ä¸­çš„ä¸­å¤§åž‹ä¼ä¸šé¦–å…ˆåº”è¯¥é€‰æ‹©å¯é æ€§é«˜ï¼Œè§£å†³æ–¹æ¡ˆå¤šï¼Œæ˜“å­¦ä¹ çš„äº‘åŽ‚å•†ï¼Œå°½å¯èƒ½åˆ©ç”¨äº‘åŽ‚å•†çš„å„ç§æœåŠ¡åšåˆ°å¿«é€Ÿé«˜æ•ˆå¯é çš„æŽ¨è¿›ä¸šåŠ¡ï¼Œå°†å°½é‡å¤šçš„ç²¾åŠ›ã€äººåŠ›æŠ•å…¥åˆ°ä¸šåŠ¡ç›¸å…³çš„äº‹æƒ…ä¸Šã€‚ä¸šåŠ¡ç¨³å®šçš„å¤§åž‹å…¬å¸ï¼Œå¯ä»¥ä½¿ç”¨å¤šæ•°æ®ä¸­å¿ƒå®žçŽ°å…³é”®ä¸šåŠ¡çš„é«˜å¯ç”¨æ€§ï¼Œè·¨äº‘å®Œå…¨ä¸åº”è¯¥ä½œä¸ºé«˜å¯ç”¨çš„å¿…è¦è§£å†³é€”å¾„ã€‚å¦å¤–ï¼Œäº‘åŽ‚å•†ç»å¯¹ä¼šæŠ•å…¥é¢å¤–çš„äººåŠ›ï¼Œä¼˜å…ˆçº§æ”¯æŒä»–ä»¬çš„å¤§å®¢æˆ·ï¼Œç”šè‡³ä¸ºè¿™ç±»å®¢æˆ·è°ƒæ•´äº§å“ç ”å‘ä¼˜å…ˆçº§æˆ–ååŒå®ŒæˆæŸäº›åŠŸèƒ½ï¼Œè¿™æ ·ç»å¯¹æ˜¯ä¸ªåŒèµ¢çš„å±€é¢ï¼ŒNetflixå’ŒAWSçš„äº’ç›¸æˆå°±å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚æ²¡æœ‰ç‰¹åˆ«å¿…è¦çš„åŽŸå› ï¼Œä¸è¦è½»æ˜“æŠ•å…¥ç²¾åŠ›å°†ä¸šåŠ¡ä»ŽæœåŠ¡å·²ç»å¾ˆç¨³å®šçš„äº‘åŽ‚å•†è¿ç§»åˆ°å¤šäº‘å¹³å°ä¸Šï¼Œé‚£æ ·å¾€å¾€æ˜¯ç™½ç™½è€—è´¹åŠ›æ°”ã€‚\nä¸‹é¢æ˜¯slideçš„æœ€æ–°å®Œæ•´ç‰ˆæœ¬ï¼Œ\n","link":"https://kane.mx/posts/2019/aws-vs-aliyun/","section":"posts","tags":["äº‘è®¡ç®—","AWS","é˜¿é‡Œäº‘"],"title":"å…¬æœ‰äº‘å¯¹æ¯”"},{"body":"","link":"https://kane.mx/tags/%E9%98%BF%E9%87%8C%E4%BA%91/","section":"tags","tags":null,"title":"é˜¿é‡Œäº‘"},{"body":"Serverless Frameworkæ˜¯ä¸€ä¸ªå¼€æºå‘½ä»¤è¡Œå·¥å…·ã€‚ä»–æä¾›å‡½æ•°è„šæ‰‹æž¶ã€æµç¨‹è‡ªåŠ¨åŒ–ã€æœ€ä½³å®žè·µç­‰å¸®åŠ©å¼€å‘ã€éƒ¨ç½²è·¨äº‘åŽ‚å•†çš„æ‰˜ç®¡æ— æœåŠ¡å™¨è®¡ç®—æœåŠ¡(å®˜æ–¹å·²æ”¯æŒaws, Azure, GCP, IBM Cloudç­‰å„ç§åŽ‚å•†çš„æ— æœåŠ¡å™¨è®¡ç®—)ã€‚åŒæ—¶æ”¯æŒä½¿ç”¨æ’ä»¶æ¥æ‰©å±•å„ç§åŠŸèƒ½ï¼Œæ¯”å¦‚æ”¯æŒæ›´å¤šäº‘åŽ‚å•†æ— æœåŠ¡å™¨è®¡ç®—æœåŠ¡ï¼Œä¾‹å¦‚é˜¿é‡Œäº‘çš„å‡½æ•°è®¡ç®—ã€‚\nè¿™é‡Œä½¿ç”¨åŸºäºŽå‡½æ•°è®¡ç®—çš„é’‰é’‰å›žè°ƒå‡½æ•°æŽ¥å£ç¤ºä¾‹æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨Serverless Frameworkå°†ä¸€ä¸ªæ— æœåŠ¡å™¨å‡½æ•°éƒ¨ç½²åˆ°AWS Lambdaã€‚\nå®‰è£…serverelessåŽï¼Œå¯ä»¥é€šè¿‡serverless createå‘½ä»¤åˆ›å»ºå‡½æ•°è„šæ‰‹æž¶å·¥ç¨‹ï¼Œæˆ–è€…åœ¨å·²æœ‰å·¥ç¨‹çš„ä¸‹åˆ›å»ºserverlessé…ç½®æ–‡ä»¶serverless.ymlã€‚\næŽ¥ä¸‹æ¥å¯ä»¥å‚è€ƒserverless aws referenceé…ç½®ä½ çš„aws lambdaå‡½æ•°åŠéœ€è¦çš„å„ç§èµ„æºã€‚å¦‚æžœå·²ç»æœ‰è¿‡ä½¿ç”¨AWS CloudFormationæˆ–è€…AWS SAMç»éªŒçš„ï¼Œå¯ä»¥å¾ˆå¿«é€‚åº”ç¼–å†™Serverlessé…ç½®ã€‚Serverlessçš„é…ç½®æœ¬è´¨ä¸Šæ˜¯å°†CloudFormation/SAMç›¸å…³çš„æ¦‚å¿µè¿›è¡ŒæŠ½è±¡ï¼Œä¸ºå„ä¸ªäº‘åŽ‚å•†çš„æ— æœåŠ¡å™¨è®¡ç®—æœåŠ¡æä¾›ç»Ÿä¸€çš„å·¥å…·ã€å‘½ä»¤ä»¥åŠæ¦‚å¿µæŠ½è±¡ã€‚åœ¨éƒ¨ç½²aws lambdaæ—¶ï¼Œserverlessé…ç½®ä¼šè¢«è½¬æ¢ä¸ºCloudFormationé…ç½®ï¼Œé€šè¿‡AWS APIè¿›è¡Œåˆ›å»ºæˆ–å˜æ›´ã€‚\nå¯¹äºŽDingtalk Callback on AWS Lambda, serverlessé…ç½®å£°æ˜Žå¦‚ä¸‹ã€‚å…¶ä¸­æŒ‡å®šäº†serviceçš„åŸºæœ¬ä¿¡æ¯ï¼Œå…¨å±€çš„é…ç½®(å¦‚stageã€regionç­‰)ã€äº‘åŽ‚å•†provider(è¿™é‡Œæ˜¯aws)ã€‚å‡½æ•°çš„åŸºæœ¬ä¿¡æ¯ã€æƒé™ã€layerã€è§¦å‘å™¨ï¼Œè‡ªå®šä¹‰layerä»¥åŠå…¶ä»–äº‘åŽ‚å•†èµ„æºï¼Œæ¯”å¦‚Dingtalk callbackè¿™é‡Œç”¨åˆ°çš„DynamoDBã€‚å®Œæ•´çš„serverlessé…ç½®æŸ¥çœ‹è¿™é‡Œã€‚\n1service: 2 name: dingtalk-callback 3 4frameworkVersion: \u0026#34;\u0026gt;=1.0.0 \u0026lt;2.0.0\u0026#34; 5 6provider: 7 name: aws 8 runtime: java8 9 stage: ${opt:stage, \u0026#39;dev\u0026#39;} # Set the default stage used. Default is dev 10 region: ${opt:region, \u0026#39;ap-southeast-1\u0026#39;} # Overwrite the default region used. Default is ap-southeast-1 11 profile: ${opt:profile, \u0026#39;default\u0026#39;} # The default profile to use with this service 12 versionFunctions: true # Optional function versioning 13 endpointType: regional # Optional endpoint configuration for API Gateway REST API. Default is Edge. 14 15functions: 16 dingtalk-callback: 17 handler: com.github.zxkane.dingtalk.Callback::handleRequest # required, handler set in AWS Lambda 18 name: ${self:provider.stage}-dingtalk-callback # optional, Deployed Lambda name 19 memorySize: 384 # optional, in MB, default is 1024 20 timeout: 15 # optional, in seconds, default is 6 21 environment: # Function level environment variables 22 PARA_DD_TOKEN: DD_TOKEN 23 TABLE_NAME: {Ref: BPMTable} 24 package: 25 artifact: build/libs/dingtalk-callback-1.0.0-SNAPSHOT.jar 26 role: dingtalkCallbackIAMRole 27 layers: # An optional list Lambda Layers to use 28 - {Ref: DependenciesLambdaLayer} 29 events: # The Events that trigger this Function 30 - http: # This creates an API Gateway HTTP endpoint which can be used to trigger this function. Learn more in \u0026#34;events/apigateway\u0026#34; 31 path: dingtalk # Path for this endpoint 32 method: post # HTTP method for this endpoint 33 34layers: 35 dependencies: 36 path: build/deps 37 38resources: # CloudFormation template syntax 39 Resources: 40 dingtalkCallbackIAMRole: 41 Type: AWS::IAM::Role 42 Properties: 43 Policies: 44 - PolicyName: SSMPolicy 45 - PolicyName: DynamoDBPolicy 46 BPMTable: 47 Type: AWS::DynamoDB::Table 48 Properties: 49 TableName: bpm_raw_${self:service.name}_${self:provider.stage} 50 ProvisionedThroughput: 51 ReadCapacityUnits: 1 52 WriteCapacityUnits: 1 å¯¹äºŽä½¿ç”¨å•ä¸€äº‘åŽ‚å•†æ— æœåŠ¡å™¨è®¡ç®—å¹¶ä¸”å·²ç»ä½¿ç”¨äº†ç±»ä¼¼sam cliå®žçŽ°æŒç»­é›†æˆã€æŒç»­éƒ¨ç½²çš„ç”¨æˆ·ï¼ŒServerless Frameworkå¹¶ä¸èƒ½å¸¦æ¥æ›´å¤šç”Ÿäº§åŠ›çš„æå‡ï¼Œåœ¨ç¨³å®šæ€§(å°è£…äº‘åŽ‚å•†çš„åŠŸèƒ½ï¼Œå¢žåŠ å¤æ‚åº¦å¾ˆå¯èƒ½å¼•å…¥æ–°çš„é—®é¢˜)æˆ–åŠŸèƒ½çš„åŠæ—¶æ€§ä¸Šå¯èƒ½è¿˜ä¸å¦‚äº‘åŽ‚å•†æä¾›çš„å·¥å…·ã€‚\nå¯¹äºŽæœ‰å¤šäº‘åŽ‚å•†éƒ¨ç½²æ— æœåŠ¡å™¨å‡½æ•°éœ€æ±‚çš„ç”¨æˆ·ï¼Œä½¿ç”¨äº†Serverless Frameworkå¹¶ä¸èƒ½è½»æ¾çš„å°†æ— æœåŠ¡å™¨å‡½æ•°éƒ¨ç½²åˆ°ä¸åŒäº‘åŽ‚å•†çš„æ‰˜ç®¡æœåŠ¡ä¸Šï¼Œä»–åªæ˜¯å¸®åŠ©æä¾›è·¨äº‘åŽ‚å•†çš„ç»Ÿä¸€å·¥å…·é“¾åŠç›¸ä¼¼çš„æŒç»­é›†æˆã€éƒ¨ç½²ç­‰æœ€ä½³å®žè·µæµç¨‹ã€‚ä¾‹å¦‚å°†ä¸€å¥—å‡½æ•°ä»ŽAWSè¿ç§»åˆ°Azureä¸Šï¼Œéœ€è¦é‡æ–°å®žçŽ°Azure providerä¸‹çš„é…ç½®ï¼Œå› ä¸ºäº‘åŽ‚å•†çš„æ‰˜ç®¡æ— æœåŠ¡å™¨æœåŠ¡å’Œå…¶ä»–äº‘èµ„æºéƒ½å­˜åœ¨ç€å¤§é‡å·®å¼‚ã€‚å¦å¤–å‡½æ•°ä»£ç ä¹Ÿéœ€è¦é¢ä¸´æ”¹é€ ï¼Œä¸åŒäº‘åŽ‚å•†çš„è§¦å‘å™¨æ¶ˆæ¯äº‹ä»¶ä¹Ÿéƒ½æœ‰ä¸åŒçš„æ ¼å¼ï¼è¿™é‡Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ç±»ä¼¼Spring Cloud Functionè¿™æ ·çš„è§£å†³æ–¹æ¡ˆæ¥å®žçŽ°è·¨äº‘åŽ‚å•†çš„å‡½æ•°ç¼–å†™ã€‚\næ€»ä¹‹ï¼ŒServerless Frameworkå¯¹äºŽè·¨äº‘åŽ‚å•†éƒ¨ç½²åœºæ™¯æœ‰ä¸€å®šç”Ÿäº§æ•ˆçŽ‡çš„æå‡ï¼Œä½†ä»–ç¦»å®Œç¾Žè§£å†³è·¨äº‘åŽ‚å•†æ— æœåŠ¡å™¨æ‰˜ç®¡æœåŠ¡ï¼ˆå„åŽ‚å•†æœåŠ¡å¤©ç”Ÿä¸å…¼å®¹ï¼‰è¿˜æœ‰å¾ˆè¿œçš„è·ç¦»ï¼Œä¹Ÿè®¸è¿™ä¸ªæ€è·¯å°±æ˜¯èµ°ä¸é€šçš„\u0026#x1f615;ã€‚\n","link":"https://kane.mx/posts/2019/serverless-framework/","section":"posts","tags":["äº‘è®¡ç®—","FaaS","AWS","AWS Lambda","Serverless Computing"],"title":"Serverless framework 101"},{"body":"åœ¨åŸºäºŽå‡½æ•°è®¡ç®—çš„é’‰é’‰å›žè°ƒå‡½æ•°æŽ¥å£ä¸­ä½¿ç”¨é’‰é’‰å›žè°ƒå‡½æ•°æ¡ˆä¾‹å®žè·µäº†AWS Lambdaæ— æœåŠ¡å‡½æ•°ã€‚è¯¥ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†è‡ªå®šä¹‰çš„å‡½æ•°ä»£ç åŠä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ï¼ˆæ¯”å¦‚jsonå¤„ç†åº“jackson, é’‰é’‰openapiåŠ å¯†åº“, aws dynamodb clientç­‰ï¼‰æ•´ä½“æ‰“åŒ…ä¸ºä¸€ä¸ªéƒ¨ç½²åŒ…ï¼Œä¸Šä¼ åˆ°lamdbaä»£ç ä»“åº“ç”¨äºŽå‡½æ•°æ‰§è¡Œã€‚\nç„¶è€Œå®žé™…é¡¹ç›®ä¸­ï¼Œå…¶å®žæœ‰å¤§é‡çš„ç›¸å…³å‡½æ•°å¯èƒ½ä¼šå…±äº«è¿™äº›åŸºç¡€ä¾èµ–åº“ã€ä¸‰æ–¹å‡½æ•°åº“(æ¯”å¦‚headless chrome(Puppeteer), pandoc, OCR library -- Tesseractç­‰ç­‰)æˆ–è€…ä½¿ç”¨è‡ªå®šä¹‰runtime(å¦‚å®˜æ–¹æœªæ”¯æŒçš„java11)çš„éœ€æ±‚ã€‚AWS Lambdaåœ¨åŽ»å¹´åº•å‘å¸ƒäº†Lambda layersåŠŸèƒ½æ¥æ»¡è¶³ä¸Šè¿°è¿™äº›å®žé™…å¼€å‘ä¸­çš„éœ€æ±‚ã€‚\næŽ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å°†å‰æ–‡ä¸­çš„å‡½æ•°ä¾èµ–æ”¾ç½®åˆ°ä¸€ä¸ªå•ç‹¬çš„layerä¸­ï¼Œä½œä¸ºä¸åŒå‡½æ•°çš„å…±äº«ä¾èµ–åº“ã€‚\nåœ¨æˆ‘ä»¬çš„æž„å»ºé…ç½®build.gradleä¸­ï¼Œå°†å‡½æ•°çš„å…±äº«ä¾èµ–æ‹·è´åˆ°java runtimeç‰¹å®šçš„ç›®å½•ç»“æž„java/lib/ä¸‹ï¼Œ\n153 154 155 156 157 tasks.register\u0026lt;Copy\u0026gt;(\u0026#34;depsLayer\u0026#34;) { into(\u0026#34;$buildDir/deps/java/lib\u0026#34;) from(configurations.compileClasspath.get()) from(configurations.runtimeClasspath.get()) } æŽ¥ä¸‹æ¥å°†å…±äº«çš„ä¾èµ–åˆ›å»ºä¸ºä¸€ä¸ªlambda layerï¼Œå¹¶ä¸”è®©callbackå‡½æ•°ä¾èµ–è¿™ä¸ªå…±äº«layerï¼Œä¸å†å°†æ‰€æœ‰çš„ä¾èµ–æ‰“åŒ…ä¸ºä¸€ä¸ªå¾ˆå¤§çš„éƒ¨ç½²åŒ…å‡å°æ¯æ¬¡å˜æ›´éœ€è¦å‘å¸ƒçš„åŒ…å¤§å°ã€‚\n31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 DependenciesLayer: Type: AWS::Serverless::LayerVersion Properties: LayerName: DingTalkDependencies Description: DingTalk Dependencies Layer ContentUri: \u0026#39;build/deps\u0026#39; CompatibleRuntimes: - java8 LicenseInfo: \u0026#39;Available under the MIT-0 license.\u0026#39; RetentionPolicy: Retain CallbackFunction: Type: AWS::Serverless::Function # More info about Function Resource: https://github.com/awslabs/serverless-application-model/blob/master/versions/2016-10-31.md#awsserverlessfunction Properties: CodeUri: build/libs/dingtalk-callback-1.0.0-SNAPSHOT.jar Handler: com.github.zxkane.dingtalk.Callback::handleRequest Layers: - !Ref DependenciesLayer Policies: åœ¨consoleæŸ¥çœ‹éƒ¨ç½²åŽçš„å‡½æ•°ï¼Œå¦‚ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°å‡½æ•°æ–°å¢žäº†ä¸€ä¸ªlayerã€‚\nåŒå…¶ä»–çš„è¯­è¨€ã€æŠ€æœ¯ä¸€æ ·ï¼ŒAwesome Layersé¡¹ç›®æ”¶é›†äº†ç›®å‰ä¸€äº›å¸¸ç”¨ä¸”ç»´æŠ¤è¾ƒå¥½çš„layerï¼Œè‡ªåˆ›è½®å­ä¹‹å‰å¯ä»¥å…ˆå‚è€ƒä¸‹\u0026#x1f600;ã€‚\nä½¿ç”¨layeråŒæ ·æœ‰ä»¥ä¸‹é™åˆ¶ï¼Œä½¿ç”¨å‰éœ€è¦æ³¨æ„ï¼Œ\nä¾èµ–çš„layeræ•°ä¸èƒ½è¶…è¿‡5ä¸ª å‡½æ•°ä»¥åŠä¾èµ–çš„æ‰€æœ‰layersè§£åŽ‹åŽä¸å¯ä»¥è¶…è¿‡250MB ","link":"https://kane.mx/posts/2019/aws-lambda-layers/","section":"posts","tags":["äº‘è®¡ç®—","FaaS","AWS","AWS Lambda","Serverless Computing"],"title":"AWS Lambda Layerå®žè·µ"},{"body":"","link":"https://kane.mx/tags/qcon/","section":"tags","tags":null,"title":"QCon"},{"body":"è¿™å‘¨å‚åŠ äº†QCon 2019åŒ—äº¬ç«™ï¼Œè¿™é‡Œè®°å½•ä¸‹éƒ¨åˆ†å°è±¡æ·±åˆ»çš„ä¸»é¢˜ä»¥åŠä¸ªäººæ„Ÿå—ã€‚\nQConæ˜¯ç”±InfoQä¸»åŠžçš„ç»¼åˆæ€§æŠ€æœ¯ç››ä¼šï¼Œä¸»é¢˜æ¶µç›–äº†å¤§å‰ç«¯ã€é«˜å¯ç”¨æž¶æž„ã€å®¹å™¨æŠ€æœ¯ã€å¤§æ•°æ®ã€æœºå™¨å­¦ä¹ ç­‰å„ç§çƒ­é—¨æŠ€æœ¯ä¸»é¢˜ã€‚å…¶ä¸­ä¹Ÿä¸ä¹ä¸‹ä¸€ä»£åˆ†å¸ƒå¼åº”ç”¨ã€æ··æ²Œå·¥ç¨‹ç­‰å‰æ²¿æœ‰æ„æ€çš„ä¸»é¢˜ï¼ŒåŽé¢ä¼šè¯¦ç»†ä»‹ç»ç›¸å…³çš„ä¸»é¢˜æ¼”è®²ã€‚\nå·¥ç¨‹æ•ˆçŽ‡æå‡ è¿™æ˜¯åœ¨QConç¬¬ä¸€æ—¥ä¸ªäººæ„Ÿå…´è¶£ä¸”éžå¸¸æœ‰æ„æ€çš„ä¸€ä¸ªç³»åˆ—ä¸»é¢˜ã€‚æ— è®ºæ˜¯åˆ›ä¸šå…¬å¸ã€ç‹¬è§’å…½ä¼ä¸šè¿˜æ˜¯äº’è”ç½‘å·¨å¤´éƒ½å¸Œæœ›ä¸æ–­æå‡å·¥ç¨‹æ•ˆçŽ‡ï¼Œ3ä¸ªç›¸å…³çš„åˆ†äº«åˆ†åˆ«æ¥è‡ªBATï¼Œå¯è§äº’è”ç½‘å·¨å¤´ä»¬å¯¹å›¢é˜Ÿæ•ˆçŽ‡æå‡çš„æ¸´æœ›å’Œé‡è§†ã€‚\n10å€é€ŸåŽŸåˆ™å¯¹å·¥ç¨‹ç”Ÿäº§åŠ›å»ºè®¾çš„æ–¹å‘æ€§å½±å“ è¿™ä¸ªtalkæ¥è‡ªè…¾è®¯çš„é«˜çº§é¡¾é—®ä¹”æ¢ï¼Œè¿™ä½è€å…„å·²ç»è¿žç»­10å¹´åœ¨QConä¸Šåˆ†äº«æŒç»­é›†æˆã€æŒç»­äº¤ä»˜ç­‰å·¥ç¨‹æ•ˆçŽ‡ç›¸å…³çš„ä¸»é¢˜äº†ï¼ä»–çš„æ¼”è®²å§‹äºŽå¯¹æˆåŠŸä¼ä¸šçš„ä¸€ä¸‡æ¬¡å®žéªŒæ³•åˆ™æ–¹æ³•è®ºï¼Œ è€Œå¤§é‡é«˜æ•ˆçš„å®žéªŒåŸºäºŽä¸€ä¸ªåŒçŽ¯æ¨¡åž‹çš„å¿«é€ŸéªŒè¯çŽ¯ã€‚ æœ€ç»ˆå·¥ç¨‹ç”Ÿäº§åŠ›æ˜¯ç”±å·¥ä½œæµç¨‹ã€æ”¯æ’‘å·¥å…·å’Œå·¥ç¨‹ç´ å…»ä¸‰æ–¹é¢ä¸€èµ·å†³å®šçš„ã€‚ éžå¸¸è®¤å¯å†³å®šå·¥ç¨‹æ•ˆçŽ‡çš„è¿™ä¸‰è¦ç´ ï¼Œä¸ªäººè®¤ä¸ºå·¥ç¨‹ç´ å…»æ˜¯å…¶ä»–ä¸¤ä¸ªè¦ç´ çš„åŸºçŸ³ï¼Œå¥ˆé£žæ–‡åŒ–æ‰‹å†Œä¸­å¼€ç¯‡å¼ºè°ƒçš„åªæ‹›è˜æˆå¹´äººå°±æ˜¯å¾ˆå¥½çš„è¯ é‡Šã€‚\nç™¾åº¦å·¥ç¨‹èƒ½åŠ›æå‡ä¹‹é“ è¿™ä¸ªåˆ†äº«æ¥è‡ªç™¾åº¦ç ”å‘æ•ˆèƒ½éƒ¨é—¨çš„äº§å“ç»ç†ï¼Œä»Žäººã€æŠ€ã€æ³•ä¸‰æ–¹é¢å¼ºè°ƒå·¥ç¨‹èƒ½åŠ›æå‡çš„ç­–ç•¥æ¨¡åž‹ã€‚å…¶å®žè¿™ä¸ªæ¨¡åž‹å°±æ˜¯å¯¹åº”ç€ä¸Šé¢ä¹”æ¢åˆ†äº«çš„å·¥ç¨‹ç”Ÿäº§åŠ›ä¸‰è¦ç´ ã€‚ å…³äºŽå¯¹å·¥ç¨‹å¸ˆçš„åŸ¹å…»å’ŒæŠ€æœ¯è§„èŒƒï¼Œç™¾åº¦å‘å¸ƒäº†\u0026quot;ç™¾åº¦å·¥ç¨‹å¸ˆæ‰‹å†Œ\u0026quot;ï¼Œæ®è¯´å¯ä»¥ä»Žç½‘ç»œä¸Šä¸‹è½½åˆ°ã€‚å¤§é‡å·¥å…·çš„ç»†èŠ‚åˆ†äº«æ¶‰åŠçš„éƒ½æ˜¯ç™¾åº¦å†…éƒ¨å·¥å…·ï¼Œä¸è¿‡å·¥å…·é’ˆå¯¹çš„æ€è·¯è¿˜æ˜¯å¯ä»¥å€Ÿé‰´çš„ã€‚\nèœé¸Ÿé›†å›¢ç ”å‘æ•ˆèƒ½å˜é©å®žè·µ è¿™ä¸ªåˆ†äº«æ¥è‡ªé˜¿é‡Œç³»çš„èœé¸Ÿé›†å›¢ï¼Œç‰¹åˆ«å¼ºè°ƒæ•°æ®åŒ–é©±åŠ¨çš„ç ”å‘æ•ˆèƒ½æå‡ï¼Œé‡Œé¢å¾ˆæœ‰æ„æ€çš„ä¸€ç‚¹æ˜¯å»ºç«‹æˆæœ¬æ¨¡åž‹æ¥è¯„ä¼°æ•ˆèƒ½çš„å¥½åã€‚\nä½œä¸ºæ•ˆèƒ½éƒ¨é—¨è´Ÿè´£äººï¼Œæœ‰æ•°æ®ç‰¹åˆ«æ˜¯æˆæœ¬æ•°æ®ï¼Œè®©é«˜å±‚ç®¡ç†è€…buy-inä½ çš„æƒ³æ³•ï¼Œè¿™åº”è¯¥æ˜¯ä¸ªéžå¸¸å¥½çš„è§’åº¦ã€‚\né«˜å¯ç”¨æž¶æž„ å£°æ˜Žå¼è‡ªæ„ˆç³»ç»Ÿâ€”â€”é«˜å¯ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„è®¾è®¡ä¹‹é“ è¿™ä¸ªåˆ†äº«æ¯”è¾ƒç†è®ºåŒ–çš„ä»‹ç»å£°æ˜Žå¼çš„ã€å¯è‡ªæ„ˆçš„åˆ†å¸ƒå¼ç³»ç»ŸåŽŸç†å’Œå®žè·µï¼Œå…¶å®žä¸šç•Œå·²ç»æœ‰ä¸ªéžå¸¸å¥½çš„å‚è€ƒå®žçŽ° -- å°±æ˜¯Kubernetes \u0026#x1f603;ã€‚\nè¶…å¤§è§„æ¨¡é«˜å¯ç”¨æ€§äº‘ç«¯ç³»ç»Ÿæž„å»ºä¹‹ç¦… è¿™æ˜¯ä¸€ä¸ªéžå¸¸å®žç”¨çš„å·¥ç¨‹å®žè·µåˆ†äº«ï¼Œåˆ—ä¸¾äº†å¤§é‡å¤§è§„æ¨¡äº‘åŽŸç”Ÿåº”ç”¨ä¸€å®šä¼šé¢ä¸´çš„æŒ‘æˆ˜ï¼Œä»¥åŠç®€å•åˆå®žç”¨çš„è§£å†³æ–¹æ³•ã€‚æ¯ä¸€ä¸ªäº‘åŽŸç”Ÿåº”ç”¨å¼€å‘è€…éƒ½åº”è¯¥çœ‹çœ‹è¿™ä¸ªslideï¼Œå­¦ä¹ å‰äººå®žè·µçš„ç»éªŒã€‚å¦å¤–ä¸ºè®²æ¼”è€…è”¡è¶…åšä¸ªæŽ¨å¹¿ï¼Œå¯¹Goè¯­è¨€æœ‰å…´è¶£çš„åŒå­¦ï¼Œå¯ä»¥è€ƒè™‘å­¦ä¹ è”¡è¶…çš„æžå®¢æ—¶é—´è¯¾ç¨‹Goè¯­è¨€ä»Žå…¥é—¨åˆ°å®žæˆ˜ã€‚\nè¿ç»´æž¶æž„ Kubernetes æ—¥å¿—å¹³å°å»ºè®¾æœ€ä½³å®žè·µ è¿™ä¸ªåˆ†äº«ä»‹ç»äº†Kubernetesä¸Šæ—¥å¿—æ–¹æ¡ˆçš„è§£å†³æ€è·¯ï¼ŒåŠå®ƒçš„å®žè·µ -- é˜¿é‡Œäº‘çš„æ—¥å¿—æœåŠ¡ã€‚å¯¹äºŽå¾ˆå¤šæœ‰åŸºç¡€æœåŠ¡å»ºè®¾çš„å›¢é˜Ÿå¯ä»¥ä½œä¸ºå¾ˆå¥½çš„å‚è€ƒæ–¹æ¡ˆã€‚å¯¹äºŽå·²ç»æ‰˜ç®¡åœ¨é˜¿é‡Œäº‘ä¸Šçš„åº”ç”¨ï¼Œå»ºè®®å°±ä¸è¦é‡å¤å»ºè®¾ä½Žç«¯çš„è½®å­äº†ï¼Œé˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡åº”è¯¥åšä¸ºå›¢é˜Ÿçš„é¦–é€‰ã€‚ä¸è®ºåœ¨æ€§èƒ½åŒå…¶ä»–äº‘æ‰˜ç®¡æœåŠ¡é›†æˆä¸Šï¼Œéƒ½è¿œè¿œå¥½äºŽè‡ªå»ºçš„æ–¹æ¡ˆã€‚\nå¤šäº‘ç®¡ä¸‹çš„è‡ªåŠ¨åŒ–è¿ç»´æž¶æž„ å¤šäº‘æ˜¯çŽ°åœ¨ä¸€äº›åŽ‚å•†åŠ›æŽ¨çš„è¯é¢˜ï¼Œä¸ªäººè®¤ä¸ºæ˜¯å¸‚åœºæŽ’åé åŽçš„æ€»è¦æ‰¾äº›æ–¹æ³•æ¥æå‡è‡ªå·±äº§å“çš„ç«žäº‰åŠ›\u0026#x1f60f;ã€‚åˆ†äº«è€…ä¼ä¸šåšäº†ä¸€å¥—opså¹³å°æ¥ç®¡ç†å¤šäº‘çš„èµ„æºï¼Œä»–ä»¬é€šè¿‡adapteræ–¹å¼æ¥å°†ä¸åŒäº‘åŽ‚å•†çš„å·®å¼‚å’Œèµ„æºè¿›è¡Œäº†æŠ½è±¡ã€‚è¿™å…¶ä¸­æ¶‰åŠå¤§é‡å¤„ç†äº§å“é—´å·®å¼‚æ€§å’Œè¢«åŠ¨é€‚é…çš„å·¥ä½œï¼Œä¸ªäººä¸å¤ªè®¤åŒè¿™ç§æ–¹å¼ã€‚å¹¶ä¸”ä¸¢æŽ‰äº†infra as codeè¿™ç±»é‡è¦çš„ç‰¹æ€§ï¼Œå¯¹äºŽæœ‰è¿™ç§éœ€æ±‚çš„å¤§åž‹ä¼ä¸šæ¥è¯´ä¸æ˜¯ä¸€ä¸ªå®Œç¾Žçš„æ–¹æ¡ˆã€‚\næ··æ²Œå·¥ç¨‹ æ··æ²Œå·¥ç¨‹è¿™ä¸ªè¯é¢˜éžå¸¸æœ‰æ„æ€ï¼ŒåŒæ—¶ä¹Ÿæ˜¯è¾ƒæ–°çš„ä¸€ç§å®žè·µå·¥ç¨‹ã€‚ä»Žæœ€æ—©çš„æå‡ºã€ç³»ç»Ÿå®žè·µåˆ°çŽ°åœ¨è¿˜ä¸åˆ°10å¹´æ—¶é—´ã€‚æ¥è‡ªé˜¿é‡Œå·´å·´çš„äº‘åŽŸç”Ÿæž¶æž„ä¸‹çš„æ··æ²Œå·¥ç¨‹å®žè·µå’ŒAWSçš„AWS äº‘ä¸Šæ··æ²Œå·¥ç¨‹å®žè·µä¹‹å¯¹ç…§å®žéªŒè®¾è®¡å’Œå®žæ–½ä¸¤ä¸ªåˆ†äº«ä»‹ç»äº†ä»Žæ··æ²Œå·¥ç¨‹çš„èµ·æºåˆ°å¦‚ä½•å…¨æ–¹ä½çš„å®žè·µç”¨äºŽæå‡äº‘åŽŸç”Ÿåº”ç”¨çš„\u0026quot;éŸ§æ€§\u0026quot;ï¼Œéžå¸¸å€¼å¾—å­¦ä¹ ã€‚è”¡è¶…çš„è¶…å¤§è§„æ¨¡é«˜å¯ç”¨æ€§äº‘ç«¯ç³»ç»Ÿæž„å»ºä¹Ÿæåˆ°äº†ä½¿ç”¨æ··æ²Œå·¥ç¨‹æ¥æå‡ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ï¼Œåœ¨äº‘åŽŸç”Ÿåº”ç”¨è¶Šæ¥è¶Šæ™®åŠçš„æƒ…å†µä¸‹ï¼Œè¢«åŠ¨çš„è®¾è®¡é«˜å¯ç”¨ç³»ç»Ÿè‚¯å®šä¸å¦‚ä¸»åŠ¨(ç”šè‡³æŒç»­çš„è‡ªåŠ¨åŒ–)å¯æŽ§çš„æ³¨å…¥æ··ä¹±æ¥é€æ¸æå‡ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€‚ç›®å‰chaos engineeringçš„å·¥å…·/å¹³å°æ”¯æŒè¿˜ä¸å¤ªå®Œå–„ï¼Œè¿™ä¸ªæ–¹å‘çœ‹èµ·æ¥æ˜¯æŠ€æœ¯åˆ›ä¸šå¾ˆå¥½çš„åˆ‡å…¥ç‚¹\u0026#x1f60f;ã€‚æœ€åŽåˆ‡è®°ä¸€ç‚¹ï¼Œæ··æ²Œå·¥ç¨‹æœ€ç»ˆä¸€å®šè¦åœ¨ç”Ÿäº§ç³»ç»Ÿä¸Šå®žæ–½ã€‚ ä¸‹ä¸€ä»£åˆ†å¸ƒå¼åº”ç”¨ è¿™ä¸ªä¸»é¢˜è™½è¯´å‘½åä¸ºä¸‹ä¸€ä»£åˆ†å¸ƒå¼åº”ç”¨ï¼Œä¸»è¦åˆ†äº«çš„å¤§å¤šæ˜¯æœåŠ¡é—´æµé‡æ²»ç†é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯Service Meshä¸‹å®žè·µç»éªŒã€‚å…¶ä¸­æ¥è‡ªé˜¿é‡ŒæŽäº‘çš„åˆ†å¸ƒå¼åº”ç”¨çš„æœªæ¥â€”â€”Distributionlessç‰¹åˆ«å€¼å¾—ä¸€æã€‚è¿™ä¸ªåˆ†äº«å¹¶æ²¡æœ‰å®žé™…çš„æ¡ˆä¾‹æˆ–ç»éªŒåˆ†äº«ï¼Œä»–é‡ç‚¹åˆ†äº«çš„æ˜¯å¯¹äºŽCloud Nativeæœ¬è´¨å’Œè¶‹åŠ¿çš„çœ‹æ³•ï¼Œè¿™äº›è§‚ç‚¹æˆ‘ä¸ªäººç‰¹åˆ«è®¤åŒ(å¥½åƒæ‰¾åˆ°çŸ¥éŸ³ä¼¼çš„:grinning:)ï¼å®Œæ•´çš„slideè¿™é‡Œä¸‹è½½ã€‚ ç”¨æˆ·å¢žé•¿ æ¥è‡ªäº‘æµ‹çš„é™ˆå† è¯šåœ¨æ™ºèƒ½ä¼˜åŒ– \u0026amp; A/B æµ‹è¯• - å®žéªŒé©±åŠ¨ç”¨æˆ·å¢žé•¿çš„ç†è®ºä¸ŽæŠ€æœ¯å®žè·µåˆ†äº«äº†A/Bæµ‹è¯•å®žéªŒå¯¹ç”¨æˆ·å¢žé•¿çš„ç†è®ºåŠå®žè·µï¼Œé¡ºä¾¿ä¹ŸæŽ¨å¹¿äº†ä»–å®¶äº‘æµ‹çš„A/Bæµ‹è¯•SaaSæœåŠ¡ã€‚å¬åœˆå†…çš„æœ‹å‹åˆ†äº«ï¼Œäº‘æµ‹çš„A/Bæµ‹è¯•æœåŠ¡ç¡®å®žæ¯”è¾ƒç®€å•å¥½ç”¨ï¼Œæ–¹ä¾¿äº§å“åŽå°åˆ›å»ºæµ‹è¯•å¹¶åˆ†æžç»“æžœï¼Œå¯¹å¢žé•¿æœ‰éœ€æ±‚çš„å°ä¼™ä¼´å¯ä»¥è€ƒè™‘ä½“éªŒä¸‹ï¼Œå‡å°‘ä¸å¿…è¦çš„é‡å¤å»ºè®¾è½®å­ã€‚\n","link":"https://kane.mx/posts/2019/2019-qconbeijing-reviews/","section":"posts","tags":["ä¼šè®®","QCon","DevOps","æž¶æž„","æ··æ²Œå·¥ç¨‹","å·¥ç¨‹æ•ˆçŽ‡"],"title":"QCon2019åŒ—äº¬ç«™å›žé¡¾"},{"body":"","link":"https://kane.mx/tags/%E4%BC%9A%E8%AE%AE/","section":"tags","tags":null,"title":"ä¼šè®®"},{"body":"","link":"https://kane.mx/tags/%E5%B7%A5%E7%A8%8B%E6%95%88%E7%8E%87/","section":"tags","tags":null,"title":"å·¥ç¨‹æ•ˆçŽ‡"},{"body":"","link":"https://kane.mx/tags/%E6%9E%B6%E6%9E%84/","section":"tags","tags":null,"title":"æž¶æž„"},{"body":"","link":"https://kane.mx/tags/%E6%B7%B7%E6%B2%8C%E5%B7%A5%E7%A8%8B/","section":"tags","tags":null,"title":"æ··æ²Œå·¥ç¨‹"},{"body":"","link":"https://kane.mx/tags/istio/","section":"tags","tags":null,"title":"Istio"},{"body":"","link":"https://kane.mx/tags/service-mesh/","section":"tags","tags":null,"title":"Service Mesh"},{"body":"","link":"https://kane.mx/tags/spring-cloud/","section":"tags","tags":null,"title":"Spring Cloud"},{"body":"åŸºäºŽJavaçš„Spring Cloudæ˜¯ç”±Javaæœ€å¤§å¼€æºç”Ÿæ€Springç¤¾åŒºæŽ¨å‡ºçš„Out-of-Boxåˆ†å¸ƒå¼å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡ª2016å¹´å‘å¸ƒèµ·å°±è¢«ä¼—å¤šå¼€å‘è€…çœ‹å¥½ã€‚Javaä½œä¸ºå¹¿ä¸ºæµè¡Œçš„æœåŠ¡ç«¯ç¼–ç¨‹è¯­è¨€ï¼ŒSpring Cloudä¹Ÿå°±è¶Šæ¥è¶Šå¤šçš„è¢«ç”¨äºŽå¾®æœåŠ¡å¼€å‘ã€‚\nSpring Cloudé›†æˆäº†Netflix OSSå¼€æºé¡¹ç›®å®žçŽ°äº†å¾ˆå¤šåŠŸèƒ½(æˆ–ä½œä¸ºå®žçŽ°ä¹‹ä¸€)ï¼ŒåŒ…æ‹¬æœåŠ¡æ²»ç†ã€ç½‘å…³è·¯ç”±ã€å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€æœåŠ¡é—´è°ƒç”¨ã€æ–­è·¯å™¨ç­‰ã€‚Spring Cloud Netflixå°†å¾ˆå¤šç”Ÿäº§çº§åˆ«å¾®æœåŠ¡èƒ½åŠ›å¼€ç®±å³ç”¨çš„å¸¦åˆ°äº†Spring Cloudæž¶æž„ä¸‹çš„å¾®æœåŠ¡ä¸­ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿçš„æž„å»ºæ»¡è¶³12è¦ç´ çš„åº”ç”¨ã€‚\nåœ¨åŽ»å¹´åº•å‘å¸ƒçš„Spring Cloud Greenwichç‰ˆæœ¬ä¸­å®£å¸ƒSpring Cloud Netflixä¸­é‡è¦çš„ç»„ä»¶Hystrixã€Ribbonã€Zuul 1ç­‰ç”±äºŽä¸Šæ¸¸å¼€æºé¡¹ç›®è¿›å…¥ç»´æŠ¤çŠ¶æ€ï¼Œå¯¹åº”çš„Spring Cloud Netflixé¡¹ç›®ä¹Ÿè¿›å…¥åˆ°ç»´æŠ¤çŠ¶æ€ã€‚è¿™äº›é¡¹ç›®å°†ä¸å†é€‚åˆç”¨äºŽé•¿æœŸç»´æŠ¤çš„äº§å“ä¸­ï¼\nåŒæ—¶éšç€è¿‘å¹´äº‘è®¡ç®—çš„å‘å±•ï¼Œç‰¹åˆ«æ˜¯Kubernetesæˆä¸ºå®¹å™¨ç¼–æŽ’å¹³å°çš„äº‹å®žæ ‡å‡†ï¼ŒåŠ ä¸ŠService Mesh(æœåŠ¡ç½‘æ ¼)å¯¹å¾®æœåŠ¡çš„æœåŠ¡æ²»ç†å’Œæµé‡æŽ§åˆ¶ï¼Œä¸ºäº‘åŽŸç”Ÿåº”ç”¨æä¾›äº†æ›´ä¸ºçŽ°ä»£ã€å¹³å°æ— å…³çš„è§£å†³æ–¹æ¡ˆã€‚\nè®©æˆ‘ä»¬é€ä¸€çœ‹çœ‹åœ¨KubernetesåŠ ä¸ŠSerivce Mesh(ä¾‹å¦‚Istio)å¦‚ä½•å®žçŽ°å¾®æœåŠ¡çš„æœåŠ¡å‘çŽ°ã€è·¯ç”±ã€é“¾è·¯è¿½è¸ªã€æ–­è·¯å™¨ç­‰åŠŸèƒ½ã€‚\né…ç½®ä¸­å¿ƒ Spring Cloud Configé»˜è®¤æä¾›äº†å¤šç§é…ç½®ç®¡ç†åŽç«¯ï¼Œä¾‹å¦‚Gitã€Vaultã€JDBC Backendç­‰ã€‚åŒæ—¶ä¹Ÿæœ‰å¾ˆå¤šå¼€æºæ–¹æ¡ˆå¯ä»¥ä½œä¸ºæ›¿æ¢æ–¹æ¡ˆï¼Œæ¯”å¦‚Alibaba Nacosã€‚\nä½œä¸ºéƒ¨ç½²åœ¨Kubernetesä¸­çš„åº”ç”¨ï¼Œæœ€ä½³å®žè·µæ˜¯å¹³è¡¡Configmapå’ŒSpring Cloud Configã€‚å°†æ¶‰åŠç¨‹åºåŠŸèƒ½çš„é…ç½®æ”¾ç½®åœ¨Configmapå’ŒSecretï¼ŒéšåŒå¾®æœåŠ¡çš„å‘å¸ƒä¸€èµ·åšç‰ˆæœ¬ç®¡ç†ï¼Œå¯ä»¥åšåˆ°éšç€åº”ç”¨å›žé€€çš„æ—¶å€™åŒæ—¶å›žé€€åˆ°åŽ†å²å¯¹åº”çš„é…ç½®ç‰ˆæœ¬ï¼Œè€Œä¸ä¼šå› ä¸ºåŽ†å²ç‰ˆæœ¬çš„ä»£ç è¢«æœ€æ–°ç‰ˆæœ¬çš„é…ç½®æ‰€ä¸­æ–­ã€‚Spring Cloud Kuberentesé¡¹ç›®å¾ˆå¥½çš„æ”¯æŒäº†Spring Cloudåº”ç”¨ä»ŽConfigmapå’ŒSecretä¸­è¯»å–é…ç½®é¡¹ã€‚è€Œæ¶‰åŠä¸šåŠ¡çš„é…ç½®é€‰é¡¹ï¼Œå°†å¯ä»¥è€ƒè™‘æ”¾åˆ°Spring Cloud ConfigåŽç«¯å®žçŽ°ç»Ÿä¸€ç®¡ç†ã€‚å¦‚æžœåº”ç”¨æ˜¯éƒ¨ç½²åœ¨é˜¿é‡Œäº‘ï¼Œä½¿ç”¨é˜¿é‡Œäº‘æ‰˜ç®¡çš„é…ç½®æœåŠ¡å’ŒSpring Cloud Config -- Nacoså°†æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚\næœåŠ¡å‘çŽ° Kubernetes Servicesæä¾›äº†é›†ç¾¤å†…åŽŸç”Ÿçš„æœåŠ¡å‘çŽ°èƒ½åŠ›ï¼Œæ˜¯Eurekaæˆ–Spring Cloud Zookeeperç­‰æœåŠ¡å‘çŽ°æœåŠ¡çš„å¾ˆå¥½æ›¿ä»£å“ã€‚åŸºäºŽK8S Servicesçš„æœåŠ¡å‘çŽ°ï¼Œå¾ˆå®¹æ˜“é€šè¿‡Service Meshèƒ½åŠ›å®žçŽ°é™æµã€A/Bæµ‹è¯•ã€é‡‘ä¸é›€å‘å¸ƒã€æ–­è·¯å™¨ã€chaosæ³¨å…¥ç­‰æœåŠ¡æ²»ç†èƒ½åŠ›ã€‚åŒæ—¶å¯¹å¾®æœåŠ¡åº”ç”¨æ¥è¯´ï¼Œä¸ç”¨åœ¨åº”ç”¨ç«¯æ·»åŠ å¯¹åº”ä¸‰æ–¹åº“æ¥å®žçŽ°æœåŠ¡æ³¨å†ŒåŠå‘çŽ°ï¼Œå‡å°‘äº†åº”ç”¨ç«¯å¼€å‘éœ€æ±‚ã€‚\nå„ç§æµé‡æ²»ç†åœºæ™¯ åº”ç”¨è¢«æœåŠ¡åŒ–åŽï¼Œä¸€å®šä¼šé¢ä¸´æµé‡æ²»ç†çš„é—®é¢˜ã€‚å¯¹äºŽå„ç§æœåŠ¡é—´å¦‚ä½•å®žçŽ°é™æµã€A/Bæµ‹è¯•ã€é‡‘ä¸é›€å‘å¸ƒã€æ–­è·¯å™¨ã€chaosæ³¨å…¥æµ‹è¯•ã€é“¾æŽ¥è¿½è¸ªç­‰ï¼Œè¿™å…¶å®žæ˜¯ä¸€ç±»é€šç”¨çš„é—®é¢˜ã€‚\nSpring Cloudæä¾›çš„æ˜¯ä¸€ç§å®¢æˆ·ç«¯è§£å†³æ€è·¯ï¼Œéœ€è¦æ¯ä¸ªåº”ç”¨å¼•å…¥å¯¹åº”åŠŸèƒ½çš„librariesçš„æ”¯æŒã€‚å³ä½¿é€šè¿‡spring boot starteræä¾›äº†è¿‘ä¼¼å¼€ç®±å³ç”¨çš„èƒ½åŠ›ï¼Œä½†æ˜¯æ¯ä¸ªåº”ç”¨ä»ç„¶éœ€è¦è‡ªè¡Œæ·»åŠ å¯¹åº”çš„èƒ½åŠ›ï¼Œç‰ˆæœ¬æ›´æ–°ã€å®‰å…¨æ¼æ´žfixç­‰åœºæ™¯éƒ½éœ€è¦æ‰‹åŠ¨å‡çº§ã€æµ‹è¯•ã€æ‰“åŒ…ã€éƒ¨ç½²ã€‚åœ¨å¼‚æž„ç¼–ç¨‹è¯­è¨€å®žçŽ°çš„å¾®æœåŠ¡æž¶æž„ä¸‹ï¼Œæœªå¿…æ¯ç§ç¼–ç¨‹æ¡†æž¶éƒ½èƒ½æä¾›å¾ˆå¥½çš„å¯¹åº”èƒ½åŠ›æ”¯æŒã€‚é™¤éžæœ‰ç‰¹åˆ«çš„æœåŠ¡æ²»ç†ç­–ç•¥ï¼Œä¸æŽ¨èåœ¨å¾®æœåŠ¡è‡ªèº«æ¥å®žçŽ°æœåŠ¡æµé‡çš„æŽ§åˆ¶ã€‚\nService Mesh(ä¾‹å¦‚Istioæˆ–Linkerd)ä»Žæ•´ä¸ªæœåŠ¡æ²»ç†å±‚é¢å¯¹ä¸Šè¿°éœ€æ±‚æä¾›äº†ç»Ÿä¸€çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œä¸éœ€è¦å¾®æœåŠ¡åšè‡ªèº«çš„å‡çº§æˆ–æ”¹åŠ¨ã€‚åœ¨åŸºäºŽKuberenteséƒ¨ç½²è¿è¡Œçš„å¾®æœåŠ¡åº”ç”¨ï¼ŒService Meshæä¾›äº†ç»Ÿä¸€çš„æœåŠ¡æ²»ç†æ–¹æ¡ˆï¼Œå°†ç”¨æˆ·ä»Žä¸åŒçš„å¾®æœåŠ¡ä¸­è‡ªèº«ç»´æŠ¤æœåŠ¡æ²»ç†åŠŸèƒ½ä¸­è§£æ”¾å‡ºæ¥ï¼Œä»Žå¹³å°å±‚é¢æä¾›æ›´åŠ ç»Ÿä¸€ä¸€è‡´çš„è§£å†³æ–¹æ¡ˆã€‚\nåœ¨åŽ»å¹´çš„SpringOne Platform 2018ä¸Šä¹Ÿæœ‰ä¸€ä¸ªTopic A Tale of Two Frameworks: Spring Cloud and Istio æŽ¢è®¨ä»€ä¹ˆåœºæ™¯åº”è¯¥ä½¿ç”¨Service Meshï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨Spring CloudæœåŠ¡æ²»ç†ç»„ä»¶ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹ä¸€çœ‹ã€‚\n","link":"https://kane.mx/posts/effective-cloud-computing/spring-cloud-or-cloud-native/","section":"posts","tags":["äº‘è®¡ç®—","kubernetes","spring","spring cloud","service mesh","istio"],"title":"Spring Cloud or Cloud Native"},{"body":"","link":"https://kane.mx/tags/iam/","section":"tags","tags":null,"title":"IAM"},{"body":"","link":"https://kane.mx/tags/oauth2/","section":"tags","tags":null,"title":"Oauth2"},{"body":"æœ¬æ–‡æ˜¯ä¸ºKubernetesä¸­ä»»æ„åº”ç”¨æ·»åŠ åŸºäºŽoauth2çš„è®¤è¯ä¿æŠ¤çš„ä¸‹ç¯‡ï¼Œå°†å›¾æ–‡è¯¦è§£å¦‚ä½•ä½¿ç”¨åŸºäºŽé’‰é’‰è®¤è¯çš„oauth2 proxyä¸ºè‡ªèº«æœ¬æ²¡æœ‰è®¤è¯æŽˆæƒåŠŸèƒ½çš„Webç«™ç‚¹å®žçŽ°è®¤è¯åŠæŽˆæƒã€‚\nç¤ºä¾‹æ˜¯ä½¿ç”¨çš„AWS EKSæœåŠ¡ä½œä¸ºK8SçŽ¯å¢ƒã€‚é‰´äºŽK8Sçš„åº”ç”¨è¿è¡Œæ—¶å±žæ€§ï¼Œè¯¥ç¤ºä¾‹ä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨å…¶ä»–äº‘åŽ‚å•†æ‰˜ç®¡çš„K8Sã€‚\nç¤ºä¾‹æ¨¡å—ç®€ä»‹ Nginx Ingress Controllerä¸ºK8Sé›†ç¾¤å†…Webåº”ç”¨æä¾›åå‘ä»£ç†ï¼Œä»¥åŠæ”¯æŒå¤–éƒ¨è®¤è¯ã€‚ ç®€å•çš„Webç«™ç‚¹ï¼ŒåŸºäºŽNginx dockerå®¹å™¨ã€‚è¯¥ç«™ç‚¹é»˜è®¤æ²¡æœ‰è®¤è¯åŠæŽˆæƒåŠŸèƒ½ï¼Œä½¿ç”¨å¤–éƒ¨é’‰é’‰åº”ç”¨ä½œä¸ºè®¤è¯åŠæŽˆæƒã€‚ OAuth2 Proxy on Dingtalkæä¾›åŸºäºŽé’‰é’‰åº”ç”¨çš„æ‰«ç è®¤è¯åŠæŽˆæƒï¼Œåªæœ‰è®¤è¯ä¸”æŽˆæƒçš„ç”¨æˆ·æ‰å¯ä»¥è®¿é—®ä¸Šé¢çš„Webç«™ç‚¹ã€‚ é»˜è®¤è®¾å®š Webç«™ç‚¹åŸŸåweb.kane.mx è®¤è¯æœåŠ¡åŸŸåoauth.kane.mx å‡†å¤‡AWS EKSçŽ¯å¢ƒ åˆ›å»ºEKSé›†ç¾¤ã€‚ç”±äºŽNginx IngressæœåŠ¡æ˜¯LoadBalancerç±»åž‹ï¼ŒEKSåˆ›å»ºNLBæˆ–ELBå¯¹åº”çš„targetsæ—¶éœ€è¦targetséƒ¨ç½²åœ¨public VPC subnetsï¼Œæ‰€ä»¥ä¸ºäº†ç®€åŒ–éƒ¨ç½²EKSé›†ç¾¤çš„VPC subnetséƒ½é€‰æ‹©public subnetã€‚æ–°å»ºçš„EKSé›†ç¾¤å…è®¸å…¬å¼€è®¿é—®ã€‚ æœ¬åœ°å®‰è£…é…ç½®kubectl, aws-iam-authenticatorç”¨äºŽè¿œç¨‹ç®¡ç†é›†ç¾¤ã€‚ ä¸ºé›†ç¾¤æ·»åŠ workerèŠ‚ç‚¹ã€‚ é…ç½®Helméƒ¨ç½²çŽ¯å¢ƒã€‚ é’‰é’‰åº”ç”¨å‡†å¤‡ ä¸ºä¼ä¸šæˆ–ç»„ç»‡å¼€é€šé’‰é’‰å¼€å‘å¹³å° åˆ›å»ºä¸€ä¸ªæ–°çš„ç§»åŠ¨åº”ç”¨ã€‚å›žè°ƒåŸŸåå¡«å†™\u0026lt;http or https\u0026gt;/\u0026lt;è®¤è¯æœåŠ¡åŸŸå\u0026gt;/oauth2/callbackã€‚è®°å½•ä¸‹æ¥åº”ç”¨çš„appIdå’ŒappSecretã€‚ åˆ›å»ºä¸€ä¸ªä¼ä¸šå†…éƒ¨å·¥ä½œå°åº”ç”¨ã€‚åœ°å€å¯ä»¥éšæ„è®¾ç½®ã€‚æœåŠ¡å™¨å‡ºå£IPè®¾ç½®ä¸ºEKSé›†ç¾¤ä¸­å·¥ä½œèŠ‚ç‚¹çš„å…¬ç½‘IPæˆ–è€…NAT EIPï¼Œå–å†³äºŽå·¥ä½œèŠ‚ç‚¹å¦‚ä½•è®¿é—®Internetã€‚å¹¶è®°å½•ä¸‹æ¥åº”ç”¨appKeyå’ŒappSecretã€‚ éƒ¨ç½²ç¤ºä¾‹åº”ç”¨ å…‹éš†ç¤ºä¾‹éƒ¨ç½²è„šæœ¬ã€‚ æ›¿æ¢values.yamlä¸­çš„dingtalk_corpidä¸ºå·¥ä½œå°åº”ç”¨çš„appKeyï¼Œ dingtalk_corpsecretä¸ºå·¥ä½œå°åº”ç”¨çš„appSecretã€‚ ç”±äºŽç¤¾åŒºç»´æŠ¤çš„oauth2-proxy chartså¹¶ä¸æ”¯æŒdingtalkæ‰©å±•çš„SECRET ENVï¼Œæ‰€ä»¥å°†å¯†é’¥é…ç½®åˆ°äº†configmapä¸­ã€‚ç”¨äºŽç”Ÿäº§çŽ¯å¢ƒçš„è¯ï¼Œå»ºè®®æŒ‰è¿™ä¸ªcommitä½¿ç”¨secretä¿å­˜åº”ç”¨secretã€‚ 62 63 64 65 66 67 68 69 70 71 72 oauth2-proxy: config: clientID: aaa clientSecret: bbb cookieSecret: ccc configFile: |+ email_domains = [ \u0026#34;*\u0026#34; ] cookie_domain = \u0026#34;kane.mx\u0026#34; cookie_secure = false dingtalk_corpid = \u0026#34;\u0026lt;appkey of dingtalk app\u0026gt;\u0026#34; dingtalk_corpsecret = \u0026#34;\u0026lt;appsecret of dingtalk app\u0026gt;\u0026#34; å¦‚æžœä»…å¸Œæœ›ä¼ä¸šéƒ¨åˆ†éƒ¨é—¨çš„å‘˜å·¥å¯ä»¥èŽ·å¾—æŽˆæƒï¼Œåœ¨ä¸Šé¢configFileé…ç½®ä¸‹æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œ 1dingtalk_departments = [\u0026#34;xxå…¬å¸/äº§å“æŠ€æœ¯ä¸­å¿ƒ\u0026#34;,\u0026#34;xxå…¬å¸/éƒ¨é—¨2/å­éƒ¨é—¨3\u0026#34;] æ›¿æ¢éƒ¨ç½²åº”ç”¨çš„åŸŸåä¸ºä½ çš„åŸŸåã€‚ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…Helméƒ¨ç½²ä¾èµ–ã€‚ 1helm dep up æ‰§è¡Œä»¥ä¸‹å‘½ä»¤éƒ¨ç½²nginx ingress controller, webåº”ç”¨ä»¥åŠoauth2 proxy 1helm upgrade --install -f values.yaml --set oauth2-proxy.config.clientID=\u0026lt;ç§»åŠ¨åº”ç”¨appid\u0026gt;,oauth2-proxy.config.clientSecret=\u0026lt;ç§»åŠ¨åº”ç”¨appsecret\u0026gt; site-with-auth --wait ./ å¦‚æžœé›†ç¾¤ä¸­å·²ç»éƒ¨ç½²äº†Nginx Ingress Controllerï¼Œä¿®æ”¹values.yamlå¦‚ä¸‹å°†å¿½ç•¥éƒ¨ç½²Nginx ingressï¼Œ 47 48 49 50 51 52 53 affinity: {} nginx-ingress: enabled: false controller: ingressClass: nginx config: éƒ¨ç½²æˆåŠŸåŽï¼ŒèŽ·å–ELBåœ°å€ã€‚ 1kubectl get svc -o jsonpath=\u0026#39;{ $.status.loadBalancer.ingress[*].hostname }\u0026#39; \u0026lt;deployment name\u0026gt;-nginx-ingress-controller;echo 2a3afe672259c511e98e2a0a0d88fda3e-xx.elb.ap-southeast-1.amazonaws.com éƒ¨ç½²æˆåŠŸåŽé…ç½® å°†ç«™ç‚¹å’ŒoauthæœåŠ¡åŸŸåè§£æžåˆ°ä¸Šé¢éƒ¨ç½²åˆ›å»ºçš„ELBä¸Šã€‚\næµ‹è¯• è®¿é—®Webç«™ç‚¹(å¦‚æœ¬ç¤ºä¾‹ä¸­çš„http://web.kane.mx)ï¼ŒæœªæŽˆæƒçš„æƒ…å†µä¸‹ï¼Œè°ƒè½¬åˆ°é’‰é’‰åº”ç”¨æ‰«ç ç™»å½•ç•Œé¢ã€‚ä½¿ç”¨ç»„ç»‡å†…æˆå‘˜çš„é’‰é’‰æ‰«ç æŽˆæƒåŽï¼Œå°†è·³è½¬å›žWebç«™ç‚¹åº”ç”¨ï¼Œå¯ä»¥æ­£å¸¸æµè§ˆè¯¥åŸŸåä¸‹çš„é¡µé¢ã€‚\n","link":"https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part2/","section":"posts","tags":["äº‘è®¡ç®—","IAM","kubernetes","oauth2","é’‰é’‰","dingtalk","AWS","AWS EKS"],"title":"ä¸ºKubernetesä¸­ä»»æ„åº”ç”¨æ·»åŠ åŸºäºŽoauth2çš„è®¤è¯ä¿æŠ¤ (ä¸‹)"},{"body":"ç”±äºŽä¼ä¸šå†…éƒ¨ç®¡ç†çš„éœ€è¦ï¼Œç”¨åˆ°äº†é’‰é’‰çš„ä¸šåŠ¡äº‹ä»¶å›žè°ƒèƒ½åŠ›ï¼Œæ­£å¥½å°†è¿™ä¸ªè½»é‡çº§çš„æŽ¥å£ä½¿ç”¨æ— æœåŠ¡å™¨æŠ€æœ¯æ¥å®žçŽ°éƒ¨ç½²ï¼Œä»¥åº”å¯¹æµé‡æ— è§„å¾‹ä¸‹çš„åŠ¨æ€æ‰©å±•ä¼¸ç¼©ã€æŒ‰éœ€ä½¿ç”¨ã€æŒ‰é‡è®¡è´¹ç­‰éœ€æ±‚ã€‚\né˜¿é‡Œäº‘å‡½æ•°è®¡ç®—ç‰ˆæœ¬ ç”±äºŽå…¬å¸ç³»ç»Ÿéƒ¨ç½²åœ¨é˜¿é‡Œäº‘ï¼Œé¦–å…ˆé€‰æ‹©ä½¿ç”¨é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—æ¥å®žçŽ°åŠéƒ¨ç½²ã€‚è¯¥æŽ¥å£ä½¿ç”¨äº†JVMä¸Šè¯­è¨€Kotlinå¼€å‘ï¼Œè™½ç„¶é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—å®˜æ–¹æ”¯æŒçš„å¼€å‘è¯­è¨€æœ‰Javaä½†æ²¡æœ‰Kotlinã€‚å…¶å®žæ— è®ºJavaæˆ–Kotlinæœ€ç»ˆéƒ¨ç½²æ–‡ä»¶éƒ½æ˜¯Java Classå­—èŠ‚ç ï¼ŒåŠ ä¸ŠKotlinä¸ŽJavaè‰¯å¥½çš„äº’æ“ä½œæ€§ï¼Œå®žæµ‹å‡½æ•°è®¡ç®—å¯ä»¥å®Œç¾Žæ”¯æŒKotlinå¼€å‘(ä¸ªäººè®¤ä¸ºä»»æ„JVMä¸Šçš„å¼€å‘è¯­è¨€éƒ½æ˜¯æ”¯æŒçš„)ã€‚\nåŒæ—¶è¯¥å‡½æ•°ä½¿ç”¨äº†è¡¨æ ¼å­˜å‚¨æ¥æŒä¹…åŒ–å›žè°ƒäº‹ä»¶ã€‚è¡¨æ ¼å­˜å‚¨æ˜¯ä¸ªæŒ‰é‡è®¡è´¹çš„åˆ†å¸ƒå¼å­˜å‚¨ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡ŒæŸ¥é˜…æ–‡æ¡£äº†è§£æ›´å¤šã€‚\nè¯¥å‡½æ•°é€šè¿‡APIç½‘å…³å’Œè¡¨æ ¼å­˜å‚¨è§¦å‘å™¨æ¥è§¦å‘ã€‚è®¿é—®æ—¥å¿—å’Œæ‰§è¡Œæ—¥å¿—è¢«å­˜å‚¨åœ¨æ—¥å¿—æœåŠ¡ä¸­ã€‚\nå‡½æ•°çš„æœ¬åœ°æµ‹è¯•å’Œçº¿ä¸Šéƒ¨ç½²ï¼Œä½¿ç”¨äº†å‡½æ•°è®¡ç®—æä¾›çš„å‘½ä»¤è¡Œå·¥å…·Funã€‚åŸºäºŽFunå®šä¹‰çš„é˜¿é‡Œäº‘Serverlessæ¨¡åž‹å®žçŽ°äº†å¯¹å‡½æ•°ä»¬ä½¿ç”¨èµ„æºçš„å£°æ˜Žå’Œç¼–æŽ’ï¼Œé›†æˆGitlab CIå®žçŽ°äº†å‡½æ•°çš„CI/CDè‡ªåŠ¨åŒ–å‘å¸ƒæµç¨‹ã€‚\nä¸æ¶‰åŠå…¬å¸ä¸šåŠ¡çš„ä»£ç å·²å¼€æºåœ¨Githubï¼Œæœ‰å…´è¶£çš„å¯ä»¥ä½œä¸ºå‚è€ƒã€‚\nç›®å‰å‡½æ•°è®¡ç®—å’Œè¡¨æ ¼å­˜å‚¨æœ‰å„è‡ªçš„å…è´¹é…é¢ï¼Œåœ¨ä¸šåŠ¡é‡ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œè¯¥æœåŠ¡å®Œå…¨å…è´¹ã€‚\nAWS Lambdaç‰ˆæœ¬ AWS Lambdaæ˜¯ç›®å‰å…¨çƒä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„serverlessæœåŠ¡ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å‡½æ•°è®¡ç®—å‘å±•æ–¹å‘çš„å¼•é¢†è€…ã€‚\nç”±äºŽä¸€äº›ä¸ªäººåŽŸå› ï¼Œç¬”è€…æœ€è¿‘æŽ¥è§¦äº†éƒ¨åˆ†AWSæœåŠ¡ï¼ŒåŒæ—¶å°è¯•å°†é’‰é’‰å›žè°ƒå‡½æ•°ç§»æ¤åˆ°äº†AWS Lambdaä¸Šã€‚é˜¿é‡Œäº‘ä¸Šä½¿ç”¨çš„äº‘æœåŠ¡æ”¹ä¸ºç”±AWSä¸Šå¯¹åº”æœåŠ¡æ¥å®žçŽ°ï¼Œä¾‹å¦‚å­˜å‚¨ä½¿ç”¨äº†DynamoDBï¼Œæ—¥å¿—ä½¿ç”¨CloudWatchæ”¶é›†å’ŒæŸ¥è¯¢ã€‚\næœ¬åœ°æµ‹è¯•å’Œéƒ¨ç½²å·¥å…·ï¼Œä½¿ç”¨çš„æ˜¯SAM CLIï¼ŒæŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ä½¿ç”¨çš„æ˜¯AWS CodeBuildå’ŒAWS CodePipelineã€‚æ­¤å¤–AWSé€šè¿‡AWS CloudFormationæä¾›ä¸€ç§éžå¸¸å¼ºå¤§çš„èƒ½åŠ›ï¼Œå¯ä»¥å°†AWSä¸Šçš„å„ç§èµ„æºé€šè¿‡é…ç½®å£°æ˜Žçš„æ–¹å¼æ¥ç®¡ç†(ä¹Ÿå°±æ˜¯çŽ°åœ¨éžå¸¸çƒ­é—¨çš„ä¸€ä¸ªæ¦‚å¿µ--Infrastructure as Code)ã€‚AWS CloudFormationä¼šä¸ºæ¯æ¬¡ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºçš„å˜æ›´ç”ŸæˆChangeSetï¼Œæä¾›æŸ¥çœ‹å¯¹æ¯”ã€ç‰ˆæœ¬ç®¡ç†ã€é‡åˆ°å˜æ›´é”™è¯¯æ•´ä½“å›žé€€ç­‰èƒ½åŠ›ã€‚æ‰€ä»¥ï¼ŒAWSç‰ˆæœ¬ä¹Ÿå°†è¯¥é¡¹ç›®çš„CI/CDéƒ¨ç½²ç”¨åˆ°çš„AWS CodeBuildã€AWS CodePipelineã€Amazon DynamoDBç­‰èµ„æºé€šè¿‡CloudFormationçš„é…ç½®ç®¡ç†èµ·æ¥ã€‚\né…ç½®ä»£ç æ®µå¦‚ä¸‹ï¼Œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 Description: Create a CodePipeline to include Github source, CodeBuild and Lambda deployment. Parameters: AppBaseName: Type: String Description: App base name Default: dingtalk-callback ArtifactStoreS3Location: Type: String Description: Name of the S3 bucket to store CodePipeline artificat. BranchName: Description: GitHub branch name Type: String Default: master RepositoryName: Description: GitHub repository name Type: String Default: dingtalk-callback-on-aws GitHubOAuthToken: Type: String NoEcho: true Resources: BuildDingtalkProject: Type: AWS::CodeBuild::Project Properties: Name: Fn::Sub: ${AppBaseName}-build-${AWS::StackName} Description: Build, test, package dingtalk callback project ServiceRole: Fn::GetAtt: [ CodeBuildRole, Arn ] Artifacts: Type: S3 Location: Ref: ArtifactStoreS3Location Name: Fn::Sub: ${AppBaseName}-build-${AWS::StackName} NamespaceType: BUILD_ID Path: Fn::Sub: ${AppBaseName}/artifacts Packaging: NONE OverrideArtifactName: true EncryptionDisabled: true Environment: Type: LINUX_CONTAINER ComputeType: BUILD_GENERAL1_SMALL Image: aws/codebuild/java:openjdk-11 PrivilegedMode: false ImagePullCredentialsType: CODEBUILD EnvironmentVariables: - Name: s3_bucket Value: Ref: ArtifactStoreS3Location Source: DingtalkCallbackPipeline: Type: \u0026#39;AWS::CodePipeline::Pipeline\u0026#39; Properties: Name: Fn::Sub: ${AppBaseName}-pipeline-${AWS::StackName} RoleArn: Fn::GetAtt: [ CodePipelineRole, Arn ] Stages: - Name: Source Actions: - Name: SourceAction ActionTypeId: Category: Source Owner: ThirdParty Version: 1 Provider: GitHub OutputArtifacts: - Name: Fn::Sub: ${AppBaseName}-source-changed Configuration: Owner: !Ref GitHubOwner Repo: !Ref RepositoryName Branch: !Ref BranchName OAuthToken: !Ref GitHubOAuthToken PollForSourceChanges: false RunOrder: 1 - Name: Build Actions: - Name: Build_Test_Package InputArtifacts: - Name: Fn::Sub: ${AppBaseName}-source-changed ActionTypeId: Category: Build Owner: AWS Version: 1 Provider: CodeBuild OutputArtifacts: - Name: Fn::Sub: ${AppBaseName}-packaged-yml Configuration: ProjectName: Ref: BuildDingtalkProject RunOrder: 1 AWSç‰ˆæœ¬å®Œæ•´çš„ä»£ç ã€CloudFormationé…ç½®ä»¥åŠéƒ¨ç½²æ–‡æ¡£å¯ä»¥é€šè¿‡è¿™é‡ŒæŸ¥çœ‹ã€‚\n","link":"https://kane.mx/posts/effective-cloud-computing/serverless-dingtalk-callback/","section":"posts","tags":["äº‘è®¡ç®—","FaaS","é˜¿é‡Œäº‘","å‡½æ•°è®¡ç®—","AWS","AWS Lambda","é’‰é’‰","dingtalk","Serverless Computing"],"title":"åŸºäºŽå‡½æ•°è®¡ç®—çš„é’‰é’‰å›žè°ƒå‡½æ•°æŽ¥å£"},{"body":"Serverless Computing(æ— æœåŠ¡å™¨è®¡ç®—)æ˜¯ç›®å‰æœ€è¢«çœ‹å¥½çš„äº‘ç«¯è®¡ç®—æ‰§è¡Œæ¨¡åž‹ã€‚å…¶æœ€å¤§çš„å¥½å¤„æ˜¯æä¾›åˆ†å¸ƒå¼å¼¹æ€§å¯ä¼¸ç¼©çš„è®¡ç®—æ‰§è¡ŒçŽ¯å¢ƒï¼Œä»…ä¸ºå®žé™…ä½¿ç”¨èµ„æºä»˜è´¹ï¼Œå¹¶ä¸”å°†åº”ç”¨ç»´æŠ¤è€…ä»Žå¸¸è§„çš„è¿ç»´äº‹åŠ¡ä¸­è§£æ”¾å‡ºæ¥ï¼Œæ›´åˆ©äºŽä¸“æ³¨åˆ°å…·ä½“çš„ä¸šåŠ¡ä¸Šã€‚\nåœ¨ä¸»æµçš„åº”ç”¨éƒ¨ç½²æ–¹å¼ä¸‹ï¼Œæ— è®ºæ˜¯ä½¿ç”¨äº‘ä¸»æœºè¿˜æ˜¯Kubernetesä½œä¸ºè¿è¡ŒçŽ¯å¢ƒï¼Œéƒ½ä¼šæœ‰å¤§é‡è¿ç»´å±‚é¢çš„äº‹åŠ¡éœ€è¦è€ƒè™‘å’Œå¤„ç†ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºéœ€è¦æŒ‰ç…§åˆ†å¸ƒå¼ç¨‹åºçš„è®¾è®¡å‡†åˆ™æ¥åº”å¯¹åº”ç”¨çš„æ°´å¹³ä¼¸ç¼©ã€‚åŒæ—¶éšç€äº‘è®¡ç®—æœåŠ¡çš„å‘å±•å’Œå®Œå–„ï¼Œäº‘è®¡ç®—åŽ‚å•†æä¾›äº†è¶Šæ¥è¶Šå¤šçš„åŸºç¡€æœåŠ¡ï¼Œä¾‹å¦‚APIç½‘å…³ã€å¯¹è±¡å­˜å‚¨ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ—¥å¿—ã€ç›‘æŽ§ç­‰æœåŠ¡ï¼Œå‡½æ•°è®¡ç®—å¯ä»¥å®Œç¾Žçš„åŒå…¶ä»–äº‘æœåŠ¡é›†æˆï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå®žçŽ°å‡ºç”Ÿäº§çº§åˆ«çš„å¼¹æ€§å¯ä¼¸ç¼©çš„åº”ç”¨ã€‚\né‚£å‡½æ•°è®¡ç®—æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹é˜¿é‡Œäº‘å¯¹äºŽå‡½æ•°è®¡ç®—çš„å®šä¹‰ã€‚\né˜¿é‡Œäº‘å‡½æ•°è®¡ç®—æ˜¯äº‹ä»¶é©±åŠ¨çš„å…¨æ‰˜ç®¡è®¡ç®—æœåŠ¡ã€‚é€šè¿‡å‡½æ•°è®¡ç®—ï¼Œæ‚¨æ— éœ€ç®¡ç†æœåŠ¡å™¨ç­‰åŸºç¡€è®¾æ–½ï¼Œåªéœ€ç¼–å†™ä»£ç å¹¶ä¸Šä¼ ã€‚å‡½æ•°è®¡ç®—ä¼šä¸ºæ‚¨å‡†å¤‡å¥½è®¡ç®—èµ„æºï¼Œä»¥å¼¹æ€§ã€å¯é çš„æ–¹å¼è¿è¡Œæ‚¨çš„ä»£ç ï¼Œå¹¶æä¾›æ—¥å¿—æŸ¥è¯¢ã€æ€§èƒ½ç›‘æŽ§ã€æŠ¥è­¦ç­‰åŠŸèƒ½ã€‚å€ŸåŠ©äºŽå‡½æ•°è®¡ç®—ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿæž„å»ºä»»ä½•ç±»åž‹çš„åº”ç”¨å’ŒæœåŠ¡ï¼Œæ— éœ€ç®¡ç†å’Œè¿ç»´ã€‚è€Œä¸”ï¼Œæ‚¨åªéœ€è¦ä¸ºä»£ç å®žé™…è¿è¡Œæ‰€æ¶ˆè€—çš„èµ„æºä»˜è´¹ï¼Œä»£ç æœªè¿è¡Œåˆ™ä¸äº§ç”Ÿè´¹ç”¨ã€‚\nåŸºäºŽå‡½æ•°è®¡ç®—çš„ç‰¹ç‚¹ï¼Œå¯ä»¥å¾ˆå¥½æ»¡è¶³ä»¥ä¸‹éœ€æ±‚ï¼Œ\nä¸šåŠ¡æµé‡ä¸ç¡®å®šæˆ–æœ‰æ˜Žç»†çš„å‘¨æœŸæ€§ æž„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿç»éªŒä¸è¶³ æ— éœ€è¿ç»´ æŒ‰éœ€è®¡ç®— è®¡è´¹çµæ´» ç”±äºŽå‡½æ•°è®¡ç®—çš„æ‰©å±•èƒ½åŠ›ï¼Œå¯¹è¿ç»´çš„è¦æ±‚æžå°‘ï¼ŒæŒ‰é‡è®¡è´¹ç­‰ç‰¹æ€§ç”¨äºŽéœ€è¦å¿«é€ŸéªŒè¯çš„æ—©æœŸé¡¹ç›®ä¹Ÿæ˜¯éžå¸¸å¥½çš„åœºæ™¯ã€‚\nä¸‹é¢è¿™ä¸ªslideæ˜¯è¿‘æœŸé’ˆå¯¹é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—åšçš„åˆ†äº«ã€‚\n","link":"https://kane.mx/posts/effective-cloud-computing/serverless-computing-101/","section":"posts","tags":["äº‘è®¡ç®—","FaaS","é˜¿é‡Œäº‘","å‡½æ•°è®¡ç®—","Serverless Computing"],"title":"æ— æœåŠ¡å™¨è®¡ç®—101"},{"body":"ä¼ä¸šéšç€ä¸šåŠ¡çš„å‘å±•ï¼Œå¿…ç„¶ä¼šéƒ¨ç½²å„ç§å„æ ·çš„ITç³»ç»Ÿã€‚å‡ºäºŽå®‰å…¨æ€§çš„è€ƒè™‘ï¼Œä¸€äº›ç³»ç»Ÿä»…å¯ä¼ä¸šå†…éƒ¨ä½¿ç”¨ï¼Œç”šè‡³ä»…å¼€æ”¾ç»™ä¼ä¸šéƒ¨åˆ†éƒ¨é—¨å‘˜å·¥ä½¿ç”¨ã€‚\nè¿™äº›ITç³»ç»Ÿå¤§è‡´å¯åˆ†ä¸ºä¸¤ç±»ï¼Œ\nç³»ç»Ÿæœ¬èº«ä¸æ”¯æŒä»»ä½•è®¤è¯æœºåˆ¶ï¼Œä¾‹å¦‚èµ„è®¯æˆ–æ–‡æ¡£ç±»ç³»ç»Ÿã€‚éœ€è¦å¢žåŠ è®¤è¯ä¿æŠ¤ï¼Œèƒ½å¤Ÿé™åˆ¶éžä¼ä¸šå‘˜å·¥è®¿é—®å³å¯ã€‚ç³»ç»Ÿè¿ç»´é€šå¸¸çš„åšæ³•æ˜¯ï¼Œä¸ºç«™ç‚¹è®¾ç½®HTTP Basicè®¤è¯ä¿æŠ¤ã€‚ç”±äºŽHTTP Basicè®¤è¯æ˜¯é€šè¿‡é¢„è®¾çš„ç”¨æˆ·ã€å¯†ç è®¤è¯ï¼Œè®¤è¯ä¿¡æ¯æ¯”è¾ƒå®¹æ˜“æ³„éœ²ã€‚å³ä½¿å®šæœŸæ›´æ¢å¯†ç ï¼Œä½†éœ€è¦é¢å¤–çš„æœºåˆ¶é€šçŸ¥ç”¨æˆ·å¯†ç çš„å˜æ›´ï¼Œç”¨æˆ·ä½“éªŒä¹Ÿä¸å¥½ã€‚ ç³»ç»Ÿè‡ªèº«æ”¯æŒè®¤è¯ï¼Œç”šè‡³æ”¯æŒå¤šç§è®¤è¯æœºåˆ¶ã€‚æ¯”å¦‚æœ€å¸¸ç”¨çš„å¼€æºCI/CDå·¥å…·ï¼ŒJenkinså†…ç½®æ”¯æŒæœ¬åœ°æ•°æ®åº“è®¤è¯ã€é€šè¿‡æ’ä»¶æ”¯æŒå¤šç§ç¬¬ä¸‰æ–¹ç³»ç»Ÿé›†æˆè®¤è¯ã€‚å¦‚æžœå¤§é‡çš„ITç³»ç»Ÿéƒ½æœ‰ä¸€å¥—ç‹¬ç«‹çš„ç”¨æˆ·ç®¡ç†ï¼Œéšç€ä¼ä¸šçš„å‘˜å·¥çš„å˜æ›´ï¼Œç”¨æˆ·çš„å¢žåˆ ç­‰æ“ä½œå¯¹ç³»ç»Ÿç®¡ç†å‘˜æ¥è¯´æ˜¯ä¸å°çš„å·¥ä½œé‡ã€‚åŒæ—¶ï¼Œä¹Ÿå¾ˆå®¹æ˜“ç”±äºŽäººä¸ºç–å¿½ï¼Œé€ æˆèµ„äº§ã€æ•°æ®çš„å®‰å…¨éšæ‚£ã€‚ å‡è®¾ä¼ä¸šè‡ªèº«å·²ç»æœ‰äº†ä¸€å¥—OAç³»ç»ŸåŒ…å«å‘˜å·¥ã€ç»„ç»‡ç»“æž„ç®¡ç†ï¼Œä¾‹å¦‚ï¼Œå›½å†…ç›®å‰æœ€ä¸ºæ™®åŠæµè¡Œçš„é’‰é’‰æˆ–ä¼ä¸šå¾®ä¿¡ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥æä¾›ä¸€å¥—åŸºäºŽoauth 2.0åè®®çš„è®¤è¯æ–¹å¼ï¼Œè®©ä»¥ä¸Šä¸¤ç±»ITç³»ç»Ÿä½¿ç”¨ä¼ä¸šå·²æœ‰çš„OAç³»ç»Ÿ(é’‰é’‰æˆ–ä¼ä¸šå¾®ä¿¡)æ¥å®žçŽ°ç™»å½•è®¤è¯ã€‚åšåˆ°è¿™ä¸€ç‚¹åŽï¼Œä¼ä¸šæ— è®ºæœ‰å¤šå°‘ITç³»ç»Ÿéƒ½ä¸å†éœ€è¦é¢å¤–ç®¡ç†ç”¨æˆ·çš„æˆæœ¬ï¼Œå¹¶ä¸”ä¹Ÿé¿å…äº†æ•°æ®å®‰å…¨éšæ‚£ã€‚\né’‰é’‰é€šè¿‡é’‰é’‰å¼€æ”¾å¹³å°æä¾›çš„APIå¼€æ”¾äº†è®¸å¤šé’‰é’‰å†…éƒ¨çš„èƒ½åŠ›ï¼Œä¾‹å¦‚ï¼Œèº«ä»½éªŒè¯ã€é€šè®¯å½•ç®¡ç†ç­‰ç­‰ã€‚ç„¶è€Œé’‰é’‰çš„ä¸‰æ–¹ç½‘ç«™ç™»å½•æŽ¥å£å¹¶ä¸æ˜¯æ ‡å‡†çš„oauth 2.0åè®®å®žçŽ°ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€ä¸ªoauth2 proxyä»£ç†å·¥å…·å®žçŽ°å°†é’‰é’‰çš„ä¸‰æ–¹ç½‘ç«™ç™»å½•å…¼å®¹oauth2åè®®ã€‚åŒç†ï¼Œä½¿ç”¨è¿™ä¸ªoauth2ä»£ç†å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨Googleã€Facebookç­‰ä¸‰æ–¹ç½‘ç«™ä½œä¸ºç»Ÿä¸€è®¤è¯æ–¹å¼ã€‚\næœ‰äº†åŸºäºŽé’‰é’‰çš„oauth2ä»£ç†ä½œä¸ºä¼ä¸šç»Ÿä¸€ç™»å½•æ–¹å¼ï¼Œå¯¹äºŽä¸Šé¢ä¸¤å¤§ç±»ç³»ç»Ÿçš„è®¤è¯éœ€æ±‚è§£å†³æ–¹æ¡ˆåˆ†åˆ«å¦‚ä¸‹ï¼Œ\néƒ¨ç½²åœ¨Kubernetesä¸­æ— å†…ç½®è®¤è¯æœºåˆ¶çš„Webåº”ç”¨ï¼Œé€šè¿‡nginx-ingressçš„å¤–éƒ¨OAUTHè®¤è¯å®žçŽ°åŸºäºŽoauth2çš„å®‰å…¨è®¤è¯ã€‚ Jenkinså¯ä»¥é€šè¿‡åå‘ä»£ç†æ’ä»¶å®žçŽ°ä½¿ç”¨oauth2è®¤è¯ç™»å½•ã€‚ åœ¨ä¸‹ç¯‡ä¸­ï¼Œæˆ‘ä»¬å°†å›¾æ–‡è¯¦è§£å¦‚ä½•ä¸€æ­¥æ­¥å®žçŽ°ä¸ºä¸€ä¸ªæ— è®¤è¯çš„ä¼ä¸šæ–‡æ¡£Webåº”ç”¨æ·»åŠ åŸºäºŽé’‰é’‰çš„ç»Ÿä¸€è®¤è¯ã€‚\n","link":"https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part1/","section":"posts","tags":["äº‘è®¡ç®—","IAM","kubernetes","oauth2","é’‰é’‰","dingtalk"],"title":"ä¸ºKubernetesä¸­ä»»æ„åº”ç”¨æ·»åŠ åŸºäºŽoauth2çš„è®¤è¯ä¿æŠ¤ (ä¸Š)"},{"body":"ä¼ä¸šä½¿ç”¨å…¬æœ‰äº‘æœåŠ¡çš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯åˆ›å»ºäº‘å¸å·ï¼Œæœ‰äº†å¸å·ä¹‹åŽå¦‚ä½•è®©ä¼ä¸šå‘˜å·¥å®‰å…¨åˆè§„çš„ä½¿ç”¨äº‘å¸å·ä¸‹çš„å„ç§èµ„æºæ˜¯å¼€å¯äº‘ä¹‹æ—…åŽçš„ç¬¬ä¸€ä¸ªè€ƒéªŒã€‚\näº‘è®¡ç®—åŽ‚å•†é’ˆå¯¹ä¼ä¸šä¸Šäº‘åŽé¢ä¸´çš„ç¬¬ä¸€ä¸ªéœ€æ±‚å·²ç»æŽ¨å‡ºäº†å®Œå–„çš„è§£å†³æ–¹æ¡ˆ--Identity and Access Managementã€‚IAMå¯ä»¥å¸®åŠ©äº‘å¸å·å®‰å…¨åœ°æŽ§åˆ¶å¯¹äº‘è®¡ç®—æœåŠ¡èµ„æºçš„è®¿é—®ã€‚ä¼ä¸šå¯ä»¥ä½¿ç”¨IAMæŽ§åˆ¶å¯¹å“ªä¸ªç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ (ç™»å½•) å’ŒæŽˆæƒ (å…·æœ‰æƒé™) ä»¥ä½¿ç”¨èµ„æºã€‚\näº‘åŽ‚å•†æ˜¯å¦æä¾›å®Œå–„çš„IAMæœåŠ¡å¯ä»¥ä½œä¸ºæ•´ä½“äº§å“è§£å†³æ–¹æ¡ˆæ˜¯å¦æˆç†Ÿçš„ä¸€ä¸ªè¡¡é‡æŒ‡æ ‡ï¼Œæ¯”å¦‚AWSçš„IAMå’Œé˜¿é‡Œäº‘çš„è®¿é—®æŽ§åˆ¶éƒ½æ˜¯è¾ƒä¸ºæˆç†Ÿå®Œå–„çš„äº§å“ã€‚å›½å†…æŸä¸ªä»¥AIèƒ½åŠ›ä¸ºå–ç‚¹çš„äº‘åŽ‚å•†ï¼Œåœ¨IAMäº§å“æ–¹é¢å‡ ä¹Žä¸ºé›¶ï¼Œå¾ˆéš¾ç›¸ä¿¡å¯¹å®‰å…¨åˆè§„æœ‰éœ€æ±‚çš„ä¼ä¸šä¼šå®Œæ•´ä½¿ç”¨ä»–çš„äº‘äº§å“ä½œä¸ºè§£å†³æ–¹æ¡ˆã€‚\nIAMé€šå¸¸æä¾›ä»¥ä¸‹åŠŸèƒ½:\nå¯¹äº‘è´¦æˆ·çš„å…±äº«è®¿é—®æƒé™ å…è®¸åœ¨ä¸€ä¸ªäº‘è´¦æˆ·ä¸‹åˆ›å»ºå¹¶ç®¡ç†å¤šä¸ªç”¨æˆ·èº«ä»½ï¼Œå¹¶å…è®¸ç»™å•ä¸ªèº«ä»½æˆ–ä¸€ç»„èº«ä»½ï¼ˆæ—¢å¯ä»¥æ˜¯å½“å‰äº‘å¸å·ä¸‹ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–äº‘å¸å·ä¸‹ï¼‰åˆ†é…ä¸åŒçš„æƒé™ç­–ç•¥ï¼Œä»Žè€Œå®žçŽ°ä¸åŒç”¨æˆ·æ‹¥æœ‰ä¸åŒçš„äº‘èµ„æºè®¿é—®æƒé™ï¼Œè€Œä¸å¿…å…±äº«äº‘å¸å·æ ¹ç”¨æˆ·çš„å¯†ç æˆ–è®¿é—®å¯†é’¥ã€‚\nç²¾ç»†æƒé™ å¯ä»¥é’ˆå¯¹ä¸åŒèµ„æºå‘ä¸åŒäººå‘˜æŽˆäºˆä¸åŒæƒé™ã€‚å¯ä»¥è¦æ±‚ç”¨æˆ·å¿…é¡»ä½¿ç”¨å®‰å…¨ä¿¡é“ï¼ˆå¦‚ SSLï¼‰ã€åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´ã€æˆ–åœ¨æŒ‡å®šæº IP æ¡ä»¶ä¸‹æ‰èƒ½æ“ä½œæŒ‡å®šçš„äº‘èµ„æºã€‚\nå¤šé‡éªŒè¯ (MFA) å¯ä»¥å‘äº‘è´¦æˆ·å’Œå„ä¸ªç”¨æˆ·æ·»åŠ åŒé‡èº«ä»½éªŒè¯ä»¥å®žçŽ°æ›´é«˜å®‰å…¨æ€§ã€‚å€ŸåŠ©MFAï¼Œç”¨æˆ·ä¸ä»…å¿…é¡»æä¾›ä½¿ç”¨è´¦æˆ·æ‰€éœ€çš„å¯†ç æˆ–è®¿é—®å¯†é’¥ï¼Œè¿˜å¿…é¡»æä¾›æ¥è‡ªç»è¿‡ç‰¹æ®Šé…ç½®çš„è®¾å¤‡çš„ä»£ç ã€‚\nè”åˆèº«ä»½ å¯ä»¥å…è®¸å·²åœ¨å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œåœ¨ä¼ä¸šç½‘ç»œä¸­æˆ–é€šè¿‡ Internet èº«ä»½æä¾›å•†ï¼‰èŽ·å¾—å¯†ç çš„ç”¨æˆ·èŽ·å–å¯¹äº‘è´¦æˆ·çš„ç”¨æˆ·è®¿é—®æƒé™ã€‚\nåŽé¢ä¼šæœ‰ä¸“é—¨çš„æ–‡ç« æ¥è®²å¦‚ä½•å®žè·µè”åˆèº«ä»½ã€‚\nç»Ÿä¸€è´¦å• äº‘è´¦æˆ·æŽ¥æ”¶åŒ…æ‹¬æ‰€æœ‰ç”¨æˆ·çš„èµ„æºæ“ä½œæ‰€å‘ç”Ÿè´¹ç”¨çš„ç»Ÿä¸€è´¦å•ã€‚\nå°½ç®¡IAMæä¾›äº†ä¸Šé¢ç§ç§åŠŸèƒ½ï¼Œäº‘å¸å·çš„ç®¡ç†è€…ä»å¯é€šè¿‡ä¸€äº›æœ€ä½³å®žè·µæ¥æ›´å¥½çš„ä½¿ç”¨IAMäº§å“æ¥æå‡å®‰å…¨çº§åˆ«å’Œå‡å°‘è¿ç»´æˆæœ¬ã€‚\nIAMæœ€ä½³å®žè·µ å°½é‡ä¸è¦ä½¿ç”¨äº‘å¸å·çš„æ ¹ç”¨æˆ·ï¼Œä¸è¦ä¸ºæ ¹ç”¨æˆ·åˆ›å»ºAKã€‚äº‘å¸å·ç®¡ç†å‘˜ä¹Ÿä½¿ç”¨å„è‡ªç‹¬ç«‹çš„å­è´¦å·ã€‚ ä¸ºä¼ä¸šä¸­æ¯ä¸€ä¸ªéœ€è¦ä½¿ç”¨äº‘æœåŠ¡çš„å‘˜å·¥å•ç‹¬åˆ›å»ºå­è´¦æˆ·ï¼Œä¸”é»˜è®¤ä¸å…è®¸åˆ›å»ºAKã€‚ä¾¿äºŽå‘˜å·¥ç¦»èŒçš„æ—¶å€™ï¼Œé€šè¿‡åˆ é™¤å¸å·æ¥å®Œå…¨æ¸…ç†ç”¨æˆ·åœ¨äº‘è®¡ç®—å¹³å°çš„å„ç§æƒé™ã€‚ å¯†ç å®‰å…¨å®žè·µï¼Œ é™åˆ¶å¯†ç å¼ºåº¦ä¸å°‘äºŽ8ä½ï¼Œå¿…é¡»ç”±å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç¬¦å·ä¸­çš„ä¸‰ç§ç»„æˆã€‚ å¼ºåˆ¶å¯†ç è¿‡æœŸæ—¶é—´ä¸è¶…è¿‡90å¤©ï¼Œä¸”è¿‡æœŸåŽä¸å¯ç™»å½•ã€‚ æ–°å¯†ç è‡³å°‘ç¦æ­¢ä½¿ç”¨å‰3æ¬¡å¯†ç ã€‚ è®¾ç½®å¯†ç é‡è¯•çº¦æŸï¼Œä¾‹å¦‚ï¼Œä¸€å°æ—¶å†…ä½¿ç”¨é”™è¯¯å¯†ç æœ€å¤§å°è¯•9æ¬¡ç™»å½•ã€‚ å¼ºåˆ¶æ‰€æœ‰ç”¨æˆ·å¯ç”¨ä¸¤æ­¥è®¤è¯ã€‚ å¯¹è®¿é—®ç½‘ç»œæœ‰é™åˆ¶çš„ä¼ä¸šï¼Œå¯ä»¥å¼€å¯ç™»å½•IPé™åˆ¶ã€‚ [æŽ¨èåšæ³•]å·²æœ‰SSOå•ç‚¹ç™»å½•ç³»ç»Ÿçš„ä¼ä¸šï¼Œå¯ä»¥é€šè¿‡SAML 2.0æ ‡å‡†å®žçŽ°ä»Žä¼ä¸šæœ¬åœ°è´¦å·ç³»ç»Ÿç™»å½•åˆ°é˜¿é‡Œäº‘ï¼Œä»Žè€Œæ»¡è¶³ä¼ä¸šçš„ç»Ÿä¸€ç”¨æˆ·ç™»å½•è®¤è¯è¦æ±‚ã€‚ ç»†ç²’åº¦çš„æƒé™ç®¡ç†ï¼Œ ä¸ºå„ç§äº‘èµ„æºåˆ›å»ºæœ€ç»†ç²’åº¦çš„æƒé™ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œåˆ†åˆ«ä¸ºRDSå®žä¾‹rds-instance-1åˆ›å»ºåªè¯»æƒé™ç­–ç•¥rds-instance-1-readonly-accessï¼ŒRDSå®žä¾‹rds-instance-2åˆ›å»ºåªè¯»æƒé™ç­–ç•¥rds-instance-2-readonly-accessã€‚ æ ¹æ®èŒèƒ½ã€éƒ¨é—¨ç­‰ç»´åº¦ä¸ºäº‘å¸å·å­ç”¨æˆ·åˆ›å»ºç”¨æˆ·ç»„ã€‚ä¾‹å¦‚ï¼ŒæŒ‰é¡¹ç›®åˆ›å»ºç”¨æˆ·ç»„ï¼Œgroup-project-aï¼Œgroup-project-bã€‚å¦‚æžœproject-aç”¨æˆ·éœ€è¦è®¿é—®rds-instance-1çš„ä¿¡æ¯ï¼Œå°†è‡ªå®šä¹‰æƒé™rds-instance-1-readonly-accessæŽˆæƒç»™group-project-aã€‚å†å°†ç›¸å…³ç”¨æˆ·åŠ åˆ°ç”¨æˆ·ç»„group-project-aä¸­ï¼Œè¿™æ ·è¿™äº›ç”¨æˆ·å°±å…·æœ‰åªè¯»è®¿é—®RDSå®žä¾‹rds-instance-1çš„æƒé™ã€‚è€Œä¸æ˜¯å°†æ‰€æœ‰RDSçš„è¯»å†™æƒé™éƒ½æŽˆäºˆè¿™äº›ç”¨æˆ·ï¼Œæœ€å¤§é™åº¦çš„ä¿è¯ç”¨æˆ·ä¸èŽ·å–è¶…è¿‡å®žé™…éœ€è¦çš„æƒé™ã€‚ åœ¨å®žé™…åœºæ™¯ä¸­ï¼Œé€šå¸¸ä¼šé€šè¿‡äº‘è®¡ç®—æœåŠ¡çš„APIæ¥å®ŒæˆæŸäº›å‘¨æœŸæ€§ä»»åŠ¡ï¼Œæ¯”å¦‚æ¯æ—¥RDSä¸­çš„æ…¢æŸ¥è¯¢ç»Ÿè®¡ã€äº‘å¸å·æ¯æ—¥èŠ±è´¹ç»Ÿè®¡ç­‰ã€‚è¿™äº›ä»»åŠ¡éƒ½éœ€è¦ä¸€ä¸ªäº‘å¸å·çš„AKæ¥å®ŒæˆAPIçš„èº«ä»½è®¤è¯ã€‚æœ€ä½³çš„åšæ³•æ˜¯ï¼Œä¸ºæ¯ç±»ç›¸å…³çš„ä»»åŠ¡åˆ›å»ºä¸€ä¸ªåŠŸèƒ½æ€§å­è´¦å·ï¼Œç¦ç”¨ä»–ä»¬çš„webç™»å½•ï¼Œä¸”éµå¾ªç‰¹æ®Šçš„å‘½åè§„èŒƒ(functional-å¼€å¤´)ï¼Œæ¯”å¦‚functional-rds-statsã€functional-cost-statsã€‚åˆ›å»ºæœ€å°çš„æƒé™ç­–ç•¥ï¼Œç„¶åŽåˆ†é…ç»™è¿™äº›åŠŸèƒ½æ€§ç”¨æˆ·ã€‚ä¾‹å¦‚ï¼Œfunctional-rds-statsä»…è¢«æŽˆäºˆRDSåªè¯»æƒé™ï¼Œfunctional-cost-statsä»…è¢«æŽˆäºˆè´¹ç”¨çš„åªè¯»æƒé™ã€‚ä¸ºè¿™äº›å­è´¦å·åˆ›å»ºAKï¼Œæ¯ç±»ä»»åŠ¡ä½¿ç”¨ä¸åŒçš„AKæ¥å®ŒæˆAPIè®¤è¯ï¼Œè€Œä¸æ˜¯éƒ½ä½¿ç”¨åŒä¸€ä¸ªAKã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œä¸åŒç±»åž‹ä»»åŠ¡çš„AKå…·æœ‰ä¸åŒçš„æƒé™ï¼Œæœ€å¤§é™åº¦çš„ä¿æŠ¤äº†äº‘å¸å·çš„å®‰å…¨ï¼Œå¹¶ä¸”è¿™äº›AKä¸è·Ÿå®žé™…çš„å‘˜å·¥å­è´¦å·å…³è”ï¼Œä¸ä¼šå› ä¸ºå‘˜å·¥å¸å·çš„å˜æ›´è€Œå—å½±å“ã€‚å¦‚æœ‰æ›´é«˜çš„å®‰å…¨åˆè§„çš„è¦æ±‚ä¸‹ï¼Œå¯ä»¥å®šæœŸä½œåºŸå·²æœ‰AKï¼Œåˆ›å»ºæ–°AKæ›¿æ¢ã€‚è‡³äºŽAKæ€Žæ ·å®‰å…¨ç®¡ç†ï¼Œä¹‹åŽä¼šæœ‰ä¸“é—¨çš„æ–‡ç« æ¥è¯¦è§£ã€‚ ","link":"https://kane.mx/posts/effective-cloud-computing/iam-best-practice/","section":"posts","tags":["äº‘è®¡ç®—","é˜¿é‡Œäº‘","AWS","IAM"],"title":"IAMæœ€ä½³å®žè·µ"},{"body":"è¿™æ˜¯â€œå¦‚ä½•é«˜æ•ˆä½¿ç”¨äº‘æœåŠ¡â€ç³»åˆ—æ–‡ç« çš„é¦–ç¯‡åˆ†äº«ã€‚å¯èƒ½æœ‰æœ‹å‹å¥½å¥‡ä¸ºä»€ä¹ˆä¸æ˜¯ä»Žäº‘è®¡ç®—æœ€åŸºç¡€çš„æœåŠ¡--è®¡ç®—èµ„æºECS/EC2è®²èµ·å‘¢ï¼Ÿåœ¨Cloud Nativeå·²ç»è¢«è¶Šæ¥è¶ŠæŽ¥å—çš„ä»Šå¤©ï¼ŒåŸºäºŽKuberneteséƒ¨ç½²ã€ç¼–æŽ’åº”ç”¨çš„æ–¹å¼å·²ç»æ˜¯ä¸šç•Œçš„äº‹å®žæ ‡å‡†ã€‚æ— è®ºæ˜¯äº’è”ç½‘å·¨å¤´ï¼Œä¼ ç»Ÿ500å¼ºä¼ä¸šï¼Œè¿˜æ˜¯åˆ›ä¸šå›¢é˜Ÿéƒ½åœ¨ä½¿ç”¨æˆ–è§„åˆ’ä½¿ç”¨Kubernetesä½œä¸ºåº”ç”¨ç¨‹åºçš„è‡ªåŠ¨åŒ–éƒ¨ç½²ã€å¯æ‰©å±•ç®¡ç†å¹³å°ã€‚åœ¨äº‘è®¡ç®—å¹³å°ï¼Œè™šæ‹Ÿæœºè¶Šæ¥è¶Šä¸éœ€è¦å•ç‹¬çš„ç®¡ç†ï¼Œåœ¨ç»å¤§å¤šæ•°çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå®ƒä»¬åªæ˜¯ä½œä¸ºå®¹å™¨é›†ç¾¤æ‰€ç®¡ç†çš„è®¡ç®—èµ„æºã€‚ç”šè‡³è™šæ‹Ÿæœºçš„åˆ›å»ºåˆ°é”€æ¯æ•´ä¸ªç”Ÿå‘½å‘¨æœŸç®¡ç†éƒ½å¯ä»¥ç”±Kubernetesæ ¹æ®é›†ç¾¤çš„è´Ÿè½½æ¥è‡ªåŠ¨å®Œæˆã€‚\næ‰€æœ‰ä¸»æµçš„äº‘è®¡ç®—åŽ‚å•†éƒ½åœ¨è§£å†³æ–¹æ¡ˆä¸­åŠ›æŽ¨æ‰˜ç®¡çš„Kubernetesï¼ŒAWSçš„EKSï¼ŒAzureä¸Šçš„AKSï¼Œå½“ç„¶å°‘ä¸äº†Googleå®¶GCPä¸Šçš„Kubernetes Engineã€‚å›½å†…é˜¿é‡Œäº‘ï¼Œè…¾è®¯äº‘ç­‰æ¯ä¸€ä¸ªå…¬æœ‰äº‘çŽ©å®¶ä¹Ÿéƒ½åŸºäºŽå¼€æºKubernetesæŽ¨å‡ºäº†æ‰˜ç®¡æœåŠ¡ã€‚å¦‚æžœä¸€å®¶äº‘è®¡ç®—åŽ‚å•†åœ¨æä¾›æ‰˜ç®¡Kubernetesè¿™ä¸€æœåŠ¡ä¸Šæ²¡è·Ÿä¸Šä¸šç•Œçš„æ­¥ä¼ï¼Œå°†æ¥æžå¤§å¯èƒ½è¢«æ·˜æ±°å‡ºè¿™ä¸ªå¸‚åœºã€‚\næ‰˜ç®¡çš„Kubernetesç±»åž‹ ä»¥å›½å†…çš„é˜¿é‡Œäº‘ä¸ºä¾‹ï¼Œç›®å‰æä¾›äº†ä¸¤å¤§ç±»ä¸‰ç§ä¸åŒçš„Kubernetesæ‰˜ç®¡æœåŠ¡ã€‚\nç»å…¸Dedicated Kubernetesæ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹ç”¨æˆ·å¯ä»¥é€‰æ‹©å®¿ä¸»æœºå®žä¾‹è§„æ ¼å’Œæ“ä½œç³»ç»Ÿï¼ŒæŒ‡å®šKubernetesç‰ˆæœ¬ã€è‡ªå®šä¹‰Kubernetesç‰¹æ€§å¼€å…³è®¾ç½®ç­‰ã€‚ç”¨æˆ·éœ€è¦æ‰‹åŠ¨ç»´æŠ¤é›†ç¾¤ï¼Œä¾‹å¦‚å‡çº§Kubernetesç‰ˆæœ¬ï¼Œå†…ç½®ç»„ä»¶ç‰ˆæœ¬ç­‰ã€‚å¯ä»¥æ‰‹åŠ¨æˆ–è‡ªåŠ¨ä¼¸ç¼©é›†ç¾¤èŠ‚ç‚¹æ•°ç›®ã€‚ç›®å‰è¯¥æ¨¡å¼ä¸‹æœ‰ä¸¤ç§ç±»åž‹ï¼Œç¬¬ä¸€ç§é›†ç¾¤ä¸»èŠ‚ç‚¹éœ€è¦ä½¿ç”¨ç”¨æˆ·çš„ECSï¼Œç”¨æˆ·å¯è¿œç¨‹ç™»å½•æˆ–ç®¡ç†è¿™äº›ECSã€‚å¦ä¸€ç§æ˜¯ï¼Œä¸»èŠ‚ç‚¹ä¹Ÿç”±äº‘åŽ‚å•†æ‰˜ç®¡ï¼Œç”¨æˆ·åªèƒ½é€šè¿‡API Serverç®¡ç†Kubernetesã€‚åœ¨è´¹ç”¨æ–¹é¢ï¼Œæ— è®ºæ˜¯å¦æ‰˜ç®¡é›†ç¾¤ä¸»èŠ‚ç‚¹ï¼Œé›†ç¾¤æœåŠ¡å…è´¹ï¼ŒæŒ‰ä½¿ç”¨çš„ECSå®žä¾‹åŠè®¡è´¹æ–¹å¼æ”¶è´¹ã€‚ Serverless æ¨¡å¼(ç›®å‰å…¬æµ‹ä¸­ï¼Œæš‚æ—¶å…è´¹)ã€‚æ— éœ€åˆ›å»ºåº•å±‚è™šæ‹ŸåŒ–èµ„æºï¼Œå¯ä»¥åˆ©ç”¨ Kubernetes å‘½ä»¤æŒ‡æ˜Žåº”ç”¨å®¹å™¨é•œåƒã€CPUå’Œå†…å­˜è¦æ±‚ä»¥åŠå¯¹å¤–æœåŠ¡æ–¹å¼ï¼Œç›´æŽ¥å¯åŠ¨åº”ç”¨ç¨‹åºã€‚æŒ‰å®¹å™¨ä½¿ç”¨çš„CPUå’Œå†…å­˜èµ„æºé‡è®¡è´¹ã€‚è¿™ç§æ¨¡å¼ä¸‹åº”è¯¥æ˜¯åœ¨ä¸€ä¸ªé›†ç¾¤å†…å®žçŽ°å¤šç§Ÿæˆ·ï¼Œç›®å‰æœ‰äº›featuresä¸è¢«æ”¯æŒã€‚ä¾‹å¦‚ï¼Œéƒ¨ç½²ä¸æ”¯æŒDaemonSetï¼ŒIngressä¸æ”¯æŒNodePortç±»åž‹ï¼Œå­˜å‚¨ä¸æ”¯æŒPVå’ŒPVCç­‰ã€‚ ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡ç±»åž‹æ¥é€‰æ‹©é€‚åˆçš„æ‰˜ç®¡Kubernetesé›†ç¾¤ã€‚å¦‚æžœéƒ¨ç½²çš„åº”ç”¨æ˜¯æ— çŠ¶æ€çš„WebæœåŠ¡ï¼Œå¯ä»¥é€‰æ‹©Serverless Kubernetesé›†ç¾¤ï¼Œè¿›ä¸€æ­¥å‡å°‘è¿ç»´å·¥ä½œé‡ã€‚\nå¦‚æžœç”¨æˆ·éƒ¨ç½²çš„åº”ç”¨æœ‰çŠ¶æ€ï¼Œéœ€è¦æŒ‚è½½å¤–éƒ¨å­˜å‚¨ï¼Œä¾‹å¦‚MongDBé›†ç¾¤ï¼ŒMQé›†ç¾¤ï¼Œå¯ä»¥é€‰æ‹©ç»å…¸Dedicated Kubernetesæ¨¡å¼ã€‚å¦‚æžœç”¨æˆ·éœ€è¦é€šè¿‡Kubernetesç»„ä»¶æ‰©å±•æˆ–è‡ªå®šä¹‰å®žçŽ°æŸäº›åŠŸèƒ½ï¼Œè¿™äº›éœ€æ±‚äº‘åŽ‚å•†çš„æ ‡å‡†ç‰ˆå¹¶æ²¡æœ‰æä¾›ï¼Œè¿™æ—¶å¯ä»¥é€‰æ‹©ç»å…¸Dedicated Kubernetesæ¨¡å¼ï¼Œåˆ©ç”¨Kubernetesé«˜åº¦çµæ´»çš„æ‰©å±•æœºåˆ¶æ¥æ»¡è¶³è‡ªå®šä¹‰éœ€æ±‚ã€‚\næ‰˜ç®¡Kuberentesçš„ä¼˜åŠ¿ å›½å†…çš„é˜¿é‡Œäº‘æœ‰ç¯‡æŠ€æœ¯æ–‡æ¡£å¯¹æ¯”é˜¿é‡Œäº‘Kubernetes vs. è‡ªå»ºKubernetesï¼Œæ–‡ç« çœ‹èµ·æ¥è™½ç„¶æœ‰åŽ‚å•†è‡ªå–è‡ªå¤¸çš„å«Œç–‘ã€‚ä½œä¸ºé˜¿é‡Œäº‘K8Sçš„å®¢æˆ·ï¼Œåœ¨ä½¿ç”¨æ‰˜ç®¡K8Sè¿‘ä¸€å¹´æ¥ï¼Œæ·±åˆ‡çš„ä½“ä¼šåˆ°äº‘åŽ‚å•†æ‰˜ç®¡K8Så¸¦æ¥çš„ç§ç§å¥½å¤„ï¼Œæ–‡æ¡£ä¸­æåˆ°çš„ç§ç§ä¼˜åŠ¿ç¡®å®žæ˜¯è¨€ä¹‹å‡¿å‡¿ã€‚\næŽ¥ä¸‹æ¥å…·ä½“çœ‹çœ‹äº‘åŽ‚å•†æ‰˜ç®¡K8Såˆ°åº•æœ‰å“ªäº›ä¼˜åŠ¿ã€‚\nä¾¿æ· é€šè¿‡Webç•Œé¢/APIä¸€é”®åˆ›å»ºKubernetesé›†ç¾¤ï¼Œé›†ç¾¤å‡çº§ã€‚ Webç•Œé¢/APIå®žçŽ°é›†ç¾¤çš„æ‰©å®¹æˆ–ç¼©å®¹ã€‚ é›†ç¾¤çš„å®‰è£…ï¼Œè¡¥ä¸ä»¥åŠå¸¸è§„ç‰ˆæœ¬å‡çº§åœ¨è¿ç»´å·¥ä½œä¸­å±žäºŽä½“åŠ›æ´»ã€‚åœ¨è§„æ¨¡ä¸å¤§çš„æ—¶å€™ï¼Œä½¿ç”¨äººå·¥å®žçŽ°éœ€è¦èŠ±è´¹ä¸å°‘æ—¶é—´å‡†å¤‡çŽ¯å¢ƒæµ‹è¯•éªŒè¯ï¼Œä¸”æ˜“é”™ã€‚å¦‚æžœé›†ç¾¤ä½“é‡ä¸å¤Ÿå¤§çš„è¯ï¼Œå¼€å‘è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬åˆæµªè´¹äººåŠ›æˆæœ¬ã€‚äº‘è®¡ç®—åŽ‚å•†çš„æ‰˜ç®¡K8Sé›†ç¾¤å°†æä¾›ä¸“ä¸šã€ç¨³å®šçš„æŠ€æœ¯è¿ç»´æœåŠ¡ï¼Œå’Œå‡ ä¹Žä¸ºé›¶çš„äººåŠ›æˆæœ¬ã€‚\nä»Žæ•ˆçŽ‡å’ŒäººåŠ›æˆæœ¬ä¸Šçœ‹ï¼Œæ‰˜ç®¡K8Sé›†ç¾¤å®Œèƒœè‡ªå»ºKubernetesé›†ç¾¤ã€‚\nåŠŸèƒ½æ›´å¼ºå¤§ Kubernetesä½œä¸ºä¸€ä¸ªå®¹å™¨ç¼–æŽ’ç³»ç»Ÿï¼Œå¼€æºç‰ˆæœ¬ä¸­è®¸å¤šç»„ä»¶æ²¡æœ‰é»˜è®¤å®žçŽ°æˆ–å®žçŽ°æœ‰é™ï¼Œéœ€è¦è·Ÿè¿è¡ŒçŽ¯å¢ƒ(å¦‚æ‰˜ç®¡K8Sçš„äº‘å¹³å°)é›†æˆã€‚ä¾‹å¦‚ï¼Œå­˜å‚¨ï¼ŒLoad Balancerï¼Œç½‘ç»œç­‰æ ¸å¿ƒç»„ä»¶ã€‚å®˜æ–¹æ–‡æ¡£Internal load balancerå°±æä¾›äº†åœ¨ä¸åŒçš„äº‘åŽ‚å•†çŽ¯å¢ƒä¸­çš„ä½¿ç”¨ç¤ºä¾‹ã€‚éƒ¨ç½²ä¸€ä¸ªå¼ºå¤§ä¸”å®Œæ•´çš„K8Sé›†ç¾¤éœ€è¦åŒè®¸å¤šäº‘è®¡ç®—çš„åŸºç¡€ç»„ä»¶é›†æˆ(ä¸”åªèƒ½é€šè¿‡APIå®Œæˆ)ï¼Œè¿™å¾€å¾€æ˜¯äº‘è®¡ç®—åŽ‚å•†çš„å¼ºé¡¹ã€‚\näº‘åŽ‚å•†æ‰˜ç®¡çš„K8Så¯ä»¥åœ¨ä»¥ä¸‹æ–¹é¢æä¾›å¼ºå¤§çš„äº‘è®¡ç®—å¹³å°æ”¯æŒï¼Œ\nç½‘ç»œ é«˜æ€§èƒ½ VPC ç½‘ç»œæ’ä»¶ã€‚ æ”¯æŒ network policy å’ŒæµæŽ§ã€‚ è´Ÿè½½å‡è¡¡ æ”¯æŒåˆ›å»ºå…¬ç½‘æˆ–å†…ç½‘è´Ÿè½½å‡è¡¡å®žä¾‹ï¼Œæˆ–è€…å¤ç”¨å·²æœ‰å®žä¾‹ã€‚æ”¯æŒæŒ‡å®šå¸¦å®½å¤§å°ã€è®¡è´¹æ–¹å¼ã€4å±‚æˆ–7å±‚åè®®ä»£ç†ç­‰äº‘åŽ‚å•†è´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚å¯¹åº”ç”¨è¿ç»´æ¥è¯´å¯ä»¥æŠŠè´Ÿè½½å‡è¡¡çš„é…ç½®é€šè¿‡ä»£ç å®žçŽ°ï¼Œå¹¶ä¸”æ”¯æŒç‰ˆæœ¬æŽ§åˆ¶ã€‚å¯¹æ¯”ä¼ ç»Ÿçš„äº‘ç«¯éƒ¨ç½²ï¼Œä¹Ÿå¯ä»¥å°†åº”ç”¨éƒ¨ç½²å’Œåº”ç”¨è¿ç»´é›†æˆåœ¨ä¸€èµ·ç»Ÿä¸€ç®¡ç†ï¼Œé¿å…åº”ç”¨å‘å¸ƒå’Œè¿ç»´é…ç½®çš„å‰²è£‚ï¼Œå‡å°‘äººä¸ºè¿ç»´å¤±è¯¯ã€‚\né˜¿é‡Œäº‘æ‰˜ç®¡K8Sçš„è´Ÿè½½å‡è¡¡è¯¦ç»†é…ç½®å¯ä»¥å‚è€ƒè¿™ä¸ªæ–‡æ¡£ï¼ŒAWSä¸Šè§æ­¤æ–‡æ¡£ã€‚\nå­˜å‚¨ é›†æˆäº†äº‘åŽ‚å•†çš„äº‘ç›˜ã€æ–‡ä»¶å­˜å‚¨NASã€å—å­˜å‚¨ç­‰å­˜å‚¨æ–¹æ¡ˆï¼ŒåŸºäºŽæ ‡å‡†çš„FlexVolumeé©±åŠ¨ï¼Œæä¾›äº†æœ€ä½³çš„æ— ç¼é›†æˆã€‚\nå¦‚æžœæ˜¯åœ¨äº‘åŽ‚å•†çš„è™šæ‹Ÿæœºä¸Šè‡ªå»ºKubernetesé›†ç¾¤ï¼Œé»˜è®¤æ— æ³•ä½¿ç”¨äº‘ä¸Šçš„å­˜å‚¨èµ„æºã€‚å¦‚æžœéœ€è¦åˆ©ç”¨äº‘åŽ‚å•†æä¾›çš„å­˜å‚¨æ–¹æ¡ˆï¼Œä¾‹å¦‚å¯¹è±¡å­˜å‚¨ï¼Œå°±éœ€è¦è‡ªè¡Œå¼€å‘åŸºäºŽFlexVolumeçš„é©±åŠ¨ã€‚åœ¨åŽ‚å•†æ‰˜ç®¡K8Så·²ç»å®Œç¾Žè§£å†³äº†å­˜å‚¨é›†æˆçš„é—®é¢˜ï¼Œä½•å¿…è‡ªå·±åˆåŽ»è´¹æ—¶è´¹åŠ›çš„å®šåˆ¶å¼€å‘å‘¢ï¼Ÿ\nå¯ä»¥çœ‹åˆ°ï¼Œäº‘åŽ‚å•†æ‰˜ç®¡çš„K8Sé›†ç¾¤åœ¨ç½‘ç»œã€è´Ÿè½½å‡è¡¡å’Œå­˜å‚¨ä¸Šæœ‰è®¸å¤šå¤©ç„¶çš„ä¼˜åŠ¿ã€‚åœ¨å…¶ä»–å‡ ä¸ªç»´åº¦ï¼Œæ‰˜ç®¡çš„K8Sé›†ç¾¤åŒæ ·ä¹Ÿä¼˜äºŽè‡ªå»ºçš„K8Sï¼Œ\nè¿ç»´ é›†æˆåŽ‚å•†çš„æ—¥å¿—æœåŠ¡ï¼Œç›‘æŽ§æœåŠ¡ã€‚ K8Sé›†ç¾¤cluster autoscalerè‡ªåŠ¨åˆ©ç”¨äº‘åŽ‚å•†çš„å¼¹æ€§ä¼¸ç¼©æ‰©ç¼©å®¹é›†ç¾¤èŠ‚ç‚¹ã€‚ é•œåƒä»“åº“ é«˜å¯ç”¨ï¼Œæ”¯æŒå¤§å¹¶å‘ã€‚ æ”¯æŒé•œåƒåŠ é€Ÿã€‚ æ”¯æŒ p2p åˆ†å‘ã€‚ å¯é›†æˆäº‘å¹³å°çš„ç”¨æˆ·æƒé™ã€‚ éƒ¨åˆ†åŽ‚å•†ç›®å‰å…è´¹ä¸”ä¸é™å®¹é‡ã€‚ é«˜å¯ç”¨ æä¾›å¤šå¯ç”¨åŒºæ”¯æŒã€‚ æ”¯æŒå¤‡ä»½å’Œå®¹ç¾ã€‚ æŠ€æœ¯æ”¯æŒ ä¸“é—¨çš„æŠ€æœ¯å›¢é˜Ÿä¿éšœå®¹å™¨çš„ç¨³å®šæ€§ã€‚ æ¯ä¸ª Linux ç‰ˆæœ¬ï¼Œæ¯ä¸ª Kubernetes ç‰ˆæœ¬éƒ½ä¼šåœ¨ç»è¿‡ä¸¥æ ¼æµ‹è¯•ä¹‹åŽä¹‹åŽæ‰ä¼šæä¾›ç»™ç”¨æˆ·ã€‚ æä¾› Kubernetes å‡çº§èƒ½åŠ›ï¼Œæ–°ç‰ˆæœ¬ä¸€é”®å‡çº§ã€‚ ä¸ºå¼€æºè½¯ä»¶æä¾›å…œåº•ï¼Œæ— è®ºæ˜¯K8Sã€Dockerç”šè‡³Linuxè‡ªèº«çš„é—®é¢˜æä¾›æ”¯æŒã€‚ ä¸“ä¸šçš„æŠ€æœ¯å›¢é˜Ÿæ˜¯æä¾›ç¨³å®šK8SæœåŠ¡å¿…ä¸å¯å°‘çš„ã€‚ä½†ç»å¤§å¤šæ•°ä¼ä¸šæ˜¯æ— æ³•åšåˆ°æœ‰ä¸“ä¸šçš„æŠ€æœ¯å›¢é˜Ÿæ¥ç»´æŠ¤K8Sã€æä¾›K8Sæˆ–å®¹å™¨æŠ€æœ¯è‡ªèº«çš„å„ç§æœ€ä½³å®žè·µã€å‘çŽ°ä»¥åŠä¿®å¤å¼€æºè½¯ä»¶Bugã€‚\nåœ¨ç¬”è€…çš„ä½¿ç”¨æ‰˜ç®¡K8Sçš„æ—¶å€™å°±é‡åˆ°è¿™æ ·çš„çŠ¶å†µã€‚å…¶ä¸­ä¸€ä¸ªé›†ç¾¤å‡çº§åˆ°æ–°ç‰ˆæœ¬KubernetesåŽï¼Œå†…ç½®DNSç»„ä»¶ä»ŽKubeDNSè¢«æ›¿æ¢ä¸ºå…¨æ–°çš„CoreDNSï¼Œè€Œå½“æ—¶çš„CoreDNSç‰ˆæœ¬åœ¨Service ExternalNameæ”¯æŒä¸Šæœ‰Bugï¼Œå¯¼è‡´å·²æœ‰çš„è¿™ç§Serviceæ— æ³•æä¾›æœåŠ¡ã€‚åœ¨åŒäº‘åŽ‚å•†çš„æŠ€æœ¯å›¢é˜Ÿæ²Ÿé€šåŽï¼Œå…ˆç”¨workaroundå°†é—®é¢˜å¿«é€Ÿç»•è¿‡ï¼Œä¸å½±å“ä¸šåŠ¡çš„ä½¿ç”¨ã€‚åŒæ—¶ï¼Œäº‘åŽ‚å•†çš„æŠ€æœ¯äººå‘˜ï¼ˆä¹Ÿæ˜¯K8Sç¤¾åŒºcommitterï¼‰ç»§ç»­è°ƒç ”ï¼Œå‘çŽ°è¯¥é—®é¢˜æ˜¯CoreDNSçš„Bugã€‚åœ¨ä¸ºå¼€æºCoreDNSé¡¹ç›®åˆ›å»ºIssueåŽï¼ŒåŒæ—¶æä¾›Patchï¼Œåˆåœ¨CoreDNS committerå»ºè®®ä¸‹å®Œå–„äº†æµ‹è¯•ç”¨ä¾‹ï¼ŒæŽ¨åŠ¨äº†è¯¥é—®é¢˜å¿«é€Ÿåœ¨CoreDNSä¸­è¢«ä¿®å¤ã€‚CoreDNSåŒ…å«Fixçš„ç‰ˆæœ¬å‘å¸ƒåŽï¼Œäº‘åŽ‚å•†æŠ€æœ¯æ”¯æŒå›¢é˜Ÿå°†æ›´å®Œç¾Žçš„è§£å†³æ–¹æ¡ˆæä¾›ç»™äº†æˆ‘ä»¬ã€‚ä½œä¸ºK8SæœåŠ¡çš„ç”¨æˆ·ï¼Œè¿™ç§ä½“éªŒæ˜¯æžå¥½çš„ã€‚å½“æ—¶æˆ‘ä»¬çš„æŠ€æœ¯å›¢é˜Ÿæ—¢æ²¡æœ‰ç²¾åŠ›ä¹Ÿæ²¡æœ‰èƒ½åŠ›å¿«é€Ÿå‘çŽ°å¹¶ä¿®å¤å¼€æºè½¯ä»¶ä¸­çš„è¿™ç±»é—®é¢˜ï¼Œè€Œäº‘åŽ‚å•†çš„æœåŠ¡é—´æŽ¥å¸®æˆ‘ä»¬å®žçŽ°äº†è¿™ç§èƒ½åŠ›ã€‚\nè¿™å…¶å®žæ˜¯ä¸€ç§éžå¸¸å¥½çš„å…±èµ¢å•†ä¸šæ¨¡å¼ï¼Œäº‘åŽ‚å•†æœ‰èƒ½åŠ›ä¸”æœ‰åŠ¨åŠ›æŠ•å…¥é¡¶å°–æŠ€æœ¯å›¢é˜Ÿå°†å¼€æºæŠ€æœ¯å•†ä¸šåŒ–ï¼Œäº‘åŽ‚å•†çš„ç”¨æˆ·åˆ™ç”¨æœ€å°çš„ä»£ä»·èŽ·å¾—äº†æœ€ä¼˜çš„åŸºç¡€æœåŠ¡æ¥ä¸ºæ ¸å¿ƒä¸šåŠ¡èµ‹èƒ½ã€‚\n","link":"https://kane.mx/posts/effective-cloud-computing/using-kubernetes-on-cloud/","section":"posts","tags":["äº‘è®¡ç®—","é˜¿é‡Œäº‘","AWS","kubernetes"],"title":"ä¸è¦è‡ªå»ºKubernetes"},{"body":"è¿™æ˜¯â€œå¦‚ä½•é«˜æ•ˆä½¿ç”¨äº‘æœåŠ¡â€ç³»åˆ—æ–‡ç« çš„å¼•å­ã€‚è¯¥ç³»åˆ—å°†è®²è¿°å¦‚ä½•åˆ©ç”¨å„ç§å…¬æœ‰äº‘æœåŠ¡æ¥å®‰å…¨åˆè§„ã€é«˜è´¨é‡ã€å¿«é€Ÿã€ä½Žæˆæœ¬çš„æ‰“é€ äº§å“/ç³»ç»Ÿï¼Œå¸®åŠ©ä¼ä¸šï¼ˆç‰¹åˆ«æ˜¯ä¸­å°å¾®åˆ›ä¸šå›¢é˜Ÿï¼‰åœ¨äººå°‘ï¼Œé’±ç¼ºçš„æƒ…å†µä¸‹åšåˆ°æœ€é«˜æ•ˆçŽ‡ã€‚\nä¸ªäººä½¿ç”¨å…¬æœ‰äº‘æœåŠ¡çš„ç»åŽ† åˆä¼š æœ€æ—©æ˜¯2012å¹´åœ¨parttimeé¡¹ç›®ä¸­å¼€å§‹æŽ¥è§¦ä½¿ç”¨äº‘è®¡ç®—æœåŠ¡ï¼Œå½“æ—¶çš„åˆåˆ›å›¢é˜Ÿä¹Ÿæ˜¯å¸Œæœ›ç”¨æœ€ä½Žçš„æˆæœ¬æ¥éªŒè¯ideaï¼Œæ‰€æœ‰ä½¿ç”¨äº†äº‘æœåŠ¡æ¥åšPOCã€‚ç›®å‰å›½å†…å¸‚åœºæœ€é¢†å…ˆçš„äº‘è®¡ç®—åŽ‚å•†é˜¿é‡Œäº‘é‚£æ—¶ä¹Ÿæ‰æä¾›å…¬æœ‰äº‘æœåŠ¡ä¸åˆ°1å¹´ã€‚ç”±äºŽäº‘äº§å“ä¸å¤Ÿæˆç†Ÿï¼ŒåŠ ä¸Šå›¢é˜ŸæŠ€èƒ½ç»éªŒä¸è¶³ï¼Œè‡ªåŠ©äº’åŠ©çš„æ¸ é“ä¸ç•…ï¼Œå¯¼è‡´æœ€åˆçš„äº‘è®¡ç®—ä½¿ç”¨ä½“éªŒå¹¶ä¸å¥½ï¼Œå›¢é˜Ÿæ²¡æœ‰é€‰æ‹©å®Œå…¨ä½¿ç”¨äº‘æœåŠ¡æž„å»ºäº§å“ã€‚\nIaaS or PaaS äº‘è®¡ç®—å…´èµ·çš„æ—©æœŸï¼Œäº‘åŽ‚å•†å¤§è‡´åˆ†ä¸ºä¸¤ç±»ï¼Œæä¾›åŸºäºŽIaaSæˆ–PaaSçš„äº‘æœåŠ¡ã€‚2013å¹´èµ·ä¹Ÿæœ‰å°è¯•ä¸åŒç±»åž‹çš„åŽ‚å•†å¹³å°ï¼Œè™½ç„¶ä¹Ÿè¾ƒå¥½çš„å®Œæˆä¸€äº›ä½“é‡ä¸å¤§çš„é¡¹ç›®ï¼Œä½†è¦åœ¨ä»–ä»¬ä¸Šé¢æž„å»ºå¤§è§„æ¨¡ç”¨æˆ·äº§å“æˆ–ä¼ä¸šçº§åº”ç”¨ï¼Œåœ¨äº‘äº§å“å®Œå–„åº¦ä¸Šæˆ–æ”¯æŒå¼€å‘å›¢é˜Ÿåä½œä¸Šéƒ½æœ‰ä¸å°‘æ¬ ç¼ºï¼Œè¿˜æœ‰å¤§é‡çš„åŸºç¡€å·¥ä½œæˆ–é™åˆ¶ç•™ç»™äº†å¼€å‘å›¢é˜Ÿè‡ªèº«è§£å†³ã€‚\nAll-in Cloud 2015å¹´æˆ‘å¼€å§‹ä¸€ä¸ªå¾®ç”µå½±é¡¹ç›®åˆ›ä¸šï¼Œå›¢é˜Ÿæ˜¯ä¸åˆ°10äººçš„å¾®åž‹å›¢é˜Ÿã€‚ä»Žæ•ˆçŽ‡å’Œæˆæœ¬è€ƒè™‘ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰çš„æœåŠ¡éƒ½æ”¾åˆ°äº†é˜¿é‡Œäº‘ä¸Šã€‚æˆ‘ä»¬ä½¿ç”¨äº†å¤šç§äº‘äº§å“ï¼Œä¾‹å¦‚ï¼Œäº‘ä¸»æœºï¼ˆå¤šç§OSï¼‰ï¼Œå¯¹è±¡å­˜å‚¨ï¼Œå›¾ç‰‡å¤„ç†ï¼ŒCDNï¼ŒSLBï¼Œäººè„¸è¯†åˆ«ç­‰äº‘æœåŠ¡ï¼Œç»“åˆDevopsé›†æˆå¼€å‘ï¼Œæµ‹è¯•ï¼Œéƒ¨ç½²pipelineæ¥åŠ é€Ÿäº§å“çš„è¿­ä»£å’Œæ›´æ–°ã€‚æ¯åå·¥ç¨‹å¸ˆæ‰¿æ‹…ä¸€ç§ä»¥ä¸Šè§’è‰²ï¼Œå‰ç«¯ï¼ŒåŽç«¯ï¼Œè¿ç»´ï¼Œæ•°æ®ï¼Œè§†é¢‘æ¸²æŸ“ç­‰ã€‚åˆç†ä½¿ç”¨äº‘åŽ‚å•†çš„å„ç§äº§å“å¸®æˆ‘ä»¬åœ¨è´¨é‡ï¼Œæ•ˆçŽ‡ï¼Œæˆæœ¬ä¸ŠèŽ·å¾—å·¨å¤§çš„æ”¶ç›Šã€‚\n2017å¹´æˆ‘åŠ å…¥äº†ä¸€å®¶ä¼ä¸šè´¢ç¨ŽæœåŠ¡çš„åˆåˆ›å…¬å¸è´Ÿè´£æŠ€æœ¯å›¢é˜Ÿã€‚å…¬å¸åœ¨2018å¹´èŽ·å¾—äº†Bè½®æŠ•èµ„ï¼Œç ”å‘äº§å“è¿è¥å›¢é˜Ÿè¿‘ç™¾äººï¼Œå±žäºŽä¸­ç­‰è§„æ¨¡ã€‚éšç€å„ç§å¼€æºæŠ€æœ¯çš„å·¨å¤§è¿›æ­¥å’Œå½±å“é€æ­¥æ‰©å¤§ï¼Œå¾®æœåŠ¡æž¶æž„çš„æµè¡Œï¼ŒåŸºäºŽKubernetesçš„Cloud Native Computingå…´èµ·ã€‚æˆ‘ä»¬åˆ©ç”¨äº‘åŽ‚å•†çš„å®¹å™¨æœåŠ¡ï¼ŒDBaaSï¼ŒBig Dataï¼ŒAIæŠ€æœ¯ç­‰ç”¨æœ€é«˜æ•ˆçš„æ–¹å¼å°†æ•°ä¸ªå•ä½“åº”ç”¨å¹³æ»‘å‡çº§åˆ°é«˜å¯ç”¨å¼¹æ€§çš„åˆ†å¸ƒå¼æž¶æž„ï¼Œæ›´å¥½çš„æ»¡è¶³å¤æ‚ä¸šåŠ¡çš„å¤šå˜éœ€æ±‚ï¼Œå…¬å¸æœåŠ¡ä¹Ÿåœ¨å…¨å›½300å¤šä¸ªåŸŽå¸‚è½åœ°ï¼ŒæœåŠ¡äº†æ•°åä¸‡ä¸­å°å¾®ä¼ä¸šå®¢æˆ·ã€‚åŒæ—¶åˆ©ç”¨äº‘åŽ‚å•†çš„VPCï¼Œè®¿é—®æŽ§åˆ¶ï¼ŒWAFç­‰äº§å“è¿›è¡Œæƒé™æŽ§åˆ¶å’Œå®‰å…¨ä¿æŠ¤ï¼Œæœ‰æ•ˆé˜²èŒƒäº†å› ä¸ºå›¢é˜Ÿæ‰©å¤§ç®¡ç†éš¾åº¦å¢žåŠ è€Œå‡ºçŽ°å®‰å…¨é—®é¢˜ã€‚\nç¼˜èµ· ä½œä¸ºä¸€åäº‘è®¡ç®—æœåŠ¡6å¹´çš„ç”¨æˆ·ï¼Œè§è¯äº†å¼€æºæŠ€æœ¯çš„å¿«é€Ÿå‘å±•å’Œå½±å“åŠ›æ€¥å‰§æ‰©å¤§ï¼Œæ„Ÿå—åˆ°æ•´ä¸ªäº‘è®¡ç®—è¡Œä¸šå’ŒåŽ‚å•†çš„é•¿è¶³è¿›æ­¥ã€‚è§è¯äº†å›½å†…å¤´éƒ¨äº‘åŽ‚å•†ä»Žæœ€åˆçš„ä½¿ç”¨éš¾åº¦é¢‡å¤§ï¼ŒçŽ°åœ¨æˆé•¿ä¸ºä¸‡ä¼—åˆ›ä¸šçš„é¦–é€‰æœåŠ¡å•†ã€‚\nè¿‡åŽ»çš„ä¸€å¹´å‚åŠ äº†æ•°åœºæŠ€æœ¯ä¼šè®®ï¼Œå…¶ä¸­ä¸»é¢˜å¤§å¤šåå‘äºŽç”±çŸ¥åçš„äº’è”ç½‘æˆ–è¡Œä¸šå…¬å¸åˆ†äº«åœ¨æµ·é‡æ•°æ®ä¸‹çš„æŠ€æœ¯åº”ç”¨ã€‚è¿™äº›æŠ€æœ¯å¹¿æ³›æ¶‰åŠå¼€å‘è¯­è¨€ã€åº”ç”¨æž¶æž„ã€æ€§èƒ½ã€å¤§æ•°æ®ã€æœºå™¨å­¦ä¹ å’Œäººå·¥æ™ºèƒ½ç­‰é¢†åŸŸï¼Œæ— è®ºè¿™äº›å…¬å¸æ˜¯å¦é‡‡ç”¨å¼€æºäº§å“ï¼Œåœ¨å›¢é˜Ÿå•å…µæŠ€æœ¯èƒ½åŠ›ï¼Œä¸“ä¸šçš„åˆ†å·¥ï¼Œå¯¹å¼€æºé¡¹ç›®çš„ç ”å‘æŠ•å…¥åŠ›é‡ï¼Œè¿™äº›ç»éªŒå’Œæ–¹æ³•å¹¶ä¸æ˜¯ä¸­å°ä¼ä¸šå¯ä»¥è½»æ˜“å€Ÿé‰´çš„ã€‚è€Œäº‘è®¡ç®—åŽ‚å•†å°†è¿™äº›é¢†åŸŸæœ€åŸºç¡€é€šç”¨çš„èƒ½åŠ›ä»¥äº§å“çš„æ–¹å¼è¾“å‡ºç»™ç”¨æˆ·ï¼Œä»¥æŒ‰ç”¨é‡çš„æ–¹å¼è®¡è´¹ï¼Œä½¿ç”¨æ›´ç®€å•ï¼Œæœ‰ä¸“ä¸šå›¢é˜Ÿç»´æŠ¤å’Œæ”¯æŒã€‚ä¸­å°å›¢é˜Ÿå°±åº”è¯¥å°†è¿™äº›äº‹æƒ…â€œå¤–åŒ…â€ç»™äº‘åŽ‚å•†ï¼Œé›†ä¸­ç²¾åŠ›åˆ°ä¸šåŠ¡ä¸Šï¼Œå°†æœ€å¤§çš„ç ”å‘èµ„æºç”¨åˆ°æœ€æ ¸å¿ƒæœ€å…³é”®çš„åœ°æ–¹ã€‚\næˆ‘åŒå›¢é˜ŸåŒäº‹æ²Ÿé€šä¸­ï¼Œå’Œå…¬å¸ç ”å‘å€™é€‰äººé¢è¯•äº¤æµä¸­ï¼Œå‘çŽ°è®¸å¤šä»Žä¸šè€…å¯¹äº‘è®¡ç®—æœåŠ¡äº†è§£è¿˜ä¸å¤Ÿæ·±å…¥ã€‚è®¸å¤šäººç†è§£ä¸­çš„äº‘è®¡ç®—æœåŠ¡åªæœ‰äº‘æœåŠ¡å™¨ã€äº‘æ•°æ®åº“ç­‰å°‘æ•°äº§å“ï¼Œéœ€è¦è‡ªå·±å®‰è£…ç»´æŠ¤åº”ç”¨æœåŠ¡å™¨ã€è´Ÿè½½å‡è¡¡ã€æ”¶é›†æ—¥å¿—ç­‰ç­‰çœ‹èµ·æ¥æ¯ä¸ªåº”ç”¨éƒ½ç»•ä¸å¼€çš„äº‹æƒ…ã€‚ä»–ä»¬çš„è®¤çŸ¥è¿˜åœç•™åœ¨æŽ’æŸ¥åº”ç”¨å¼‚å¸¸è¿˜éœ€è¦è¿œç¨‹ç™»å½•æœåŠ¡å™¨çœ‹æ—¥å¿—ï¼Œåšä¸åˆ°åˆç†çš„æ ¹æ®åœºæ™¯é«˜æ•ˆç»„åˆä½¿ç”¨äº‘æœåŠ¡ï¼Œå°†äº‘æœåŠ¡å½“åšæ°´ç”µä¸€æ ·ï¼Œä½œä¸ºæœ€åŸºç¡€çš„èƒ½åŠ›åŠ é€Ÿä¸šåŠ¡çš„å‘å±•ã€‚ä¸šåŠ¡ä¸Šæ˜¯é‡‡ç”¨åæ°”å¤§ä¸”æˆç†Ÿçš„äº§å“ï¼Œå°è¯•æ–°é²œçœ‹èµ·æ¥é…·ä½†ä¸é‚£ä¹ˆå®Œå–„çš„äº§å“ï¼Œè¿˜æ˜¯äºŒæ¬¡å¼€å‘æˆ–è‡ªç ”å¼€å‘ï¼Ÿè¦åšå‡ºæœ€ä¼˜çš„é€‰æ‹©éœ€è¦å·¥ç¨‹å¸ˆèƒ½å¤Ÿä»Žæœ‰é«˜åº¦çš„å…¨å±€è§’åº¦æ¥è€ƒé‡ï¼Œç”šè‡³åœ¨çŸ­æ—¶é—´å†…èƒ½ç”¨POCé¡¹ç›®éªŒè¯å¤šä¸ªå¯é€‰çš„æ–¹æ¡ˆï¼ŒåŸºäºŽæ•°æ®åšå‡ºæœ€ç»ˆçš„é€‰æ‹©ã€‚\nè¿™å°±æ˜¯è¿™ä¸ªç³»åˆ—çš„ç¼˜èµ·ï¼Œä¹‹åŽæˆ‘å°†é™†ç»­åˆ†äº«ä½¿ç”¨é‚£äº›é«˜æ•ˆçš„äº‘æœåŠ¡äº§å“çš„åœºæ™¯ã€å¿ƒå¾—ã€ä½“ä¼šç­‰ç­‰ã€‚\nå°é¢å›¾ç‰‡Cloud Computingå¼•ç”¨è‡ªThe Blue Diamond Gallery under CC BY-SA 3.0\n","link":"https://kane.mx/posts/effective-cloud-computing/preface/","section":"posts","tags":["äº‘è®¡ç®—","é˜¿é‡Œäº‘"],"title":"çœŸçš„ä¼šç”¨äº‘æœåŠ¡å—ï¼Ÿ"},{"body":"ä¸Šå‘¨å‚åŠ äº†ArchSummit(å…¨çƒæž¶æž„å¸ˆå³°ä¼š)ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸‹éƒ¨åˆ†å‚åŠ çš„ä¸»é¢˜ä»¥åŠä¸ªäººæ„Ÿå—ã€‚\nä¼šè®®å›žé¡¾ ä»Šå¹´å‚åŠ äº†å‡ æ¬¡æŠ€æœ¯ä¼šè®®ï¼Œå¾®æœåŠ¡ã€å®¹å™¨æŠ€æœ¯ã€åŒºå—é“¾ã€å¤§æ•°æ®ã€æœºå™¨å­¦ä¹ ä»¥åŠäººå·¥æ™ºèƒ½éƒ½æ˜¯å½“ä¸‹æœ€çƒ­é—¨çš„ä¸»é¢˜ã€‚åŒæ ·è¿™æ¬¡ArchSummitç»å¤§éƒ¨åˆ†topicséƒ½è·Ÿè¿™äº›ä¸»é¢˜ç›¸å…³ã€‚\nè¿™æ¬¡ä¼šè®®ä¸»è¦å‚åŠ äº†ä¸¤ä¸ªä¸“åœºä¸»é¢˜ï¼ŒKubernetesçš„åº”ç”¨å’Œå¿«æ‰‹ç§‘æŠ€æŠ€æœ¯ä¸“é¢˜ã€‚\nåŸºäºŽ Kubernetes çš„ DevOpsæ˜¯æ¥è‡ªå¾®è½¯Azureçš„å®¹å™¨å·¥ç¨‹å¸ˆåˆ†äº«å¦‚ä½•åŸºäºŽ Kubernetes çš„ CI/CD è½åœ°å®žè·µã€‚è¯¥åˆ†äº«ä¸­æåˆ°äº†CI/CDå„ä¸ªæ­¥éª¤ä¸­éƒ½æœ‰ä¼—å¤šçš„å·¥å…·æ”¯æŒï¼Œå¦‚ä½•é€‰æ‹©åˆé€‚Kubernetesçš„å·¥å…·å°†æŒç»­é›†æˆå’Œéƒ¨ç½²ä¸²è”åœ¨ä¸€èµ·æ˜¯Devopsä¸­çš„ä¸»è¦æŒ‘æˆ˜ã€‚åˆ†äº«è€…ä¹Ÿå®‰åˆ©äº†AKSæä¾›Devopså®Œæ•´çš„å·¥å…·é“¾ï¼Œä»¥åŠå°†å¼€æºå·¥å…·åŒAKSä¸­çš„æœåŠ¡é›†æˆå®žçŽ°CI/CDçš„æœ€ä½³å®žè·µã€‚\næˆ‘ä»¬å™¼é‡Œå•ªå›¢é˜Ÿåœ¨CI/CDã€Devopsè¿™å—åšå¾—è¿˜ä¸é”™ã€‚CI/CD pipelinesæŒç»­å°†åº”ç”¨éƒ¨ç½²åœ¨è¿è¡Œçš„Kubernetesé›†ç¾¤ï¼Œè¿‡ç¨‹ä¸­ä½¿ç”¨çš„å·¥å…·é“¾åŸºæœ¬ä¹Ÿæ˜¯ç¤¾åŒºæˆ–CNCFæŽ¨èçš„ä¸»æµå·¥å…·ã€‚ä¸‹ä¸€æ­¥å¯ä»¥è€ƒè™‘åŒäº‘åŽ‚å•†çš„Devopså·¥å…·é“¾é›†æˆï¼Œè¿›ä¸€æ­¥å‡å°‘ç»´æŠ¤æˆæœ¬ã€‚\nåŸºäºŽIstio on Kubernetesäº‘åŽŸç”Ÿåº”ç”¨çš„æœ€ä½³å®žè·µæ¥è‡ªé˜¿é‡Œäº‘å®¹å™¨å·¥ç¨‹å¸ˆçš„åˆ†äº«ã€‚ä»–æ¦‚è¦çš„åˆ†äº«äº†IstioæŠ€æœ¯å’Œå®žçŽ°åŽŸç†ã€‚å½“ç„¶ä¹Ÿå¤§åŠ›ä»‹ç»äº†é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡å¯¹Istioçš„åŽŸç”Ÿæ”¯æŒï¼Œä»¥åŠé˜¿é‡Œäº‘å¯¹å®¢æˆ·ä½¿ç”¨Istioçš„æ”¯æŒï¼Œå³ä½¿å®¢æˆ·é—®é¢˜éžå¸¸çš„åˆçº§ä»–ä»¬çš„æŠ€æœ¯æ”¯æŒä¹Ÿå¾ˆåˆ°ä½ã€‚\nIstioå¯ä»¥è¯´æ˜¯CNCFåœ¨Kubernetesä¸Šäº‹å®žçš„æœåŠ¡æ²»ç†å®žçŽ°ã€‚å™¼é‡Œå•ªæŠ€æœ¯å›¢é˜Ÿä¹Ÿä¸€ç›´åœ¨å…³æ³¨è¿™ä¸€å—ï¼Œæ­£åœ¨å°è¯•å¼•å…¥Istioæå‡æœåŠ¡çš„SLAã€‚\nå¿«æ‰‹æŠ€æœ¯å›¢é˜Ÿçš„4ä¸ªåˆ†äº«éƒ½æ˜¯å›´ç»•è§£å†³æ˜Žç¡®çš„ä¸šåŠ¡é—®é¢˜è€Œåšå¾—æŠ€æœ¯å·¥ä½œï¼Œéžå¸¸å…·æœ‰å®žæˆ˜æ€§ã€‚å…¶ä¸­å¿«æ‰‹ä¸‡äº¿çº§å®žæ—¶ OLAP å¹³å°çš„å»ºè®¾ä¸Žå®žè·µä»‹ç»äº†å¿«æ‰‹å®žæ—¶OLAPå¹³å°ä»Ž0åˆ°1çš„æ­å»ºè¿‡ç¨‹ã€‚è¯¥å¹³å°ä»Žä»Šå¹´4æœˆå¼€å§‹æ­å»ºï¼Œæˆªæ­¢åˆ°11æœˆï¼Œæ¯æ—¥å¯ä»¥å®žæ—¶è®¡ç®—å¤„ç†è¶…è¿‡ä¸‡äº¿çš„æ•°æ®ã€‚è€Œæ•´ä¸ªå¹³å°çš„æ­å»ºç”±ä¸¤åå¤§æ•°æ®å·¥ç¨‹å¸ˆå¤–åŠ ä¸€åå‰ç«¯å·¥ç¨‹å¸ˆè´Ÿè´£portalç­‰UIï¼Œäººæ•ˆäº§å‡ºè®©äººéžå¸¸ä½©æœã€‚ç»“åˆæœ‹å‹é—´ä¼ è¨€å¿«æ‰‹ç»™æŠ€æœ¯äººå‘˜çš„offerï¼Œå¿«æ‰‹åº”è¯¥æ˜¯ä¸€å®¶åœ¨å®žè·µç±»ä¼¼Netflixç®¡ç†æ–‡åŒ–çš„å…¬å¸ã€‚\næœ€åŽç»™å¤§å®¶æŽ¨èä¸€ä¸ªå›½äº§çš„åˆ†å¸ƒå¼New SQLæ•°æ®åº“TiDBç›¸å…³çš„ä¸»é¢˜ã€‚TiDBæ˜¯å›½å†…æŠ€æœ¯å›¢é˜Ÿå¼€æºçš„ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå·²è¢«CNCFä½œä¸ºDatabaseå®žçŽ°æŽ¨èæ–¹æ¡ˆä¹‹ä¸€ã€‚ä»–ä»¬çš„CTOåˆ†äº«äº†TiDB on Kubernetes æœ€ä½³å®žè·µï¼Œä»¥åŠä»–ä»¬å®¢æˆ·åŒ—äº¬é“¶è¡Œåœ¨ä¸¤åœ°å¤šæ´»çš„æ ¸å¿ƒç³»ç»Ÿä¸­é‡‡ç”¨çš„æ•°æ®åº“å°±æ˜¯TiDBã€‚\nä¸ªäººæ„Ÿå— ä¼šè®®çš„åˆ†äº«è€…å¤§å¤šæ¥è‡ªå›½å†…ä¸€çº¿çš„äº’è”ç½‘å…¬å¸ï¼Œä»–ä»¬æ™®éå…·å¤‡æµé‡å¤§ã€æ•°æ®å¤šã€æŠ€æœ¯å›¢é˜Ÿèƒ½åŠ›æ›´å¼ºç­‰ç‰¹è´¨ã€‚å¹¶ä¸”å¾ˆå°‘ä½¿ç”¨å…¬æœ‰äº‘æœåŠ¡ï¼Œä½¿ç”¨å¼€æºäº§å“å¤šæ•°ä¹Ÿä¼šç»´æŠ¤ç§æœ‰ç‰ˆæœ¬ã€‚ä»–ä»¬çš„ä¸šåŠ¡è§£å†³æ–¹æ¡ˆå¯¹ä¸­å°åž‹æŠ€æœ¯å›¢é˜Ÿæ¥è¯´å¯å¤åˆ¶æ€§ä¸å¼ºï¼Œç…§æ¬å®žæ–½çš„éš¾åº¦é«˜ï¼Œæ›´å¤šçš„æ˜¯åœ¨æ‰©å±•æ€è·¯äº†è§£ä¸šç•ŒæŠ€æœ¯åŠ¨æ€ã€‚ä¸­å°åž‹æŠ€æœ¯å›¢é˜Ÿæœ€ç´§è¿«çš„äº‹æƒ…æ˜¯æ»¡è¶³ä¸šåŠ¡å¿«é€Ÿå‘å±•å’Œéœ€æ±‚å¤šå˜ï¼Œæ›´åˆç†çš„è§£æ³•æ˜¯é€‰ç”¨äº‘åŽ‚å•†çš„æœåŠ¡æˆ–ç¬¬ä¸‰æ–¹æœåŠ¡å¿«é€Ÿé«˜æ•ˆçš„æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚æžå®¢é‚¦æ——ä¸‹çš„ä¼šè®®å¤§å¤šç¼ºå°‘è¿™ç±»çš„åˆ†äº«ï¼Œç›¸æ¯”ä¹‹ä¸‹AWSçš„reInventå¤§ä¼šåœ¨è¿™æ–¹é¢åšå¾—æ›´å¥½ã€‚\n","link":"https://kane.mx/posts/2018/2018-12-13-bj-archsummit-review/","section":"posts","tags":["ä¼šè®®","æž¶æž„","ArchSummit"],"title":"2018åŒ—äº¬ArchSummitå›žé¡¾"},{"body":"","link":"https://kane.mx/tags/archsummit/","section":"tags","tags":null,"title":"ArchSummit"},{"body":"","link":"https://kane.mx/tags/jenkins/","section":"tags","tags":null,"title":"Jenkins"},{"body":"","link":"https://kane.mx/tags/trouble-shooting/","section":"tags","tags":null,"title":"Trouble-Shooting"},{"body":"Vç§˜å¼€å‘å›¢é˜Ÿä¸€ç›´ä½¿ç”¨ç€Jenkins CIæ¥æŒç»­é›†æˆVç§˜æœåŠ¡çš„æ–°åŠŸèƒ½å’Œå„ç§æ”¹è¿›ã€‚è¿‘æ—¥ï¼ŒJenkins CIåœ¨é‡å¯ä¹‹åŽï¼Œå¾ˆå¤šå·²æœ‰ä»»åŠ¡çš„é…ç½®æ— æ³•è¢«Jenkins CIå®Œæ•´çš„åŠ è½½ï¼Œå¯¼è‡´å¾ˆå¤šåŠŸèƒ½æ— æ³•ä½¿ç”¨ã€‚å¯¼è‡´æˆ‘ä»¬æ•´ä¸ªç½‘ç«™çš„å„ç§æœåŠ¡æ— æ³•è¢«å‡çº§æ›´æ–°äº†:-(\nJenkins CIåœ¨ç®¡ç†æŽ§åˆ¶å°åˆ—å‡ºå¦‚ä¸‹çš„é”™è¯¯ä¿¡æ¯ï¼Œç¤ºæ„çŽ°æœ‰ä»»åŠ¡çš„éƒ¨åˆ†é…ç½®ç”±äºŽé”™è¯¯æ— æ³•åŠ è½½ã€‚\nCannotResolveClassException: hudson.plugins.git.GitSCM, CannotResolveClassException: com.cloudbees.jenkins.plugins.BitBucketTrigger, CannotResolveClassException: hudson.plugins.emailext.ExtendedEmailPublisher, CannotResolveClassException: hudson.plugins.parameterizedtrigger.BuildTrigger é€šè¿‡ä¸Šé¢çš„é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘ä»¬åˆæ­¥è®¤ä¸ºé”™è¯¯æ˜¯ç”±äºŽæ’ä»¶æ— æ³•è¢«Jenkins CIåŠ è½½ã€‚ä½†æ˜¯é€šè¿‡Jenkins CIçš„æ’ä»¶ç®¡ç†åˆ—è¡¨ï¼Œæˆ‘ä»¬å‘çŽ°Gitæ’ä»¶å·²ç»è¢«è®¤ä¸ºæ˜¯å®‰è£…çš„äº†ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨Jenkins CIå®‰è£…ç›®å½•ä¸­æ‰¾åˆ°æ’ä»¶å¯¹åº”çš„æ–‡ä»¶git.jarï¼Œå¹¶ä¸”æˆåŠŸéªŒè¯äº†ç±»hudson.plugins.git.GitSCMä¹Ÿæ˜¯å­˜åœ¨åœ¨jaræ–‡ä»¶é‡Œé¢çš„ã€‚é‡æ–°å®‰è£…Git clientæ’ä»¶ä¹Ÿä¸èƒ½è§£å†³è¿™ä¸ªé”™è¯¯ï¼\nç»è¿‡è¿›ä¸€æ­¥çš„åˆ†æžï¼Œé€šè¿‡Jenkins CIçš„ç³»ç»Ÿæ—¥å¿—ï¼Œæˆ‘ä»¬å‘çŽ°Gitæ’ä»¶è™½ç„¶æ˜¯æˆåŠŸå®‰è£…äº†ï¼Œä½†æ˜¯å®ƒæ‰€ä¾èµ–çš„æŸäº›æ’ä»¶æ²¡æœ‰è¢«å®‰è£…ï¼è¿™å¯¼è‡´Jenkins CIæ— æ³•æ­£ç¡®åŠ è½½Gitæ’ä»¶ã€‚é€šè¿‡æ—¥å¿—çš„æç¤ºï¼Œå°†ç¼ºå¤±çš„æ’ä»¶ä¸€ä¸€å®‰è£…ä¸Šï¼Œé‡å¯Jenkins CIåŽï¼Œæ’ä»¶åŠ è½½æ­£å¸¸ï¼Œä»»åŠ¡æ‰§è¡Œä¹Ÿæ¢å¤æ­£å¸¸ã€‚\nè¿™ä¸ªé”™è¯¯å‡ºçŽ°çš„è¿˜æ˜¯ç›¸å½“å¥‡æ€ªã€‚å› ä¸ºJenkins CIä¼šåœ¨å®‰è£…æ’ä»¶çš„æ—¶å€™å°†ä¾èµ–çš„æ’ä»¶ä¸€å¹¶å®‰è£…ä¸Šã€‚æ­¤å¤–è¯¥Jenkins CIå·²ç»è¿è¡Œå¾ˆä¹…äº†ï¼Œè¿™äº›æ’ä»¶ä¹Ÿæ˜¯ä¸€ç›´å®‰è£…ç€çš„ã€‚ä¸è¿‡çŽ°åœ¨å›žæƒ³èµ·ä¹‹å‰å‡çº§Jenkins CIæ’ä»¶çš„æ—¶å€™ï¼Œéƒ¨åˆ†æ’ä»¶ç”±äºŽç½‘ç»œåŽŸå› å‡çº§å¤±è´¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰é‡æ–°æ›´æ–°ã€‚è¿™å¯¼è‡´è¿™äº›æ’ä»¶å¤„åœ¨äº†ä¸€ä¸ªä¸æ­£ç¡®çš„çŠ¶æ€ã€‚åœ¨é‡å¯Jenkins CIåŽï¼Œè¿™äº›æ’ä»¶è¢«æ ‡è®°ä¸ºæœªå®‰è£…ï¼Œå¯¼è‡´ä¾èµ–å®ƒä»¬çš„æ’ä»¶æ— æ³•åŠ è½½ã€‚\n","link":"https://kane.mx/posts/2016/how-to-fix-jenkins-fail-to-load-job-config/","section":"posts","tags":["Jenkins","trouble-shooting"],"title":"å¦‚ä½•ä¿®å¤Jenkins CIæ— æ³•è¯»å–å­˜åœ¨çš„ä»»åŠ¡é…ç½®"},{"body":"","link":"https://kane.mx/tags/mongodb/","section":"tags","tags":null,"title":"MongoDB"},{"body":"MongoDBæ˜¯ç›®å‰æœ€ä¸ºæµè¡Œçš„NoSQLæ•°æ®åº“ä¹‹ä¸€ã€‚Vç§˜çš„åŽå°æ•°æ®å°±æ˜¯ä¿å­˜åœ¨MongoDBä¸­çš„å“¦;)\nå°½ç®¡MongoDBçš„æ€§èƒ½ä¸ºä¸šç•Œç§°é“ï¼Œä½†ä»»ä½•æ•°æ®åº“ç³»ç»Ÿä½¿ç”¨ä¸­éƒ½å­˜åœ¨ç€æ…¢æŸ¥è¯¢çš„é—®é¢˜ã€‚æ…¢æŸ¥è¯¢çš„æ€§èƒ½é—®é¢˜ï¼Œå¯èƒ½æ˜¯ç”±äºŽä½¿ç”¨éžæœ€ä¼˜çš„æŸ¥è¯¢è¯­å¥ï¼Œä¸æ­£ç¡®çš„ç´¢å¼•æˆ–å…¶ä»–é…ç½®åŽŸå› å¯¼è‡´çš„ã€‚ä½†å¼€å‘äººå‘˜æˆ–æ•°æ®åº“ç»´æŠ¤äººå‘˜é¦–å…ˆè¦æ‰¾å‡ºè¿™äº›ä½Žæ•ˆçš„æŸ¥è¯¢ï¼Œæ‰èƒ½åšå‡ºå¯¹åº”çš„æŸ¥è¯¢ä¼˜åŒ–ã€‚\nåœ¨MongoDBä¸­å®žçŽ°æ…¢æŸ¥è¯¢çš„profileæ˜¯éžå¸¸å®¹æ˜“ï¼Œå› ä¸ºMongoDBå†…ç½®äº†profileå¼€å…³æ¥è®°å½•æ‰§è¡Œæ—¶é—´è§¦å‘äº†profileæ¡ä»¶çš„æŸ¥è¯¢ã€‚\nå‚ç…§db.setProfileLevel()çš„æ–‡æ¡£ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤å°±å¯ä»¥è®°å½•æ‰§è¡Œæ—¶é•¿è¶…è¿‡300msçš„æŸ¥è¯¢ã€‚\n1db.setProfilingLevel(1, 300) å½“æ…¢æŸ¥è¯¢è¢«é‡çŽ°åŽï¼Œå¯ä»¥é€šè¿‡æŸ¥æ‰¾system.profile collectionæ¥æŸ¥çœ‹æ‰§è¡Œæ—¶é•¿è¶…è¿‡300msçš„æŸ¥è¯¢ã€‚\nè¢«profilerè®°å½•ä¸‹æ¥æ…¢æŸ¥è¯¢recordçœ‹èµ·æ¥å¦‚ä¸‹ï¼Œ\n1{ 2 \u0026#34;op\u0026#34; : \u0026#34;query\u0026#34;, 3 \u0026#34;ns\u0026#34; : \u0026#34;myCollection\u0026#34;, 4 \u0026#34;query\u0026#34; : { 5 \u0026#34;builds\u0026#34; : { 6 \u0026#34;$elemMatch\u0026#34; : { 7 \u0026#34;builtTime\u0026#34; : null, 8 \u0026#34;$and\u0026#34; : [ 9 { 10 \u0026#34;createdTime\u0026#34; : { 11 \u0026#34;$lt\u0026#34; : ISODate(\u0026#34;2016-09-20T20:07:00.796Z\u0026#34;) 12 } 13 } 14 ] 15 } 16 } 17 }, 18 \u0026#34;ntoreturn\u0026#34; : 0, 19 \u0026#34;ntoskip\u0026#34; : 0, 20 \u0026#34;nscanned\u0026#34; : 0, 21 \u0026#34;nscannedObjects\u0026#34; : 18231, 22 \u0026#34;keyUpdates\u0026#34; : 0, 23 \u0026#34;writeConflicts\u0026#34; : 0, 24 \u0026#34;numYield\u0026#34; : 577, 25 \u0026#34;locks\u0026#34; : { 26 \u0026#34;Global\u0026#34; : { 27 \u0026#34;acquireCount\u0026#34; : { 28 \u0026#34;r\u0026#34; : NumberLong(1156) 29 } 30 }, 31 \u0026#34;Database\u0026#34; : { 32 \u0026#34;acquireCount\u0026#34; : { 33 \u0026#34;r\u0026#34; : NumberLong(578) 34 } 35 }, 36 \u0026#34;Collection\u0026#34; : { 37 \u0026#34;acquireCount\u0026#34; : { 38 \u0026#34;r\u0026#34; : NumberLong(578) 39 } 40 } 41 }, 42 \u0026#34;nreturned\u0026#34; : 2, 43 \u0026#34;responseLength\u0026#34; : 98076, 44 \u0026#34;millis\u0026#34; : 11161, 45 \u0026#34;execStats\u0026#34; : { 46 \u0026#34;stage\u0026#34; : \u0026#34;COLLSCAN\u0026#34;, 47 \u0026#34;filter\u0026#34; : { 48 \u0026#34;builds\u0026#34; : { 49 \u0026#34;$elemMatch\u0026#34; : { 50 \u0026#34;$and\u0026#34; : [ 51 { 52 \u0026#34;$and\u0026#34; : [ 53 { 54 \u0026#34;createdTime\u0026#34; : { 55 \u0026#34;$lt\u0026#34; : ISODate(\u0026#34;2016-09-20T20:07:00.796Z\u0026#34;) 56 } 57 } 58 ] 59 }, 60 { 61 \u0026#34;builtTime\u0026#34; : { 62 \u0026#34;$eq\u0026#34; : null 63 } 64 } 65 ] 66 } 67 } 68 }, 69 \u0026#34;nReturned\u0026#34; : 2, 70 \u0026#34;executionTimeMillisEstimate\u0026#34; : 11080, 71 \u0026#34;works\u0026#34; : 18233, 72 \u0026#34;advanced\u0026#34; : 2, 73 \u0026#34;needTime\u0026#34; : 18230, 74 \u0026#34;needFetch\u0026#34; : 0, 75 \u0026#34;saveState\u0026#34; : 577, 76 \u0026#34;restoreState\u0026#34; : 577, 77 \u0026#34;isEOF\u0026#34; : 1, 78 \u0026#34;invalidates\u0026#34; : 0, 79 \u0026#34;direction\u0026#34; : \u0026#34;forward\u0026#34;, 80 \u0026#34;docsExamined\u0026#34; : 18231 81 }, 82 \u0026#34;ts\u0026#34; : ISODate(\u0026#34;2016-09-20T23:07:14.313Z\u0026#34;), 83 \u0026#34;client\u0026#34; : \u0026#34;10.171.127.66\u0026#34;, 84 \u0026#34;allUsers\u0026#34; : [ 85 { 86 \u0026#34;user\u0026#34; : \u0026#34;dbuser\u0026#34;, 87 \u0026#34;db\u0026#34; : \u0026#34;mydb\u0026#34; 88 } 89 ], 90 \u0026#34;user\u0026#34; : \u0026#34;dbuser@mydb\u0026#34; 91} ä¸Šé¢çš„æ•°æ®å…·ä½“è§£è¯»å¦‚ä¸‹ï¼Œ\nop: 'query'è¡¨ç¤ºæ‰§è¡Œçš„æ˜¯æŸ¥è¯¢ï¼Œ nsæ˜¯æŒ‡æŸ¥è¯¢çš„collectionï¼Œ queryæ˜¯å…·ä½“çš„æŸ¥è¯¢è¯­å¥ï¼Œ æ ¸å¿ƒéƒ¨åˆ†æ˜¯execStatsï¼Œç»™å‡ºäº†çš„æŸ¥è¯¢è¯­å¥å…·ä½“æ‰§è¡Œç»Ÿè®¡ï¼Œè·Ÿ**.explain('execStats')**çš„å†…å®¹æ˜¯ä¸€è‡´çš„ã€‚ä¸Šé¢çš„ç»Ÿè®¡æ˜¯è¯´ï¼Œè¿™ä¸ªqueryæ‰§è¡Œäº†æ•´ä¸ªcollectionçš„æ‰«æ(æ€»è®¡æ‰«æäº†18231ä¸ªæ–‡æ¡£)ï¼Œæœ€ç»ˆè¿”å›žäº†2æ¡æ–‡æ¡£ï¼ŒèŠ±è´¹äº†11080msï¼Œä¹Ÿå°±æ˜¯11sè¿˜å¤šçš„æ—¶é—´ï¼è¿™è¡¨æ˜Žè¢«è®°å½•ä¸‹çš„æ…¢æŸ¥è¯¢è·Ÿcollectionçš„ç´¢å¼•è®¾ç½®æœ‰é—®é¢˜ï¼Œè¯¥æŸ¥è¯¢æ²¡æœ‰ç”¨ä¸Šç´¢å¼•ã€‚è§£å†³æ–¹æ¡ˆå¾ˆç®€å•ï¼Œæ”¹å–„æŸ¥è¯¢è¯­å¥ä½¿ç”¨å­˜åœ¨çš„ç´¢å¼•æˆ–è€…è®¾ç½®åˆç†çš„ç´¢å¼•ã€‚ tsæ˜¯æŸ¥è¯¢å¼€å§‹è¯·æ±‚çš„æ—¶é—´ï¼Œ allUserså’Œuseréƒ½æ˜¯MongoDB clientè¿žæŽ¥æ‰€ä½¿ç”¨çš„ç”¨æˆ·ã€‚ ","link":"https://kane.mx/posts/2016/how-to-find-slow-queries-in-mongodb/","section":"posts","tags":["MongoDB","performance-tuning"],"title":"MongoDBä¸­å¦‚ä½•æ‰¾å‡ºæ…¢æŸ¥è¯¢"},{"body":"Swarm modeåœ¨Docker v1.12ä¸­æ­£å¼å‘å¸ƒï¼ŒSwarm modeå¸¦æ¥äº†è¯¸å¦‚Dockeré›†ç¾¤ï¼Œå®¹å™¨ç¼–æŽ’ï¼Œå¤šä¸»æœºç½‘ç»œç­‰æ¿€åŠ¨äººå¿ƒçš„ç‰¹æ€§ã€‚Vç§˜å›¢é˜Ÿä¹Ÿå°è¯•ç€å°†å„ç§åŽå°æœåŠ¡éƒ¨ç½²åˆ°Docker Swarm ClusterèŽ·å–æ›´å¥½çš„å¼¹æ€§è®¡ç®—èƒ½åŠ›ã€‚\nDocker v1.12ä¸­æ­£å¼å‘å¸ƒçš„Docker Swarmåœ¨æˆ‘ä»¬å®žç”¨ä¸­å‘çŽ°ä»æœ‰ä¸å°‘ä¸è¶³ä¹‹å¤„ï¼Œè®©æˆ‘ä»¬ä¸€ä¸€åˆ†äº«ç»™å¤§å®¶ã€‚\næ— æ³•å°†æœåŠ¡çš„publishedç«¯å£åªç»‘å®šåˆ°ç‰¹ç‚¹çš„ç½‘å¡ä¸Šã€‚æ¯”å¦‚æˆ‘ä»¬çš„äº‘ä¸»æœºï¼ˆåŒæ—¶ä¹Ÿæ˜¯Swarm manager/nodeï¼‰æœ‰eth0å’Œeth1ä¸¤å—ç½‘å¡ï¼Œåˆ†åˆ«è¿žæŽ¥å†…ç½‘å’Œå¤–ç½‘ã€‚æˆ‘ä»¬è®¡åˆ’åœ¨Docker Swarmä¸­è¿è¡Œä¸€ä¸ªnginxæœåŠ¡ï¼Œé€šè¿‡80/443ç«¯å£æä¾›HTTP/HTTPSæœåŠ¡ã€‚å½“æˆ‘ä»¬å¸Œæœ›å°†nginxä¸­çš„WebæœåŠ¡æš´éœ²åœ¨äº‘ä¸»æœºä¸Šæ—¶ï¼Œæˆ‘ä»¬é€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆ›å»ºnginxæœåŠ¡ã€‚ç„¶è€Œæˆ‘ä»¬æ— æ³•é€‰æ‹©å°†publishedçš„80ç«¯å£ç»‘å®šåœ¨å“ªä¸ªinterfaceä¸Šã€‚Docker Swarmä¼šè‡ªåŠ¨å°†æœåŠ¡ç›‘å¬åˆ°Swarm nodeçš„æ‰€æœ‰80ç«¯å£ä¸Šã€‚å¦‚æžœæˆ‘ä»¬åªæƒ³å°†è¿™ä¸ªæœåŠ¡æš´éœ²åœ¨å†…ç½‘interfaceæš‚æ—¶æ— æ³•å®žçŽ°ã€‚ 1docker service create --name vme-nginx --network vme-network --replicas 1 \\ 2 --publish 80:80 --publish 443:443 \\ 3 nginx:1.11 æ— æ³•ä¸ºDocker Swarmå†…è¿è¡Œçš„æœåŠ¡è®¾ç½®ä¸»æœºåã€‚é€šè¿‡docker runå‘½ä»¤æ‰§è¡Œçš„å®¹å™¨å¯ä»¥è®¾ç½®hostnameã€‚æ¯”å¦‚ï¼Œ 1docker run --hostname vme-nginx nginx:1.11 ä½†æ˜¯docker service createå‘½ä»¤ç¼ºå°‘ç­‰ä»·çš„å‚æ•°ä¸ºå®¹å™¨æŒ‡å®šhostnameã€‚ä¸€äº›ä¾èµ–äºŽhostnameçš„æœåŠ¡å°†æ— æ³•éƒ¨ç½²åœ¨Docker Swarmä¸­ï¼Œæ¯”å¦‚clustered rabbitmqã€‚ Docker composeè¿˜ä¸èƒ½ä¸ŽDocker Swarmå®Œç¾Žé›†æˆã€‚ç›®å‰æœ‰ä¸€ä¸ªexperimentalçš„Docker Stacks and Distributed Application Bundlesåœ¨å°è¯•åšæ›´å¥½çš„æ•´åˆã€‚ docker service updateæœ‰æ—¶ä¸èƒ½æ›´æ–°æ­£åœ¨è¿è¡Œä¸­çš„containerã€‚æ›´å¤šè®¨è®ºè§è¿™ä¸ªissueã€‚ ","link":"https://kane.mx/posts/2016/the-limitations-docker-swarm-mode-v1.12/","section":"posts","tags":["docker","docker-swarm"],"title":"Docker Swarm mode(v1.12.x)çš„ä¸€äº›ä½¿ç”¨é™åˆ¶"},{"body":"","link":"https://kane.mx/tags/docker-swarm/","section":"tags","tags":null,"title":"Docker-Swarm"},{"body":"","link":"https://kane.mx/tags/ubuntu-1404/","section":"tags","tags":null,"title":"Ubuntu-1404"},{"body":"Vç§˜å›¢é˜Ÿä¸€ç›´è‡´åŠ›äºŽç”¨æŠ€æœ¯æ”¹å–„äº§å“ã€‚Vç§˜åŽå°çš„å„ç§æœåŠ¡ä¸€ç›´æ˜¯é€šè¿‡å®Œå–„çš„Devopsæµç¨‹è‡ªåŠ¨éƒ¨ç½²åˆ°Dockerå®¹å™¨é›†ç¾¤ã€‚éšç€Swarm modeåœ¨Docker v1.12ä¸­æ­£å¼å‘å¸ƒï¼ŒSwarm modeå¸¦æ¥äº†è¯¸å¦‚Dockeré›†ç¾¤ï¼Œå¤šä¸»æœºç½‘ç»œç­‰æ¿€åŠ¨äººå¿ƒçš„ç‰¹æ€§ã€‚æˆ‘ä»¬ä¹Ÿåœ¨å°è¯•å°†Vç§˜æœåŠ¡éƒ¨ç½²åˆ°Docker Swarm ClusterèŽ·å–æ›´å¥½çš„å¼¹æ€§è®¡ç®—èƒ½åŠ›ã€‚\nç„¶è€Œæˆ‘ä»¬å°†Vç§˜çš„æœåŠ¡éƒ¨ç½²åˆ°Docker Swarm Clusteræ—¶é‡åˆ°æœåŠ¡å®¹å™¨æ— æ³•å¯åŠ¨çš„é”™è¯¯ã€‚é”™è¯¯ä¿¡æ¯ç±»ä¼¼å¦‚ä¸‹ï¼Œ\nstarting container failed: could not add veth pair inside the network sandbox: could not find an appropriate master \u0026quot;ov-000100-1wkbc\u0026quot; for \u0026quot;vethee39f9d\u0026quot;\nç»è¿‡ä¸ŽDocker ç¤¾åŒºçš„å›žé¦ˆè®¨è®ºï¼Œæš‚æ—¶é€šè¿‡å‡çº§Dockerä¸»æœº(OS: Ubuntu 14.04 LTS)çš„å†…æ ¸ç‰ˆæœ¬è§£å†³äº†è¿™ä¸ªé”™è¯¯ã€‚\nå…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼Œ\n1root@swarm1:~# uname -r 23.13.0-32-generic 3 4root@swarm1:~# apt-get install linux-generic-lts-vivid 5root@swarm1:~# reboot 6 7root@swarm1:~# uname -r 83.19.0-69-generic è‡³äºŽè¿™ä¸ªé”™è¯¯çš„æ ¹æœ¬åŽŸå› æ˜¯Dockerçš„bugè¿˜æ˜¯å¯¹Linux Kernelæœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œéœ€è¦Dockerå¼€å‘è¿›ä¸€æ­¥ç¡®è®¤ã€‚å¦‚æžœå¯¹æ­¤é—®é¢˜æœ‰æ›´å¤šå…´è¶£ï¼Œå¯ä»¥å…³æ³¨docker issue #25039ã€‚\n","link":"https://kane.mx/posts/2016/docker-swarm-mode-in-ubuntu-1404/","section":"posts","tags":["docker","docker-swarm","ubuntu-1404"],"title":"åˆ›å»ºäºŽDocker Swarmçš„æœåŠ¡æ— æ³•åœ¨Ubuntu 14.04 LTSä¸­è¿è¡Œ"},{"body":"","link":"https://kane.mx/tags/angularjs/","section":"tags","tags":null,"title":"Angularjs"},{"body":"","link":"https://kane.mx/tags/nginx/","section":"tags","tags":null,"title":"Nginx"},{"body":"","link":"https://kane.mx/tags/seo/","section":"tags","tags":null,"title":"Seo"},{"body":"","link":"https://kane.mx/tags/single-page-app/","section":"tags","tags":null,"title":"Single-Page-App"},{"body":"åœ¨ä¹‹å‰çš„æ–‡ç« æˆ‘æ›¾æåˆ°åŸºäºŽAngularjsçš„å•é¡µé¢åº”ç”¨åœ¨ç”¨æˆ·ä½“éªŒä¸Šçš„ç§ç§å¥½å¤„ã€‚ç„¶è€Œä»»ä½•äº‹æƒ…éƒ½ä¸æ˜¯å®Œç¾Žçš„ï¼ŒAngularå’Œç±»ä¼¼çš„æ¡†æž¶é€šè¿‡åº”ç”¨å†…åšé¡µé¢è·¯ç”±çš„å®žçŽ°ç»™SEOï¼ˆä¹Ÿä¿—ç§°æœç´¢å¼•æ“Žä¼˜åŒ–ï¼‰å¸¦æ¥äº†ä¸å°‘éº»çƒ¦ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹é¡µé¢å†…è·¯ç”±æ˜¯å¦‚ä½•å®žçŽ°çš„ã€‚é»˜è®¤Angularjsç”Ÿæˆçš„é¡µé¢uriç±»åž‹å¦‚ä¸‹ï¼Œ\nhttp://mydomain.com/#/app/page1\næµè§ˆå™¨è¯·æ±‚ä¸Šé¢è¿™ä¸ªuriçš„æ—¶å€™ï¼Œå®žé™…å‘é€ç»™æœåŠ¡å™¨çš„è¯·æ±‚åœ°å€æ˜¯http://mydomain.com/, webæœåŠ¡å™¨ä¼šå°†é»˜è®¤çš„é¡µé¢å“åº”ç»™æµè§ˆå™¨ï¼Œæ¯”å¦‚index.htmlæˆ–index.phpç­‰ã€‚\næµè§ˆå™¨è¿”å›žçš„é¡µé¢é‡Œé¢å¼•å…¥äº†Angularjså’Œå…¶ä»–åº”ç”¨éœ€è¦çš„JSåº“ã€‚Angularjsåº”ç”¨å¼€å§‹æ‰§è¡ŒåŽï¼Œå°è¯•å¤„ç†è·¯ç”±**/app/page1**ã€‚å¦‚æžœåº”ç”¨å®šä¹‰äº†è¯¥è·¯ç”±ï¼Œå°†åŠ è½½å¿…è¦çš„JSåº“å’Œå…¶ä»–htmlç‰‡æ®µæ¥å®Œæˆé¡µé¢çš„æ¸²æŸ“ã€‚\nç†è§£äº†Angularjsé¡µé¢å†…è·¯ç”±çš„åŽŸç†åŽï¼Œæˆ‘ä»¬çŸ¥é“äº†å¯¹æµè§ˆå™¨æˆ–æœç´¢å¼•æ“Žçˆ¬è™«è€Œè¨€ï¼Œå•é¡µé¢åº”ç”¨æ‰€æœ‰çš„é¡µé¢å¯¹æµè§ˆå™¨å’Œæœç´¢å¼•æ“Žéƒ½æ˜¯ä¸€ä¸ªç½‘å€ï¼Œæ¯”å¦‚http://mydomain.com/ã€‚è¿™æ ·å¯¹çˆ¬è™«æŠ“å–ç«™å†…é“¾æŽ¥é€ æˆäº†å›°éš¾ï¼Œå› ä¸ºæ‰€æœ‰åº”ç”¨å†…çš„é“¾æŽ¥éƒ½è¢«è®¤åšäº†åŒä¸€ä¸ªé“¾æŽ¥ã€‚\næˆ‘ä»¬ç†è§£äº†uri http://mydomain.com/#/app/page1ç»™SEOé€ æˆçš„éº»çƒ¦ï¼ŒæŽ¥ä¸‹æ¥å°±æ˜¯è®¨è®ºå¦‚ä½•é’ˆå¯¹SEOæ¥ä½œçš„ä¼˜åŒ–ã€‚\næœ€ç†æƒ³çš„æƒ…å†µå½“ç„¶æ˜¯æœç´¢å¼•æ“Žçˆ¬è™«å˜çš„æ›´åŠ æ™ºèƒ½ï¼Œå®ƒèƒ½ç†è§£ç½‘ç«™çš„æ¡†æž¶ï¼Œå¹¶ä¸”é’ˆå¯¹æ­¤ç§æƒ…å†µåšå‡ºä¼˜åŒ–ã€‚ä½†æˆªæ­¢åˆ°ç›®å‰ï¼ŒåŒ…æ‹¬Googleåœ¨å†…çš„æ‰€æœ‰çˆ¬è™«éƒ½æ— æ³•åšåˆ°è¿™ç‚¹ã€‚é‚£æˆ‘ä»¬SEOçš„ä¼˜åŒ–åªèƒ½åœ¨åº”ç”¨è¿™è¾¹æ¥åšäº†ã€‚\nAngularjsæä¾›äº†ä¸€ç§HTML5 modeæ¨¡å¼å¯ä»¥åˆ©ç”¨HTML5 History APIæ¥å®žçŽ°é¡µé¢å†…è·¯ç”±ã€‚æ‰“å¼€çš„æ–¹æ³•å¦‚ä¸‹ï¼Œ\n1$locationProvider.html5Mode(true); åŒæ—¶åœ¨index.htmlé¡µé¢åŠ ä¸Šå¦‚ä¸‹æ ‡ç­¾ï¼Œ\n1\u0026lt;base href=\u0026#34;/\u0026#34;\u0026gt; åœ¨æ‰“å¼€HTML5 modeåŽçš„Angularjsåº”ç”¨çš„é“¾æŽ¥çœ‹èµ·æ¥å°±æ˜¯è¿™æ ·äº†ï¼Œ\nhttp://mydomain.com/app/page1\næ–°çš„é“¾æŽ¥æ¨¡å¼å’Œç«™å†…è·³è½¬é€šè¿‡è®¿é—®ç½‘ç«™ä¸»é¡µè¯·æ±‚å°†æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ç„¶è€Œç›´æŽ¥åœ¨æµè§ˆå™¨è¯·æ±‚å¦‚ä¸Šé“¾æŽ¥çš„è¯ï¼ŒWebæœåŠ¡å™¨å°†å°è¯•è¯·æ±‚/app/page1ï¼Œé€šå¸¸ä¼šå¾—åˆ°404çš„é¡µé¢å“åº”ã€‚å› ä¸ºæœåŠ¡å™¨ä¸Šå¹¶æ²¡æœ‰éƒ¨ç½²é¡µé¢/app/page1ã€‚\nè¿™æ—¶å°±éœ€è¦åœ¨Webåº”ç”¨æœåŠ¡å™¨æˆ–åº”ç”¨é‡Œé¢å®žçŽ°URL Rewriteã€‚å°†/app/page1çš„è¯·æ±‚è½¬åˆ°å•é¡µé¢åº”ç”¨htmlæ–‡ä»¶ä¸Šã€‚\nä¸‹é¢æ˜¯ä¸€äº›WebæœåŠ¡å™¨æˆ–åº”ç”¨çš„å‚è€ƒé…ç½®ï¼Œ\nApache Rewrites\n1\u0026lt;VirtualHost *:80\u0026gt; 2 ServerName my-app 3 4 DocumentRoot /path/to/app 5 6 \u0026lt;Directory /path/to/app\u0026gt; 7 RewriteEngine on 8 9 # Don\u0026#39;t rewrite files or directories 10 RewriteCond %{REQUEST_FILENAME} -f [OR] 11 RewriteCond %{REQUEST_FILENAME} -d 12 RewriteRule ^ - [L] 13 14 # Rewrite everything else to index.html to allow html5 state links 15 RewriteRule ^ index.html [L] 16 \u0026lt;/Directory\u0026gt; 17\u0026lt;/VirtualHost\u0026gt; Nginx Rewrites\n1server { 2 server_name my-app; 3 4 root /path/to/app; 5 6 location / { 7 try_files $uri $uri/ /index.html; 8 } 9} Azure IIS Rewrites\n1\u0026lt;system.webServer\u0026gt; 2 \u0026lt;rewrite\u0026gt; 3 \u0026lt;rules\u0026gt; 4 \u0026lt;rule name=\u0026#34;Main Rule\u0026#34; stopProcessing=\u0026#34;true\u0026#34;\u0026gt; 5 \u0026lt;match url=\u0026#34;.*\u0026#34; /\u0026gt; 6 \u0026lt;conditions logicalGrouping=\u0026#34;MatchAll\u0026#34;\u0026gt; 7 \u0026lt;add input=\u0026#34;{REQUEST_FILENAME}\u0026#34; matchType=\u0026#34;IsFile\u0026#34; negate=\u0026#34;true\u0026#34; /\u0026gt; 8 \u0026lt;add input=\u0026#34;{REQUEST_FILENAME}\u0026#34; matchType=\u0026#34;IsDirectory\u0026#34; negate=\u0026#34;true\u0026#34; /\u0026gt; 9 \u0026lt;/conditions\u0026gt; 10 \u0026lt;action type=\u0026#34;Rewrite\u0026#34; url=\u0026#34;/\u0026#34; /\u0026gt; 11 \u0026lt;/rule\u0026gt; 12 \u0026lt;/rules\u0026gt; 13 \u0026lt;/rewrite\u0026gt; 14\u0026lt;/system.webServer\u0026gt; Express Rewrites\n1var express = require(\u0026#39;express\u0026#39;); 2var app = express(); 3 4app.use(\u0026#39;/js\u0026#39;, express.static(__dirname + \u0026#39;/js\u0026#39;)); 5app.use(\u0026#39;/dist\u0026#39;, express.static(__dirname + \u0026#39;/../dist\u0026#39;)); 6app.use(\u0026#39;/css\u0026#39;, express.static(__dirname + \u0026#39;/css\u0026#39;)); 7app.use(\u0026#39;/partials\u0026#39;, express.static(__dirname + \u0026#39;/partials\u0026#39;)); 8 9app.all(\u0026#39;/*\u0026#39;, function(req, res, next) { 10 // Just send the index.html for other files to support HTML5Mode 11 res.sendFile(\u0026#39;index.html\u0026#39;, { root: __dirname }); 12}); 13 14app.listen(3006); //the port you want to use ASP.Net C# Rewrites\n1private const string ROOT_DOCUMENT = \u0026#34;/default.aspx\u0026#34;; 2 3protected void Application_BeginRequest( Object sender, EventArgs e ) 4{ 5 string url = Request.Url.LocalPath; 6 if ( !System.IO.File.Exists( Context.Server.MapPath( url ) ) ) 7 Context.RewritePath( ROOT_DOCUMENT ); 8} ","link":"https://kane.mx/posts/2016/seo-optimization-for-angularajs-based-app/","section":"posts","tags":["angularjs","single-page-app","seo","nginx","æœç´¢å¼•æ“Žä¼˜åŒ–"],"title":"åŸºäºŽAngularjså•é¡µé¢åº”ç”¨çš„SEOä¼˜åŒ–"},{"body":"","link":"https://kane.mx/tags/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E4%BC%98%E5%8C%96/","section":"tags","tags":null,"title":"æœç´¢å¼•æ“Žä¼˜åŒ–"},{"body":"","link":"https://kane.mx/tags/session-management/","section":"tags","tags":null,"title":"Session-Management"},{"body":"","link":"https://kane.mx/tags/spring-boot/","section":"tags","tags":null,"title":"Spring-Boot"},{"body":"","link":"https://kane.mx/tags/spring-framework/","section":"tags","tags":null,"title":"Spring-Framework"},{"body":"","link":"https://kane.mx/tags/spring-session/","section":"tags","tags":null,"title":"Spring-Session"},{"body":"åœ¨å¾®æœåŠ¡å’Œå®¹å™¨ç­‰æŠ€æœ¯çš„å¸®åŠ©ä¸‹ï¼ŒWebåº”ç”¨å¯ä»¥è¾ƒä¸ºå®¹æ˜“çš„è¿›è¡Œæ°´å¹³æ‰©å±•ï¼Œæ¥éƒ¨ç½²æ›´å¤šçš„åº”ç”¨å®žä¾‹æ¥æå‡è¯·æ±‚å¤„ç†æ•°QPSã€‚å½“WebæœåŠ¡æœ‰çŠ¶æ€çš„æ—¶å€™ï¼Œå¦‚ä½•åœ¨é›†ç¾¤ä¸‹ç®¡ç†ç”¨æˆ·sessionæˆä¸ºæ–°çš„å¾…è§£å†³é—®é¢˜ã€‚\nSpring Frameworké’ˆå¯¹æ­¤é—®é¢˜è¡ç”Ÿå‡ºäº†ä¸€ä¸ªå­é¡¹ç›®Spring Sessionæ¥å®žçŽ°é›†ç¾¤ä¸‹çš„sessionç®¡ç†ã€‚è¯¥é¡¹ç›®æä¾›äº†ä»¥ä¸‹åŠŸèƒ½ï¼š\næä¾›APIå’Œå®žçŽ°ç®¡ç†ç”¨æˆ·session HttpSession - æ›¿æ¢å®žçŽ°åº”ç”¨å®¹å™¨(tomcat)ä¸­çš„HttpSession Clustered Sessions - å®žçŽ°é›†ç¾¤çš„sessionè€Œä¸ä¾èµ–ä»»ä½•åº”ç”¨å®¹å™¨ç‰¹å®šçš„è§£å†³æ–¹æ¡ˆ Multiple Browser Sessions - æ”¯æŒå¤šä¸ªç”¨æˆ·sessionä¿å­˜åœ¨åŒä¸€ä¸ªæµè§ˆå™¨å®žä¾‹ä¸­ (ä¾‹å¦‚ï¼Œç±»ä¼¼Googleçš„å¤šç”¨æˆ·è®¤è¯). RESTful APIs - é€šè¿‡æ”¯æŒsession idsåœ¨Httpè¯·æ±‚å¤´æ¥æ”¯æŒRestful APIçš„è®¤è¯ WebSocket - èƒ½å¤Ÿä¿è¯HttpSessionçš„å­˜æ´»å½“åœ¨æŽ¥å—WebSocketæ¶ˆæ¯æ—¶ ä»Žä¸Šé¢çš„åŠŸèƒ½åˆ—è¡¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Spring Sessionèƒ½å¤Ÿæ»¡è¶³é›†ç¾¤ä¸‹å„ç§sessionçš„ä½¿ç”¨åœºæ™¯å’Œéœ€æ±‚ã€‚\nSpring Sessionåœ¨1.0.0 GAå¯ä»¥ä½¿ç”¨Redisåšä¸ºsessionå‚¨å­˜çš„backendã€‚\né€šè¿‡changelogï¼Œåœ¨æœ€æ–°çš„1.1.0 GAä¸­æ”¯æŒè‡ªå®šä¹‰Cookieçš„åˆ›å»ºï¼Œå…è®¸è‡ªå®šä¹‰Cookieçš„è¿‡æœŸæ—¶é—´ï¼Œä½œç”¨åŸŸç­‰ã€‚åœ¨å³å°†å‘å¸ƒçš„1.2.0 GAç‰ˆæœ¬ä¸­ï¼Œå°†æ·»åŠ æ”¯æŒJDBCçš„å…³ç³»æ•°æ®åº“å’ŒMongoDBä½œä¸ºsessionä¿å­˜çš„backendã€‚\næ­¤å¤–ï¼ŒSpring SessionåŒSpring-bootçš„åº”ç”¨æœ‰å¾ˆå¥½çš„é›†æˆï¼Œåªéœ€è¦åå¤šè¡Œä»£ç åŠé…ç½®å³å¯é›†æˆï¼\n","link":"https://kane.mx/posts/2016/clustered-session-under-spring-framework/","section":"posts","tags":["web-2.0","session-management","spring-framework","spring-session","spring-boot"],"title":"Springæ¡†æž¶ä¸‹çš„åˆ†å¸ƒå¼sessionç®¡ç†"},{"body":"","link":"https://kane.mx/tags/web-2.0/","section":"tags","tags":null,"title":"Web-2.0"},{"body":"","link":"https://kane.mx/tags/architecture/","section":"tags","tags":null,"title":"Architecture"},{"body":"æ˜¥å¤©æ¥äº†ï¼ŒVç§˜å¤§å®¶åº­ä¹Ÿæ–°å¢žäº†ä¸¤ä½10åŽçš„ä¼ äººã€‚æ–°çˆ¸çˆ¸ç»è¿‡ä¸€ç•ªå¿™ä¹±åŽï¼Œå¸Œæœ›åœ¨è¿™é‡Œä¸Žå¤§å®¶åˆ†äº«Vç§˜çš„æž¶æž„ï¼Œå…±åŒæŽ¢è®¨å¦‚ä½•å¿«é€Ÿçš„æž„å»ºé«˜å¯ç”¨ï¼Œé«˜æ€§èƒ½çš„WebæœåŠ¡ã€‚\nVç§˜è‡´åŠ›äºŽæä¾›æœ€å¥½çš„åœ¨çº¿è§†é¢‘åˆ¶ä½œäº‘å¹³å°ã€‚è®©ç”¨æˆ·éšæ—¶éšåœ°é›¶é—¨æ§›çš„å¿«é€Ÿåˆ¶ä½œå‡ºé«˜è´¨é‡é«˜æ¸…æ™°åº¦çš„è§†é¢‘ï¼Œæ¥çºªå¿µè®°å½•ç”Ÿæ´»ä¸­æœ‰æ„ä¹‰çš„æ—¶åˆ»ï¼ŒåŒæ—¶å°†è¿™ä»½å¿«ä¹ä¼ é€’ç»™æ›´å¤šçš„å®¶äººæœ‹å‹ä¸€èµ·åˆ†äº«ã€‚\nç„¶è€Œè¦å¯é çš„å¯æ‰©å±•çš„å®žçŽ°è¿™æ ·çœ‹ä¼¼ç®€å•çš„éœ€æ±‚ï¼Œå…¶èƒŒåŽç¡®ç”±ä¼—å¤šçŸ¥åå¼€æºæŠ€æœ¯ï¼Œå¯é çš„äº‘æœåŠ¡ï¼Œä¸é—´æ­‡çš„ç›‘æŽ§è¿ç»´æ¥å®žçŽ°å’Œä¿è¯çš„ã€‚\nVç§˜æž¶æž„çš„åŸºæœ¬ç›®æ ‡å°±æ˜¯è¦å®žçŽ°ï¼Œ\næœåŠ¡çš„é«˜æ‰©å±•æ€§ã€‚æœ‰æœ‰æ•ˆå¯é çš„æ–¹æ³•æ”¯æ’‘æ•°ä¸‡å¹¶å‘åˆ°æ•°åä¸‡ï¼Œç™¾ä¸‡åŠæ›´å¤šçš„å¹¶å‘è¯·æ±‚ã€‚ æœåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚å„ç§æœåŠ¡éƒ½æ˜¯å¤šå®žä¾‹çš„é›†ç¾¤ï¼ŒæŸäº›æœåŠ¡æ•…éšœåŽï¼Œé›†ç¾¤ä¸­çš„å…¶ä»–å®žä¾‹ä»ç„¶èƒ½å¤Ÿæä¾›æœåŠ¡ã€‚ æœåŠ¡çš„è‡ªåŠ¨åŒ–æž„å»ºã€‚ä»Žä»£ç åˆ°æœåŠ¡éƒ¨ç½²ä¸Šçº¿æ˜¯ä¸€å¥—è‡ªåŠ¨åŒ–çš„æµç¨‹ï¼Œè¶Šå°‘çš„äººå·¥ä»‹å…¥ä¿è¯äº†æœåŠ¡çš„å¯ç”¨æ€§ã€‚ ç³»ç»Ÿçš„å®žæ—¶ç›‘æŽ§ã€‚7x24å°æ—¶çš„ç›‘æŽ§ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ï¼Œå½“ç›‘æŽ§åˆ°æ•°æ®å¼‚å¸¸æˆ–æœåŠ¡åœæ­¢è¿è¡Œèƒ½åŠæ—¶å‘Šè­¦å¼•å…¥äººå·¥è¿ç»´å›¢é˜Ÿã€‚ æ›´å¤šç»†èŠ‚è¯·å‚é˜…ä¸‹é¢çš„slides,\nHow we build Videome from Meng Xin Zhu æ¬¢è¿Žç•™è¨€ä¸Žæˆ‘ä»¬æŽ¢è®¨ä½ çš„å¿ƒå¾—å’Œå»ºè®®ã€‚\n","link":"https://kane.mx/posts/2016/how-we-build-videome/","section":"posts","tags":["web-2.0","architecture","ç½‘ç«™æž¶æž„"],"title":"Vç§˜æ˜¯å¦‚ä½•æž„å»ºçš„"},{"body":"","link":"https://kane.mx/tags/%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84/","section":"tags","tags":null,"title":"ç½‘ç«™æž¶æž„"},{"body":"","link":"https://kane.mx/tags/aliyun/","section":"tags","tags":null,"title":"Aliyun"},{"body":"","link":"https://kane.mx/tags/oss/","section":"tags","tags":null,"title":"Oss"},{"body":"","link":"https://kane.mx/tags/ossfs/","section":"tags","tags":null,"title":"Ossfs"},{"body":"é˜¿é‡Œäº‘æä¾›çš„å¯¹è±¡æˆ–è€…æ–‡ä»¶å­˜å‚¨å«OSSï¼Œä¸ºåº”ç”¨ç¨‹åºæä¾›äº†æµ·é‡å­˜å‚¨ï¼ŒæŒ‰éœ€ä»˜è´¹ç­‰æœåŠ¡ã€‚åº”ç”¨ç¨‹åºåˆ™éœ€è¦é€šè¿‡Aliyun OSSçš„å„è¯­è¨€SDKæ‰èƒ½æ“ä½œï¼ˆè¯»ï¼Œå†™ï¼ŒéåŽ†ç­‰ï¼‰OSSä¸­çš„æ–‡ä»¶ã€‚\nå¯¹è¿ç»´äººå‘˜æ¥è¯´ï¼Œåšä¸€äº›æ•°æ®ç»´æŠ¤å·¥ä½œçš„æ—¶å€™ï¼Œé€šè¿‡SDKæ“ä½œOSSä¸­çš„æ–‡ä»¶å°±ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚åœ¨linux/unixçŽ¯å¢ƒä¸‹ï¼Œé€šå¸¸æœ‰ä¸€äº›å·¥å…·æŠŠè¿œç¨‹æ–‡ä»¶ç³»ç»Ÿæˆ–äº‘ç›˜æŒ‚è½½ä¸ºæœ¬åœ°æ–‡ä»¶ã€‚åœ¨ç½‘ç»œçŠ¶å†µæ¯”è¾ƒå¥½çš„æƒ…å†µä¸‹ï¼Œæ“ä½œè¿œç¨‹æ–‡ä»¶å°±åƒæ“ä½œæœ¬åœ°æ–‡ä»¶ä¸€æ ·ã€‚ä¾‹å¦‚ï¼ŒæŠŠAmazon S3ï¼ŒDropboxäº‘ç›˜ï¼Œå¯é€šè¿‡sshç™»å½•çš„è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ç£ç›˜æŒ‚è½½ä¸ºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚\nä¹‹å‰ä¹Ÿæœ‰ç¬¬ä¸‰æ–¹å…¬å¸å¼€å‘çš„å·¥å…·æŠŠOSS bucketæŒ‚è½½ä¸ºæœ¬åœ°ç£ç›˜ã€‚å‡ºäºŽå®‰å…¨è€ƒè™‘ä¸€ç›´ä¸ºæ•¢ä½¿ç”¨ã€‚\nç»ˆäºŽï¼Œé˜¿é‡Œäº‘æŽ¨å‡ºäº†å®˜æ–¹å¼€æºç‰ˆæœ¬çš„ossfsï¼Œå¹¶ä¸”æä¾›æŠ€æœ¯æ”¯æŒï¼ˆé€šè¿‡å·¥å•ï¼‰ã€‚\næŽ¥ä¸‹æ¥ï¼ŒèŠèŠæˆ‘çš„ä½¿ç”¨ä½“ä¼šã€‚\nå®‰è£…ï¼Œé…ç½®éƒ½è¿˜ç®€å•ã€‚ æ–‡æ¡£çœ‹èµ·æ¥æ¯”è¾ƒè¯¦ç»†ï¼Œä½†å®žé™…æ“ä½œèµ·æ¥æœ‰äº›å°±ä¸å¯¹ã€‚æ„Ÿè§‰å†™æ–‡æ¡£çš„äººï¼Œå¹¶æ²¡æœ‰åœ¨ç›¸åº”çŽ¯å¢ƒä¸Šæµ‹è¯•è¿‡ã€‚ æƒé™è®¾è®¡çš„ä¸€å¡Œç³Šæ¶‚ã€‚ossfsåŸºäºŽFUSEï¼Œç†å½“å…è®¸éžrootæŒ‚è½½æˆ–å¸è½½OSS bucketã€‚éžrootç”¨æˆ·ä½¿ç”¨ossfsæŒ‚è½½çš„æ–‡ä»¶é»˜è®¤çš„owneréƒ½æ˜¯root! è¿˜å¥½ç›®å‰æœ‰workaroundï¼ŒæŒ‚è½½çš„æ—¶å€™æŒ‡å®šå‚æ•°ï¼Œ-ouid=your_uid -ogid=your_gidæ¥æŒ‡å®šæ–‡ä»¶çš„ownerã€‚ æ€§èƒ½æžå…¶ä½Žä¸‹ï¼ï¼ï¼ä¸€å°ECSä¸»æœºæŒ‚è½½äº†ä¸€ä¸ªä½¿ç”¨å†…ç½‘åœ°å€çš„oss bucketï¼Œbucketæ ¹ä¸‹é¢æœ‰2k+å­ç›®å½•ï¼ˆå¯¹æ–‡ä»¶ç³»ç»Ÿè€Œè¨€ï¼‰,bucketå†…æ–‡ä»¶æ€»è®¡æœ‰28Gã€‚ç„¶è€Œæ‰§è¡Œls /tmp/\u0026lt;bucket mount point\u0026gt;è¶…è¿‡10åˆ†é’Ÿéƒ½æ— æ³•å®Œæˆã€‚è€Œæˆ‘ä»¬Vç§˜ä¹‹å‰ç”¨Javaå®žçŽ°çš„AliyunOSSFSæ‰§è¡ŒåŒæ ·çš„æ“ä½œåªéœ€è¦æ•°ç§’ã€‚ é˜¿é‡Œäº‘ç›¸å…³çš„æŠ€æœ¯æ”¯æŒäººå‘˜åŠå…¶ä¸ä¸“ä¸šã€‚å¾ˆå¤šæ–‡ä»¶ç³»ç»Ÿï¼ŒFUSEç­‰æ¦‚å¿µéƒ½ä¸ç”šäº†è§£ã€‚è·Ÿä»–ä»¬æ²Ÿé€šè¿™äº›æŠ€æœ¯é—®é¢˜ï¼Œé¦–å…ˆè¦èŠ±æ—¶é—´è¿›è¡Œæ•™è‚²ã€‚èŠ±è´¹å¤§é‡æ—¶é—´æ¥æ²Ÿé€šï¼Œè¿›å±•ç¡®ç¼“æ…¢ã€‚ æ€»ä¹‹ï¼Œé˜¿é‡Œäº‘ossfsè¿™ä¸ªå·¥å…·è¿œè¿œæ²¡æœ‰è¾¾åˆ°production readyçš„è´¨é‡ã€‚æ— æ³•ä½¿ç”¨åˆ°ç”Ÿäº§çŽ¯å¢ƒä¸­ã€‚ ","link":"https://kane.mx/posts/2016/aliyun-ossfs-sucks/","section":"posts","tags":["aliyun","oss","ossfs","é˜¿é‡Œäº‘"],"title":"è¯´ä¸€è¯´é˜¿é‡Œäº‘ossfs"},{"body":"","link":"https://kane.mx/tags/wechat/","section":"tags","tags":null,"title":"Wechat"},{"body":"","link":"https://kane.mx/tags/weixin/","section":"tags","tags":null,"title":"Weixin"},{"body":"","link":"https://kane.mx/tags/%E5%85%AC%E4%BC%97%E5%B9%B3%E5%8F%B0/","section":"tags","tags":null,"title":"å…¬ä¼—å¹³å°"},{"body":"å¾®ä¿¡ç»™å…¬ä¼—å¹³å°æä¾›äº†ç´ æç®¡ç†çš„æŽ¥å£ï¼Œé€šè¿‡è¿™ä¸€ç³»åˆ—æŽ¥å£å¯ä»¥ä¸Šä¼ ï¼ŒæŽ¥æ”¶ä»¥åŠç®¡ç†å›¾ç‰‡ï¼Œè§†é¢‘ç­‰å¤šåª’ä½“æ–‡ä»¶ã€‚å…¶ä¸­åˆåˆ†ä¸ºä¸´æ—¶å’Œæ°¸ä¹…ä¸¤ç§ç±»åž‹ã€‚æ°¸ä¹…ç´ ææœ‰æ€»é‡çš„é™åˆ¶ï¼Œä¸´æ—¶ç´ æå¾®ä¿¡æœåŠ¡å™¨åªç»™ä¿å­˜3å¤©ã€‚\næœ€è¿‘Vç§˜åˆšå¥½æœ‰ä¸ªåŒå¾®ä¿¡ç”¨æˆ·äº’åŠ¨çš„åœºæ™¯ï¼Œä¸ºç”¨æˆ·ç¾ŽåŒ–å¾®ä¿¡æ‹æ‘„çš„å°è§†é¢‘ã€‚Vç§˜åŽå°æœåŠ¡å™¨æ”¶åˆ°ç”¨æˆ·å‘é€è¿‡æ¥å°è§†é¢‘ï¼ˆå¾®ä¿¡å°†å…¶è®¤åšä¸´æ—¶ç´ æï¼‰ï¼Œå°†å…¶ç¾ŽåŒ–å¤„ç†åŽï¼Œå†å°†ç¾ŽåŒ–çš„è§†é¢‘ä¸Šä¼ ä¸ºä¸´æ—¶ç´ æï¼Œæœ€ç»ˆç¾ŽåŒ–åŽçš„è§†é¢‘ä½œä¸ºè§†é¢‘ç±»åž‹çš„å®¢æœæ¶ˆæ¯è¢«æŽ¨é€ç»™ç”¨æˆ·ã€‚æ•´ä¸ªæµç¨‹å¾ˆç®€æ´ï¼Œç”¨æˆ·å‘é€å°è§†é¢‘åŽï¼Œå°±åç­‰è§‚çœ‹ç¾ŽåŒ–åŽçš„å°è§†é¢‘äº†ã€‚\nç„¶è€Œæœ€ç»ˆç»è¿‡Vç§˜å¼€å‘å›¢é˜Ÿçš„å®žè·µåŠæµ‹è¯•ï¼Œå¾—å‡ºçš„ç»“è®ºæ˜¯ï¼Œ\n##å¾®ä¿¡å…¬ä¼—å¹³å°çš„ä¸´æ—¶ç´ æä¸èƒ½ç”¨ï¼ç»å¯¹çš„é¸¡è‚‹ï¼\nå…¬ä¼—å¹³å°ä¸Šä¼ ç´ æçš„APIä»¥åŠä½¿ç”¨å·²æœ‰ç´ æå‘é€è§†é¢‘æ¶ˆæ¯APIéƒ½å¾ˆå¥å£®ã€‚ä½†é—®é¢˜å‡ºåœ¨äº†å¾®ä¿¡åŽå°èµ„æºçš„æœåŠ¡ä¸Šé¢ã€‚\nå¼€å‘è€…æŠŠå›¾ç‰‡è§†é¢‘æˆåŠŸä¸Šä¼ ä¸ºä¸´æ—¶ç´ æåŽï¼Œä¼šä»Žå¾®ä¿¡çš„æŽ¥å£å¾—åˆ°è¿™ä¸ªç´ æçš„IDã€‚è¿™ä¸ªIDéšåŽä½œä¸ºç»™ç”¨æˆ·å‘é€å›¾æ–‡æ¶ˆæ¯æˆ–è§†é¢‘æ¶ˆæ¯çš„èµ„æºã€‚å¾®ä¿¡åŽå°ä¼šæŠŠè¿™ä¸ªIDå¯¹åº”åˆ°ç´ æçš„çœŸå®žURLè·¯å¾„ä¸Šã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚åŒæ—¶å¾®ä¿¡ä½œä¸ºä¸€ä¸ªæ‹¥æœ‰æµ·é‡ç”¨æˆ·çš„è½¯ä»¶ï¼Œå®ƒä¼šå°†è¿™äº›å°†è¦æŽ¨é€ç»™ç”¨æˆ·çš„ç´ æéƒ½å‘å¸ƒåˆ°å®ƒçš„CDNã€‚ç”¨æˆ·æ”¶åˆ°çš„æœ€ç»ˆå›¾ç‰‡è§†é¢‘çš„åœ°å€å°±æ˜¯ç´ ææ–‡ä»¶åœ¨å¾®ä¿¡/è…¾è®¯CDNä¸Šçš„åœ°å€ã€‚å¯¹CDNæœ‰äº†è§£çš„æœ‹å‹éƒ½çŸ¥é“ï¼ŒCDNæœåŠ¡å™¨åˆ†æ•£åœ¨å…¨å›½æˆ–å…¨ä¸–ç•Œå„åœ°ï¼Œå½“ç”¨æˆ·è¯·æ±‚è¿™ä¸ªèµ„æºçš„æ—¶å€™ï¼Œè¯·æ±‚ä¼šè¢«è·¯ç”±åˆ°ç¦»ç”¨æˆ·æœ€è¿‘çš„CDNæœåŠ¡å™¨ä¸Šã€‚å½“CDNæœåŠ¡å™¨ä¸Šè¿˜æ²¡æœ‰ç¼“å­˜è¯·æ±‚çš„èµ„æºæ—¶ï¼Œè¿™æ—¶å€™æœ‰ä¸ªæº¯æºçš„è¿‡ç¨‹ã€‚å°±æ˜¯åŽŸå§‹æ–‡ä»¶ä»Žæ–‡ä»¶æœåŠ¡å™¨ä¼ é€åˆ°è¯¥CDNæœåŠ¡å™¨çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚è¿™æ—¶ï¼Œç”¨æˆ·æœ‰ä¸€ä¸ªé¢å¤–çš„ç­‰å¾…ï¼Œç­‰å¾…æ—¶é—´å–å†³äºŽæ–‡ä»¶å¤§å°å’ŒCDNæœåŠ¡å™¨å’Œæ–‡ä»¶æœåŠ¡å™¨é—´çš„å¸¦å®½ã€‚\nå¾®ä¿¡ç”¨æ¥ç»™å…¬ä¼—å·æ”¾ç½®ä¸´æ—¶ç´ æçš„CDNåœ¨è¿™ä¸€å—å‡ºäº†é—®é¢˜ã€‚åœ¨æˆ‘ä»¬çš„æµ‹è¯•ä¸­ï¼Œå¾®ä¿¡CDNå¯èƒ½ä¸€ç›´æ— æ³•æä¾›è¿™äº›ä¸´æ—¶ç´ æï¼ˆæŸäº›æ–‡ä»¶è¶…è¿‡1å¤©åŽä»ç„¶æ— æ³•è®¿é—®ï¼‰ã€‚è€Œä¸”å‡ºçŽ°é”™è¯¯çš„å‡ çŽ‡ç›¸å½“é«˜ï¼Œè‡³å°‘20%ä»¥ä¸Šã€‚ç”±äºŽCDNæ— æ³•ä¸ºä¸´æ—¶ç´ ææä¾›å¯é çš„è®¿é—®ä¿éšœï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—å‡ºå¾®ä¿¡ç»™å…¬ä¼—å·ä¸´æ—¶ç´ æè¿™ä¸ªåŠŸèƒ½åŸºæœ¬å°±æ˜¯ä¸èƒ½ç”¨ã€‚\n","link":"https://kane.mx/posts/2016/weixin-temporary-materials/","section":"posts","tags":["weixin","wechat","å¾®ä¿¡","å…¬ä¼—å¹³å°"],"title":"å¦‚ä½•ä½¿ç”¨å¾®ä¿¡å…¬ä¼—å¹³å°çš„ä¸´æ—¶ç´ æ"},{"body":"","link":"https://kane.mx/tags/%E5%BE%AE%E4%BF%A1/","section":"tags","tags":null,"title":"å¾®ä¿¡"},{"body":"","link":"https://kane.mx/tags/pay/","section":"tags","tags":null,"title":"Pay"},{"body":"éšç€AngularJSç­‰å‰ç«¯MVCæ¡†æž¶çš„æµè¡Œï¼ŒAJAXçš„å¼‚æ­¥è¯·æ±‚æ•°æ®ç»“åˆH5çš„push stateç­‰ç‰¹æ€§ï¼Œæžå¤§çš„æ”¹å–„äº†ç½‘ç«™çš„ç”¨æˆ·ä½“éªŒå’Œé¡µé¢åŠ è½½æ€§èƒ½ã€‚è¿™ç±»ç½‘ç«™åº”ç”¨é€šå¸¸åªæœ‰ä¸€ä¸ªå…¥å£é¡µé¢ï¼Œé€šè¿‡åº”ç”¨å†…è·¯ç”±åˆ°ä¸åŒçš„é¡µé¢ï¼Œæ‰€ä»¥ä¿—ç§°å•é¡µé¢(signle page application)åº”ç”¨ã€‚é¡µé¢URLçœ‹èµ·æ¥å¦‚ä¸‹ï¼Œ\nç½‘ç«™é¦–é¡µ http://mysite.com/#/index å•†å“åˆ—è¡¨é¡µ http://mysite.com/#/goods/list å•†å“è¯¦æƒ…é¡µ http://mysite.com/#/goods/skuid ç½‘ç«™å…³äºŽé¡µ http://mysite.com/#/about å¯¹æµè§ˆå™¨è€Œè¨€ï¼Œä¸Šé¢å‡ ä¸ªåœ°å€éƒ½æ˜¯è®¿é—®çš„ç½‘ç«™**/ç›®å½•ï¼Œæ¯ä¸ªurlä¸åŒçš„æ˜¯hashéƒ¨åˆ†ã€‚è€ŒAngularJS**æ­£æ˜¯ä¾èµ–é¡µé¢çš„hashæ¥åšçš„åº”ç”¨å†…è·¯ç”±ï¼Œæ ¹æ®ä¸åŒçš„è·¯ç”±æ¥åŠ è½½ä¸åŒçš„jså’Œhtmlç‰‡æ®µï¼Œå®žçŽ°åŠ¨æ€å†…å®¹çš„åŠ è½½ã€‚\nä¸–ä¸Šå¹¶æ²¡æœ‰ç»å¯¹å®Œç¾Žçš„äº‹æƒ…ï¼Œå•é¡µé¢åº”ç”¨åœ¨ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½ä¸ŠèŽ·å¾—äº†å¥½å¤„ã€‚ç„¶è€Œï¼Œåœ¨åˆ«çš„åœ°æ–¹å¿…ç„¶ä»˜å‡ºä»£ä»·ã€‚è¿™é‡Œå°±åˆ†äº«ä¸€ä¸‹å•é¡µé¢åº”ç”¨å’Œå¾®ä¿¡æ”¯ä»˜é›†æˆçš„ä¸€äº›ç»éªŒã€‚\nè¿™é‡Œçš„å¾®ä¿¡æ”¯ä»˜æŒ‡çš„æ˜¯ï¼Œåœ¨å¾®ä¿¡æµè§ˆå™¨ä¸­é€šè¿‡JSæŽ¥å£è°ƒèµ·å¾®ä¿¡æ”¯ä»˜æ¥å®Œæˆç½‘é¡µåº”ç”¨ä¸­å•†å“çš„è´­ä¹°ã€‚å¾®ä¿¡æ”¯ä»˜æœ¬èº«çš„å¼€å‘é›†æˆå¹¶ä¸å¤æ‚ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚å¾®ä¿¡æ”¯ä»˜å‡ºäºŽå®‰å…¨è€ƒè™‘ï¼Œè¦æ±‚å…¬ä¼—å·å¿…é¡»æ³¨å†Œæ”¯ä»˜å‘èµ·é¡µé¢çš„åœ°å€ï¼ˆåˆ°æ”¯ä»˜é¡µé¢çš„ä¸Šçº§ç›®å½•ä¸ºæ­¢ï¼‰ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ·»åŠ åˆ°ç™½åå•çš„åœ°å€ä¸è¶…è¿‡3ä¸ªã€‚ä¹Ÿå°±æ˜¯å¦‚æžœåº”ç”¨åœ¨å•†å“è¯¦æƒ…é¡µå‘èµ·æ”¯ä»˜è¯·æ±‚ï¼Œé‚£ä¹ˆåœ°å€**http://mysite.com/#/goods/**å¿…é¡»åœ¨ç™½åå•åˆ—è¡¨ã€‚\nç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡éƒ½å¾ˆå¥½ç†è§£ï¼ŒæŠŠæ”¯ä»˜é¡µé¢åŠ åˆ°å¾®ä¿¡æ”¯ä»˜ç™½åå•ä¸å°±ä¸‡äº‹å¤§å‰äº†ã€‚å¯ç»è¿‡å®žæµ‹ï¼Œäº‹å®žç¡®ä¸æ˜¯è¿™ä¹ˆç®€å•ï¼\nåœ¨å¾®ä¿¡iOSç‰ˆæœ¬ä¸­ï¼Œå¾®ä¿¡æ”¯ä»˜JSä¼šé”™è¯¯çš„ä½¿ç”¨landingç½‘ç«™é¡µé¢çš„URLï¼Œè€Œä¸æ˜¯å‘èµ·æ”¯ä»˜çš„é¡µé¢URLï¼æ¯”å¦‚ç”¨æˆ·é€šè¿‡ç½‘ç«™é¦–é¡µ**http://mysite.com/#/indexè¿›å…¥åº”ç”¨ï¼Œé€šè¿‡ç«™å†…é“¾æŽ¥æµè§ˆåˆ°äº†æŸå•†å“è¯¦æƒ…é¡µhttp://mysite.com/#/goods/skuidå¹¶å‘èµ·äº†æ”¯ä»˜ã€‚ä½†å¾®ä¿¡JSä¼šæŠŠlandingé¡µé¢URLhttp://mysite.com/#/index**åˆ¤å®šä¸ºæ”¯ä»˜çš„å‘èµ·é¡µé¢ï¼Œä»Žè€Œå¯¼è‡´æ”¯ä»˜JSè°ƒç”¨å¤±è´¥ï¼\nå› ä¸ºåº”ç”¨å­˜åœ¨å¤šä¸ªé¡µé¢ï¼Œä¸å¯èƒ½æŠŠæ‰€æœ‰çš„é¡µé¢éƒ½åŠ åˆ°æ”¯ä»˜ç™½åå•ä¸­(æœ‰3ä¸ªæ•°ç›®é™åˆ¶ï¼Œå¹¶ä¸”å·¥ä½œé‡ä¹Ÿå¤§åˆ°ä¸çŽ°å®ž)ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªå¥½å¦è¾Ÿè¹Šå¾„ã€‚æˆ‘ç›®å‰æ‰¾åˆ°çš„æ–¹æ³•æ˜¯ï¼Œå¼ºåˆ¶åˆ·æ–°é¡µé¢å½“æ‰“å¼€å•†å“è¯¦æƒ…é¡µçš„æ—¶å€™ã€‚ç­‰åŒäºŽç›´æŽ¥åœ¨å¾®ä¿¡æµè§ˆå™¨ä¸­æ‰“å¼€äº†å•†å“è¯¦æƒ…é¡µã€‚è™½ç„¶å¯¹ç”¨æˆ·ä½“éªŒæœ‰äº›å½±å“ï¼Œä½†æ”¯ä»˜åŠŸèƒ½æ­£å¸¸å·¥ä½œäº†ã€‚\n","link":"https://kane.mx/posts/2016/single-page-app-meets-weixin-pay/","section":"posts","tags":["weixin","wechat","pay","æ”¯ä»˜"],"title":"å•é¡µé¢åº”ç”¨(single page application)ä¸­ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜"},{"body":"","link":"https://kane.mx/tags/%E6%94%AF%E4%BB%98/","section":"tags","tags":null,"title":"æ”¯ä»˜"},{"body":"æœ€è¿‘åœ¨æäº¤å‰ç«¯ä»£ç åŽï¼Œå‰ç«¯ä»£ç çš„è‡ªåŠ¨å‘å¸ƒè€æ˜¯å¤±è´¥ã€‚å¤±è´¥çš„åŽŸå› å¤šæ˜¯ç¼–è¯‘Dockeré•œåƒæ—¶åœ¨æ‰§è¡ŒCOPYè¯­å¥æ‹·è´æ–‡ä»¶åˆ°é•œåƒæ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œæ‰”å‡ºäº†'No space left on device'è¿™ä¸ªé”™è¯¯ã€‚è¿™ä¸ªé”™è¯¯æ ¹æ®æè¿°éžå¸¸å¥½ç†è§£ï¼Œå°±æ˜¯dockeræ–‡ä»¶ç³»ç»Ÿæ‰€åœ¨ç£ç›˜æ²¡æœ‰äº†ç©ºé—´ã€‚\nä½†æ˜¯é€šè¿‡df -hå‘½ä»¤ï¼Œè¯¥ç£ç›˜è‡³å°‘è¿˜æœ‰3ï¼Œ4ä¸ªGçš„å‰©ä½™ç©ºé—´ã€‚è€Œå‰ç«¯é•œåƒçš„æ–‡ä»¶å¤§å°æœ€å¤šä¹Ÿä¸è¶…è¿‡300Mã€‚åœ¨è¯¥ç£ç›˜é€šè¿‡touch,cpä»ç„¶å¯ä»¥åˆ›å»ºæ–‡ä»¶ã€‚\næ‰€ä»¥è¿™ä¸ªé—®é¢˜éžå¸¸å¥‡æ€ªï¼Œä¸ºä»€ä¹ˆdockeræˆ–è€…æ“ä½œç³»ç»ŸæŠ±æ€¨ç£ç›˜æ²¡æœ‰äº†ç©ºé—´ï¼Ÿåœ¨ç£ç›˜ä»ç„¶å‰©ä½™æ•°ä¸ªGçš„æƒ…å†µä¸‹ï¼Ÿ\nå†é€šè¿‡ç›¸å…³çš„æŸ¥æ‰¾åŽï¼Œdockerçš„è¿™ä¸ªissueç»™äº†æˆ‘å¯å‘ã€‚Linuxæ–‡ä»¶ç³»ç»Ÿçš„inodeåœ¨è€—å°½åŽï¼Œè¯¥æ–‡ä»¶ç³»ç»Ÿå°†ä¸èƒ½å†åˆ›å»ºæ–°æ–‡ä»¶ã€‚å› ä¸ºå‰ç«¯é¡µé¢æ˜¯åŸºäºŽnodejsçš„ç¨‹åºï¼Œå®ƒä¾èµ–çš„packagesäº§ç”Ÿäº†å¤§é‡æ–‡ä»¶ï¼Œåœ¨åå¤åˆ¶ä½œä¸åŒçš„docker imagesæ—¶ï¼Œè¿™äº›ä¾èµ–æ–‡ä»¶åˆè¢«åå¤å¤åˆ¶ï¼Œå¯¼è‡´æ–‡ä»¶æ•°é‡è¿œè¿œè¶…è¿‡äº†é»˜è®¤inodeå’Œç£ç›˜å¤§å°çš„æ¯”ä¾‹ï¼Œæœ€ç»ˆinodeå…ˆäºŽç£ç›˜ç©ºé—´è¢«å…¨éƒ¨ä½¿ç”¨ã€‚\né‡åˆ°ç±»ä¼¼é—®é¢˜çš„åŒå­¦ï¼Œå¯ä»¥é€šè¿‡df -iæŸ¥çœ‹inodeçš„ä½¿ç”¨æƒ…å†µæ¥æŽ’æŸ¥é—®é¢˜æ˜¯å¦ç”±äºŽinodeè€—å°½å¯¼è‡´è¿™ä¸ªé”™è¯¯ã€‚\n","link":"https://kane.mx/posts/2016/docker-build-no-space-left-caused-by-inode-exhausted/","section":"posts","tags":["docker","troubleshoot"],"title":"æ–‡ä»¶ç³»ç»Ÿçš„Inodeè€—å°½ï¼Œä¼šå¯¼è‡´Dockerç¼–è¯‘é•œåƒå‡ºçŽ°'No space left on device'é”™è¯¯"},{"body":"","link":"https://kane.mx/tags/daemon/","section":"tags","tags":null,"title":"Daemon"},{"body":"Recently I wrote a Linux like initd script to start/stop my web application.\nThe script works well when running it in shell of linux. The web application will run in background by daemon.\nHowever I found both daemon and web application(java) exited immediately if I started the script in Jenkins as a shell step of build process.\nI put below simple script in 'Execute shell' block,\n1daemon --name=test-daemon -- sleep 200sleep 60 The process 'daemon' and 'sleep 200' should exit after 200 seconds the 'sleep' exits. The jenkins job will be finished in 60 secs.\njenkins 9954 9950 0 21:48 ? 00:00:00 sleep 60 jenkins 9955 1 0 21:48 ? 00:00:00 daemon â€”name=test-daemon â€” sleep 200 jenkins 9956 9955 0 21:48 ? 00:00:00 sleep 200 Above is the process info queried via ps command. The father pid of daemon is 1, not the script generated by Jenkins.\nBut both the process 'daemon' and 'sleep 200' immediately exited when the script finished. Should be something wrong in Jenkins to cause daemon exited unexpected.\nIt's something really frustrating to use daemon to stop/start the web application in Jenkins.\nFinally I used docker container to run my web application, which easily can be stopped/started via script in Jenkins.\n","link":"https://kane.mx/posts/archive/blogspot/daemon-hell-in-jenkins/","section":"posts","tags":["docker","daemon","jenkins","jenkins-cli"],"title":"Daemon hell in Jenkins"},{"body":"","link":"https://kane.mx/tags/jenkins-cli/","section":"tags","tags":null,"title":"Jenkins-Cli"},{"body":"","link":"https://kane.mx/tags/java/","section":"tags","tags":null,"title":"Java"},{"body":"","link":"https://kane.mx/tags/mac-osx/","section":"tags","tags":null,"title":"Mac OSX"},{"body":"After uninstalling some applications from my Mac OSX, I found the applications that depends on JRE totally does not work. I noticed below symptoms,\nEclipse Mars can not be launched, even though I specified the launching vm to another one(`java -version` still work). The SWT native library failed to resolve the dependencies to '/System/Library/Frameworks/JavaVM.framework/Versions/A/JavaVM' which does not exists. I tried to reinstall Oracle 1.8.0_u45 via both brew and dmg image downloaded from Oracle website, both ways were failed as well. The Mac pkg Installer can not be started due to dylib broken. It means I can't install any pkg via GUI. The command line(such as sudo installer -verboseR -target / -pkg /Volumes/OS\\ X\\ 10.10.4\\ Update\\ Combo/OSXUpdCombo10.10.4.pkg) still works. Finally I realized the problem was caused by I uninstalled the out of date Apple Java 6. Looks like all of above failures are required the system built-in Java. It really does not make sense the Oracle 1.8 installer script to depend on the out of date Java.\nFinally I reinstalledÂ Java for OS X 2014-001 to make everything working again. The GUI installer for pkg still does not work, you need use below command to use the pkg.\nsudo installer -verboseR -target / -pkg /Volumes/Java\\ for\\ OS\\ X\\ 2014-001/JavaForOSX.pkg\n","link":"https://kane.mx/posts/archive/blogspot/the-symptoms-of-java-broken-in-mac-osx/","section":"posts","tags":["Java","Mac OSX","troubleshoot"],"title":"The symptoms of Java broken in Mac OSX 10.10 and fix solution"},{"body":"","link":"https://kane.mx/tags/groovy/","section":"tags","tags":null,"title":"Groovy"},{"body":"Jenkins supports ssh authentication in CLI.\nBelow is a command to verify that I am authenticated:\n1 2java -jar jenkins-cli.jar -sÂ http://myserver/jenkinsÂ who-am-i 3 4Â Authenticated as: myuser 5Â Authorities: 6Â authenticated However you still would meet permission error when running groovy script in CLI.\n1 2java -jar jenkins-cli.jar -sÂ http://myserver/jenkinsÂ groovysh \u0026#39;jenkins.model.Jenkins.instance.pluginManager.plugins.each { println(\u0026#34;${it.longName} - ${it.version}\u0026#34;) };\u0026#39; 3 4Exception in thread \u0026#34;main\u0026#34; java.lang.reflect.UndeclaredThrowableException 5at $Proxy2.main(Unknown Source) 6at hudson.cli.CLI.execute(CLI.java:271) 7at hudson.cli.CLI._main(CLI.java:417) 8at hudson.cli.CLI.main(CLI.java:322) It's a bug of Jenkins. The workaround is create a groovy script, then run that script via Jenkins CLI.\n1java -jar jenkins-cli.jar -sÂ http://myserver/jenkins/Â groovyÂ test_script.gsh ","link":"https://kane.mx/posts/archive/blogspot/run-groovy-script-via-jenkins-cli/","section":"posts","tags":["groovy","jenkins","jenkins-cli"],"title":"Run groovy script via Jenkins CLI"},{"body":"","link":"https://kane.mx/tags/lucene/","section":"tags","tags":null,"title":"Lucene"},{"body":"","link":"https://kane.mx/tags/solr/","section":"tags","tags":null,"title":"Solr"},{"body":"The index has a field named 'create_time' that is the timestamp of document created time. The query string can boost the latest created document like below,\n{!boost b=recip(ms(NOW,create_time),3.16e-11,0.08,0.05)}name:keyword\nThere is another field named 'important' that indicates whether the document is important or not. The query string can boost the document is important like below,\nq={!boost b=$importfunc}name:keyword\u0026amp;importfunc=query({!v='important:true'})\nAbove query string uses a sub query in boost function.\nFinally I want to boost both above two fields, and 'important' field has higher priority. The query string looks like below,\ndefType=edismax\u0026amp;q=name:keyword\u0026amp;bf=query({!v='import:true'})^20.0 recip(ms(NOW,create_time),3.16e-11,0.08,0.05)^10.0\u0026quot;)\n","link":"https://kane.mx/posts/archive/blogspot/solr-boost-examples/","section":"posts","tags":["lucene","solr"],"title":"Solr boost examples"},{"body":"","link":"https://kane.mx/tags/django/","section":"tags","tags":null,"title":"Django"},{"body":"It's a common and ugly problem when using non-ascii characters in Django.\nThe general solution is below,\nput # -- coding: utf-8 -- at beginning of every python source files that are using utf-8 characters declare every string variable as unicode, such as str_var = u'ä¸­æ–‡å­—ç¬¦' add a __unicode__ method in your model classes if you are running server on apache/mod_wsgi or ngnix, you need configure web server to use utf-8 encoding ","link":"https://kane.mx/posts/archive/blogspot/djangos-unicdoe-encode-error/","section":"posts","tags":["django","encoding","python"],"title":"Django's unicdoe encode error"},{"body":"","link":"https://kane.mx/tags/encoding/","section":"tags","tags":null,"title":"Encoding"},{"body":"","link":"https://kane.mx/tags/python/","section":"tags","tags":null,"title":"Python"},{"body":"","link":"https://kane.mx/tags/eclipse/","section":"tags","tags":null,"title":"Eclipse"},{"body":"","link":"https://kane.mx/tags/mountain-lion/","section":"tags","tags":null,"title":"Mountain Lion"},{"body":"","link":"https://kane.mx/tags/php/","section":"tags","tags":null,"title":"Php"},{"body":"I installed both Zend CE and zend debugger of Eclipse on my Mac. Both of them work well in Mac lion.Â However they don't work any more after I upgraded my Mac to mountain lion.Â After some investigation I found some extensions of Zend PHP can't be loaded due to shared library dependency can't be found in mountain lion. The xslt module of PHP depends on some system libraries(suc as /usr/local/libxslt-1.1.23/lib/libxslt.1.dylib) that have been removed by mountain lion.\nThe temporary solution is disabling xlst module of zend PHP if your application doesn't need them.Â The workaround fix of Zend CE on Mac,Â rename /usr/local/zend/lib/php_extensions/xsl.so to any other name\nThe workaround fix of zend debugger for Eclipse,Â Delete the line extension=xsl.so from file /plugins/org.zend.php.debug.debugger.macosx_5.3.18.v20110322/resources/php53/php.ini\n","link":"https://kane.mx/posts/archive/blogspot/workaround-of-making-zend-ce-mountain-lion/","section":"posts","tags":["zend ce","zend debugger","workaround","Eclipse","php","mountain lion"],"title":"The workaround of making Zend CE/Zend debugger work on mountain lion"},{"body":"","link":"https://kane.mx/tags/workaround/","section":"tags","tags":null,"title":"Workaround"},{"body":"","link":"https://kane.mx/tags/zend-ce/","section":"tags","tags":null,"title":"Zend Ce"},{"body":"","link":"https://kane.mx/tags/zend-debugger/","section":"tags","tags":null,"title":"Zend Debugger"},{"body":"","link":"https://kane.mx/tags/dual-monitor/","section":"tags","tags":null,"title":"Dual Monitor"},{"body":"I had two monitors for my workstation. One is 22' and the another is 17'. I used the small one as a extend desktop.\nToday I get a another 23' monitor to replace the small one. However the resolution of the 23' monitor can't be changed after pluging it in. It always used the resolution matching the 17' one.\nBoth 'Setting - Display' and 'AMD Catalyst control' can't adjust it as higher resolution.\nAfter some tuning, I found a workaround.\nI totally remove all config of small one from /etc/X11/xorg.conf. Then change its resolution in 'AMD Catalyst control', it works!\n","link":"https://kane.mx/posts/archive/blogspot/dual-monitors-on-ubuntu/","section":"posts","tags":["Tip","Ubuntu","Dual monitor","Trick"],"title":"Dual monitors on Ubuntu"},{"body":"","link":"https://kane.mx/tags/trick/","section":"tags","tags":null,"title":"Trick"},{"body":"","link":"https://kane.mx/tags/ubuntu/","section":"tags","tags":null,"title":"Ubuntu"},{"body":"I want to create a test server for my application. Using embedding Http server in equinox is my first option.\nI had experience using simple http service implementation of equinox, however I want to play with Jetty this time.\nFollowing the guide of Equinox server, I can't running a Jetty server with my servlet in Eclipse Indigo. Obviously the guide is out of date.\nAfter tuning it, I found below bundles are minimum collection to run Jetty inside OSGi runtime.\nYou only need create a run configuration of OSGi framework, add your bundles with servlets and above bundles.\n","link":"https://kane.mx/posts/archive/blogspot/embedding-http-server-in-equinox/","section":"posts","tags":["Equinox","Jetty","OSGi"],"title":"Embedding an HTTP server in Equinox"},{"body":"","link":"https://kane.mx/tags/equinox/","section":"tags","tags":null,"title":"Equinox"},{"body":"","link":"https://kane.mx/tags/jetty/","section":"tags","tags":null,"title":"Jetty"},{"body":"","link":"https://kane.mx/tags/osgi/","section":"tags","tags":null,"title":"OSGi"},{"body":"Sometimes I need access the Intranet of company, however I don't like to create VPN connection. The connection is slow, waste time to create the connection and have to change password due to security policy.\nMy workstation is Linux, which has a lot of utility tools to help me access Intranet at home without VPN.\nFirstly I set up a ssh server on my personal computer. It's quite easy if you are using Linux, for Windows I installed Copssh.\nThen register a free domain name and configure it in my router. And let router forward port 22(or any port you wan to use) to my personal computer.\nIn my working Linux machine, create a ssh tunnel to my personal computer. Must use the public/private key for authenticating. For example,\nIt means remote server can access my workstation's port 22 via accessing its port 1002 after the ssh tunnel is created successfully. Above command line also forwards the ports 5900 and 6500. The default VNC session will listen the port 5900.\nBut it only works when my personal computer is running. And the connection can't be reconnected after it fails once.\nThe graceful solution is installing 'autossh' in my Linux, which is an utility to retry the ssh connection with an interval if it's disconnected or failed.\nThen create a script and running it when OS is booted. The script will be executed by root user, so we need configure it ran by the normal user.\nAfter my personal computer is booted a while(the default interval of autossh is 300 seconds), I can use localhost:10002 to login my workstation, localhost:5900 to access my VNC session. Of course you can use 'froxyproxy' of Firefox via a localport to access web page of Intranet.\n","link":"https://kane.mx/posts/archive/blogspot/acess-intranet-without-vpn/","section":"posts","tags":["ssh"],"title":"Acess Intranet without VPN"},{"body":"","link":"https://kane.mx/tags/ssh/","section":"tags","tags":null,"title":"Ssh"},{"body":"","link":"https://kane.mx/tags/configuration/","section":"tags","tags":null,"title":"Configuration"},{"body":"","link":"https://kane.mx/tags/gerrit/","section":"tags","tags":null,"title":"Gerrit"},{"body":"An internal Gerrit server was moved, so the hostname of server is changed. However we are using OpenID for user control, the OpenID provider(such as Google account) will generate a new token for the new server(hostname changing will impact the identity token of Google account) when we login Gerrit with same OpenID account. Gerrit will create a new internal account by default even though my OpenID account has existed in the system and has a lot of activities.\nThe solution is updating the 'ACCOUNT_EXTERNAL_IDS' table of Gerrit via gsql. Setting the 'ACCOUNT_ID' to your existing account_id for the new record whose 'EXTERNAL_ID' is the new token gotten from Google.\nupdate ACCOUNT_EXTERNAL_IDS set ACCOUNT_ID='1000001' where EXTERNAL_ID='https://www.google.com/accounts/o8/id?id=xxxxxxxxxx';\nThen search the documentation of Gerrit, I find a configuration property looks like supporting such a migration for OpenID authentication.\nauth.allowGoogleAccountUpgrade\nAllows Google Account users to automatically update their Gerrit account when/if their Google Account OpenID identity token changes. Identity tokens can change if the server changes hostnames, or for other reasons known only to Google. The upgrade path works by matching users by email address if the identity is not present, and then changing the identity.\nThis setting also permits old Gerrit 1.x users to seamlessly upgrade from Google Accounts on Google App Engine to OpenID authentication.\nHaving this enabled incurs an extra database query when Google Account users register with the Gerrit server.\nBy default, unset/false.\n","link":"https://kane.mx/posts/archive/blogspot/how-to-reuse-existing-openid-accounts/","section":"posts","tags":["OpenID","gerrit","configuration"],"title":"How to reuse the existing OpenID accounts after the host name of Gerrit server is changed"},{"body":"","link":"https://kane.mx/tags/openid/","section":"tags","tags":null,"title":"OpenID"},{"body":"","link":"https://kane.mx/tags/certificate/","section":"tags","tags":null,"title":"Certificate"},{"body":"The problem came from I tried to set up send mail server(SMTP) for my Gerrit server. My Gerrit server is using OpenID for user authorization, so I registered a new email account to send notification from Gerrit.\nMost of email service providers require the secure authorization when using its SMTP server to send mail. However the root CA of my email provider is not added into the default certificate of JRE. So Gerrit always failed to send email due to ssl verification exception.\nMy solution is adding the certificate of SMTP server into the certificate used by JRE.\nThe detail steps are below,\nUse open_ssl utility to the certificate of SMTP server or its root CA of email provider. Below command can list the certificate of SMTP and its chain. You can paste any of them into a file.\nopenssl s_client -connect smtp.163.com:465\nThen import the certificate saved in previous step into my JRE's key store. The default password of JRE's default keystore is 'changeit'. You can find the cacerts under jre/lib/security folder.\nsudo keytool -import -keystore cacerts -alias Smtp163com -file /tmp/smtp.163.PEM\n","link":"https://kane.mx/posts/archive/blogspot/jrejdks-certificate-issue-and-solution/","section":"posts","tags":["Java","gerrit","configuration","smtp","certificate"],"title":"JRE/JDK's certificate issue and solution"},{"body":"","link":"https://kane.mx/tags/smtp/","section":"tags","tags":null,"title":"Smtp"},{"body":"","link":"https://kane.mx/tags/build/","section":"tags","tags":null,"title":"Build"},{"body":"","link":"https://kane.mx/tags/maven/","section":"tags","tags":null,"title":"Maven"},{"body":"I successfully converted our product build from PDE build to Maven/Tycho. Something is worth to be documented here.\nThere are several examples and posts to demonstrate how using Tycho building your Eclipse plug-ins, features, applications and products. The most helpful example is the demo of Tycho project.\nBelow are some traps I met when building my project by Tycho,\nproduct build\nOur product is based on plug-ins, however we added the 'featurelist' in build.properties of PDE build to include some root binary for the product. However Tycho doesn't support this type of build, we create some features as the placeholder of plug-ins. Then change the product as features based. You have to manually remove the plugins tag in .product definition file, otherwise Tycho will fail on strange error if the .produce has both features and plugins tag. Then configure the director plugin as not installing features.\norg.eclipse.tycho\ntycho-p2-director-plugin\n${tycho-version}\nmaterialize-products\nmaterialize-products\nfalse\nmyappprofile\narchive-products\narchive-products\nAnd I used below way to customize the qualifier string of our build.\norg.eclipse.tycho tycho-packaging-plugin ${tycho-version} '${qualifier-prefix}_'yyyyMMddHHmm An limitation of director plugin is that no way using different profile name for the application installed on different hosts. I contributed a patch on bug 362550 for this enhancement.\nfeature build\nWe have some features to pack some binary files as root files. But Tycho doesn't support root folder that is recognized by PDE build. The workaround is creating an additional folder, then put the root files into it.\nMeanwhile Tycho doesn't support wildcard to other native touch points, such as changing the files permission. For static file list use comma separated list as workaround.\neclipse test plug-in\nI have a plug-in whose scope is 'test', but it doesn't have test case and no dependency for any test framework, such as junit 3.8 or junit 4. And it's used for mocking test server. Configure surefire plugin to let it build as test plug-in as well.\norg.eclipse.tycho\ntycho-surefire-plugin\n${tycho-version}\njunit\njunit\n4.1\nfalse junit\njunit\n4.1\nAnd configure the surefire plugin like below to test code in Maven build.\norg.eclipse.tycho\ntycho-surefire-plugin\n${tycho-version}\nmy.group\nmy.feature\n${version}\neclipse-feature\nmy.group\nmy.testserver\n1.0.0\neclipse-plugin\n${testSuiteName}\n${testClassName} -Dcom.sun.management.jmxremote\n-consoleLog\norg.eclipse.equinox.ds\n1\ntrue\nsign jars\nAdd below signjar plugin into parent pom.xml, however I met the md5 error when materializing the repository built on .product. There is a workaround mentioned on Bug 344691.\norg.apache.maven.plugins maven-jarsigner-plugin 1.2 ${keystore} MyCompany ${storepass} ${keypass} true ${skip.jar.signing} -tsa https://timestamp.geotrust.com/tsa **/artifacts.jar **/content.jar jar eclipse-plugin eclipse-feature eclipse-test-plugin sign sign verify verify ","link":"https://kane.mx/posts/archive/blogspot/tips-of-maventycho-building/","section":"posts","tags":["Maven","Eclipse","build","Tycho"],"title":"The tips of Maven/Tycho building crossplatform RCP and repository"},{"body":"","link":"https://kane.mx/tags/tycho/","section":"tags","tags":null,"title":"Tycho"},{"body":"","link":"https://kane.mx/tags/clearcase/","section":"tags","tags":null,"title":"Clearcase"},{"body":"Several days ago I had a post to record the unsuccessful experience to migrate source code from Clearcase to Git.\nWe have a new way after doing some brain storms. This way still is not a perfect solution, but it's much better than previous trial.\nUse clearexport_ccase to export the source folder to intermittent data. See documentation of Clearcase admin. Create a temporary vob for importing the data later. See example. Import the data into temporary vob. See example. Repeat step 1 to 3 for importing all necessary data into temporary vob. Use the SVN Importer to import the temporary vob as Subversion repository. Last steps refer to a documentation of succeeded migration case of one of Eclipse project from Subversion to Git. Git definitely is greatest SCM tool now. The size of Subversion repository is around 10GB, finally the Git repository is less than 700MB, which saves more than 10 times disk space. It's awesome!\nThe flaw of this way is that the removed elements in Clearcase(said using Main/LATEST as cspec of Clearcase vob when exporting) would lose after importing into a temporary vob. So switching to a maintenance branch or tag like 1.0/2.0 in Git, the source code is incomplete. The files existed in that branch or tag, then removed in latest code base are lost. The workaround could be manually checking in GA version to have complete code.\nIf anybody have graceful and perfect solution to migrate Clearcase to Git, I think he could start a new business. :)\n","link":"https://kane.mx/posts/archive/blogspot/migration-clearcase-to-git-part-2/","section":"posts","tags":["Git","Clearcase"],"title":"Migration Clearcase to Git -- part 2"},{"body":"I tried to migrate the source code of project from Clearcase to Git repository. As far as I know there is no elegant solution for such migration. For purpose of this migration, I want to keep the history and label of files in Clearcase after migrating to Git repository.\nThere are mature tools to migrate CVS/SVN repository to Git, so I tried to use Subversion as a bridge for my migration.\nI used a free software 'SVN Importer' to import the Clearcase vobs to Subversion. The tool is great, and it keeps the history of files, labels and branches. The entire size of new Subversion repository has near 50GB which is unacceptable size of Git repository. The subversion repository contains a lot of legacy code and unwanted binaries, so removing those revisions could significantly reduce the size of subversion repository. And subversion provides some admin tools to manipulate the metadata of subversion, it's possible to remove the unnecessary revisions and re-create a subversion repository with refined content. But I don't have any experience to use the admin tool of subversion before, I failed to filter the unwanted data. It's not worthy of costing too much effects on it. Finally I failed to filter the subversion repository.\nActually the detail history of files is rarely used. If need, we still can find it in Clearcase. At last I manually checked in the released version of our project into Git repository, and tagged them.\nWrote this unsuccessful idea here for elapsed efforts.\n","link":"https://kane.mx/posts/archive/blogspot/migrate-clearcase-to-git/","section":"posts","tags":["Git","Clearcase"],"title":"Migrate Clearcase to Git"},{"body":"","link":"https://kane.mx/tags/p2/","section":"tags","tags":null,"title":"P2"},{"body":"Our p2 based on installer suffered performance issue when querying IUs from repositories. Though the repositories have a large number of IUs to be queried, but we find the performance of using QL is unacceptable in some special scenarios.\nI published several different methods to find the expected IUs. Thomas pointed out the better expression of QL and finally helped us to find out the our repository without IIndexProvider implementation.\nIIndexProvider implementation of a repository is quite important to improve the performance of QL, especially use the 'traverse' clause to query something.\nAnd Slicer API is an alternative method when querying the complete dependencies.\n","link":"https://kane.mx/posts/archive/blogspot/p2-query-performance/","section":"posts","tags":["p2","performance"],"title":"p2 query performance"},{"body":"","link":"https://kane.mx/tags/performance/","section":"tags","tags":null,"title":"Performance"},{"body":"","link":"https://kane.mx/tags/compile/","section":"tags","tags":null,"title":"Compile"},{"body":"Yesterday I modified an existing c++ application for Windows. And its default build environment is Makefile and MinGW.\nHowever I used a newly Windows API that is not included by header files of MinGW.\nFirst of all, I copied the constant definition from header file of Windows SDK, and defined the Windows API method as a extern C method. So it's no problem to compile the code in MinGW.\nSecondly I have to fix the link issue. Because the symbol of the Windows API also can't be found by gcc link.\nHere great thanks to Google. It's quite easy to get the knowledge from others.\nI found a way to create an library by using dlltool. Dlltool is a utility to create an library with specified methods from existing dll library, which can be used by gcc link later.\nBelow are links I referred to create an import library,\n[1] http://www.emmestech.com/moron_guides/moron1.html\n[2] http://www.mingw.org/wiki/CreateImportLibraries\n[3] http://lists-archives.org/mingw-users/19461-import-library-for-c.html\n","link":"https://kane.mx/posts/archive/blogspot/create-import-library-for-building/","section":"posts","tags":["compile","MinGW"],"title":"Create an import library for building application in MinGW"},{"body":"","link":"https://kane.mx/tags/mingw/","section":"tags","tags":null,"title":"MinGW"},{"body":"The documentation of PDE has a chapter for this topic. Basically it's simply. Copy the template scripts what you want from templates/headless-build folder under org.eclipse.pde.build plug-in to your build configuration directory that is the folder has build.properties file.\nHowever I found the variables listed in template 'customAssembly.xml' can't be used in the runtime. I filed bug 346370 against it.\n","link":"https://kane.mx/posts/archive/blogspot/customize-pde-build/","section":"posts","tags":["PDE","Eclipse","build"],"title":"Customize PDE build"},{"body":"","link":"https://kane.mx/tags/pde/","section":"tags","tags":null,"title":"PDE"},{"body":"","link":"https://kane.mx/tags/code-signing/","section":"tags","tags":null,"title":"Code Signing"},{"body":"I did sign the jars via reusing the existing certificate of Windows code signing several months ago. Writing it down for further reference.\nWhatever your purpose of reusing the existing Windows code certificate, I only document the way from technical perspective.\nAfter buying the certificate of Windows code signing from CA, you will get a .pvk file that stores both the certificate and private key. PVK file is the PKCS12 format[1], however java uses JKS format by default. So you need convert the pvk file to JKS keystore and certificate.\nSince 6.0 JDK supports PKCS12 directly, you can use 'jarsigner' and PVK file to sign jars directly[2].\n1jarsigner -keystore /working/mystore.pvk -storetype pkcs12 -storepass myspass -keypass j638klm -signedjar sbundle.jar bundle.jar jane Or using keytool to convert the PKCS#12 to JKS format[3] if using Eclipse PDE build to sign your jars.\n1keytool -importkeystore -srckeystore KEYSTORE.pvk -destkeystore KEYSTORE.jksÂ -srcstoretype PKCS12 -deststoretype JKS -srcstorepass mysecret -deststorepass mysecret -srcalias myalias -destalias myalias -srckeypass mykeypass -destkeypass mykeypass -nopromptÂ [1] http://en.wikipedia.org/wiki/PKCS\n[2] http://download.oracle.com/javase/6/docs/technotes/tools/solaris/jarsigner.html\n[3] http://shib.kuleuven.be/docs/ssl_commands.shtml#keytool\n","link":"https://kane.mx/posts/archive/blogspot/using-certificate-of-windows-code/","section":"posts","tags":["code signing","java","certificate"],"title":"Using the certificate of Windows code signing to sign jars"},{"body":"I met that firefox/thunderbird complained another its instance running even if no a running firefox/thunderbird process. Finally let them run again after removing the '.parentlock' file in their default profile.\nstrace utility helps me a lot to find the solution.\nstrace -f -e file firfox\n","link":"https://kane.mx/posts/archive/blogspot/unlock-locked-profile-if/","section":"posts","tags":null,"title":"Unlock the locked profile if firefox/thunderbird crash"},{"body":"I implemented the replication tool at the end of 2009, then published it to Eclipse Marketplace in May 2010. However it's not pervasively used due to users have to install that plug-in firstly.\nI searched a similar request on bugzilla, then I initialized my contribution in the early of this year. Finally it was accepted and will release as part of eclipse itself since Eclipse 3.7 M7! I hope it would benefit the users of Eclipse more and more.\nAnd I was nominated and elected as the committer of Equinox p2, it's a great honor for me. :)\n","link":"https://kane.mx/posts/archive/blogspot/eclipse-p2s-importexport-capability/","section":"posts","tags":["Equinox","p2","Eclipse","feature"],"title":"Eclipse P2's import/export capability"},{"body":"","link":"https://kane.mx/tags/feature/","section":"tags","tags":null,"title":"Feature"},{"body":":g!/some expression/d\n","link":"https://kane.mx/posts/archive/blogspot/vim-delete-lines-not-contain-words/","section":"posts","tags":null,"title":"[vim] delete the lines not contain words"},{"body":"Recently our installer met a strange bug, it didn't uninstall all legacy bundles after updating to new version. Finally I found it's due to a magic fragment is missing in the profile due to some causes.\ninstallBundle(bundle:${artifact})\nuninstallBundle(bundle:${artifact})\nsetStartLevel(startLevel:4);\nIt has 'hostRequirements' element that represents it's a fragment IU and match all the eclipse's plug-ins in that profile. And this fragment defines the touch point actions for its hosts that will do installBundle action during 'install' phrase and uninstallBundle action during 'uninstall' phrase. It's a very good way to remove the duplicate touch point definitions for all eclipse's plug-ins in the profile.\nBTW, p2's engine also doesn't attach this fragment to the eclipse's plug-in IU if the top level IU doesn't have the STRICT rule. I'm not sure the root cause of designing for it, but it's the fact.\n","link":"https://kane.mx/posts/archive/blogspot/inside-p2s-profile-2-fragment-matches/","section":"posts","tags":["p2","Eclipse","profile"],"title":"Inside P2's profile (2) - the fragment matches all osgi bundles"},{"body":"","link":"https://kane.mx/tags/profile/","section":"tags","tags":null,"title":"Profile"},{"body":"You would see some interesting properties at the bottom of eclipse's profile.\nFor example,\nIt attaches a property named 'org.eclipse.equinox.p2.internal.inclusion.rules' with value 'STRICT' on the IU 'org.eclipse.sdk.ide' with version 3.6.1.M20100909-0800.\nIt's a very important property for the p2 engine. It means the IU 'org.eclipse.sdk.ide' has been explicitly installed into the profile, so it's not allowed be implicitly updated or removed.\nFor example,\nWe have top feature IU 'org.eclipse.sdk.ide' that represents the Eclipse SDK,Â 'org.eclipse.pde.feature' that represents the Plug-in Development Tool and 'org.eclipse.jdt.feature' that represents the Java Development Tool. And both JDT and PDT are part of Eclipse SDK, so 'org.eclipse.pde.feature' and 'org.eclipse.jdt.feature' are required by 'org.eclipse.sdk.ide'.\nIf the profile only has the STRICT rule for 'org.eclipse.sdk.ide', 'org.eclipse.jdt.feature' and 'org.eclipse.pdt.feature' will implicitly be updated to 3.6.2 when updating 'org.eclipse.sdk.ide' from 3.6.1 to 3.6.2.\nHowever the profile has below STRICT rule for PDT feature,\nThe p2 engine will report errors due to 'org.eclipse.pdt.feature' has STRICT rule for updating. Hence third-party must explicitly update both 'org.eclipse.sdk.ide' and 'org.eclipse.pdt.feature' from 3.6.1 to 3.6.2.\n","link":"https://kane.mx/posts/archive/blogspot/inside-p2s-profile-1-inclusion-rules/","section":"posts","tags":["p2","Eclipse","profile"],"title":"Inside P2's profile (1) - inclusion rules"},{"body":"Latest gcc compiler enables the stack overflow protector that is since GLIBC 2.4. So the library or executable is compiled by latest gcc could be loaded or executed in RHEL4 or Solaris 9 that only have GLIBC 2.3. Hence using option '-fno-stack-protector' to compile the library or executable to make sure it could be executed in older linux release.\ng++ -fno-stack-protector -o test.o test\n","link":"https://kane.mx/posts/archive/blogspot/stack-overflow-protector/","section":"posts","tags":null,"title":"stack overflow protector"},{"body":"Recently I just know such a useful syntax usage of java.\naLoopName: for (;;) { // ...Â while (someCondition) // ...Â if (otherCondition) continue aLoopName; ","link":"https://kane.mx/posts/archive/blogspot/loop-name-for-for-clause-in-java/","section":"posts","tags":null,"title":"the loop name for 'for' clause in java"},{"body":"It's a powerful command to rename files in a batch.\nUsage:\nrename 's/(\\d+)$/$1\\.txt/' * rename add '.txt' extension name for all files that ends with number.\n","link":"https://kane.mx/posts/archive/blogspot/rename-command/","section":"posts","tags":null,"title":"rename command"},{"body":"If you have http proxy, set it to system environment,\nexport http_proxy=http://127.0.0.1:8000 Then start the application in that same terminal.\nIf the proxy is socks proxy, use 'tsocks' to wrap the application in terminal.\n","link":"https://kane.mx/posts/archive/blogspot/applying-proxy-for-softwares-without/","section":"posts","tags":null,"title":"applying proxy for the softwares without proxy support in linux"},{"body":"Honestly speaking, you have eaten the best delicious food if you're living in China. Though we have more and more concerns on the safety of food, we have to recognize that Chinese food is more delicious than others.\nThe cuisine is simple in Austria. People always use pork, beef, flour, tomato, potato and few green vegetables. So they surprised Chinese cost several hours to make the food.\nGulasch, it's good tasted after eating pizza several times\npasta\nAbout the drinking, most of them directly drink the water from water pipe. And some of them like the special water that mixes water with gas. The coffee and beer are the favorite of local citizens. You can find more than one hundred beer brand in the city, and some of them have been found for centuries. Indeed they're good tasted.\nspecial water\nDie Weissf\nWieninger, it comes from Vienna\nStiegl, local famous brand\n","link":"https://kane.mx/posts/archive/blogspot/food-and-drinking/","section":"posts","tags":["salzburg","travel","tour"],"title":"Food and Drinking"},{"body":"","link":"https://kane.mx/tags/salzburg/","section":"tags","tags":null,"title":"Salzburg"},{"body":"","link":"https://kane.mx/tags/tour/","section":"tags","tags":null,"title":"Tour"},{"body":"","link":"https://kane.mx/tags/travel/","section":"tags","tags":null,"title":"Travel"},{"body":"","link":"https://kane.mx/categories/trip/","section":"categories","tags":null,"title":"Trip"},{"body":"Joel posted a blog related to how to hire the great programmers. One of his key points is building comfortable workspaces.\nI believe every programmer loves the workspace like Google and Fog Creek. The workspace of Google has been very famous due to its French chef, gymnasium and big sofas. Why is Fog Creek? It's the company created by Joel, he also practiced his theory on his company. Ruan YiFeng posted a blog for it. I bet you would envy the guys working in that office.\nHow about the workspace of the office in Salzburg? Let me show some pictures.\nSpace\nprogrammers have two monitors\nReading\nnon-technique magazines\ntechnique books\nDrinking\ncoffee machine\nKitchen\nfreezer for fast food\nEntertainment\ntable football game\n","link":"https://kane.mx/posts/archive/blogspot/working-workspace/","section":"posts","tags":["salzburg","travel","tour"],"title":"Working Workspace"},{"body":"Salzburg is a small city and is on the banks of the Salzach River. It's easy to go through the city by bus in 30 minutes.\nSalzach River\noutline view\nRiding the bicycle is a very good way to enjoy the beautiful sight of the city. You could see many kids with parents riding bicycle in the sunny weekend.\nThe train station and a major bus transient station are the same one that is called as 'main station' by local residents. it's not far from the office of company, about 20 minutes by foot.\nThe ticket system of bus is more complicated than Beijing's. People can buy the ticket for single, 24 hours, 48 hours, a week and even a year. The children can get discount. There's no ticket seller in the bus. Usually nobody checks whether you have valid ticket. Pressing the button to open the door when getting on/off the bus.\nThe public transportation is designed well. There are different tickets for different people. For example, tourists would prefer to buy 24 hours ticket or 48 hours tickets. 24 hours ticket means the passengers can take any bus in the 24 hours after it's used first time. So it's very convenient for tourists. 24 hours ticket is 4.2â‚¬ for adults, 2.1â‚¬ for children.Â The price of train tickets is same. The faster train \u0026quot;ICE\u0026quot; have higher price. The regular train is much cheaper. And the ticket allows a family not exceed 5 persons to go back and forth another city in a day. It's very cheap for a family to enjoy weekend in another city or town by train. I think it's a good approach to use public transportation more to reduce environment pollution.\nround-trip ticket\nTaking the train is more convenient than China. There is no security checking, no long distance between gate and platform and even no staffs in the platform. Meanwhile there is no any limitation to travel among the European countries. I went to Munich of Germany by train, I felt it's even more convenient than taking subway in Beijing. Both the train and bus have a lot of humanization design for disability people and people with their bicycles or pets.\n","link":"https://kane.mx/posts/archive/blogspot/transportation/","section":"posts","tags":["salzburg","travel","tour"],"title":"Transportation"},{"body":"There are 20+ staffs in Salzburg office. Most of them are developers, one is administrator of office.\nGenerally the staffs in Salzburg work more flexible than the staffs working in Beijing.\nSome of them live in German. Even though it's not so far as Salzburg, they also need come to Salzburg by train. So sometimes they work at home, use internet and phone as communication tool.\nAnd they have different responsibilities for products. For example, Helmut works on installer, Matthias and Michael are responsibility for QFT testing, Martin N. is focus on license API developing. So everybody has himself schedule, he can decide when he come to office and when leave office based on his working schedule. Nobody cares when you come/leave office or how long you work every day. I believe all of them do well on their jobs.\nFurthermore you can work with your dogs together if nobody takes care of them at home.\nMax's dogs\nMost of foreign like coffee, so there is a kitchen with seats in the office. Some of them like to drink a cup of coffee or tea as a break, and it's a good chance to talk with others. It's a relaxing time for changing your mind out of work. Besides drinking some things, there is a room for playing table football game. It's a small amount of exercise, it's good for body.\nAnother thing makes me very impressive is that the team is very stable than any company I know in China. Most of them work in company more than 10 years. So I think I know that's why they know more than us. Everyone could be expert after doing the same thing more than 10 years. They love the work of coding, and they would like to do coding until retiring. That's why I can see some of them are more than 40, even 50 years old.\n","link":"https://kane.mx/posts/archive/blogspot/working-style/","section":"posts","tags":null,"title":"Working style"},{"body":"åº¦è¿‡é•¿é€”é£žè¡Œçš„æ—…ç¨‹ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ã€‚è¦åœ¨ç‹­å°çš„ç©ºé—´é‡Œå¾…ä¸Šè¿‘10ä¸ªå°æ—¶ï¼Œå¥½åœ¨æ˜¯ä¸¤äººå‡ºè¡Œï¼ŒåŠç¡åŠèŠçš„æ‰“å‘è¿‡äº†æ—¶é—´ã€‚\nåˆ°è¾¾ç»´ä¹Ÿçº³ä¹‹åŽï¼Œå‡ºäº†ç™»æœºé€šé“çœ‹åˆ°çš„å±…ç„¶æ˜¯ä¸€ä¸ªé…’å§ç±»çš„é¤é¦†ã€‚æ„Ÿè§‰å¾ˆç¨€å¥‡ï¼Œä¹Ÿå¾ˆæœ‰å‘³é“ã€‚\nå‘¨å›´å½“ç„¶å°‘ä¸äº†å…ç¨Žåº—å’Œå•†é“ºï¼Œä½†è¿œæ²¡æœ‰é¦–éƒ½æœºåœºé‚£æ ·çš„è§„æ¨¡ã€‚æ€»ä½“æ„Ÿè§‰å°±åƒå›½å†…å¤§åž‹è¶…å¸‚è´­ç‰©å‡ºå£ä¸€æ ·ï¼Œè€Œä¸”äººä¹Ÿä¸å¤šã€‚\nå¦å¤–èµžä¸€ä¸‹ç»´ä¹Ÿçº³æœºåœºçš„Wifiï¼Œç®€å•é…ç½®å°±Käº†ï¼Œå“ªåƒå›½å†…çš„ï¼Œåˆè¦ç§»åŠ¨å·ç ï¼Œè¿˜è¦çŸ­ä¿¡èŽ·å–ï¼ŒæžåŠå¤©ä¹Ÿæ²¡å¼„å®šã€‚\nè½¬æœºä¹‹å‰è¿˜æœ‰æ®µæ—¶é—´ï¼Œå°±åœ¨æœºåœºé‡Œåˆ°å¤„é€›äº†é€›ã€‚é¡ºä¾¿åœ¨ä¸€ä¸ªå§è§£å†³äº†æ™šé¤ï¼ŒåŒæ—¶ä¹Ÿå°äº†æ¯å½“åœ°å•¤é…’ã€‚\nåŽ»è¨å°”èŒ¨å ¡çš„é£žæœºè¿˜æ˜¯å¸¦èžºæ—‹æ¡¨çš„ï¼Œå¤´æ¬¡åè¿™æ ·çš„è€å¼é£žæœºã€‚\n","link":"https://kane.mx/posts/archive/blogspot/day-1/","section":"posts","tags":null,"title":"day 1"},{"body":"Check out this SlideShare Presentation:\nDiscovering the p2 API\nView more presentations from Sonatype.\n","link":"https://kane.mx/posts/archive/blogspot/discovering-p2-api/","section":"posts","tags":null,"title":"Discovering the p2 API"},{"body":"Days ago I updated my p2 replication tool. It's easier to install it in your Eclipse.\nA new component named 'Eclipse marketplace' is added into Eclipse SDK since Helios, which is an application store for Eclipse. People could be easy to install third party plug-ins into their Eclipse.\nYou can launch marketplace via 'Help' - 'Eclipse Marketplace...', then search key word 'p2' or 'replication' to find the tool. Finally click next to install it.\nIt's a very graceful workflow to install some add-ons like firefox.\nAnd then p2 replication tool could help you replicate your environment. This tool supports install components from another existing Eclipse instance to save the time cost on downloading them from Internet now! Enjoy it.\n","link":"https://kane.mx/posts/archive/blogspot/p2-replication-tool-lives-on-eclipse/","section":"posts","tags":null,"title":"P2 replication tool lives on Eclipse Marketplace"},{"body":"1. tcpdump\ntcpdump -n port 80 -i eth0|lo\nmonitor all package transferred on 80 port on the network interface eth0/lo\n2. netstat\nnetstat -anp|grep java\ntrace all network traffic on the process named java\nnetstat -anp|grep 128.224.159.xxx\ntrace all network traffic on the host whose ip address is 128.224.159.xxx\n3. nslookup\nnslookup 206.191.52.46\nlook up the domain name whose ip address is 206.191.52.46\n","link":"https://kane.mx/posts/archive/blogspot/useful-network-utility-tools/","section":"posts","tags":null,"title":"useful network utility tools"},{"body":"Using -exec command like below, need add escape character for semicolon that separated two commands in shell\n1find directory/ -type d -exec chmod a+x {} \\\\; Feb 24, 2010 - update:\n1find . -maxdepth 4 -type dÂ -name \u0026#39;g-vxworks\u0026#39; 2\u0026gt;/dev/null -print Jan. 7, 2024 - update: You might see No such file or directory when combining --exec rm to delete the found files.\nYou can add -depth option to mitigate the message.\n1find deployment/g -depth -name \u0026#39;asset.*\u0026#39; -type d -exec rm -rf {} \\; ","link":"https://kane.mx/posts/archive/blogspot/find-exec-tip/","section":"posts","tags":["Shell"],"title":"[tip]Find -exec tip"},{"body":"","link":"https://kane.mx/tags/shell/","section":"tags","tags":null,"title":"Shell"},{"body":"I suffered p2 installation failed on the configure parse. Becase I try to add vm arguments for my application.\nFor example, I added '-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=8272' in the product configuration.\nP2 will fail when parsing the argument, because it contains ':' and ',' that should be escaped.\nIt works again after replacing it to '-agentlib${#58}jdwp=transport=dt_socket${#44}server=y${#44}suspend=n${#44}address=8272'.\nThe more detail note could be found in p2 touchpoint wiki.\nAnd I also opened bug to request improving it.\n","link":"https://kane.mx/posts/archive/blogspot/special-characters-in-p2-touchpoint/","section":"posts","tags":null,"title":"special characters in p2 touchpoint instruction"},{"body":"mount -t cifs -o username=xxx,password=xxx,workgroup=xx,iocharset=utf8 //share.domain/folder /localfolder\n","link":"https://kane.mx/posts/archive/blogspot/mount-windows-share-folder/","section":"posts","tags":null,"title":"mount windows share folder"},{"body":"1. open the file in vim, :%!xxd\n2. hexdump\n","link":"https://kane.mx/posts/archive/blogspot/way-to-dump-hex-file/","section":"posts","tags":null,"title":"the way to dump hex file"},{"body":"public class NameRuleTest { @Rule public TestName name = new TestName(); @Test public void testA() { assertEquals(\u0026quot;testA\u0026quot;, name.getMethodName()); }Â @Test public void testB() { assertEquals(\u0026quot;testB\u0026quot;, name.getMethodName()); }} ","link":"https://kane.mx/posts/archive/blogspot/how-to-get-name-of-running-test-case-in/","section":"posts","tags":null,"title":"How to get the name of running test case in JUnit4"},{"body":"P2 install wizard firstly query the repository to find out the root installable unit(as well as top installable). Then p2 recalculate the dependency and try to search the requirements in all available repositories after user submits their installation request. Go to the license agreement page if all the dependencies are satisfied.\nP2 agreement page obtains all the units to be installed from the operands of provision plan. The number always is much greater than the number submitted by user. Because the submitted IUs only are the root IUs.\nP2 UI would check the unaccepted licenses comparing to before records. The policy class of p2 UI provides the license manager to record the even accepted license. It traverses all the installable units, querying its license whether it has already been accepted if it has. If the license agreement has been accepted, it would be ignored, won't be shown in the agreement page. Otherwise, new record is created to mark it as accepted by the license manager and display it in the agreement wizard page.\nThe default implementation of license manager would persist the accepted information in the file -- /.metadata/.plugins/org.eclipse.equinox.p2.ui.sdk/license.xml.\n","link":"https://kane.mx/posts/archive/blogspot/how-p2-ui-handles-with-license/","section":"posts","tags":null,"title":"How p2 UI handles with license agreements"},{"body":"Setup SSH without password.\na) execute \u0026quot;ssh-keygen -t rsa\u0026quot; under your linux/unix login to get the RSA keys.\n(press Enter for all)\nYou will get 2 files uner ~/.ssh/, id_rsa and id_rsa.pub\nb) Put the public key id_rsa.pub to your remote host: ~/.ssh/authorized_keys If the remote host share the same nfs, just try \u0026quot; cat id_rsa.pub \u0026gt;\u0026gt; ~/.ssh/authorized_keys\u0026quot;\n* Remember to modify hostname or ip info in ~/.ssh/authorized_keys to \u0026quot;\u0026quot;, so that you can login from any host without password in your NIS domain.\nFor example:\nssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA4Ri5J0s1BL/+mR7RfAuDW6FY2P6ILc61Zvw1BdDkvHMFrTzaC/AUMw33H7biAMCXuCleakCuSoV8ZDiGHYs4wOVvet5sDmphkwdiC4xTekdl3dRNvGjMVbvFUta/Y5CiayL6YIu47Ro6Vvu4Mutsrv/13pTlifrEz+NTR/+bzMb9nTniCwiryMyYod3E46b8WvS8yE3WK+tH4BZE8bjiCwdvAzSdPyk/OFNrlBNuF1yewwnxv1roRD3UalT2+7O4kfEG9sMvvBHjuX2l7xlUe3stBftYpigBbwGmmadxjRpNIlk88t5xKcQX6nSu7V8HI3GWPHI0D+ISIlbfU5Sunw== kzhu0@\n","link":"https://kane.mx/posts/archive/blogspot/ssh-key/","section":"posts","tags":["ssh","Tip"],"title":"[tip]ssh key"},{"body":"I wrote a plug-in to simplify the process to install the same plug-ins in different platform or different workstation.\nAnyone is interested in it, pls follow below guide to freely use it.\nhttp://code.google.com/p/kane-toolkit/wiki/P2Replication\nEnjoy it.\n","link":"https://kane.mx/posts/archive/blogspot/p2-replication-plug-in/","section":"posts","tags":["p2","Eclipse"],"title":"[Eclipse][P2]P2 replication plug-in"},{"body":"How Equinox load bundles Equinox launcher is responsible to start OSGi framework. The system bundle would be created and marked as installed when initializing the framework. Equinox also tries to install the installed bundles if finding them in persistence data during the initializing period. Of course there is no extra bundles would be installed when launching Equinox first time.\nThen Equinox launcher would install the bundles specified by vm's system property 'osgi.bundles'. And start the initial bundles that are marked as early start. For example, let's have a look at the configuration/config.ini of Eclipse, you would find a line similar as below,\nosgi.bundles=reference\\:file\\:org.eclipse.equinox.simpleconfigurator_1.0.200.v20090831.jar@1\\:start\nIt means the start level of bundle 'org.eclipse.equinox.simpleconfigurator_1.0.200.v20090831.jar' is 1, and it would be started after installing it.\nHere you would ask there are only two bundles are installed(one is system bundle 'org.eclipse.osgi', the other is 'org.eclipse.equinox.simpleconfigurator') when launching Equinox, how the other bundles are installed? It's done by the activate method of 'simpleconfigurator' bundle. The available bundles are recorded in plain text file configuration/org.eclipse.equinox.simpleconfigurator/bundles.info, simpleconfigurator read the file then install those bundles.\nIt's a new bundle management introduced by p2. P2 also supports the traditional way to install extensions, such as link file, .eclipseproduct file and directly copying features/plugins.\nBelow table lists the p2 bundles to implement the compatibility installation feature,\nBundle\nUsage\norg.eclipse.equinox.p2.directorywatcher\nthe definition and implementation of directory watcher API\norg.eclipse.equinox.p2.updatesite\nthe implementation of updatesite repository\norg.eclipse.equinox.p2.extensionlocation\nthe implementation of extension repository\norg.eclipse.equinox.p2.reconciler.dropins\nscan dropin folder and link files; watch the traditional configuration file used by update manager\nP2 reconciler would scan the dropin, link folder and legacy configuration file in every Equinox launching. You can disable the capability by marking it not be early start.\norg.eclipse.equinox.p2.reconciler.dropins,1.0.100.v20091010,plugins/org.eclipse.equinox.p2.reconciler.dropins_1.0.100.v20091010.jar,4,false\nIf finding some new bundles in dorpin folder, the reconciler would add the new bundles into a local metadata repository that is stored as OSGi data of Equinox. Then synchronize the bundles into the current p2 profile, then add the new bundles into bundles.info file.\n","link":"https://kane.mx/posts/archive/blogspot/how-equinox-load-bundles/","section":"posts","tags":["Equinox","Eclipse"],"title":"[eclipse]How Equinox load bundles"},{"body":"Learn p2 step by step See this link for detail\nLearn P2 step by step\np2 concept p2 install p2 install practice p2 repository publish customized p2 touchpoint p2 repository publish practice Example Code Reference p2 concept é¦–å…ˆæ¥ç†è§£p2å¼•å…¥çš„å‡ ä¸ªæ¦‚å¿µ[1]\np2 / Agent\nThe provisioning infrastructure on client machines\nInstallable Unit (IU)\nMetadata that describes things that can be installed/configured\nArtifact\nThe actual content being installed/configured(e.g., bundle JARs)\nRepository\nA store of metadata or artifacts\nProfile\nThe target of install/management operations\nPlanner\nThe decision-making entity in the provisioning system\nEngine\nThe mechanism for executing provisioning requests\nTouchpoint\nThe part of the engine responsible for integrating the provisioning\nsystem to a particular runtime or management system\nIUæ¯”è¾ƒå¥½ç†è§£ï¼Œå°±æ˜¯å¯¹å¯å®‰è£…æˆ–é…ç½®çš„éƒ¨åˆ†ä¸€ç§æè¿°ï¼Œå¹¶ä¸å¯¹åº”å®žé™…è¦å®‰è£…çš„æ–‡ä»¶ã€‚\nArifactå°±æ˜¯æ¥æè¿°å®žé™…è¦å®‰è£…çš„æ–‡ä»¶ï¼Œbundleç±»åž‹çš„jarï¼Œfeatureï¼Œbinaryæ–‡ä»¶ã€‚\nè¿™æ—¶å°±æœ‰äº†Repositoryï¼ˆä»“åº“ï¼‰è¿™ä¸ªæ¦‚å¿µï¼Œæ˜¯ç”¨æ¥ä¿å­˜artifactsä¿¡æ¯ï¼Œä»¥åŠartifactsçš„å…ƒæ•°æ®ã€‚å…ƒæ•°æ®åŒ…æ‹¬äº†å¯¹artifactçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç‰ˆæœ¬ï¼Œå¯¹å¤–æš´éœ²çš„æŽ¥å£ä¿¡æ¯ï¼Œä»¥åŠå®ƒä¾èµ–çš„æŽ¥å£åŠå…¶ç‰ˆæœ¬ä¿¡æ¯ï¼Œå„ä¸ªå®‰è£…é˜¶æ®µéœ€è¦æ‰§è¡Œçš„é…ç½®ã€‚åœ¨p2é»˜è®¤çš„å®žçŽ°é‡Œé¢ï¼Œè¿™ä¸¤ä¸ªrepositoryç”¨xmlæ–‡ä»¶æ¥æè¿°ï¼ŒåŒæ—¶è¢«åŽ‹ç¼©ä¸ºartifacts.jar, content.jaræ¥å‡å°æ–‡ä»¶å¤§å°ï¼Œç¼©çŸ­ä¼ è¾“æ—¶é—´ã€‚\nä»ŽEclipse 3.4èµ·ï¼Œå½“ä»Žè¿œç¨‹siteå®‰è£…æ–°çš„è½¯ä»¶æ—¶ï¼Œå°±ä¼šçœ‹åˆ°æœ‰ä¸ªwork threadåœ¨åŽå°ä¸‹è½½content.jaræ–‡ä»¶ã€‚p2åœ¨å®‰è£…æ—¶å€™ï¼Œé¦–å…ˆä¼šæ ¹æ®content.xmlï¼ˆmetadata repositoryï¼‰æ¥è§£æžæ­£åœ¨å®‰è£…è½¯ä»¶çš„ä¾èµ–ã€‚åœ¨å½“å‰runtimeé‡Œé¢æŸ¥æ‰¾metadataä¸­æŒ‡å®šçš„ä¾èµ–ï¼Œå¦‚æžœæ»¡è¶³æ‰ç»§ç»­å®‰è£…ã€‚æ®æˆ‘ä¸ªäººç»éªŒï¼Œå¦‚æžœå®‰è£…çš„è½¯ä»¶æ¯”è¾ƒå¤æ‚ï¼Œé‚£å®ƒäº§ç”Ÿçš„metadataæ–‡ä»¶å°±ä¼šæ¯”è¾ƒå¤§ï¼ˆå¾ˆå®¹æ˜“ä¸Šå…†ï¼‰ï¼Œä¸‹è½½è¿™ä¸ªæ–‡ä»¶ä»¥åŠè§£æžå®ƒçš„å†…å®¹éƒ½ä¼šæ¯”è¾ƒæ…¢ï¼Œä»Žè€Œå½±å“ç”¨æˆ·ä½“éªŒã€‚\næ¯”è¾ƒçµæ´»çš„æ˜¯ï¼Œç”¨æˆ·å¯ä»¥å®žçŽ°è‡ªå·±çš„ArtifactRepositoryå’ŒMetadataRepositoryï¼Œæ³¨å†Œåˆ°å®ƒä»¬å„è‡ªçš„Manageré‡Œé¢å°±å¯ä»¥äº†ã€‚æ‰€æœ‰è¿™äº›æœåŠ¡éƒ½è¢«å®žçŽ°ä¸ºOSGi Service.\nä¸‹ä¸€ä¸ªProfileï¼Œæ˜¯ç”¨æ¥ç®¡ç†å®‰è£…ç›®æ ‡é‡Œçš„è½¯ä»¶ä¿¡æ¯ã€‚p2åœ¨è¢«è®¾è®¡çš„æ—¶å€™ï¼Œå¸Œæœ›è§£å†³å¤šä¸ªeclipseå®žä¾‹å…±äº«ä¸€ä»½å®‰è£…çš„æŸè½¯ä»¶ã€‚æ¯”å¦‚ä¸ºäº†æŸç§ç›®çš„æˆ‘æœºå™¨ä¸Šæœ‰å¥½å‡ ä¸ªEclipseï¼ŒåŒæ—¶å®ƒä»¬éƒ½éœ€è¦CDTï¼Œå…åŽ»ä¸ºé‡å¤å®‰è£…çš„éº»çƒ¦ã€‚profileå°±ä¼šè®°å½•æ¯æ¬¡å®‰è£…çš„å†…å®¹ï¼Œè®©æ•´ä¸ªåº”ç”¨ç¨‹åºè¢«ç®¡ç†èµ·æ¥ã€‚åœ¨Galileoé‡Œå®‰è£…çš„è½¯ä»¶éƒ½å¯ä»¥è½¯ä»¶ç®¡ç†é‡Œé¢æŸ¥æ‰¾åˆ°ã€‚\nPlannerå’ŒEngineå®Œå…¨å°±æ˜¯p2å†…éƒ¨çš„ä¸œè¥¿ã€‚ä»»ä½•p2çš„æ“ä½œï¼ˆå®‰è£…ï¼Œåˆ é™¤ï¼Œé…ç½®ï¼‰éƒ½éœ€è¦Plannerå®žä¾‹æ¥æè¿°ã€‚æœ‰äº†Plannerä»¥åŽï¼Œè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªEngineå¯¹è±¡ï¼Œé€šè¿‡engineæ¥æ‰§è¡Œå¯¹åº”çš„planã€‚è¿™å°±æ˜¯ç›®å‰è°ƒç”¨p2 APIæ¥å®Œæˆå®‰è£…çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚\næœ€åŽä¸€ä¸ªTouchpointã€‚ç¨‹åºåœ¨å®‰è£…çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šæ ¹æ®runtime(os, ws, archç­‰ï¼‰æˆ–é˜¶æ®µ(å®‰è£…ï¼Œå¸è½½ï¼Œé…ç½®ç­‰)æ‰§è¡ŒæŸäº›é…ç½®ï¼Œtouchpointå°±æ˜¯å¸®åŠ©å®žçŽ°è¿™äº›é…ç½®ã€‚å…·ä½“æ“ä½œæ˜¯ä»¥IUä¸ºå•ä½è®°å½•åœ¨metadata repositoryé‡Œçš„ã€‚p2é»˜è®¤å®žçŽ°äº†ä¸€äº›Eclipse touchpointï¼Œæ¯”å¦‚æ‹·è´ï¼Œåˆ é™¤æ–‡ä»¶ï¼Œæ‰§è¡Œå¤–éƒ¨ç¨‹åºç­‰ã€‚å¦‚æžœç”¨æˆ·æœ‰è‡ªå·±ç‰¹æ®Šçš„nativeæ“ä½œéœ€è¦æ‰§è¡Œï¼Œå¯ä»¥è‡ªå·±å®žçŽ°è‡ªå®šä¹‰çš„touchpointã€‚\np2 install æœ‰äº†è¿™äº›æ¦‚å¿µä»¥åŽï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨p2 APIã€‚ä»¥å®‰è£…ä¸ºä¾‹ï¼Œ\né¦–å…ˆéœ€è¦å¾—åˆ°å½“å‰å®‰è£…çš„profileã€‚å¦‚æžœæ˜¯å…¨æ–°å®‰è£…ï¼Œé€šè¿‡IProfileRegistry.addProfileåˆ›å»ºä¸€ä¸ªæ–°profileã€‚æ˜¯æ›´æ–°å®‰è£…çš„è¯ï¼Œå¯ä»¥é€šè¿‡IProfileRegistryæŸ¥è¯¢åˆ°æœŸæœ›æ›´æ–°çš„profileã€‚åˆ›å»ºprofileçš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„è®¾ç½®profileçš„å±žæ€§ï¼Œ\nMap\u0026lt;String, String\u0026gt; profileProperties = new HashMap\u0026lt;String, String\u0026gt;();\nprofileProperties.put(IProfile.PROP_INSTALL_FOLDER, installLocation.getAbsolutePath());\nprofileProperties.put(IProfile.PROP_FLAVOR, \u0026quot;tooling\u0026quot;); //$NON-NLS-1$\nprofileProperties.put(IProfile.PROP_ENVIRONMENTS, \u0026quot;osgi.os=\u0026quot; + Platform.getOS() + \u0026quot;,osgi.ws=\u0026quot; + Platform.getWS() + \u0026quot;,osgi.arch=\u0026quot; + Platform.getOSArch()); //$NON-NLS-1$;\nprofileProperties.put(IProfile.PROP_NL, \u0026quot;en_US\u0026quot;); //$NON-NLS-1$\nprofileProperties.put(IProfile.PROP_INSTALL_FEATURES, \u0026quot;true\u0026quot;);\nprofileProperties.put(IProfile.PROP_CONFIGURATION_FOLDER, new File(installLocation, \u0026quot;configuration\u0026quot;).getAbsolutePath());\nprofileProperties.put(IProfile.PROP_ROAMING, \u0026quot;true\u0026quot;);\nprofileProperties.put(IProfile.PROP_CACHE, installLocation.getAbsolutePath());\ncurrentProfile = registry.addProfile(PROFILE_ID, profileProperties);\nPROP_INSTALL_FOLDERè®¾ç½®å®‰è£…çš„ç›®å½•ï¼ŒPROP_CACHEè®¾ç½®ä¿å­˜ä¸‹è½½æ¥çš„Eclipse IU(features/plugins)çš„ç›®å½•ï¼Œå¦‚æžœrepositoryæ˜¯ä»¥featureä¸ºå•ä½æ¥å‘å¸ƒçš„è¯ï¼Œéœ€è¦è®¾ç½®PROP_INSTALL_FEATURESä¸ºtrueã€‚å¦‚æžœrepositoryåŒ…æ‹¬nativeçš„binaryï¼ˆæ¯”å¦‚launcherï¼‰ä¹Ÿéœ€è¦æŒ‡å®šæ­£ç¡®çš„PROP_ENVIROMENTSï¼ŒåŒ…æ‹¬OS,WS,ARCHæˆ–PROCESSORã€‚\nç„¶åŽéœ€è¦èŽ·å¾—å°†è¦å®‰è£…çš„IMetadataRepositoryé›†åˆã€‚æ¯”å¦‚ï¼š\nArrayList ius = new ArrayList();\nIMetadataRepositoryManager repositoryManager = (IMetadataRepositoryManager) ServiceHelper.getService(Activator.getDefault().getBundle().getBundleContext(),\nIMetadataRepositoryManager.class.getName());Â if (repositoryManager == null)Â throw new InterruptedException(\u0026quot;Failed to get IMetadataRepositoryManager.\u0026quot;);\ntry {\nfor (URI uri : uris) {\nIMetadataRepository metaRepo = repositoryManager.loadRepository(uri, progress.newChild(50/uris.length));\nCollector collector = metaRepo.query(new AccpetQuery(), new LatestNoninstalledIUCollector(currentProfile), progress.newChild(50/uris.length));\nius.addAll(collector.toCollection());\n}\n} catch (ProvisionException e) {\nthrow new InterruptedException(\u0026quot;Failed to get IMetadataRepository.\u0026quot;);\n}\n-åŒæ—¶è¿™é‡Œä¹ŸæŸ¥æ‰¾å‡ºIMetaRepositoryä¸­æ²¡å®‰è£…è¿‡çš„IUsã€‚è¿™å°±éœ€è¦åŒå½“å‰å®‰è£…çš„profileä¸­å·²ç»å®‰è£…è¿‡çš„å†…å®¹æ¥æ¯”è¾ƒï¼Œ\nCollector collector = metaRepo.query(new AccpetQuery(), new LatestNoninstalledIUCollector(currentProfile), progress.newChild(50/uris.length));\nè¿™é‡Œéœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼ŒIMetadataRepositoryå®žçŽ°äº†IQueryableæŽ¥å£ã€‚IQueryableæ˜¯p2å¼•å…¥çš„æŸ¥æ‰¾æŽ¥å£ï¼Œè¿”å›žæ»¡è¶³ç‰¹æ®ŠæŸ¥è¯¢æ¡ä»¶çš„é›†åˆï¼ŒåŒæ—¶ä¼ å…¥äº†ä¸€ä¸ªIProgressMonitorå¯¹è±¡ï¼Œå¯ä»¥ååº”æŸ¥æ‰¾è¿›åº¦ã€‚è¿™é‡Œçš„AcceptQueryï¼ŒLatestNoninstalledIUCollectoræ˜¯è‡ªå®šä¹‰çš„Queryå’ŒCollectorå¯¹è±¡ã€‚p2å·²ç»å®žçŽ°äº†è®¸å¤šæœ‰ç”¨çš„Queryï¼Œç»å¸¸ç”¨åˆ°çš„æœ‰InstallableUnitQueryï¼ŒIUPropertyQueryï¼ŒRangeQueryã€‚\n-æŽ¥ä¸‹æ¥ç”ŸæˆIEngineæ‰€éœ€çš„ProvisionPlanã€‚é¦–å…ˆåˆ›å»ºProfileChangeRequestå¯¹è±¡ï¼Œå°†å…ˆå‰æŸ¥æ‰¾å‡ºçš„è¦å®‰è£…çš„IUsæ·»åŠ è¿›åŽ»ã€‚\nrequest.addInstallableUnits(ius);\nåˆ é™¤çš„è¯åˆ™ä¸Žä¹‹ç›¸åã€‚æ›´æ–°çš„è¯ä¹Ÿéœ€è¦é€šè¿‡ProfileChangeRequest.removeInstallableUnits()åŽ»æŽ‰æ—§ç‰ˆæœ¬çš„IUsã€‚\nè°ƒç”¨IPlanner serviceçš„getProvisioningPlan(ProfileChangeRequest, ProvisioningContext, IProgressMonitor)å¾—åˆ°å¯¹åº”äºŽå½“å‰requestçš„planã€‚\n-æœ€åŽå°±æ˜¯è°ƒç”¨IEngine.perform(IProfile, PhaseSet, Operand[], ProvisioningContext, IProgressMonitor)æ¥æ‰§è¡Œprovisioningæ“ä½œã€‚è¿™é‡Œçš„PhaseSetæ˜¯ç”¨æ¥æŒ‡å®šEngineå°†è¦æ‰§è¡Œçš„å‡ ä¸ªé˜¶æ®µï¼Œä»¥åŠæ¯ä¸ªé˜¶æ®µçš„æ‰§è¡Œæ—¶é—´æƒé‡ã€‚è¿™äº›é˜¶æ®µåŒ…æ‹¬äº†Collect, Unconfigure, Uninstall, Property, CheckTrust, Install, Configure. å¦‚æžœç†Ÿæ‚‰Eclipseä¹‹å‰çš„Installer Handlerï¼Œå¯¹Unconfigure/Uninstall/Install/Configureåº”è¯¥éƒ½å¾ˆç†Ÿæ‚‰ã€‚ åœ¨p2é‡Œï¼Œæ›´æ˜¯å°†Collect, CheckTrustè¿™äº›è¿‡ç¨‹ä¹Ÿæš´éœ²äº†å‡ºæ¥ã€‚ä¸‹é¢æ˜¯p2é‡Œé»˜è®¤PhaseSetçš„å®žçŽ°ï¼Œ\npublic DefaultPhaseSet() {\nthis(new Phase[] {new Collect(100), new Unconfigure(10, forcedUninstall), new Uninstall(50, forcedUninstall), new Property(1), new CheckTrust(10), new Install(50), new Configure(10)});\n}\nOperand[]é€šè¿‡ProvisionPlan.getOperands()èŽ·å¾—ã€‚\np2 install practice å…ˆåˆ¶ä½œä¸€ä¸ªå¯å®‰è£…çš„repositoryï¼Œè¿™é‡Œçš„æ–¹æ³•æ˜¯åŸºäºŽEclipseæä¾›çš„æ¨¡ç‰ˆåˆ›å»ºä¸€ä¸ªRCPç¨‹åºï¼Œæ¯”å¦‚mail template,\nç„¶åŽåˆ›å»ºä¸€ä¸ªfeatureåŒ…å«åˆšæ‰åˆ›å»ºå‡ºæ¥çš„plug-in 'com.example.mail'ã€‚\nåŸºäºŽå­˜åœ¨çš„â€˜com.example.mail.productâ€™åˆ›å»ºproduct configurationï¼Œå°†å…¶è®¾ç½®ä¸ºbase on features, åŒæ—¶åœ¨dependenciesé¡µé¢æ·»åŠ ä»¥ä¸‹featureã€‚featureçš„qaulifier idä¾èµ–äºŽç”¨åˆ°çš„Eclipsseç‰ˆæœ¬ï¼Œä»Žä¸‹å›¾çœ‹åˆ°æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯Eclipse 3.5.1ã€‚å¦‚æžœè¦è®©RCPç¨‹åºå…·æœ‰å®‰è£…æ’ä»¶çš„èƒ½åŠ›ï¼ˆåŒ…å«p2å’Œp2 UIï¼‰ï¼Œå°±éœ€è¦ä¾èµ–æ›´å¤šçš„featureã€‚åŽé¢çš„exampleé‡Œé¢ä¼šå®žçŽ°è¿™éƒ¨åˆ†åŠŸèƒ½ã€‚å¦å¤–æ³¨æ„ï¼šIDä¸èƒ½åŒ…æ‹¬ç©ºæ ¼å­—ç¬¦ã€‚\næŽ¥ä¸‹æ¥ä½¿ç”¨Eclipse Product Export Wizardç”Ÿæˆrepositoryã€‚è®°å¾—è¦å‹¾é€‰ä¸Šgenerate metadata repositoryã€‚\nåœ¨æˆåŠŸåˆ›å»ºäº†Mail Applicationçš„repositoryåŽï¼Œè¯•ç”¨æˆ‘ä»¬è‡ªå·±çš„p2 installeræ¥å®‰è£…è¿™ä¸ªåº”ç”¨ç¨‹åºã€‚å®‰è£…è¿‡ç¨‹ç±»ä¼¼ä¸‹é¢çš„æˆªå›¾ã€‚ç„¶åŽæ‰§è¡Œ/folk/kzhu0/tmp/mailrcp/mailæ¥è¿è¡ŒMail Application.\np2 repository publish è¿™ä¸€èŠ‚å°†ä¼šå±•ç¤ºå¦‚ä½•å‘å¸ƒ/äº§ç”ŸåŸºäºŽp2çš„repositoryã€‚åœ¨p2æœ€æ—©çš„ç‰ˆæœ¬Eclipse 3.4ä¸­å°†ç”Ÿæˆrepositoryè¿™ä¸ªç¨‹åºç§°ä¸ºgeneratorï¼Œè€Œ3.5å¯¹æ­¤é‡æž„åŽå‘½åä¸ºpublisherã€‚é‡æž„åŽçš„publishè¿‡ç¨‹ç®€å•æ˜Žäº†ã€‚é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªIPublishInfoå¯¹è±¡ï¼Œå®ƒè´Ÿè´£æä¾›å°†è¦ç”Ÿæˆçš„repositoryçš„æƒ…å†µã€‚åŒ…æ‹¬äº†meta repository, artifact repositoryçš„ä¿¡æ¯ï¼Œå±žæ€§ï¼Œä»¥åŠæä¾›è¾…åŠ©ä¿¡æ¯çš„adviceå¯¹è±¡ã€‚IPublisherAdviceå¯ä»¥çœ‹ä½œç±»ä¼¼åˆ›å»ºRCPçª—å£æ—¶å€™çš„WorkbenchAdviceå’ŒWorkbenchWindowAdviceç­‰è¾…åŠ©ç±»ã€‚å®ƒç”¨æ¥æä¾›éœ€è¦è®°å½•åœ¨repositoryä¸­çš„IUç‰¹æ®Šä¿¡æ¯ã€‚æ¯”å¦‚IUçš„å±žæ€§ï¼Œtouchpointçš„ç±»åž‹åŠå„ä¸ªé˜¶æ®µæ‰§è¡Œçš„actionï¼Œå¯¹å¯æ‰§è¡Œæ–‡ä»¶æˆ–é…ç½®æ–‡ä»¶IUçš„å¤„ç†ã€‚\næ­¤å¤–è¿˜éœ€è¦åˆ›å»ºIPublisherActionæ¥å¤„ç†ä¸åŒç±»åž‹çš„IUå‘å¸ƒè¿‡ç¨‹ã€‚ä¾‹å¦‚BundlesActionæ¥å®žçŽ°å‘å¸ƒbundlesåˆ°repositoryï¼ŒFeaturesActionåˆ™æ˜¯å¤„ç†featureã€‚æ­¤å¤–p2å·²æä¾›çš„IPublisherActionè¿˜åŒ…æ‹¬product action, config action, launcher actionå’Œjre actionç­‰ç­‰[2]ã€‚\næœ‰äº†æè¿°repositoryæƒ…å†µçš„publishinfoå’Œå‘å¸ƒå„ç§IUsçš„actionåŽï¼Œè°ƒç”¨Publisher.publishæ–¹æ³•å®Œæˆrepositoryçš„å‘å¸ƒã€‚\nIPublisherInfo info = createPublisherInfo();\nIPublisherAction[] actions = createActions();\nPublisher publisher = new Publisher(info);\npublisher.publish(actions, new NullProgressMonitor());\nè¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œpublishåªæ˜¯æŠŠå°†è¦ç”¨äºŽéƒ¨ç½²çš„features/plugins/binaryå‘å¸ƒåˆ°repositoryï¼Œå¹¶ä¸è´Ÿè´£ç¼–è¯‘æ‰“åŒ…å®ƒä»¬ã€‚å…ˆå‰æˆ‘ä»¬ä½¿ç”¨è¿‡Eclipse ExportåŠŸèƒ½æ—¢ç¼–è¯‘æ‰“åŒ…features/pluginsåŒæ—¶åˆç”Ÿæˆrepositoryã€‚Exportå®žçŽ°çš„è¿‡ç¨‹é¦–å…ˆæ˜¯è°ƒç”¨PDEæ¥ç¼–è¯‘æ‰“åŒ…features/pluginsï¼Œå†è°ƒç”¨å¯¹åº”çš„publisheråº”ç”¨ç¨‹åºå°†ç¼–è¯‘åŽçš„features/plugins/productå‘å¸ƒä¸ºrepositoryã€‚\ncustomized p2 touchpoint å‰é¢ä¸€èŠ‚å·²ç»æè¿‡IPublishInfoé€šè¿‡é¢å¤–çš„IPublisherAdviseæ¥å®šåˆ¶å‘å¸ƒåˆ°repositoryçš„IUä¿¡æ¯ã€‚è¿™é‡Œä»‹ç»ä¸ºè‡ªå·±çš„IUå®šåˆ¶æ–°çš„touchpointç±»åž‹ï¼Œå¹¶ä¸”è¦æ±‚åœ¨é…ç½®é˜¶æ®µåœ¨æ“ä½œç³»ç»Ÿæ¡Œé¢åˆ›å»ºåº”ç”¨ç¨‹åºçš„å¯åŠ¨å¿«æ·æ–¹å¼ã€‚é¦–å…ˆä¸ºæˆ‘ä»¬çš„PublisherInfoæ·»åŠ å¤„ç†touchpoint dataçš„adviceï¼ŒNativeLauncherTouchPointå®žçŽ°äº†ITouchpointAdviceæŽ¥å£ï¼Œpublisheråœ¨å‘å¸ƒçš„æ—¶å€™å½“å¤„ç†åˆ°touchpoint dataéƒ¨åˆ†ï¼Œä¼šæŸ¥æ‰¾å®žçŽ°äº†ITouchpointAdviceæŽ¥å£çš„adviceã€‚å¦‚æžœæœ‰adviceå¯ç”¨ï¼Œå°†ä¼šè®©è¿™äº›adviceå¤„ç†çŽ°æœ‰çš„touchpoint dataï¼Œå¹¶ä¸”å¾—åˆ°æ–°çš„touchpoint dataï¼Œå¹¶æŠŠç»“æžœä¿å­˜åˆ°metadata repositoryå½“ä¸­ã€‚\nPublisherInfo result = new PublisherInfo();\nresult.addAdvice(new NativeLauncherTouchPoint());\nNativeLauncherTouchPointå°†æŒ‡å®šä¸ºç‰¹å®šçš„IUåœ¨configureé˜¶æ®µæ‰§è¡ŒcreateDesktopæ“ä½œï¼Œä»¥åŠç›¸åçš„æ“ä½œï¼Œunconfigureé˜¶æ®µæ‰§è¡ŒdeleteDesktopæ“ä½œã€‚\næ›´æ”¹touchpoint typeçš„æ–¹æ³•å¦‚ä¸‹ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä¸ºçŽ°æœ‰çš„touchpoint typeæ‰©å±•actionã€‚å†…ç½®çš„touchpointç±»åž‹å’Œactionçš„å…·ä½“å‘½ä»¤ç”¨æ³•ï¼Œè¯·å‚è€ƒp2 wiki[3]ã€‚\niu.setTouchpointType(DesktopTouchpoint.TOUCHPOINT_TYPE);\ntouchpointç±»åž‹å’Œactionéƒ½æ˜¯é€šè¿‡extension pointæ¥æ‰©å±•çš„ã€‚é€šè¿‡æ‰©å±•â€œorg.eclipse.equinox.p2.engine.touchpointsâ€æ¥æ·»åŠ æ–°çš„touchpointç±»åž‹ï¼Œæ‰©å±•â€org.eclipse.equinox.p2.engine.actionsâ€œå°†æ–°çš„actionåŒæŸä¸ªç±»åž‹å…³è”èµ·æ¥ã€‚\np2 repository publish practice æˆ‘ä»¬åˆ›å»ºplug-in 'com.example.p2.touchpoint'æ¥å®žçŽ°æ¡Œé¢å¿«æ·æ–¹å¼çš„æ‰©å±•ï¼Œå¹¶ä¸”åˆ›å»º'com.example.p2.feature'åŒ…å«touchpointå®žçŽ°çš„plug-inã€‚å…·ä½“å®žçŽ°è¯·å‚è€ƒp2 exampleæºç ã€‚\nç„¶åŽä¸ºMail Applicationæ·»åŠ p2ç›¸å…³featureçš„ä¾èµ–ï¼Œé‡æ–°å‘å¸ƒå¾—åˆ°æ”¯æŒå®‰è£…è½¯ä»¶çš„æ–°ç‰ˆæœ¬ã€‚å¹¶ä¸”ç”¨p2 example installerå®‰è£…å®ƒã€‚p.s: ä¸ªäººæ„Ÿè§‰Eclipseåœ¨åŒ…å«ç¬¬ä¸‰æ–¹plug-inæ—¶ï¼Œå±‚æ¬¡æœ‰äº›é—®é¢˜ã€‚p2ä½œä¸ºä¸€ä¸ªruntimeçš„projectï¼ˆè·Ÿequinox, ECFåŒçº§ï¼‰ï¼Œå±…ç„¶éœ€è¦ç›´æŽ¥æˆ–é—´æŽ¥ä¾èµ–help, rcp.platformè¿™æ ·çš„ä¸Šå±‚æ¨¡å—ã€‚\næŽ¥ä¸‹æ¥åˆ›å»ºplug-in 'com.example.mail.desktop' å’Œ feature 'com.example.mail.desktop.feature'ï¼Œä½œä¸ºæä¾›æ¡Œé¢å¿«æ·æ–¹å¼çš„IUã€‚ç”¨Eclipse Export Featureå°†'com.example.mail.desktop.feature'å¯¼å‡ºï¼Œå®žé™…å°±æ˜¯ç”¨PDEæ›¿æˆ‘ä»¬ç¼–è¯‘æ‰“åŒ…:)ã€‚\nè¿è¡Œâ€˜com.example.p2.generator'æä¾›çš„headless publisheræ¥ç”Ÿæˆæˆ‘ä»¬å®šåˆ¶çš„repositoryã€‚â€™/folk/kzhu0/tmp/mail/desktop-deploy'æ˜¯å…ˆå‰desktop featureå¯¼å‡ºåŽçš„è·¯å¾„ï¼Œè€Œ'/folk/kzhu0/tmp/mail/desktop'æ˜¯ç”Ÿæˆrepositoryçš„è·¯å¾„ã€‚\nè¿è¡Œæ–°ç‰ˆæœ¬çš„Mail Applicationï¼Œåœ¨Helpèœå•ä¸‹é¢ä¼šå¤šå‡ºInstall New Softwareé€‰é¡¹ã€‚å°†è‡ªå®šä¹‰publisherç”Ÿæˆçš„Desktop feature repositoryæ·»åŠ ä¸ºæ–°çš„è½¯ä»¶æºï¼Œå®‰è£…Mail Desktop Featureã€‚å®‰è£…å®ŒæˆåŽï¼Œå°†åœ¨æ¡Œé¢æ‰¾åˆ°Mail Applicationçš„å¿«æ·æ–¹å¼ã€‚åœ¨Installation Detailé‡Œé¢å°†ä¼šå‡ºçŽ°è¿™æ¬¡å®‰è£…çš„å†…å®¹ã€‚é€‰ä¸­Desktop FeatureåŽé€‰æ‹©å¸è½½ï¼Œæ¡Œé¢çš„å¿«æ·æ–¹å¼æ–‡ä»¶å°†ä¼šè¢«åˆ é™¤æŽ‰ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨p2 example installeræ¥ä¸ºMail Applicationå®‰è£…desktop featureã€‚p.s: exampleä»£ç é‡Œåªå®žçŽ°äº†åˆ›å»ºlinux/unixæ¡Œé¢å¿«æ·æ–¹å¼ã€‚\nExample Code Example Codeåº”è¯¥åªèƒ½ç¼–è¯‘è¿è¡Œåœ¨Eclipse 3.5.xã€‚Example Codeä½¿ç”¨çš„éƒ½æ˜¯p2 internal API, è€Œp2 public APIå°†ä¼šéšEclipse 3.6é¦–æ¬¡å‘å¸ƒã€‚è¿™äº›ç±»å’Œæ–¹æ³•åŸºæœ¬éƒ½ä¼šä¿ç•™ï¼Œä½†å‘½åï¼ŒåŒ…ä¸€å®šä¼šæœ‰é‡æž„ã€‚\nhttp://code.google.com/p/kane-toolkit/source/browse/#svn/trunk/p2-example\nReference [1] http://wiki.eclipse.org/Equinox/p2/Concepts\n[2] http://wiki.eclipse.org/Equinox/p2/Publisher\n[3] http://wiki.eclipse.org/Equinox/p2/Engine/Touchpoint_Instructions\n","link":"https://kane.mx/posts/archive/blogspot/learn-p2-step-by-step/","section":"posts","tags":["Equinox","p2","Eclipse"],"title":"[Eclipse][P2]Learn p2 step by step"},{"body":"ssh -qTfnN -D LocalPort remotehost\nAll the added options are for a ssh session that's used for tunneling.\n-q :- be very quite, we are acting only as a tunnel.\n-T :- Do not allocate a pseudo tty, we are only acting a tunnel.\n-f :- move the ssh process to background, as we don't want to interact with this ssh session directly.\n-N :- Do not execute remote command.\n-n :- redirect standard input to /dev/null.\nIn addition on a slow line you can gain performance by enabling compression with the -C option.\n","link":"https://kane.mx/posts/archive/blogspot/ssh-forward/","section":"posts","tags":["ssh","Tip"],"title":"[tip]ssh forward"},{"body":"-Dosgi.install.area=\u0026lt;launcher's folder\u0026gt;\n-Declipse.p2.profile=\n","link":"https://kane.mx/posts/archive/blogspot/simulate-p2-self-host-in-eclipse-run/","section":"posts","tags":["p2","Eclipse"],"title":"Simulate p2 self host in Eclipse run"},{"body":"The IPreferenceStore API of Eclipse is based on OSGi's preferences service.Â Equinox implementsÂ several scope context for different preferences, such DefaultScope, InstanceScope and ConfigurationScope. The IPreferenceStore is the wrapper of instance scope for back-compatibility. It stored the data in workspace(osgi.data.area).\nThe workspace folder would be created when launching RCP application if it doesn't exist. But we can use argument '-data @none' to suppress the creation of workspace. If that, the instance scope/IPreferenceStore can't store any value any more.\nThere is a workaround to resolve such issue. Use ConfigurationScope instead of InstanceScope. Both of them are implemented the same interface, so it's easy to migrate to use ConfigurationScope. The data of configuration scope would be stored in @config.dir/.setting folder.\n","link":"https://kane.mx/posts/archive/blogspot/eclipseosgi-preference/","section":"posts","tags":["Equinox","OSGi","Eclipse"],"title":"Eclipse/OSGi preference"},{"body":"Eclipse platform register an OSGi service 'IProxyService' to manage network connection, which has capability to set proxy setting. There are three types of proxy working mode,\nDirect(no proxy), Manual(specified by user), Native(using OS's proxy setting, such as gnome-proxy, IE). There are three types of proxy supported by IProxyService. They're http, https and socks.\nIt also allows to add/remove ip address from white list, which are accessed without connecting proxy.\nEnd users can manage the proxy setting of Eclipse via Preference - General - Network Connections. Eclipse would do persistence of user's setting. Other components of Eclipse also use those proxy settings to access network, such as ECF.\nBelow code snippet shows how to use proxy API to manually specify proxy server,\nproxyService.setProxiesEnabled(true);\nproxyService.setSystemProxiesEnabled(false); IProxyData[] datas = proxyService.getProxyData(); IProxyData proxyData = null; for(IProxyData data : datas) { // clean old data ((ProxyData)data).setSource(\u0026quot;Manual\u0026quot;); //$NON-NLS-1$ data.setUserid(null); //$NON-NLS-1$ data.setPassword(null); //$NON-NLS-1$ if(proxyType == SOCKSPROXY \u0026amp;\u0026amp; IProxyData.SOCKS_PROXY_TYPE.equals(data.getType())) {\nproxyData = data; continue; }else if(proxyType == WEBPROXY \u0026amp;\u0026amp; IProxyData.HTTP_PROXY_TYPE.equals(data.getType())){\nproxyData = data; continue; } data.setHost(null); //$NON-NLS-1$ data.setPort(0); } if(proxyData != null){ proxyData.setHost(proxyServer); proxyData.setPort(proxyPort); } try { proxyService.setProxyData(datas); } catch (CoreException e) { proxyService.setProxiesEnabled(false); proxyService.setSystemProxiesEnabled(false); return false; }\nOfficial API Reference\n","link":"https://kane.mx/posts/archive/blogspot/usage-of-eclipses-proxy-api/","section":"posts","tags":["Eclipse"],"title":"The usage of Eclipse's Proxy API"},{"body":"tune2fs -i 0 -c 0 /dev/sdx\n","link":"https://kane.mx/posts/archive/blogspot/turnoff-automatically-scanning-disk/","section":"posts","tags":["Tip","Linux"],"title":"[tip]Turn off automatically scanning disk when reboot"},{"body":"","link":"https://kane.mx/tags/linux/","section":"tags","tags":null,"title":"Linux"},{"body":"add below lines in ~/.gnomerc\nexport XMODIFIERS=\u0026quot;@im=fcitx\u0026quot;\nexport GTK_IM_MODULE=\u0026quot;xim\u0026quot;\n","link":"https://kane.mx/posts/archive/blogspot/how-to-set-default-input-method-for/","section":"posts","tags":null,"title":"How to set default input method for GNOME"},{"body":"create symbol link under lib/plugins of firefox to link jre/plugins/i386/ns**/libjavaplugin_oji.so\n","link":"https://kane.mx/posts/archive/blogspot/how-to-set-up-jre-environment-in/","section":"posts","tags":["JRE","Firefox","HowTo"],"title":"[HowTo]How to set up jre environment in firefox"},{"body":"","link":"https://kane.mx/tags/firefox/","section":"tags","tags":null,"title":"Firefox"},{"body":"","link":"https://kane.mx/tags/howto/","section":"tags","tags":null,"title":"HowTo"},{"body":"","link":"https://kane.mx/tags/jre/","section":"tags","tags":null,"title":"JRE"},{"body":"Such as,\n(gdb) handle SIGPIPE nostop noprint pass\n","link":"https://kane.mx/posts/archive/blogspot/how-to-ignore-specified-signal-when/","section":"posts","tags":["Tip","GDB","Debug"],"title":"[Debug][tip]How to ignore specified signal when debugging program via gdb"},{"body":"","link":"https://kane.mx/tags/debug/","section":"tags","tags":null,"title":"Debug"},{"body":"","link":"https://kane.mx/tags/gdb/","section":"tags","tags":null,"title":"GDB"},{"body":"Close Notes\nDouble click c:\\notes\\notes.ini to open it.\nAdd one new line \u0026quot;Display_font_adjustment=n\u0026quot; after the third line in notes.ini file. \u0026quot;n\u0026quot; is the number.It can be 1or 2 or 3....and the font will be larger with the number increasing.\nLaunch note\n","link":"https://kane.mx/posts/archive/blogspot/how-to-adjust-font-size-of-notes-editor/","section":"posts","tags":["Tip","IBM Notes"],"title":"[HowTo][tip]How to adjust the font size of Notes editor"},{"body":"","link":"https://kane.mx/tags/ibm-notes/","section":"tags","tags":null,"title":"IBM Notes"},{"body":"Set vm arguments 'osgi.framework.extensions' and 'osgi.frameworkClassPath' when vm starts. If those value are set, those jar or path would be added into the classloader when starting EclipseStarter.\nSee org.eclipse.equinox.launcher.Main for more details in the source code of Eclipse 3.4.\nBest Regards\nKane\n","link":"https://kane.mx/posts/archive/blogspot/add-custom-jar-or-path-into-equinox/","section":"posts","tags":["Equinox","OSGi","Eclipse"],"title":"[OSGi][Eclipse]Add custom jar or path into Equinox Framework"},{"body":"The answer is very simple, using the service 'org.eclipse.service.PackageAdmin'.\n","link":"https://kane.mx/posts/archive/blogspot/osgihow-to-acquire-fragments-of/","section":"posts","tags":["Equinox","OSGi","Eclipse"],"title":"[OSGi]How to acquire the fragments of specified bundle"},{"body":"Equinox uses the adaptor hooks to implement the class loader.\nSee http://wiki.eclipse.org/Adaptor_Hooks for more detail\nBaseClassLoadingHook would search the native code on itself. If it find the file in that jar file, it would extract the native library into its storage folder.\nEclipseClassLoadingHook defines some variables to search the native library. Belows are built-in variables:\nresult.add(\u0026quot;ws/\u0026quot; + info.getWS() + \u0026quot;/\u0026quot;); //$NON-NLS-1$ //$NON-NLS-2$\nresult.add(\u0026quot;os/\u0026quot; + info.getOS() + \u0026quot;/\u0026quot; + info.getOSArch() + \u0026quot;/\u0026quot;); //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$\nresult.add(\u0026quot;os/\u0026quot; + info.getOS() + \u0026quot;/\u0026quot;); //$NON-NLS-1$ //$NON-NLS-2$\nSo the classloader can find your native library that under those path. If your bundle is jar file, equinox would extract your native library into its storage folder.\nI prefer to use OSGi header(Bundle-NativeCode) defining the path of native code, which still works on other OSGi implementations.\nEquinox defines its url schema, one of them is named as 'BundleURLConnection'. From its name, we know it's used for describing the files of bundle. You can obtain the url of file that is located on bundle by Bundle.getResource()/Bundle.getEntry()/Bundle.findEntries()/Bundle.getResources(). The return value of those functions are an object of BundleURLConnection. Once it's used as the argument of FileLocator.toFileURL(URL), the jar bundle would be unpacked into its storage folder recursively.\n","link":"https://kane.mx/posts/archive/blogspot/eclipseequinoxs-classloader-and-its-url/","section":"posts","tags":["Equinox","OSGi","Eclipse"],"title":"[Eclipse]Equinox's classloader and its URL schema"},{"body":"Â 1. å°†è¦æŽ’ç‰ˆçš„æ–‡å­—è´´åˆ°vimäº†\n2. set textwidth=70\n3. visualæ¨¡å¼ä¸‹é€‰æ‹©è¦æŽ’ç‰ˆçš„æ–‡å­—,æŒ‰gq, å°±å˜æˆ70å­—æ¯1è¡Œçš„æ ¼å¼äº†\n","link":"https://kane.mx/posts/archive/blogspot/tipvim/","section":"posts","tags":null,"title":"[tip][vim]æŽ’ç‰ˆå°æŠ€å·§"},{"body":"In vi/vim,\nï»¿set file format=unix\nor dos2unix, unix2dos\n","link":"https://kane.mx/posts/archive/blogspot/tipconvert-dos-format-to-unix/","section":"posts","tags":["Tip","Linux"],"title":"[tip]convert dos format to unix"},{"body":"Build c/c++ project always need third party library on linux, such as gtk+, glib. Writing their absolute path in Makefile is not flexible way. You can use pkg-config instead of the absolute path. Below is code snippet:\nGTK_LIB=$(shell pkg-config --libs gtk+-2.0)\nGTK_INC=$(shell pkg-config --cflags gtk+-2.0)\ngcc -o yourlibrary.so $(GTK_INC) $(GTK_LIB)\n","link":"https://kane.mx/posts/archive/blogspot/makefile-tip/","section":"posts","tags":["Tip","Linux","Makefile"],"title":"[tip]Makefile"},{"body":"","link":"https://kane.mx/tags/makefile/","section":"tags","tags":null,"title":"Makefile"},{"body":"OSGi provides a mechanism to let user contribute custom schemes automatically. It avoid some restriction with Java facilities for extending the handlers. The more detail could be found from OSGi specification R4, which has description how OSGi implements URL Handler Service.\nUse a sample to illustrate how to contribute your scheme(protocol):\n1. register your URLStreamHandlerService implementation, which must contain a property named \u0026quot;url.handler.protocol\u0026quot;. below register my scheme 'smb'\npublic void start(BundleContext context) throws Exception {\nHashtable properties = new Hashtable();\nproperties.put( URLConstants.URL_HANDLER_PROTOCOL, new String[] { \u0026quot;smb\u0026quot; } );\ncontext.registerService(URLStreamHandlerService.class.getName(), new SmbURLHandler(), properties );\n}\n2. your URL Handler extends AbstractURLStreamHandlerService, and implements abstract function 'openConnection(URL)'\npublic class SmbURLHandler extends AbstractURLStreamHandlerService {\npublic URLConnection openConnection(URL url) throws IOException {\nreturn new SmbURLConnection(url);\n}\n}\n3. your URL Connection extends java.net.URLConnection\npublic class SmbURLConnection extends URLConnection {\nprotected SmbURLConnection(URL url) {\nsuper(url);\n}\npublic void connect() throws IOException {\n}\n}\n","link":"https://kane.mx/posts/archive/blogspot/url-handlers-service/","section":"posts","tags":["Equinox","URL Handler Service","OSGi"],"title":"[OSGi][Equinox]URL Handlers Service"},{"body":"","link":"https://kane.mx/tags/url-handler-service/","section":"tags","tags":null,"title":"URL Handler Service"},{"body":"OSGi Spec defines Bundle-NativeCode header to contain a specification of native code libraries contained in that bundle. All magic things are initialized by org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.findLibrary(String) and org.eclipse.osgi.framework.internal.core.BundleLoader.findLibrary(String). Then BundleLoader uses the org.eclipse.osgi.baseadaptor.BaseData(an implementation of BundleData) to find the library path, if the bundle is NOT a jar file, it would directly get the absolute path of library. Otherwise, the BaseData would extract the library file if it could NOT find it in OSGi bundle storage(located in ${data}/org.eclipse.osgi/bundles/[bundle_id]/.cp/). Refer to org.eclipse.osgi.baseadaptor.BaseData.findLibrary(String) for more detail.\n","link":"https://kane.mx/posts/archive/blogspot/bundle-nativecode-implementation-in/","section":"posts","tags":["Equinox","NativeCode","Bundle","OSGi","Eclipse"],"title":"[OSGi][Equinox]the Bundle-NativeCode implementation in Equinox"},{"body":"","link":"https://kane.mx/tags/bundle/","section":"tags","tags":null,"title":"Bundle"},{"body":"","link":"https://kane.mx/tags/nativecode/","section":"tags","tags":null,"title":"NativeCode"},{"body":"1\u0026gt; æ˜¯è¾“å‡ºæ­£ç¡®æ•°æ®ï¼Œ 2\u0026gt; åˆ™æ˜¯é”™è¯¯æ•°æ®è¾“å‡ºé¡¹ç›®, è‹¥è¦åŒæ—¶å†™å…¥åŒä¸€ä¸ªæ¡£æ¡ˆéœ€è¦ä½¿ç”¨ 2\u0026gt;\u0026amp;1 /dev/null æ˜¯ä»€ä¹ˆå‘¢ï¼ŸåŸºæœ¬ä¸Šï¼Œé‚£å°±æœ‰ç‚¹åƒæ˜¯ä¸€ä¸ªã€Žé»‘æ´žã€çš„åžƒåœ¾æ¡¶åŠŸèƒ½ï¼å½“ä½ è¾“å…¥çš„ä»»ä½•ä¸œè¥¿å¯¼å‘åˆ°è¿™ä¸ªè™šæ‹Ÿçš„åžƒåœ¾æ¡¶è£…ç½®æ—¶ï¼Œã€Žä»–å°±ä¼šå‡­ç©ºæ¶ˆå¤±ä¸è§äº†ï½žï½žã€\n","link":"https://kane.mx/posts/archive/blogspot/linux-shelllearning-note-31908/","section":"posts","tags":["Linux","Shell"],"title":"[shell]Learning Note - 3/19/08"},{"body":"You must see the qualifier string property when exporting your features and plug-ins by Eclipse pde. But specified qualifier string won't appear after you export the features successfully.\nIf you want to use the qualifier string, you must define your feature and plug-in version like below:\n1.0.0.qualifier, 2.2.2.qaulifier\n:)\n","link":"https://kane.mx/posts/archive/blogspot/how-to-use-qualifier-string-when/","section":"posts","tags":["PDE","Eclipse"],"title":"[Eclipse]How to use qualifier string when exporting features and plug-ins"},{"body":"æœ€è¿‘å‡ å¤©è¢«ä¸€ä¸ªæ³¨å†Œè¡¨ç›¸å…³çš„defectæžçš„ç„¦å¤´çƒ‚é¢ã€‚\nèƒŒæ™¯æ˜¯è¿™æ ·çš„ï¼Œäº§å“åœ¨å®‰è£…çš„æ—¶å€™éœ€è¦é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨æ³¨å†Œæ–‡ä»¶å…³è”ç­‰ä¿¡æ¯ã€‚åœ¨å…ˆå‰å®‰è£…ç¨‹åºåŸºäºŽInstallShieldæ—¶å·¥ä½œæ­£ç¡®ï¼Œä½†åœ¨æœ€è¿‘å®‰è£…ç¨‹åºæ”¹ç”¨MSIåŽï¼Œæˆ‘ä»¬å†™å…¥æ³¨å†Œè¡¨çš„ä¿¡æ¯æ²¡æœ‰è¢«å†™åˆ°æ‰€æœŸæœ›çš„ä½ç½®ã€‚\né€šè¿‡å„ç§è¯•éªŒï¼ŒæŸ¥æ‰¾èµ„æ–™ï¼Œç»ˆäºŽæžæ˜Žç™½åŽŸå› ã€‚æˆ‘ä»¬ä¿®æ”¹æ³¨å†Œè¡¨çš„è¿›ç¨‹ä¸æ˜¯å½“å‰ç”¨æˆ·è¿›ç¨‹ï¼Œè€Œæ˜¯ç³»ç»Ÿè¿›ç¨‹ï¼Œå› æ­¤å†™å…¥åˆ°HKEY_CURRENT_USERä¸‹çš„æ•°æ®ä¸èƒ½è¢«å†™å…¥åˆ°å½“å‰ç™»é™†ç”¨æˆ·ä¸‹ã€‚\nWe should not use \u0026quot;HKEY_CURRENT_USER\u0026quot; to retrival current user's registry key value. Because Windows Services always startup before user login. It may happen some error or loading the wrong setting profile. If you still insist on using the current user registry key setting, please refer \u0026quot;RegOpenCurrentUser\u0026quot;.\næœ€åŽåªå¥½å°†è¿™äº›æ•°æ®å†™åˆ°äº†Local Machineé”®å€¼ä¸‹ã€‚\n","link":"https://kane.mx/posts/archive/blogspot/suck-windows-registry/","section":"posts","tags":["æ³¨å†Œè¡¨"],"title":"ä¸‡æ¶çš„æ³¨å†Œè¡¨"},{"body":"","link":"https://kane.mx/tags/%E6%B3%A8%E5%86%8C%E8%A1%A8/","section":"tags","tags":null,"title":"æ³¨å†Œè¡¨"},{"body":"When you develop a rich client application base on eclipse framework, and your application require eclipse platform feature, you would find that your application has some menu items contributed by eclipse platform. Those menu items are defined by several plug-ins' implementation of actionSet extention point. In fact Eclipse provides an activity mechanism to suppress the extension points which you don't want to use. However, you must know the identification name of extension points which you want to suppress. It's a hard work to find out all of them from dozens of plugins. so, I wrote a utility function to list all the extension points of specified name.\nIExtensionRegistry registry = Platform.getExtensionRegistry(); IExtensionPoint extensionPoint = registry.getExtensionPoint(\u0026quot;org.eclipse.ui.actionSets\u0026quot;); IExtension\\[\\] extensions = extensionPoint.getExtensions(); for(int i = 0; i \u0026lt; extensions.length; i++){ IConfigurationElement elements\\[\\] = extensions\\[i \\].getConfigurationElements(); for(int j = 0; j \u0026lt; elements.length; j++){ String pluginId = elements\\[j\\].getNamespaceIdentifier(); if(pluginId.indexOf(\u0026quot;org.eclipse\u0026quot;) \u0026gt; -1){ //$NON-NLS-1$ IConfigurationElement\\[\\] subElements = elements\\[j\\].getChildren(\u0026quot;action\u0026quot;); for(int m = 0; m \u0026lt; subElements.length; m++){ System.out.println(\u0026quot;Plugin: \u0026quot; + pluginId + \u0026quot; Id: \u0026quot; + subElements\\[m\\].getAttribute(\u0026quot;id\u0026quot;)); } } } } and the follow snippet is about the activities of menus of eclipse platform:\n","link":"https://kane.mx/posts/archive/blogspot/get-rid-of-menus-of-eclipse-platform/","section":"posts","tags":["Eclipse","RCP"],"title":"[Eclipse]get rid of the menus of eclipse platform"},{"body":"","link":"https://kane.mx/tags/rcp/","section":"tags","tags":null,"title":"RCP"},{"body":"","link":"https://kane.mx/tags/jni/","section":"tags","tags":null,"title":"JNI"},{"body":"javaç¨‹åºå¼€å‘ä¸­ç»å¸¸ç”¨åˆ°JNIè°ƒç”¨æœ¬åœ°library, åŒæ—¶åˆå¸Œæœ›å°†libraryåŒclassæ–‡ä»¶ç¼–è¯‘æˆä¸€ä¸ªjaræ–‡ä»¶ä»¥æ–¹ä¾¿deploy.\nä½†æ˜¯JDKçš„classloaderä¸æ”¯æŒä»Žjaræ–‡ä»¶ä¸­åŠ è½½library, ä¸€ä¸ªå˜é€šçš„æ–¹æ³•å°±æ˜¯jaré‡Œçš„libraryä»¥ä¸´æ—¶æ–‡ä»¶çš„æ–¹å¼å†™åˆ°ä¸´æ—¶ç›®å½•æˆ–java.libraryç›®å½•.\né™„ä¸Šä¸¤ç¯‡æ–‡æ¡£é“¾æŽ¥ :\n**Load Library inside a jar file\n**\nä½¿ç”¨JNIæ—¶ï¼Œè£…è½½æœ¬åœ°åº“çš„å°æŠ€å·§\n","link":"https://kane.mx/posts/archive/blogspot/jar/","section":"posts","tags":["Java","JNI"],"title":"åŠ è½½jaræ–‡ä»¶é‡Œçš„æœ¬åœ°åº“"},{"body":"Those days my work is focus on eclipse's update. Now I understand the general mechanism and meet some issues when using it in development work.\nThe update mechanism includes four major types: install, enable, disable and uninstall. And all of those operations can be executed by command line, such as installing a feature can use following line:\n-application org.eclipse.update.core.standaloneUpdate -command install -featureId my.feature -version 1.0.0 -from file:/v:/local_updateSite/ -to file:/v:/eclipse/.\nThe installation process would copy the feature and plugins which are included by the feature to the local site from the update site, then execute the feature's global install handler if it has one.\nSome strange issue occurs when I want to disable a feature.Then I try to disable the feature with command,\n-command disable -featureId my.feature -version 1.0.0 -to file:/v:/eclipse/\nThe output of command means that the command is executed successfully.\nBut I list the status of features with command line \u0026quot;-command listFeatures\u0026quot;, the status of my.feature is still enable.\nThen I try to uninstall my.feature with command,\n-command uninstall -featureId my.feature -version 1.0.0 -to file:/v:/eclipse/\nIt fails, and the following is the root cause found in log file.\n!MESSAGE [Cannot find unconfigured feature my.feature with version 1.0.0]\nunconfigured feature means the feature is disabled.\nI posted my question in forum, and one guy told me that it might be a bug of eclipse and advised me to fire a bug for it.\n","link":"https://kane.mx/posts/archive/blogspot/eclipse-update-support/","section":"posts","tags":["Update","Eclipse","RCP"],"title":"[Eclipse]Eclipse update support"},{"body":"","link":"https://kane.mx/tags/update/","section":"tags","tags":null,"title":"Update"},{"body":"I met a defect that dynamically created menu items disappear after creating a new viewPart. It caused me overtime last Friday. Today I find the root cause.\nThe scenario is:\nopen first document, the items are shown well\nopen another document, the items disappear\nThe requirement is that showing the menu items while current part is document, otherwise hide them.\nSo our implementation is:\nwhen current document part is deactivated, set menu items invisible\nwhen document part is activated, set menu items visible\nAfter debugging, I found that menu items was updated before the part activated listener was notified. Hence the menu is invisible while the parent menu is updated. The resolved solution is that setting menu items visible while part opened listener is notified.\n","link":"https://kane.mx/posts/archive/blogspot/call-sequence-between-partactivated-and/","section":"posts","tags":["Eclipse","RCP"],"title":"[Eclipse]The call sequence between partActivated and menu update"},{"body":"I need use remote debug in our project, however just some experience in Weblogic were found from internet. After my investigation, I got some experience about using Eclipse remote debug RCP.\nThere are two important parameters for jvm. And we must launch remote java app with those two parameters.\n-Xdebug //tells jvm starting with debug mode\n-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=1044 //transport=dt_socket represents communication with socket, address=1044 represents that the port number is 1044\nThen there are 3 steps in local env:\n1.import source code into eclipse's project\n2.Debug-Remote Java Application, see attachement as a sample\n3.insert breakpoint,\nupdate:\na simpler way:\n-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=8000\n","link":"https://kane.mx/posts/archive/blogspot/remote-debug-in-eclipse/","section":"posts","tags":["Java","Eclipse","Debug"],"title":"[debug][java]Remote debug in Eclipse"}]