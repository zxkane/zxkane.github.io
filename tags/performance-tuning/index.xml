<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>performance-tuning on The road</title><link>https://kane.mx/tags/performance-tuning/</link><description>Recent content in performance-tuning on The road</description><generator>Hugo -- gohugo.io</generator><copyright>Copyright © 2021, Kane Zhu; all rights reserved.</copyright><lastBuildDate>Wed, 22 Apr 2020 00:00:00 +0000</lastBuildDate><atom:link href="https://kane.mx/tags/performance-tuning/index.xml" rel="self" type="application/rss+xml"/><item><title>oh-my-zsh性能调优思路</title><link>https://kane.mx/posts/2020/zsh-performance-tuning/</link><pubDate>Wed, 22 Apr 2020 00:00:00 +0000</pubDate><guid>https://kane.mx/posts/2020/zsh-performance-tuning/</guid><description>
&lt;p>&lt;a href="https://zh.wikipedia.org/wiki/Z_shell">Z shell&lt;/a>搭配&lt;a href="https://ohmyz.sh/">oh-my-zsh&lt;/a>自定义配置已成为众多Linux/Macosx用户的标准terminal配置。&lt;/p>
&lt;p>最近遇到在&lt;code>zsh&lt;/code>中执行任意命令都变得特别慢(哪怕简单执行&lt;code>ls&lt;/code>也要花费肉眼可见的1，2秒钟)，这里记录下如何排查&lt;a href="https://zh.wikipedia.org/wiki/Z_shell">Z shell&lt;/a>下启用&lt;a href="https://ohmyz.sh/">oh-my-zsh&lt;/a>的性能问题。&lt;/p>
&lt;h3 id="性能问题症状">性能问题症状&lt;/h3>
&lt;p>突然某天起在终端中执行任意命令，都至少要花费1，2秒（肉眼计数），该命令才会完成执行并退出到终端开始接受新的输入。&lt;/p>
&lt;p>我当前主要使用的终端是&lt;a href="https://www.iterm2.com/">iTerm2&lt;/a>，执行命令后，在终端Tab的title bar上能显式的看到&lt;code>git&lt;/code>命令也被执行了。&lt;/p>
&lt;p>尝试了其他的shell，比如&lt;code>bash&lt;/code>，是没有这个问题。基本断定问题同&lt;code>zsh&lt;/code>相关。更多问题描述乃至动画截屏，可以参见&lt;a href="https://github.com/ohmyzsh/ohmyzsh/issues/8833">这个issue&lt;/a>。&lt;/p>
&lt;h3 id="zsh--oh-my-zsh-性能问题分析">zsh + oh-my-zsh 性能问题分析&lt;/h3>
&lt;p>&lt;a href="https://ohmyz.sh/">oh-my-zsh&lt;/a>其实就是提供&lt;a href="https://zh.wikipedia.org/wiki/Z_shell">zsh&lt;/a>的定制化配置，主要包括Theme主题和各种软件的插件。&lt;/p>
&lt;h4 id="oh-my-zsh-插件">oh-my-zsh 插件&lt;/h4>
&lt;p>通常&lt;a href="https://ohmyz.sh/">oh-my-zsh&lt;/a>中内置或三方社区提供的插件是导致性能降低甚至互相冲突的主要原因。排查思路也很简单，通过逐个禁用已加载的插件来测试是否可以解决问题。&lt;/p>
&lt;p>用文本编辑器打开当前用户的&lt;code>~/.zshrc&lt;/code>配置，找到&lt;code>plugins&lt;/code>开头的配置行，例如，&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="ln"> 1&lt;/span>&lt;span class="nv">plugins&lt;/span>&lt;span class="o">=(&lt;/span>
&lt;span class="ln"> 2&lt;/span> git
&lt;span class="ln"> 3&lt;/span> osx
&lt;span class="ln"> 4&lt;/span>&lt;span class="c1">## gradle&lt;/span>
&lt;span class="ln"> 5&lt;/span> brew
&lt;span class="ln"> 6&lt;/span>&lt;span class="c1">## command-not-found&lt;/span>
&lt;span class="ln"> 7&lt;/span> github
&lt;span class="ln"> 8&lt;/span>&lt;span class="c1"># gnu-utils&lt;/span>
&lt;span class="ln"> 9&lt;/span>&lt;span class="c1">## mvn&lt;/span>
&lt;span class="ln">10&lt;/span> python
&lt;span class="ln">11&lt;/span> pip
&lt;span class="ln">12&lt;/span>&lt;span class="c1"># screen&lt;/span>
&lt;span class="ln">13&lt;/span> vi-mode
&lt;span class="ln">14&lt;/span> docker
&lt;span class="ln">15&lt;/span>&lt;span class="c1">## docker-compose&lt;/span>
&lt;span class="ln">16&lt;/span> node
&lt;span class="ln">17&lt;/span>&lt;span class="c1">## spring&lt;/span>
&lt;span class="ln">18&lt;/span> mosh
&lt;span class="ln">19&lt;/span>&lt;span class="c1"># httpie&lt;/span>
&lt;span class="ln">20&lt;/span>&lt;span class="c1">## sudo&lt;/span>
&lt;span class="ln">21&lt;/span> tmux
&lt;span class="ln">22&lt;/span>&lt;span class="c1">## kubectl&lt;/span>
&lt;span class="ln">23&lt;/span>&lt;span class="c1">## helm&lt;/span>
&lt;span class="ln">24&lt;/span> golang
&lt;span class="ln">25&lt;/span> &lt;span class="nb">history&lt;/span>
&lt;span class="ln">26&lt;/span> history-substring-search
&lt;span class="ln">27&lt;/span> zsh-autosuggestions
&lt;span class="ln">28&lt;/span> zsh-syntax-highlighting
&lt;span class="ln">29&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>通过行首添加&lt;code>#&lt;/code>来禁用&lt;code>oh-my-zsh&lt;/code>插件，启动新的终端窗口或tab来验证是否该插件是引起问题的根源。&lt;/p>
&lt;p>在我的配置中，出现过因为启用过多插件，导致新建终端需要10来秒钟。但因为创建终端不是一个高频的需求，这个性能通常来说还是可以忍受。&lt;/p>
&lt;h4 id="oh-my-zsh-主题">oh-my-zsh 主题&lt;/h4>
&lt;p>在我的这个问题中，即使将所有插件都禁用了，命令执行后退出速度还是没有改善，&lt;code>git&lt;/code>命令仍然有被执行。这时我尝试更换不同&lt;code>oh-my-zsh&lt;/code>内置主题来排查问题。但是使用了包括默认主题&lt;code>robbyrussell&lt;/code>，极简主题&lt;code>ys&lt;/code>在内的多个主题都无法解决该问题。&lt;/p>
&lt;p>最后直接禁止&lt;code>oh-my-zsh&lt;/code>使用主题，问题没有了！&lt;/p>
&lt;p>然而&lt;code>oh-my-zsh&lt;/code>主题是对zsh的极大增强，改善了默认的用户体验，没有主题扩展使用起来会非常不习惯。&lt;/p>
&lt;h3 id="小结">小结&lt;/h3>
&lt;p>最终试用了另一个社区维护的知名&lt;code>zsh&lt;/code>主题&lt;a href="https://github.com/sindresorhus/pure">Pure&lt;/a>，性能问题得到了解决:v: 同时也满足了主题对zsh输入输出用户体验的增强 :blush:&lt;/p>
&lt;p>希望这里分享的&lt;code>oh-my-zsh&lt;/code>性能的调优思路，可以帮助到有类似需要的各位。&lt;/p>
&lt;blockquote>
&lt;p>将来社区对这个&lt;a href="https://github.com/ohmyzsh/ohmyzsh/issues/8833">问题&lt;/a>如有进一步的反馈，将会做更新。&lt;/p>
&lt;/blockquote></description></item><item><title>MongoDB中如何找出慢查询</title><link>https://kane.mx/posts/2016/how-to-find-slow-queries-in-mongodb/</link><pubDate>Thu, 29 Sep 2016 00:00:00 +0000</pubDate><guid>https://kane.mx/posts/2016/how-to-find-slow-queries-in-mongodb/</guid><description>
&lt;p>&lt;a href="https://www.mongodb.com/">MongoDB&lt;/a>是目前最为流行的&lt;a href="https://en.wikipedia.org/wiki/NoSQL">NoSQL&lt;/a>数据库之一。&lt;a href="https://vme360.com">V秘&lt;/a>的后台数据就是保存在&lt;a href="https://www.mongodb.com/">MongoDB&lt;/a>中的哦;)&lt;/p>
&lt;p>尽管&lt;a href="https://www.mongodb.com/">MongoDB&lt;/a>的性能为业界称道，但任何数据库系统使用中都存在着慢查询的问题。慢查询的性能问题，可能是由于使用非最优的查询语句，不正确的索引或其他配置原因导致的。但开发人员或数据库维护人员首先要找出这些低效的查询，才能做出对应的查询优化。&lt;/p>
&lt;!-- more -->
&lt;p>在&lt;a href="https://www.mongodb.com/">MongoDB&lt;/a>中实现慢查询的profile是非常容易，因为&lt;a href="https://www.mongodb.com/">MongoDB&lt;/a>内置了&lt;a href="https://docs.mongodb.com/manual/reference/method/db.setProfilingLevel/">profile开关&lt;/a>来记录执行时间触发了profile条件的查询。&lt;/p>
&lt;p>参照&lt;a href="https://docs.mongodb.com/manual/reference/method/db.setProfilingLevel/">db.setProfileLevel()&lt;/a>的文档，通过以下命令就可以记录执行时长超过&lt;strong>300ms&lt;/strong>的查询。&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="ln">1&lt;/span>&lt;span class="nx">db&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setProfilingLevel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">300&lt;/span>&lt;span class="p">)&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>当慢查询被重现后，可以通过查找&lt;code>system.profile&lt;/code> collection来查看执行时长超过&lt;strong>300ms&lt;/strong>的查询。&lt;/p>
&lt;p>被profiler记录下来慢查询record看起来如下，&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="ln"> 1&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="ln"> 2&lt;/span> &lt;span class="nt">&amp;#34;op&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;query&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln"> 3&lt;/span> &lt;span class="nt">&amp;#34;ns&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;myCollection&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln"> 4&lt;/span> &lt;span class="nt">&amp;#34;query&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln"> 5&lt;/span> &lt;span class="nt">&amp;#34;builds&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln"> 6&lt;/span> &lt;span class="nt">&amp;#34;$elemMatch&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln"> 7&lt;/span> &lt;span class="nt">&amp;#34;builtTime&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln"> 8&lt;/span> &lt;span class="nt">&amp;#34;$and&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;span class="ln"> 9&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">10&lt;/span> &lt;span class="nt">&amp;#34;createdTime&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">11&lt;/span> &lt;span class="nt">&amp;#34;$lt&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="err">ISODate(&lt;/span>&lt;span class="s2">&amp;#34;2016-09-20T20:07:00.796Z&amp;#34;&lt;/span>&lt;span class="err">)&lt;/span>
&lt;span class="ln">12&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">13&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">14&lt;/span> &lt;span class="p">]&lt;/span>
&lt;span class="ln">15&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">16&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">17&lt;/span> &lt;span class="p">},&lt;/span>
&lt;span class="ln">18&lt;/span> &lt;span class="nt">&amp;#34;ntoreturn&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">19&lt;/span> &lt;span class="nt">&amp;#34;ntoskip&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">20&lt;/span> &lt;span class="nt">&amp;#34;nscanned&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">21&lt;/span> &lt;span class="nt">&amp;#34;nscannedObjects&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">18231&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">22&lt;/span> &lt;span class="nt">&amp;#34;keyUpdates&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">23&lt;/span> &lt;span class="nt">&amp;#34;writeConflicts&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">24&lt;/span> &lt;span class="nt">&amp;#34;numYield&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">577&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">25&lt;/span> &lt;span class="nt">&amp;#34;locks&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">26&lt;/span> &lt;span class="nt">&amp;#34;Global&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">27&lt;/span> &lt;span class="nt">&amp;#34;acquireCount&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">28&lt;/span> &lt;span class="nt">&amp;#34;r&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="err">NumberLong(&lt;/span>&lt;span class="mi">1156&lt;/span>&lt;span class="err">)&lt;/span>
&lt;span class="ln">29&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">30&lt;/span> &lt;span class="p">},&lt;/span>
&lt;span class="ln">31&lt;/span> &lt;span class="nt">&amp;#34;Database&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">32&lt;/span> &lt;span class="nt">&amp;#34;acquireCount&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">33&lt;/span> &lt;span class="nt">&amp;#34;r&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="err">NumberLong(&lt;/span>&lt;span class="mi">578&lt;/span>&lt;span class="err">)&lt;/span>
&lt;span class="ln">34&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">35&lt;/span> &lt;span class="p">},&lt;/span>
&lt;span class="ln">36&lt;/span> &lt;span class="nt">&amp;#34;Collection&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">37&lt;/span> &lt;span class="nt">&amp;#34;acquireCount&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">38&lt;/span> &lt;span class="nt">&amp;#34;r&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="err">NumberLong(&lt;/span>&lt;span class="mi">578&lt;/span>&lt;span class="err">)&lt;/span>
&lt;span class="ln">39&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">40&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">41&lt;/span> &lt;span class="p">},&lt;/span>
&lt;span class="ln">42&lt;/span> &lt;span class="nt">&amp;#34;nreturned&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">43&lt;/span> &lt;span class="nt">&amp;#34;responseLength&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">98076&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">44&lt;/span> &lt;span class="nt">&amp;#34;millis&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">11161&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">45&lt;/span> &lt;span class="nt">&amp;#34;execStats&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">46&lt;/span> &lt;span class="nt">&amp;#34;stage&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;COLLSCAN&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">47&lt;/span> &lt;span class="nt">&amp;#34;filter&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">48&lt;/span> &lt;span class="nt">&amp;#34;builds&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">49&lt;/span> &lt;span class="nt">&amp;#34;$elemMatch&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">50&lt;/span> &lt;span class="nt">&amp;#34;$and&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;span class="ln">51&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">52&lt;/span> &lt;span class="nt">&amp;#34;$and&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;span class="ln">53&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">54&lt;/span> &lt;span class="nt">&amp;#34;createdTime&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">55&lt;/span> &lt;span class="nt">&amp;#34;$lt&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="err">ISODate(&lt;/span>&lt;span class="s2">&amp;#34;2016-09-20T20:07:00.796Z&amp;#34;&lt;/span>&lt;span class="err">)&lt;/span>
&lt;span class="ln">56&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">57&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">58&lt;/span> &lt;span class="p">]&lt;/span>
&lt;span class="ln">59&lt;/span> &lt;span class="p">},&lt;/span>
&lt;span class="ln">60&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">61&lt;/span> &lt;span class="nt">&amp;#34;builtTime&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">62&lt;/span> &lt;span class="nt">&amp;#34;$eq&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="kc">null&lt;/span>
&lt;span class="ln">63&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">64&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">65&lt;/span> &lt;span class="p">]&lt;/span>
&lt;span class="ln">66&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">67&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">68&lt;/span> &lt;span class="p">},&lt;/span>
&lt;span class="ln">69&lt;/span> &lt;span class="nt">&amp;#34;nReturned&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">70&lt;/span> &lt;span class="nt">&amp;#34;executionTimeMillisEstimate&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">11080&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">71&lt;/span> &lt;span class="nt">&amp;#34;works&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">18233&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">72&lt;/span> &lt;span class="nt">&amp;#34;advanced&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">73&lt;/span> &lt;span class="nt">&amp;#34;needTime&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">18230&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">74&lt;/span> &lt;span class="nt">&amp;#34;needFetch&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">75&lt;/span> &lt;span class="nt">&amp;#34;saveState&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">577&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">76&lt;/span> &lt;span class="nt">&amp;#34;restoreState&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">577&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">77&lt;/span> &lt;span class="nt">&amp;#34;isEOF&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">78&lt;/span> &lt;span class="nt">&amp;#34;invalidates&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">79&lt;/span> &lt;span class="nt">&amp;#34;direction&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;forward&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">80&lt;/span> &lt;span class="nt">&amp;#34;docsExamined&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">18231&lt;/span>
&lt;span class="ln">81&lt;/span> &lt;span class="p">},&lt;/span>
&lt;span class="ln">82&lt;/span> &lt;span class="nt">&amp;#34;ts&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="err">ISODate(&lt;/span>&lt;span class="s2">&amp;#34;2016-09-20T23:07:14.313Z&amp;#34;&lt;/span>&lt;span class="err">)&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">83&lt;/span> &lt;span class="nt">&amp;#34;client&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.171.127.66&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">84&lt;/span> &lt;span class="nt">&amp;#34;allUsers&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;span class="ln">85&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">86&lt;/span> &lt;span class="nt">&amp;#34;user&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;dbuser&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="ln">87&lt;/span> &lt;span class="nt">&amp;#34;db&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;mydb&amp;#34;&lt;/span>
&lt;span class="ln">88&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">89&lt;/span> &lt;span class="p">],&lt;/span>
&lt;span class="ln">90&lt;/span> &lt;span class="nt">&amp;#34;user&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;dbuser@mydb&amp;#34;&lt;/span>
&lt;span class="ln">91&lt;/span>&lt;span class="p">}&lt;/span> &lt;/code>&lt;/pre>&lt;/div>
&lt;p>上面的数据具体解读如下，&lt;/p>
&lt;ol>
&lt;li>&lt;code>op: 'query'&lt;/code>表示执行的是查询，&lt;/li>
&lt;li>&lt;code>ns&lt;/code>是指查询的collection，&lt;/li>
&lt;li>&lt;code>query&lt;/code>是具体的查询语句，&lt;/li>
&lt;li>核心部分是&lt;code>execStats&lt;/code>，给出了的查询语句具体执行统计，跟**.explain('execStats')**的内容是一致的。上面的统计是说，这个query执行了整个collection的扫描(总计扫描了18231个文档)，最终返回了2条文档，花费了11080ms，也就是11s还多的时间！这表明被记录下的慢查询跟collection的索引设置有问题，该查询没有用上索引。解决方案很简单，改善查询语句使用存在的索引或者设置合理的索引。&lt;/li>
&lt;li>&lt;code>ts&lt;/code>是查询开始请求的时间，&lt;/li>
&lt;li>&lt;code>allUsers&lt;/code>和&lt;code>user&lt;/code>都是MongoDB client连接所使用的用户。&lt;/li>
&lt;/ol></description></item></channel></rss>