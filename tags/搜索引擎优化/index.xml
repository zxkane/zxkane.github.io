<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>搜索引擎优化 on The road</title><link>https://kane.mx/tags/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E4%BC%98%E5%8C%96/</link><description>Recent content in 搜索引擎优化 on The road</description><generator>Hugo -- gohugo.io</generator><copyright>Copyright © 2021, Kane Zhu; all rights reserved.</copyright><lastBuildDate>Thu, 19 May 2016 00:00:00 +0000</lastBuildDate><atom:link href="https://kane.mx/tags/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E4%BC%98%E5%8C%96/index.xml" rel="self" type="application/rss+xml"/><item><title>基于Angularjs单页面应用的SEO优化</title><link>https://kane.mx/posts/2016/seo-optimization-for-angularajs-based-app/</link><pubDate>Thu, 19 May 2016 00:00:00 +0000</pubDate><guid>https://kane.mx/posts/2016/seo-optimization-for-angularajs-based-app/</guid><description>
&lt;p>在之前的&lt;a href="https://kane.mx/posts/2016/single-page-app-meets-weixin-pay/">文章&lt;/a>我曾提到基于&lt;a href="https://angularjs.org/">Angularjs&lt;/a>的单页面应用在用户体验上的种种好处。然而任何事情都不是完美的，&lt;a href="https://angularjs.org/">Angular&lt;/a>和类似的框架通过应用内做页面路由的实现给SEO（也俗称搜索引擎优化）带来了不少麻烦。&lt;/p>
&lt;p>首先，我们来看看页面内路由是如何实现的。默认&lt;a href="https://angularjs.org/">Angularjs&lt;/a>生成的页面uri类型如下，&lt;/p>
&lt;p>&lt;code>http://mydomain.com/#/app/page1&lt;/code>&lt;/p>
&lt;p>浏览器请求上面这个uri的时候，实际发送给服务器的请求地址是&lt;strong>&lt;a href="http://mydomain.com/">http://mydomain.com/&lt;/a>&lt;/strong>, web服务器会将默认的页面响应给浏览器，比如&lt;em>index.html&lt;/em>或&lt;em>index.php&lt;/em>等。&lt;/p>
&lt;p>浏览器返回的页面里面引入了&lt;a href="https://angularjs.org/">Angularjs&lt;/a>和其他应用需要的JS库。&lt;a href="https://angularjs.org/">Angularjs&lt;/a>应用开始执行后，尝试处理路由**/app/page1**。如果应用定义了该路由，将加载必要的JS库和其他html片段来完成页面的渲染。&lt;/p>
&lt;p>理解了&lt;a href="https://angularjs.org/">Angularjs&lt;/a>页面内路由的原理后，我们知道了对浏览器或搜索引擎爬虫而言，单页面应用所有的页面对浏览器和搜索引擎都是一个网址，比如&lt;code>http://mydomain.com/&lt;/code>。这样对爬虫抓取站内链接造成了困难，因为所有应用内的链接都被认做了同一个链接。&lt;/p>
&lt;!-- more -->
&lt;p>我们理解了uri &lt;code>http://mydomain.com/#/app/page1&lt;/code>给SEO造成的麻烦，接下来就是讨论如何针对SEO来作的优化。&lt;/p>
&lt;p>最理想的情况当然是搜索引擎爬虫变的更加智能，它能理解网站的框架，并且针对此种情况做出优化。但截止到目前，包括Google在内的所有爬虫都无法做到这点。那我们SEO的优化只能在应用这边来做了。&lt;/p>
&lt;p>&lt;a href="https://angularjs.org/">Angularjs&lt;/a>提供了一种&lt;a href="https://docs.angularjs.org/guide/$location">HTML5 mode&lt;/a>模式可以利用HTML5 History API来实现页面内路由。打开的方法如下，&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="ln">1&lt;/span>&lt;span class="nx">$locationProvider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">html5Mode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>同时在&lt;code>index.html&lt;/code>页面加上如下标签，&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="ln">1&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">base&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>在打开&lt;a href="https://docs.angularjs.org/guide/$location">HTML5 mode&lt;/a>后的&lt;a href="https://angularjs.org/">Angularjs&lt;/a>应用的链接看起来就是这样了，&lt;/p>
&lt;p>&lt;code>http://mydomain.com/app/page1&lt;/code>&lt;/p>
&lt;p>新的链接模式和站内跳转通过访问网站主页请求将没有任何问题。然而直接在浏览器请求如上链接的话，Web服务器将尝试请求&lt;code>/app/page1&lt;/code>，通常会得到&lt;strong>404&lt;/strong>的页面响应。因为服务器上并没有部署页面&lt;code>/app/page1&lt;/code>。&lt;/p>
&lt;p>这时就需要在Web应用服务器或应用里面实现&lt;strong>URL Rewrite&lt;/strong>。将&lt;code>/app/page1&lt;/code>的请求转到单页面应用html文件上。&lt;/p>
&lt;p>下面是一些Web服务器或应用的参考配置，&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>Apache Rewrites&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="ln"> 1&lt;/span> &amp;lt;VirtualHost *:80&amp;gt;
&lt;span class="ln"> 2&lt;/span> ServerName my-app
&lt;span class="ln"> 3&lt;/span>
&lt;span class="ln"> 4&lt;/span> DocumentRoot /path/to/app
&lt;span class="ln"> 5&lt;/span>
&lt;span class="ln"> 6&lt;/span> &amp;lt;Directory /path/to/app&amp;gt;
&lt;span class="ln"> 7&lt;/span> RewriteEngine on
&lt;span class="ln"> 8&lt;/span>
&lt;span class="ln"> 9&lt;/span> # Don&amp;#39;t rewrite files or directories
&lt;span class="ln">10&lt;/span> RewriteCond %{REQUEST_FILENAME} -f [OR]
&lt;span class="ln">11&lt;/span> RewriteCond %{REQUEST_FILENAME} -d
&lt;span class="ln">12&lt;/span> RewriteRule ^ - [L]
&lt;span class="ln">13&lt;/span>
&lt;span class="ln">14&lt;/span> # Rewrite everything else to index.html to allow html5 state links
&lt;span class="ln">15&lt;/span> RewriteRule ^ index.html [L]
&lt;span class="ln">16&lt;/span> &amp;lt;/Directory&amp;gt;
&lt;span class="ln">17&lt;/span> &amp;lt;/VirtualHost&amp;gt;
&lt;span class="ln">18&lt;/span> &lt;/code>&lt;/pre>&lt;/div>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Nginx Rewrites&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="ln"> 1&lt;/span> &lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln"> 2&lt;/span> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">my-app&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="ln"> 3&lt;/span>
&lt;span class="ln"> 4&lt;/span> &lt;span class="kn">root&lt;/span> &lt;span class="s">/path/to/app&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="ln"> 5&lt;/span>
&lt;span class="ln"> 6&lt;/span> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln"> 7&lt;/span> &lt;span class="kn">try_files&lt;/span> &lt;span class="nv">$uri&lt;/span> &lt;span class="nv">$uri/&lt;/span> &lt;span class="s">/index.html&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="ln"> 8&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln"> 9&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">10&lt;/span> &lt;/code>&lt;/pre>&lt;/div>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Azure IIS Rewrites&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="ln"> 1&lt;/span> &amp;lt;system.webServer&amp;gt;
&lt;span class="ln"> 2&lt;/span> &amp;lt;rewrite&amp;gt;
&lt;span class="ln"> 3&lt;/span> &amp;lt;rules&amp;gt;
&lt;span class="ln"> 4&lt;/span> &amp;lt;rule name=&amp;#34;Main Rule&amp;#34; stopProcessing=&amp;#34;true&amp;#34;&amp;gt;
&lt;span class="ln"> 5&lt;/span> &amp;lt;match url=&amp;#34;.*&amp;#34; /&amp;gt;
&lt;span class="ln"> 6&lt;/span> &amp;lt;conditions logicalGrouping=&amp;#34;MatchAll&amp;#34;&amp;gt;
&lt;span class="ln"> 7&lt;/span> &amp;lt;add input=&amp;#34;{REQUEST_FILENAME}&amp;#34; matchType=&amp;#34;IsFile&amp;#34; negate=&amp;#34;true&amp;#34; /&amp;gt;
&lt;span class="ln"> 8&lt;/span> &amp;lt;add input=&amp;#34;{REQUEST_FILENAME}&amp;#34; matchType=&amp;#34;IsDirectory&amp;#34; negate=&amp;#34;true&amp;#34; /&amp;gt;
&lt;span class="ln"> 9&lt;/span> &amp;lt;/conditions&amp;gt;
&lt;span class="ln">10&lt;/span> &amp;lt;action type=&amp;#34;Rewrite&amp;#34; url=&amp;#34;/&amp;#34; /&amp;gt;
&lt;span class="ln">11&lt;/span> &amp;lt;/rule&amp;gt;
&lt;span class="ln">12&lt;/span> &amp;lt;/rules&amp;gt;
&lt;span class="ln">13&lt;/span> &amp;lt;/rewrite&amp;gt;
&lt;span class="ln">14&lt;/span> &amp;lt;/system.webServer&amp;gt;
&lt;span class="ln">15&lt;/span> &lt;/code>&lt;/pre>&lt;/div>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Express Rewrites&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="ln"> 1&lt;/span> &lt;span class="kd">var&lt;/span> &lt;span class="nx">express&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;express&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="ln"> 2&lt;/span> &lt;span class="kd">var&lt;/span> &lt;span class="nx">app&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">express&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="ln"> 3&lt;/span>
&lt;span class="ln"> 4&lt;/span> &lt;span class="nx">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">use&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;/js&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">express&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">static&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">__&lt;/span>&lt;span class="nx">dirname&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;/js&amp;#39;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;span class="ln"> 5&lt;/span> &lt;span class="nx">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">use&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;/dist&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">express&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">static&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">__&lt;/span>&lt;span class="nx">dirname&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;/../dist&amp;#39;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;span class="ln"> 6&lt;/span> &lt;span class="nx">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">use&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;/css&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">express&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">static&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">__&lt;/span>&lt;span class="nx">dirname&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;/css&amp;#39;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;span class="ln"> 7&lt;/span> &lt;span class="nx">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">use&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;/partials&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">express&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="kr">static&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">__&lt;/span>&lt;span class="nx">dirname&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;/partials&amp;#39;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;span class="ln"> 8&lt;/span>
&lt;span class="ln"> 9&lt;/span> &lt;span class="nx">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">all&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;/*&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">req&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">res&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">next&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">10&lt;/span> &lt;span class="c1">// Just send the index.html for other files to support HTML5Mode
&lt;/span>&lt;span class="ln">11&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">res&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">sendFile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;index.html&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">root&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">__&lt;/span>&lt;span class="nx">dirname&lt;/span> &lt;span class="p">});&lt;/span>
&lt;span class="ln">12&lt;/span> &lt;span class="p">});&lt;/span>
&lt;span class="ln">13&lt;/span>
&lt;span class="ln">14&lt;/span> &lt;span class="nx">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">listen&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3006&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//the port you want to use
&lt;/span>&lt;span class="ln">15&lt;/span>&lt;span class="c1">&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ASP.Net C# Rewrites&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="ln">1&lt;/span> &lt;span class="k">private&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">ROOT_DOCUMENT&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;/default.aspx&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="ln">2&lt;/span>
&lt;span class="ln">3&lt;/span> &lt;span class="k">protected&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Application_BeginRequest&lt;/span>&lt;span class="p">(&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EventArgs&lt;/span> &lt;span class="n">e&lt;/span> &lt;span class="p">)&lt;/span>
&lt;span class="ln">4&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">5&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">url&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">Request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Url&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">LocalPath&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="ln">6&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">IO&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">File&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Exists&lt;/span>&lt;span class="p">(&lt;/span> &lt;span class="n">Context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Server&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">MapPath&lt;/span>&lt;span class="p">(&lt;/span> &lt;span class="n">url&lt;/span> &lt;span class="p">)&lt;/span> &lt;span class="p">)&lt;/span> &lt;span class="p">)&lt;/span>
&lt;span class="ln">7&lt;/span> &lt;span class="n">Context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">RewritePath&lt;/span>&lt;span class="p">(&lt;/span> &lt;span class="n">ROOT_DOCUMENT&lt;/span> &lt;span class="p">);&lt;/span>
&lt;span class="ln">8&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="ln">9&lt;/span> &lt;/code>&lt;/pre>&lt;/div>
&lt;/li>
&lt;/ul></description></item></channel></rss>