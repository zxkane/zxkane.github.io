<!doctype html><html lang=en-us><head><title>MongoDB中如何找出慢查询</title><style>body,body.pushable{background-repeat:no-repeat;background-attachment:fixed;background-size:cover!important}</style><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=author content="Kane"><meta name=description content="MongoDB是目前最为流行的NoSQL数据库之一。V秘的后台数据就是保存在MongoDB中的哦;) 尽管MongoDB的性能为业界称道，但任"><meta name=generator content="Hugo 0.78.1"><link rel="shortcut icon" href=/img/favicon.ico><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css><script src=https://code.jquery.com/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js></script><link href="https://fonts.googleapis.com/css?family=Abril+Fatface|Inconsolata" rel=stylesheet><link rel=stylesheet type=text/css href=/css/site.css><link rel=stylesheet type=text/css href=/css/highlight.css><link rel=stylesheet type=text/css href=/css/highlight.css><style>body.pushable{display:block;background-image:var(--bgImage)!important}</style><script>var isMobile=(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))
console.log("The client device is a "+(isMobile?"mobile":"PC")+".")</script></head><body><script>var prevBgIndex=0;var bodyBgSwitchIndex=0;var gradients=[[],['#40e0d0','#ff8c00','#ff0080'],['#3e5151','#decba4'],['#11998e','#38ef7d'],['#108dc7','#ef8e38'],['#fc5c7d','#6a82fb'],['#fc466b','#3f5efb'],['#c94b4b','#4b134f'],['#23074d','#cc5333']];var randomBgColor=gradients[getRandomInt(0,gradients.length)].join(", ");var backgroundProperty='linear-gradient(to right, '+randomBgColor+')';document.body.style.background=backgroundProperty;function getRandomInt(min,max){min=Math.ceil(min);max=Math.floor(max);var random;while(1){random=Math.floor(Math.random()*(max-min))+min;if(random!==prevBgIndex){prevBgIndex=random;break;}}
return random;}</script><div id=sidebar class="ui sidebar inverted vertical menu"><section id=author class="ui top attached center aligned inverted segment"><div class="ui small circular image"><img src=/img/portrait.jpg></div><h3 class="ui header">Kane<div class="sub header">Three boys' father, open source mania.</div></h3></section><section class="ui attached center aligned inverted segment sidebar-dream-tags"><a class="ui label violet" href=/tags/aws title=aws>aws</a>
<a class="ui label violet" href=/tags/eclipse title=eclipse>eclipse</a>
<a class="ui label olive" href=/tags/%E4%BA%91%E8%AE%A1%E7%AE%97 title=云计算>云计算</a>
<a class="ui label yellow" href=/tags/equinox title=equinox>equinox</a>
<a class="ui label pink" href=/tags/tip title=tip>tip</a>
<a class="ui label blue" href=/tags/osgi title=osgi>osgi</a>
<a class="ui label violet" href=/tags/p2 title=p2>p2</a>
<a class="ui label purple" href=/tags/%E9%98%BF%E9%87%8C%E4%BA%91 title=阿里云>阿里云</a>
<a class="ui label yellow" href=/tags/docker title=docker>docker</a>
<a class="ui label pink" href=/tags/faas title=faas>faas</a></section><section class="ui attached inverted segment sidebar-dream-categories both flexbox"><div class="ui inverted accordion"><div class=title><i class="dropdown icon"></i><a class=link href=/categories/amazon-builders-library>amazon-builders-library</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/the-best-practise-of-deployment-at-amazon/><div><i class="cocktail icon"></i><p>亚马逊的部署最佳实践</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/blogging>blogging</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/the-best-practise-of-deployment-at-amazon/><div><i class="cocktail icon"></i><p>亚马逊的部署最佳实践</p></div></a><a class=item href=https://kane.mx/posts/2020/deploy-aws-cdk-applications-cross-accounts/><div><i class="cocktail icon"></i><p>跨账号跨区域部署AWS CDK编排的应用</p></div></a><a class=item href=https://kane.mx/posts/2020/deploy-sonatype-nexus-oss-on-eks/><div><i class="cocktail icon"></i><p>Deploy Sonatype Nexus repository OSS on EKS</p></div></a><a class=item href=https://kane.mx/posts/2020/serverless-docker-images-analytics/><div><i class="cocktail icon"></i><p>无服务器架构的Docker镜像数据分析应用</p></div></a><a class=item href=https://kane.mx/posts/2020/get-docker-image-size-without-pulling-image/><div><i class="cocktail icon"></i><p>Get the size of Docker image without pulling image</p></div></a><a class=item href=https://kane.mx/posts/2020/zsh-performance-tuning/><div><i class="cocktail icon"></i><p>oh-my-zsh性能调优思路</p></div></a><a class=item href=https://kane.mx/posts/2020/codecommit-devops-model/><div><i class="cocktail icon"></i><p>基于CodeCommit代码管理的无服务器架构Devops</p></div></a><a class=item href=https://kane.mx/posts/2020/new-http-apis-of-api-gateway/><div><i class="cocktail icon"></i><p>AWS发布更快、更便宜、更易用的HTTP APIs</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cloud-debugging/><div><i class="cocktail icon"></i><p>AWS Cloud Debugging初探</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-batch/><div><i class="cocktail icon"></i><p>AWS Batch简介</p></div></a><a class=item href=https://kane.mx/posts/2019/email-forwarding/><div><i class="cocktail icon"></i><p>免费邮件转发服务</p></div></a><a class=item href=https://kane.mx/posts/2019/aliyun-edas-migration-in-action/><div><i class="cocktail icon"></i><p>实战Aliyun EDAS应用迁移AWS</p></div></a><a class=item href=https://kane.mx/posts/2019/rds-log-analysis/><div><i class="cocktail icon"></i><p>AWS RDS数据库日志分析及展示</p></div></a><a class=item href=https://kane.mx/posts/2019/using-openswan-connect-aws-vpn/><div><i class="cocktail icon"></i><p>使用Openswan连接AWS VPC</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cdk/><div><i class="cocktail icon"></i><p>AWS CDK简介</p></div></a><a class=item href=https://kane.mx/posts/2019/alexa-login-issue/><div><i class="cocktail icon"></i><p>Amazon Alexa Android版本国内登录问题</p></div></a><a class=item href=https://kane.mx/posts/2019/using-s3-as-device-for-mac-time-machine-backup/><div><i class="cocktail icon"></i><p>使用AWS S3作为MacOSX时间机器(Time Machine)的备份存储</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-vs-aliyun/><div><i class="cocktail icon"></i><p>公有云对比</p></div></a><a class=item href=https://kane.mx/posts/2019/serverless-framework/><div><i class="cocktail icon"></i><p>Serverless framework 101</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-lambda-layers/><div><i class="cocktail icon"></i><p>AWS Lambda Layer实践</p></div></a><a class=item href=https://kane.mx/posts/2019/2019-qconbeijing-reviews/><div><i class="cocktail icon"></i><p>QCon2019北京站回顾</p></div></a><a class=item href=https://kane.mx/posts/2018/2018-12-13-bj-archsummit-review/><div><i class="cocktail icon"></i><p>2018北京ArchSummit回顾</p></div></a><a class=item href=https://kane.mx/posts/2016/how-to-fix-jenkins-fail-to-load-job-config/><div><i class="cocktail icon"></i><p>如何修复Jenkins CI无法读取存在的任务配置</p></div></a><a class=item href=https://kane.mx/posts/2016/how-to-find-slow-queries-in-mongodb/><div><i class="cocktail icon"></i><p>MongoDB中如何找出慢查询</p></div></a><a class=item href=https://kane.mx/posts/2016/the-limitations-docker-swarm-mode-v1.12/><div><i class="cocktail icon"></i><p>Docker Swarm mode(v1.12.x)的一些使用限制</p></div></a><a class=item href=https://kane.mx/posts/2016/docker-swarm-mode-in-ubuntu-1404/><div><i class="cocktail icon"></i><p>创建于Docker Swarm的服务无法在Ubuntu 14.04 LTS中运行</p></div></a><a class=item href=https://kane.mx/posts/2016/seo-optimization-for-angularajs-based-app/><div><i class="cocktail icon"></i><p>基于Angularjs单页面应用的SEO优化</p></div></a><a class=item href=https://kane.mx/posts/2016/clustered-session-under-spring-framework/><div><i class="cocktail icon"></i><p>Spring框架下的分布式session管理</p></div></a><a class=item href=https://kane.mx/posts/2016/how-we-build-videome/><div><i class="cocktail icon"></i><p>V秘是如何构建的</p></div></a><a class=item href=https://kane.mx/posts/2016/aliyun-ossfs-sucks/><div><i class="cocktail icon"></i><p>说一说阿里云ossfs</p></div></a><a class=item href=https://kane.mx/posts/2016/weixin-temporary-materials/><div><i class="cocktail icon"></i><p>如何使用微信公众平台的临时素材</p></div></a><a class=item href=https://kane.mx/posts/2016/single-page-app-meets-weixin-pay/><div><i class="cocktail icon"></i><p>单页面应用(single page application)中使用微信支付</p></div></a><a class=item href=https://kane.mx/posts/2016/docker-build-no-space-left-caused-by-inode-exhausted/><div><i class="cocktail icon"></i><p>文件系统的Inode耗尽，会导致Docker编译镜像出现'No space left on device'错误</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/effective-cloud-computing>effective-cloud-computing</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/deploy-aws-cdk-applications-cross-accounts/><div><i class="cocktail icon"></i><p>跨账号跨区域部署AWS CDK编排的应用</p></div></a><a class=item href=https://kane.mx/posts/2020/deploy-sonatype-nexus-oss-on-eks/><div><i class="cocktail icon"></i><p>Deploy Sonatype Nexus repository OSS on EKS</p></div></a><a class=item href=https://kane.mx/posts/2020/serverless-docker-images-analytics/><div><i class="cocktail icon"></i><p>无服务器架构的Docker镜像数据分析应用</p></div></a><a class=item href=https://kane.mx/posts/2020/codecommit-devops-model/><div><i class="cocktail icon"></i><p>基于CodeCommit代码管理的无服务器架构Devops</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cloud-debugging/><div><i class="cocktail icon"></i><p>AWS Cloud Debugging初探</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-batch/><div><i class="cocktail icon"></i><p>AWS Batch简介</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cdk/><div><i class="cocktail icon"></i><p>AWS CDK简介</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-domain-redirect/><div><i class="cocktail icon"></i><p>无服务器架构的域名重定向服务</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-function-for-aws/><div><i class="cocktail icon"></i><p>Spring Cloud Function -- 跨Serverless平台的函数计算框架</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-or-cloud-native/><div><i class="cocktail icon"></i><p>Spring Cloud or Cloud Native</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part2/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (下)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-dingtalk-callback/><div><i class="cocktail icon"></i><p>基于函数计算的钉钉回调函数接口</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-computing-101/><div><i class="cocktail icon"></i><p>无服务器计算101</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part1/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (上)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/iam-best-practice/><div><i class="cocktail icon"></i><p>IAM最佳实践</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/using-kubernetes-on-cloud/><div><i class="cocktail icon"></i><p>不要自建Kubernetes</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/preface/><div><i class="cocktail icon"></i><p>真的会用云服务吗？</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/kubernetes>kubernetes</a></div><div class=content><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-or-cloud-native/><div><i class="cocktail icon"></i><p>Spring Cloud or Cloud Native</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part2/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (下)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part1/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (上)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/using-kubernetes-on-cloud/><div><i class="cocktail icon"></i><p>不要自建Kubernetes</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/serverless-computing>serverless-computing</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/new-http-apis-of-api-gateway/><div><i class="cocktail icon"></i><p>AWS发布更快、更便宜、更易用的HTTP APIs</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-domain-redirect/><div><i class="cocktail icon"></i><p>无服务器架构的域名重定向服务</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-function-for-aws/><div><i class="cocktail icon"></i><p>Spring Cloud Function -- 跨Serverless平台的函数计算框架</p></div></a><a class=item href=https://kane.mx/posts/2019/serverless-framework/><div><i class="cocktail icon"></i><p>Serverless framework 101</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-lambda-layers/><div><i class="cocktail icon"></i><p>AWS Lambda Layer实践</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-dingtalk-callback/><div><i class="cocktail icon"></i><p>基于函数计算的钉钉回调函数接口</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-computing-101/><div><i class="cocktail icon"></i><p>无服务器计算101</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/trip>trip</a></div><div class=content><a class=item href=https://kane.mx/posts/archive/blogspot/food-and-drinking/><div><i class="cocktail icon"></i><p>Food and Drinking</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/working-workspace/><div><i class="cocktail icon"></i><p>Working Workspace</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/transportation/><div><i class="cocktail icon"></i><p>Transportation</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/working-style/><div><i class="cocktail icon"></i><p>Working style</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/day-1/><div><i class="cocktail icon"></i><p>day 1</p></div></a></div></div></section><section id=footer class="ui bottom attached center aligned inverted segment"><p>© 2020 The Road</p><p>Powered by <a href=https://gohugo.io/ target=_blank>Hugo</a> with <a href=https://github.com/UtkarshVerma/hugo-dream-plus target=_blank>Dream Plus</a> theme.</p></section></div><div class=pusher><div class=flipper><div class=front><nav class="ui top secondary menu bar"><div class=item><i class="inverted big link bullseye icon dream-flip-toggle" title="About Me"></i></div><div class=item><a href=/><i class="inverted big link home icon" title=Home></i></a></div><div class=item><a href=/tags><i class="inverted big link tags icon" title="All Tags"></i></a></div><div class=item><a href=/categories><i class="inverted big link cubes icon" title="All Categories"></i></a></div><div class="ui container tablet computer only grid"><div class=item onclick="$('.ui.sidebar').sidebar('setting','transition','overlay').sidebar('toggle');"><i class="inverted big link sidebar icon" title="Show Sidebar"></i></div></div><div class="item right"><a href=/posts/index.xml><i class="inverted big link rss icon" title="RSS Feed"></i></a></div></nav><div class="ui centered grid"><div class="sixteen wide mobile only column"><div class="ui inverted accordion"><div id=header class="ui inverted segment column box"><header id=author class="ui top attached center aligned inverted segment"><div class="ui small circular image"><img src=/img/portrait.jpg></div><h3 class="ui header">Kane<div class="sub header">Three boys' father, open source mania.</div></h3></header><div class="title header-title"><div id=tag-category-pop class="ui red right corner label"><i class="hand point icon down" title="Show/hide tags and categories"></i></div></div><div id=tag-category class=content><section class="ui attached center aligned inverted segment dream-tags none flexbox"><a class="ui label red" href=/tags/aws title=aws>aws</a>
<a class="ui label violet" href=/tags/eclipse title=eclipse>eclipse</a>
<a class="ui label yellow" href=/tags/%E4%BA%91%E8%AE%A1%E7%AE%97 title=云计算>云计算</a>
<a class="ui label teal" href=/tags/equinox title=equinox>equinox</a>
<a class="ui label teal" href=/tags/tip title=tip>tip</a>
<a class="ui label orange" href=/tags/osgi title=osgi>osgi</a>
<a class="ui label violet" href=/tags/p2 title=p2>p2</a>
<a class="ui label purple" href=/tags/%E9%98%BF%E9%87%8C%E4%BA%91 title=阿里云>阿里云</a>
<a class="ui label brown" href=/tags/docker title=docker>docker</a>
<a class="ui label red" href=/tags/faas title=faas>faas</a></section><section class="ui attached inverted segment dream-categories both flexbox"><div class="inverted accordion"><div class=title><i class="dropdown icon"></i><a class=link href=/categories/amazon-builders-library>amazon-builders-library</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/the-best-practise-of-deployment-at-amazon/><div><i class="cocktail icon"></i><p>亚马逊的部署最佳实践</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/blogging>blogging</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/the-best-practise-of-deployment-at-amazon/><div><i class="cocktail icon"></i><p>亚马逊的部署最佳实践</p></div></a><a class=item href=https://kane.mx/posts/2020/deploy-aws-cdk-applications-cross-accounts/><div><i class="cocktail icon"></i><p>跨账号跨区域部署AWS CDK编排的应用</p></div></a><a class=item href=https://kane.mx/posts/2020/deploy-sonatype-nexus-oss-on-eks/><div><i class="cocktail icon"></i><p>Deploy Sonatype Nexus repository OSS on EKS</p></div></a><a class=item href=https://kane.mx/posts/2020/serverless-docker-images-analytics/><div><i class="cocktail icon"></i><p>无服务器架构的Docker镜像数据分析应用</p></div></a><a class=item href=https://kane.mx/posts/2020/get-docker-image-size-without-pulling-image/><div><i class="cocktail icon"></i><p>Get the size of Docker image without pulling image</p></div></a><a class=item href=https://kane.mx/posts/2020/zsh-performance-tuning/><div><i class="cocktail icon"></i><p>oh-my-zsh性能调优思路</p></div></a><a class=item href=https://kane.mx/posts/2020/codecommit-devops-model/><div><i class="cocktail icon"></i><p>基于CodeCommit代码管理的无服务器架构Devops</p></div></a><a class=item href=https://kane.mx/posts/2020/new-http-apis-of-api-gateway/><div><i class="cocktail icon"></i><p>AWS发布更快、更便宜、更易用的HTTP APIs</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cloud-debugging/><div><i class="cocktail icon"></i><p>AWS Cloud Debugging初探</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-batch/><div><i class="cocktail icon"></i><p>AWS Batch简介</p></div></a><a class=item href=https://kane.mx/posts/2019/email-forwarding/><div><i class="cocktail icon"></i><p>免费邮件转发服务</p></div></a><a class=item href=https://kane.mx/posts/2019/aliyun-edas-migration-in-action/><div><i class="cocktail icon"></i><p>实战Aliyun EDAS应用迁移AWS</p></div></a><a class=item href=https://kane.mx/posts/2019/rds-log-analysis/><div><i class="cocktail icon"></i><p>AWS RDS数据库日志分析及展示</p></div></a><a class=item href=https://kane.mx/posts/2019/using-openswan-connect-aws-vpn/><div><i class="cocktail icon"></i><p>使用Openswan连接AWS VPC</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cdk/><div><i class="cocktail icon"></i><p>AWS CDK简介</p></div></a><a class=item href=https://kane.mx/posts/2019/alexa-login-issue/><div><i class="cocktail icon"></i><p>Amazon Alexa Android版本国内登录问题</p></div></a><a class=item href=https://kane.mx/posts/2019/using-s3-as-device-for-mac-time-machine-backup/><div><i class="cocktail icon"></i><p>使用AWS S3作为MacOSX时间机器(Time Machine)的备份存储</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-vs-aliyun/><div><i class="cocktail icon"></i><p>公有云对比</p></div></a><a class=item href=https://kane.mx/posts/2019/serverless-framework/><div><i class="cocktail icon"></i><p>Serverless framework 101</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-lambda-layers/><div><i class="cocktail icon"></i><p>AWS Lambda Layer实践</p></div></a><a class=item href=https://kane.mx/posts/2019/2019-qconbeijing-reviews/><div><i class="cocktail icon"></i><p>QCon2019北京站回顾</p></div></a><a class=item href=https://kane.mx/posts/2018/2018-12-13-bj-archsummit-review/><div><i class="cocktail icon"></i><p>2018北京ArchSummit回顾</p></div></a><a class=item href=https://kane.mx/posts/2016/how-to-fix-jenkins-fail-to-load-job-config/><div><i class="cocktail icon"></i><p>如何修复Jenkins CI无法读取存在的任务配置</p></div></a><a class=item href=https://kane.mx/posts/2016/how-to-find-slow-queries-in-mongodb/><div><i class="cocktail icon"></i><p>MongoDB中如何找出慢查询</p></div></a><a class=item href=https://kane.mx/posts/2016/the-limitations-docker-swarm-mode-v1.12/><div><i class="cocktail icon"></i><p>Docker Swarm mode(v1.12.x)的一些使用限制</p></div></a><a class=item href=https://kane.mx/posts/2016/docker-swarm-mode-in-ubuntu-1404/><div><i class="cocktail icon"></i><p>创建于Docker Swarm的服务无法在Ubuntu 14.04 LTS中运行</p></div></a><a class=item href=https://kane.mx/posts/2016/seo-optimization-for-angularajs-based-app/><div><i class="cocktail icon"></i><p>基于Angularjs单页面应用的SEO优化</p></div></a><a class=item href=https://kane.mx/posts/2016/clustered-session-under-spring-framework/><div><i class="cocktail icon"></i><p>Spring框架下的分布式session管理</p></div></a><a class=item href=https://kane.mx/posts/2016/how-we-build-videome/><div><i class="cocktail icon"></i><p>V秘是如何构建的</p></div></a><a class=item href=https://kane.mx/posts/2016/aliyun-ossfs-sucks/><div><i class="cocktail icon"></i><p>说一说阿里云ossfs</p></div></a><a class=item href=https://kane.mx/posts/2016/weixin-temporary-materials/><div><i class="cocktail icon"></i><p>如何使用微信公众平台的临时素材</p></div></a><a class=item href=https://kane.mx/posts/2016/single-page-app-meets-weixin-pay/><div><i class="cocktail icon"></i><p>单页面应用(single page application)中使用微信支付</p></div></a><a class=item href=https://kane.mx/posts/2016/docker-build-no-space-left-caused-by-inode-exhausted/><div><i class="cocktail icon"></i><p>文件系统的Inode耗尽，会导致Docker编译镜像出现'No space left on device'错误</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/effective-cloud-computing>effective-cloud-computing</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/deploy-aws-cdk-applications-cross-accounts/><div><i class="cocktail icon"></i><p>跨账号跨区域部署AWS CDK编排的应用</p></div></a><a class=item href=https://kane.mx/posts/2020/deploy-sonatype-nexus-oss-on-eks/><div><i class="cocktail icon"></i><p>Deploy Sonatype Nexus repository OSS on EKS</p></div></a><a class=item href=https://kane.mx/posts/2020/serverless-docker-images-analytics/><div><i class="cocktail icon"></i><p>无服务器架构的Docker镜像数据分析应用</p></div></a><a class=item href=https://kane.mx/posts/2020/codecommit-devops-model/><div><i class="cocktail icon"></i><p>基于CodeCommit代码管理的无服务器架构Devops</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cloud-debugging/><div><i class="cocktail icon"></i><p>AWS Cloud Debugging初探</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-batch/><div><i class="cocktail icon"></i><p>AWS Batch简介</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cdk/><div><i class="cocktail icon"></i><p>AWS CDK简介</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-domain-redirect/><div><i class="cocktail icon"></i><p>无服务器架构的域名重定向服务</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-function-for-aws/><div><i class="cocktail icon"></i><p>Spring Cloud Function -- 跨Serverless平台的函数计算框架</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-or-cloud-native/><div><i class="cocktail icon"></i><p>Spring Cloud or Cloud Native</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part2/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (下)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-dingtalk-callback/><div><i class="cocktail icon"></i><p>基于函数计算的钉钉回调函数接口</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-computing-101/><div><i class="cocktail icon"></i><p>无服务器计算101</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part1/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (上)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/iam-best-practice/><div><i class="cocktail icon"></i><p>IAM最佳实践</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/using-kubernetes-on-cloud/><div><i class="cocktail icon"></i><p>不要自建Kubernetes</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/preface/><div><i class="cocktail icon"></i><p>真的会用云服务吗？</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/kubernetes>kubernetes</a></div><div class=content><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-or-cloud-native/><div><i class="cocktail icon"></i><p>Spring Cloud or Cloud Native</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part2/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (下)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part1/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (上)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/using-kubernetes-on-cloud/><div><i class="cocktail icon"></i><p>不要自建Kubernetes</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/serverless-computing>serverless-computing</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/new-http-apis-of-api-gateway/><div><i class="cocktail icon"></i><p>AWS发布更快、更便宜、更易用的HTTP APIs</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-domain-redirect/><div><i class="cocktail icon"></i><p>无服务器架构的域名重定向服务</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-function-for-aws/><div><i class="cocktail icon"></i><p>Spring Cloud Function -- 跨Serverless平台的函数计算框架</p></div></a><a class=item href=https://kane.mx/posts/2019/serverless-framework/><div><i class="cocktail icon"></i><p>Serverless framework 101</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-lambda-layers/><div><i class="cocktail icon"></i><p>AWS Lambda Layer实践</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-dingtalk-callback/><div><i class="cocktail icon"></i><p>基于函数计算的钉钉回调函数接口</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-computing-101/><div><i class="cocktail icon"></i><p>无服务器计算101</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/trip>trip</a></div><div class=content><a class=item href=https://kane.mx/posts/archive/blogspot/food-and-drinking/><div><i class="cocktail icon"></i><p>Food and Drinking</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/working-workspace/><div><i class="cocktail icon"></i><p>Working Workspace</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/transportation/><div><i class="cocktail icon"></i><p>Transportation</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/working-style/><div><i class="cocktail icon"></i><p>Working style</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/day-1/><div><i class="cocktail icon"></i><p>day 1</p></div></a></div></div></section></div><footer class="ui bottom attached center aligned inverted segment"><p>© 2020 The Road</p><p>Powered by <a href=https://gohugo.io/ target=_blank>Hugo</a> with <a href=https://github.com/UtkarshVerma/hugo-dream-plus target=_blank>Dream Plus</a> theme.</p></footer></div></div></div><div class="sixteen wide mobile fifteen wide tablet twelve wide computer column post-list"><section class="ui secondary top attached black segment post-head"><h1 class=post-title>MongoDB中如何找出慢查询</h1><div class="sub header"><div><span><i class="calendar outline icon"></i>Sep 29, 2016</span></div><div><span><i class="clock outline icon"></i>2 min read</span></div><div><span><i class="angle double up icon"></i>Last updated on Jan 25, 2019</span></div></div><hr><article class="post-content twemoji"><p><a href=https://www.mongodb.com/>MongoDB</a>是目前最为流行的<a href=https://en.wikipedia.org/wiki/NoSQL>NoSQL</a>数据库之一。<a href=https://vme360.com>V秘</a>的后台数据就是保存在<a href=https://www.mongodb.com/>MongoDB</a>中的哦;)</p><p>尽管<a href=https://www.mongodb.com/>MongoDB</a>的性能为业界称道，但任何数据库系统使用中都存在着慢查询的问题。慢查询的性能问题，可能是由于使用非最优的查询语句，不正确的索引或其他配置原因导致的。但开发人员或数据库维护人员首先要找出这些低效的查询，才能做出对应的查询优化。</p><p>在<a href=https://www.mongodb.com/>MongoDB</a>中实现慢查询的profile是非常容易，因为<a href=https://www.mongodb.com/>MongoDB</a>内置了<a href=https://docs.mongodb.com/manual/reference/method/db.setProfilingLevel/>profile开关</a>来记录执行时间触发了profile条件的查询。</p><p>参照<a href=https://docs.mongodb.com/manual/reference/method/db.setProfilingLevel/>db.setProfileLevel()</a>的文档，通过以下命令就可以记录执行时长超过<strong>300ms</strong>的查询。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>setProfilingLevel</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>300</span>)
</code></pre></div><p>当慢查询被重现后，可以通过查找<code>system.profile</code> collection来查看执行时长超过<strong>300ms</strong>的查询。</p><p>被profiler记录下来慢查询record看起来如下，</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{       
        <span style=color:#f92672>&#34;op&#34;</span> : <span style=color:#e6db74>&#34;query&#34;</span>,
        <span style=color:#f92672>&#34;ns&#34;</span> : <span style=color:#e6db74>&#34;myCollection&#34;</span>,
        <span style=color:#f92672>&#34;query&#34;</span> : {     
                <span style=color:#f92672>&#34;builds&#34;</span> : {    
                        <span style=color:#f92672>&#34;$elemMatch&#34;</span> : {
                                <span style=color:#f92672>&#34;builtTime&#34;</span> : <span style=color:#66d9ef>null</span>,
                                <span style=color:#f92672>&#34;$and&#34;</span> : [      
                                        {               
                                                <span style=color:#f92672>&#34;createdTime&#34;</span> : {
                                                        <span style=color:#f92672>&#34;$lt&#34;</span> : <span style=color:#960050;background-color:#1e0010>ISODate(</span><span style=color:#e6db74>&#34;2016-09-20T20:07:00.796Z&#34;</span><span style=color:#960050;background-color:#1e0010>)</span>
                                                }
                                        }
                                ]
                        }
                }
        },
        <span style=color:#f92672>&#34;ntoreturn&#34;</span> : <span style=color:#ae81ff>0</span>,
        <span style=color:#f92672>&#34;ntoskip&#34;</span> : <span style=color:#ae81ff>0</span>,
        <span style=color:#f92672>&#34;nscanned&#34;</span> : <span style=color:#ae81ff>0</span>,
        <span style=color:#f92672>&#34;nscannedObjects&#34;</span> : <span style=color:#ae81ff>18231</span>,
        <span style=color:#f92672>&#34;keyUpdates&#34;</span> : <span style=color:#ae81ff>0</span>,
        <span style=color:#f92672>&#34;writeConflicts&#34;</span> : <span style=color:#ae81ff>0</span>,
        <span style=color:#f92672>&#34;numYield&#34;</span> : <span style=color:#ae81ff>577</span>,
        <span style=color:#f92672>&#34;locks&#34;</span> : {     
                <span style=color:#f92672>&#34;Global&#34;</span> : {    
                        <span style=color:#f92672>&#34;acquireCount&#34;</span> : {
                                <span style=color:#f92672>&#34;r&#34;</span> : <span style=color:#960050;background-color:#1e0010>NumberLong(</span><span style=color:#ae81ff>1156</span><span style=color:#960050;background-color:#1e0010>)</span>
                        }
                },      
                <span style=color:#f92672>&#34;Database&#34;</span> : {  
                        <span style=color:#f92672>&#34;acquireCount&#34;</span> : {
                                <span style=color:#f92672>&#34;r&#34;</span> : <span style=color:#960050;background-color:#1e0010>NumberLong(</span><span style=color:#ae81ff>578</span><span style=color:#960050;background-color:#1e0010>)</span>
                        }
                },      
                <span style=color:#f92672>&#34;Collection&#34;</span> : {
                        <span style=color:#f92672>&#34;acquireCount&#34;</span> : {
                                <span style=color:#f92672>&#34;r&#34;</span> : <span style=color:#960050;background-color:#1e0010>NumberLong(</span><span style=color:#ae81ff>578</span><span style=color:#960050;background-color:#1e0010>)</span>
                        }
                }
        },
        <span style=color:#f92672>&#34;nreturned&#34;</span> : <span style=color:#ae81ff>2</span>,
        <span style=color:#f92672>&#34;responseLength&#34;</span> : <span style=color:#ae81ff>98076</span>,
        <span style=color:#f92672>&#34;millis&#34;</span> : <span style=color:#ae81ff>11161</span>,
        <span style=color:#f92672>&#34;execStats&#34;</span> : {
                <span style=color:#f92672>&#34;stage&#34;</span> : <span style=color:#e6db74>&#34;COLLSCAN&#34;</span>,
                <span style=color:#f92672>&#34;filter&#34;</span> : {
                        <span style=color:#f92672>&#34;builds&#34;</span> : {
                                <span style=color:#f92672>&#34;$elemMatch&#34;</span> : {
                                        <span style=color:#f92672>&#34;$and&#34;</span> : [
                                                {
                                                        <span style=color:#f92672>&#34;$and&#34;</span> : [
                                                                {
                                                                        <span style=color:#f92672>&#34;createdTime&#34;</span> : {
                                                                                <span style=color:#f92672>&#34;$lt&#34;</span> : <span style=color:#960050;background-color:#1e0010>ISODate(</span><span style=color:#e6db74>&#34;2016-09-20T20:07:00.796Z&#34;</span><span style=color:#960050;background-color:#1e0010>)</span>
                                                                        }
                                                                }
                                                        ]
                                                },
                                                {
                                                        <span style=color:#f92672>&#34;builtTime&#34;</span> : {
                                                                <span style=color:#f92672>&#34;$eq&#34;</span> : <span style=color:#66d9ef>null</span>
                                                        }
                                                }
                                        ]
                                }
                        }
                },
                <span style=color:#f92672>&#34;nReturned&#34;</span> : <span style=color:#ae81ff>2</span>,
                <span style=color:#f92672>&#34;executionTimeMillisEstimate&#34;</span> : <span style=color:#ae81ff>11080</span>,
                <span style=color:#f92672>&#34;works&#34;</span> : <span style=color:#ae81ff>18233</span>,
                <span style=color:#f92672>&#34;advanced&#34;</span> : <span style=color:#ae81ff>2</span>,
                <span style=color:#f92672>&#34;needTime&#34;</span> : <span style=color:#ae81ff>18230</span>,
                <span style=color:#f92672>&#34;needFetch&#34;</span> : <span style=color:#ae81ff>0</span>,
                <span style=color:#f92672>&#34;saveState&#34;</span> : <span style=color:#ae81ff>577</span>,
                <span style=color:#f92672>&#34;restoreState&#34;</span> : <span style=color:#ae81ff>577</span>,
                <span style=color:#f92672>&#34;isEOF&#34;</span> : <span style=color:#ae81ff>1</span>,
                <span style=color:#f92672>&#34;invalidates&#34;</span> : <span style=color:#ae81ff>0</span>,
                <span style=color:#f92672>&#34;direction&#34;</span> : <span style=color:#e6db74>&#34;forward&#34;</span>,
                <span style=color:#f92672>&#34;docsExamined&#34;</span> : <span style=color:#ae81ff>18231</span>
        },      
        <span style=color:#f92672>&#34;ts&#34;</span> : <span style=color:#960050;background-color:#1e0010>ISODate(</span><span style=color:#e6db74>&#34;2016-09-20T23:07:14.313Z&#34;</span><span style=color:#960050;background-color:#1e0010>)</span>,
        <span style=color:#f92672>&#34;client&#34;</span> : <span style=color:#e6db74>&#34;10.171.127.66&#34;</span>,
        <span style=color:#f92672>&#34;allUsers&#34;</span> : [
                {
                        <span style=color:#f92672>&#34;user&#34;</span> : <span style=color:#e6db74>&#34;dbuser&#34;</span>,
                        <span style=color:#f92672>&#34;db&#34;</span> : <span style=color:#e6db74>&#34;mydb&#34;</span>
                }
        ],
        <span style=color:#f92672>&#34;user&#34;</span> : <span style=color:#e6db74>&#34;dbuser@mydb&#34;</span>
}   </code></pre></div><p>上面的数据具体解读如下，</p><ol><li><code>op: 'query'</code>表示执行的是查询，</li><li><code>ns</code>是指查询的collection，</li><li><code>query</code>是具体的查询语句，</li><li>核心部分是<code>execStats</code>，给出了的查询语句具体执行统计，跟**.explain(&lsquo;execStats&rsquo;)**的内容是一致的。上面的统计是说，这个query执行了整个collection的扫描(总计扫描了18231个文档)，最终返回了2条文档，花费了11080ms，也就是11s还多的时间！这表明被记录下的慢查询跟collection的索引设置有问题，该查询没有用上索引。解决方案很简单，改善查询语句使用存在的索引或者设置合理的索引。</li><li><code>ts</code>是查询开始请求的时间，</li><li><code>allUsers</code>和<code>user</code>都是MongoDB client连接所使用的用户。</li></ol></article></section><section class="ui secondary attached segment dream-tags"><a class="ui label green" href=/tags/mongodb title=MongoDB>MongoDB</a>
<a class="ui label red" href=/tags/performance-tuning title=performance-tuning>performance-tuning</a></section><section class="ui secondary bottom attached segment share row box"><div class=author><img class=avatar src=/img/portrait.jpg></div><div class="info grow flexbox"><p class=name>Kane</p><p class=desc>Three boys' father, open source mania.</p></div><section class="buttons row box"><div class="facebook none flexbox" href=# onclick="window.open('https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),'facebook-share-dialog','width=626,height=436');return false;"><button class="ui facebook button"><i class="facebook icon"></i>Share</button></div><div class="twitter none flexbox" onclick="window.open('https://twitter.com/intent/tweet?text=Read &#34;MongoDB中如何找出慢查询  https:\/\/kane.mx\/posts\/2016\/how-to-find-slow-queries-in-mongodb\/','_self')"><button class="ui twitter button"><i class="twitter icon"></i>Tweet</button></div></section></section><script src=https://utteranc.es/client.js repo=zxkane/articles issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></div><div class=back><nav class="ui top secondary menu bar"><div class=item><i class="inverted big link bullseye icon dream-flip-toggle" title="About Me"></i></div><div class=item><a href=https://github.com/zxkane target=_blank><i id=ico class="inverted big link github icon" title=GitHub></i></a></div><div class=item><a href=mailto:me@kane.mx target=_blank><i id=ico class="inverted big link mail icon" title=Email></i></a></div><div class=item><a href=https://www.stackoverflow.com/users/390513/kane target=_blank><i id=ico class="inverted big link stack overflow icon" title="Stack Overflow"></i></a></div></nav><div class="ui centered grid about"><div class="sixteen wide mobile fifteen wide tablet fifteen wide computer column about"><section class="ui stacked segments"><div class="ui inverted segment"><article class=twemoji><h1 id=so-who-am-i>So, Who Am I?</h1><hr><p>I’m the father of three boys. Live in Beijing. Also I&rsquo;m the *uix user, a full stack software engineer, devops and cloud native evangelist.</p><p>Curious about me? Use the social links above to check out my profiles.</p></article></div></section></div></div></div></div></div><script src=/js/site.js></script><script src=https://twemoji.maxcdn.com/2/twemoji.min.js?2.6></script><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-11561366-2','auto');ga('send','pageview');</script><script async src=https://www.google-analytics.com/analytics.js></script><script>(function(){console.log("Twemoji up and making stuff colourful!");for(var b=document.getElementsByClassName("twemoji"),a=0;a<b.length;a++){twemoji.parse(b[a]);}})();</script></body></html>