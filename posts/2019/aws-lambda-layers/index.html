<!doctype html><html lang=en-us><head><title>AWS Lambda Layer实践</title><style>body,body.pushable{background-repeat:no-repeat;background-attachment:fixed;background-size:cover!important}</style><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=author content="Kane"><meta name=description content="使用Lambda Layer共享基础依赖、三方库或自定义runtime"><meta name=generator content="Hugo 0.78.1"><link rel="shortcut icon" href=/img/favicon.ico><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css><script src=https://code.jquery.com/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js></script><link href="https://fonts.googleapis.com/css?family=Abril+Fatface|Inconsolata" rel=stylesheet><link rel=stylesheet type=text/css href=/css/site.css><link rel=stylesheet type=text/css href=/css/highlight.css><link rel=stylesheet type=text/css href=/css/highlight.css><style>body.pushable{display:block;background-image:var(--bgImage)!important}</style><script>var isMobile=(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))
console.log("The client device is a "+(isMobile?"mobile":"PC")+".")</script></head><body><script>var prevBgIndex=0;var bodyBgSwitchIndex=0;var gradients=[[],['#40e0d0','#ff8c00','#ff0080'],['#3e5151','#decba4'],['#11998e','#38ef7d'],['#108dc7','#ef8e38'],['#fc5c7d','#6a82fb'],['#fc466b','#3f5efb'],['#c94b4b','#4b134f'],['#23074d','#cc5333']];var randomBgColor=gradients[getRandomInt(0,gradients.length)].join(", ");var backgroundProperty='linear-gradient(to right, '+randomBgColor+')';document.body.style.background=backgroundProperty;function getRandomInt(min,max){min=Math.ceil(min);max=Math.floor(max);var random;while(1){random=Math.floor(Math.random()*(max-min))+min;if(random!==prevBgIndex){prevBgIndex=random;break;}}
return random;}</script><div id=sidebar class="ui sidebar inverted vertical menu"><section id=author class="ui top attached center aligned inverted segment"><div class="ui small circular image"><img src=/img/portrait.jpg></div><h3 class="ui header">Kane<div class="sub header">Three boys' father, open source mania.</div></h3></section><section class="ui attached center aligned inverted segment sidebar-dream-tags"><a class="ui label blue" href=/tags/aws title=aws>aws</a>
<a class="ui label blue" href=/tags/eclipse title=eclipse>eclipse</a>
<a class="ui label blue" href=/tags/%E4%BA%91%E8%AE%A1%E7%AE%97 title=云计算>云计算</a>
<a class="ui label green" href=/tags/equinox title=equinox>equinox</a>
<a class="ui label orange" href=/tags/tip title=tip>tip</a>
<a class="ui label teal" href=/tags/osgi title=osgi>osgi</a>
<a class="ui label teal" href=/tags/p2 title=p2>p2</a>
<a class="ui label violet" href=/tags/%E9%98%BF%E9%87%8C%E4%BA%91 title=阿里云>阿里云</a>
<a class="ui label yellow" href=/tags/docker title=docker>docker</a>
<a class="ui label violet" href=/tags/faas title=faas>faas</a></section><section class="ui attached inverted segment sidebar-dream-categories both flexbox"><div class="ui inverted accordion"><div class=title><i class="dropdown icon"></i><a class=link href=/categories/amazon-builders-library>amazon-builders-library</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/the-best-practise-of-deployment-at-amazon/><div><i class="cocktail icon"></i><p>亚马逊的部署最佳实践</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/blogging>blogging</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/the-best-practise-of-deployment-at-amazon/><div><i class="cocktail icon"></i><p>亚马逊的部署最佳实践</p></div></a><a class=item href=https://kane.mx/posts/2020/deploy-aws-cdk-applications-cross-accounts/><div><i class="cocktail icon"></i><p>跨账号跨区域部署AWS CDK编排的应用</p></div></a><a class=item href=https://kane.mx/posts/2020/deploy-sonatype-nexus-oss-on-eks/><div><i class="cocktail icon"></i><p>Deploy Sonatype Nexus repository OSS on EKS</p></div></a><a class=item href=https://kane.mx/posts/2020/serverless-docker-images-analytics/><div><i class="cocktail icon"></i><p>无服务器架构的Docker镜像数据分析应用</p></div></a><a class=item href=https://kane.mx/posts/2020/get-docker-image-size-without-pulling-image/><div><i class="cocktail icon"></i><p>Get the size of Docker image without pulling image</p></div></a><a class=item href=https://kane.mx/posts/2020/zsh-performance-tuning/><div><i class="cocktail icon"></i><p>oh-my-zsh性能调优思路</p></div></a><a class=item href=https://kane.mx/posts/2020/codecommit-devops-model/><div><i class="cocktail icon"></i><p>基于CodeCommit代码管理的无服务器架构Devops</p></div></a><a class=item href=https://kane.mx/posts/2020/new-http-apis-of-api-gateway/><div><i class="cocktail icon"></i><p>AWS发布更快、更便宜、更易用的HTTP APIs</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cloud-debugging/><div><i class="cocktail icon"></i><p>AWS Cloud Debugging初探</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-batch/><div><i class="cocktail icon"></i><p>AWS Batch简介</p></div></a><a class=item href=https://kane.mx/posts/2019/email-forwarding/><div><i class="cocktail icon"></i><p>免费邮件转发服务</p></div></a><a class=item href=https://kane.mx/posts/2019/aliyun-edas-migration-in-action/><div><i class="cocktail icon"></i><p>实战Aliyun EDAS应用迁移AWS</p></div></a><a class=item href=https://kane.mx/posts/2019/rds-log-analysis/><div><i class="cocktail icon"></i><p>AWS RDS数据库日志分析及展示</p></div></a><a class=item href=https://kane.mx/posts/2019/using-openswan-connect-aws-vpn/><div><i class="cocktail icon"></i><p>使用Openswan连接AWS VPC</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cdk/><div><i class="cocktail icon"></i><p>AWS CDK简介</p></div></a><a class=item href=https://kane.mx/posts/2019/alexa-login-issue/><div><i class="cocktail icon"></i><p>Amazon Alexa Android版本国内登录问题</p></div></a><a class=item href=https://kane.mx/posts/2019/using-s3-as-device-for-mac-time-machine-backup/><div><i class="cocktail icon"></i><p>使用AWS S3作为MacOSX时间机器(Time Machine)的备份存储</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-vs-aliyun/><div><i class="cocktail icon"></i><p>公有云对比</p></div></a><a class=item href=https://kane.mx/posts/2019/serverless-framework/><div><i class="cocktail icon"></i><p>Serverless framework 101</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-lambda-layers/><div><i class="cocktail icon"></i><p>AWS Lambda Layer实践</p></div></a><a class=item href=https://kane.mx/posts/2019/2019-qconbeijing-reviews/><div><i class="cocktail icon"></i><p>QCon2019北京站回顾</p></div></a><a class=item href=https://kane.mx/posts/2018/2018-12-13-bj-archsummit-review/><div><i class="cocktail icon"></i><p>2018北京ArchSummit回顾</p></div></a><a class=item href=https://kane.mx/posts/2016/how-to-fix-jenkins-fail-to-load-job-config/><div><i class="cocktail icon"></i><p>如何修复Jenkins CI无法读取存在的任务配置</p></div></a><a class=item href=https://kane.mx/posts/2016/how-to-find-slow-queries-in-mongodb/><div><i class="cocktail icon"></i><p>MongoDB中如何找出慢查询</p></div></a><a class=item href=https://kane.mx/posts/2016/the-limitations-docker-swarm-mode-v1.12/><div><i class="cocktail icon"></i><p>Docker Swarm mode(v1.12.x)的一些使用限制</p></div></a><a class=item href=https://kane.mx/posts/2016/docker-swarm-mode-in-ubuntu-1404/><div><i class="cocktail icon"></i><p>创建于Docker Swarm的服务无法在Ubuntu 14.04 LTS中运行</p></div></a><a class=item href=https://kane.mx/posts/2016/seo-optimization-for-angularajs-based-app/><div><i class="cocktail icon"></i><p>基于Angularjs单页面应用的SEO优化</p></div></a><a class=item href=https://kane.mx/posts/2016/clustered-session-under-spring-framework/><div><i class="cocktail icon"></i><p>Spring框架下的分布式session管理</p></div></a><a class=item href=https://kane.mx/posts/2016/how-we-build-videome/><div><i class="cocktail icon"></i><p>V秘是如何构建的</p></div></a><a class=item href=https://kane.mx/posts/2016/aliyun-ossfs-sucks/><div><i class="cocktail icon"></i><p>说一说阿里云ossfs</p></div></a><a class=item href=https://kane.mx/posts/2016/weixin-temporary-materials/><div><i class="cocktail icon"></i><p>如何使用微信公众平台的临时素材</p></div></a><a class=item href=https://kane.mx/posts/2016/single-page-app-meets-weixin-pay/><div><i class="cocktail icon"></i><p>单页面应用(single page application)中使用微信支付</p></div></a><a class=item href=https://kane.mx/posts/2016/docker-build-no-space-left-caused-by-inode-exhausted/><div><i class="cocktail icon"></i><p>文件系统的Inode耗尽，会导致Docker编译镜像出现'No space left on device'错误</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/effective-cloud-computing>effective-cloud-computing</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/deploy-aws-cdk-applications-cross-accounts/><div><i class="cocktail icon"></i><p>跨账号跨区域部署AWS CDK编排的应用</p></div></a><a class=item href=https://kane.mx/posts/2020/deploy-sonatype-nexus-oss-on-eks/><div><i class="cocktail icon"></i><p>Deploy Sonatype Nexus repository OSS on EKS</p></div></a><a class=item href=https://kane.mx/posts/2020/serverless-docker-images-analytics/><div><i class="cocktail icon"></i><p>无服务器架构的Docker镜像数据分析应用</p></div></a><a class=item href=https://kane.mx/posts/2020/codecommit-devops-model/><div><i class="cocktail icon"></i><p>基于CodeCommit代码管理的无服务器架构Devops</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cloud-debugging/><div><i class="cocktail icon"></i><p>AWS Cloud Debugging初探</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-batch/><div><i class="cocktail icon"></i><p>AWS Batch简介</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cdk/><div><i class="cocktail icon"></i><p>AWS CDK简介</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-domain-redirect/><div><i class="cocktail icon"></i><p>无服务器架构的域名重定向服务</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-function-for-aws/><div><i class="cocktail icon"></i><p>Spring Cloud Function -- 跨Serverless平台的函数计算框架</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-or-cloud-native/><div><i class="cocktail icon"></i><p>Spring Cloud or Cloud Native</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part2/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (下)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-dingtalk-callback/><div><i class="cocktail icon"></i><p>基于函数计算的钉钉回调函数接口</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-computing-101/><div><i class="cocktail icon"></i><p>无服务器计算101</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part1/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (上)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/iam-best-practice/><div><i class="cocktail icon"></i><p>IAM最佳实践</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/using-kubernetes-on-cloud/><div><i class="cocktail icon"></i><p>不要自建Kubernetes</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/preface/><div><i class="cocktail icon"></i><p>真的会用云服务吗？</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/kubernetes>kubernetes</a></div><div class=content><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-or-cloud-native/><div><i class="cocktail icon"></i><p>Spring Cloud or Cloud Native</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part2/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (下)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part1/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (上)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/using-kubernetes-on-cloud/><div><i class="cocktail icon"></i><p>不要自建Kubernetes</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/serverless-computing>serverless-computing</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/new-http-apis-of-api-gateway/><div><i class="cocktail icon"></i><p>AWS发布更快、更便宜、更易用的HTTP APIs</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-domain-redirect/><div><i class="cocktail icon"></i><p>无服务器架构的域名重定向服务</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-function-for-aws/><div><i class="cocktail icon"></i><p>Spring Cloud Function -- 跨Serverless平台的函数计算框架</p></div></a><a class=item href=https://kane.mx/posts/2019/serverless-framework/><div><i class="cocktail icon"></i><p>Serverless framework 101</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-lambda-layers/><div><i class="cocktail icon"></i><p>AWS Lambda Layer实践</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-dingtalk-callback/><div><i class="cocktail icon"></i><p>基于函数计算的钉钉回调函数接口</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-computing-101/><div><i class="cocktail icon"></i><p>无服务器计算101</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/trip>trip</a></div><div class=content><a class=item href=https://kane.mx/posts/archive/blogspot/food-and-drinking/><div><i class="cocktail icon"></i><p>Food and Drinking</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/working-workspace/><div><i class="cocktail icon"></i><p>Working Workspace</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/transportation/><div><i class="cocktail icon"></i><p>Transportation</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/working-style/><div><i class="cocktail icon"></i><p>Working style</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/day-1/><div><i class="cocktail icon"></i><p>day 1</p></div></a></div></div></section><section id=footer class="ui bottom attached center aligned inverted segment"><p>© 2020 The Road</p><p>Powered by <a href=https://gohugo.io/ target=_blank>Hugo</a> with <a href=https://github.com/UtkarshVerma/hugo-dream-plus target=_blank>Dream Plus</a> theme.</p></section></div><div class=pusher><div class=flipper><div class=front><nav class="ui top secondary menu bar"><div class=item><i class="inverted big link bullseye icon dream-flip-toggle" title="About Me"></i></div><div class=item><a href=/><i class="inverted big link home icon" title=Home></i></a></div><div class=item><a href=/tags><i class="inverted big link tags icon" title="All Tags"></i></a></div><div class=item><a href=/categories><i class="inverted big link cubes icon" title="All Categories"></i></a></div><div class="ui container tablet computer only grid"><div class=item onclick="$('.ui.sidebar').sidebar('setting','transition','overlay').sidebar('toggle');"><i class="inverted big link sidebar icon" title="Show Sidebar"></i></div></div><div class="item right"><a href=/posts/index.xml><i class="inverted big link rss icon" title="RSS Feed"></i></a></div></nav><div class="ui centered grid"><div class="sixteen wide mobile only column"><div class="ui inverted accordion"><div id=header class="ui inverted segment column box"><header id=author class="ui top attached center aligned inverted segment"><div class="ui small circular image"><img src=/img/portrait.jpg></div><h3 class="ui header">Kane<div class="sub header">Three boys' father, open source mania.</div></h3></header><div class="title header-title"><div id=tag-category-pop class="ui red right corner label"><i class="hand point icon down" title="Show/hide tags and categories"></i></div></div><div id=tag-category class=content><section class="ui attached center aligned inverted segment dream-tags none flexbox"><a class="ui label green" href=/tags/aws title=aws>aws</a>
<a class="ui label teal" href=/tags/eclipse title=eclipse>eclipse</a>
<a class="ui label red" href=/tags/%E4%BA%91%E8%AE%A1%E7%AE%97 title=云计算>云计算</a>
<a class="ui label green" href=/tags/equinox title=equinox>equinox</a>
<a class="ui label pink" href=/tags/tip title=tip>tip</a>
<a class="ui label teal" href=/tags/osgi title=osgi>osgi</a>
<a class="ui label purple" href=/tags/p2 title=p2>p2</a>
<a class="ui label red" href=/tags/%E9%98%BF%E9%87%8C%E4%BA%91 title=阿里云>阿里云</a>
<a class="ui label purple" href=/tags/docker title=docker>docker</a>
<a class="ui label teal" href=/tags/faas title=faas>faas</a></section><section class="ui attached inverted segment dream-categories both flexbox"><div class="inverted accordion"><div class=title><i class="dropdown icon"></i><a class=link href=/categories/amazon-builders-library>amazon-builders-library</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/the-best-practise-of-deployment-at-amazon/><div><i class="cocktail icon"></i><p>亚马逊的部署最佳实践</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/blogging>blogging</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/the-best-practise-of-deployment-at-amazon/><div><i class="cocktail icon"></i><p>亚马逊的部署最佳实践</p></div></a><a class=item href=https://kane.mx/posts/2020/deploy-aws-cdk-applications-cross-accounts/><div><i class="cocktail icon"></i><p>跨账号跨区域部署AWS CDK编排的应用</p></div></a><a class=item href=https://kane.mx/posts/2020/deploy-sonatype-nexus-oss-on-eks/><div><i class="cocktail icon"></i><p>Deploy Sonatype Nexus repository OSS on EKS</p></div></a><a class=item href=https://kane.mx/posts/2020/serverless-docker-images-analytics/><div><i class="cocktail icon"></i><p>无服务器架构的Docker镜像数据分析应用</p></div></a><a class=item href=https://kane.mx/posts/2020/get-docker-image-size-without-pulling-image/><div><i class="cocktail icon"></i><p>Get the size of Docker image without pulling image</p></div></a><a class=item href=https://kane.mx/posts/2020/zsh-performance-tuning/><div><i class="cocktail icon"></i><p>oh-my-zsh性能调优思路</p></div></a><a class=item href=https://kane.mx/posts/2020/codecommit-devops-model/><div><i class="cocktail icon"></i><p>基于CodeCommit代码管理的无服务器架构Devops</p></div></a><a class=item href=https://kane.mx/posts/2020/new-http-apis-of-api-gateway/><div><i class="cocktail icon"></i><p>AWS发布更快、更便宜、更易用的HTTP APIs</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cloud-debugging/><div><i class="cocktail icon"></i><p>AWS Cloud Debugging初探</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-batch/><div><i class="cocktail icon"></i><p>AWS Batch简介</p></div></a><a class=item href=https://kane.mx/posts/2019/email-forwarding/><div><i class="cocktail icon"></i><p>免费邮件转发服务</p></div></a><a class=item href=https://kane.mx/posts/2019/aliyun-edas-migration-in-action/><div><i class="cocktail icon"></i><p>实战Aliyun EDAS应用迁移AWS</p></div></a><a class=item href=https://kane.mx/posts/2019/rds-log-analysis/><div><i class="cocktail icon"></i><p>AWS RDS数据库日志分析及展示</p></div></a><a class=item href=https://kane.mx/posts/2019/using-openswan-connect-aws-vpn/><div><i class="cocktail icon"></i><p>使用Openswan连接AWS VPC</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cdk/><div><i class="cocktail icon"></i><p>AWS CDK简介</p></div></a><a class=item href=https://kane.mx/posts/2019/alexa-login-issue/><div><i class="cocktail icon"></i><p>Amazon Alexa Android版本国内登录问题</p></div></a><a class=item href=https://kane.mx/posts/2019/using-s3-as-device-for-mac-time-machine-backup/><div><i class="cocktail icon"></i><p>使用AWS S3作为MacOSX时间机器(Time Machine)的备份存储</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-vs-aliyun/><div><i class="cocktail icon"></i><p>公有云对比</p></div></a><a class=item href=https://kane.mx/posts/2019/serverless-framework/><div><i class="cocktail icon"></i><p>Serverless framework 101</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-lambda-layers/><div><i class="cocktail icon"></i><p>AWS Lambda Layer实践</p></div></a><a class=item href=https://kane.mx/posts/2019/2019-qconbeijing-reviews/><div><i class="cocktail icon"></i><p>QCon2019北京站回顾</p></div></a><a class=item href=https://kane.mx/posts/2018/2018-12-13-bj-archsummit-review/><div><i class="cocktail icon"></i><p>2018北京ArchSummit回顾</p></div></a><a class=item href=https://kane.mx/posts/2016/how-to-fix-jenkins-fail-to-load-job-config/><div><i class="cocktail icon"></i><p>如何修复Jenkins CI无法读取存在的任务配置</p></div></a><a class=item href=https://kane.mx/posts/2016/how-to-find-slow-queries-in-mongodb/><div><i class="cocktail icon"></i><p>MongoDB中如何找出慢查询</p></div></a><a class=item href=https://kane.mx/posts/2016/the-limitations-docker-swarm-mode-v1.12/><div><i class="cocktail icon"></i><p>Docker Swarm mode(v1.12.x)的一些使用限制</p></div></a><a class=item href=https://kane.mx/posts/2016/docker-swarm-mode-in-ubuntu-1404/><div><i class="cocktail icon"></i><p>创建于Docker Swarm的服务无法在Ubuntu 14.04 LTS中运行</p></div></a><a class=item href=https://kane.mx/posts/2016/seo-optimization-for-angularajs-based-app/><div><i class="cocktail icon"></i><p>基于Angularjs单页面应用的SEO优化</p></div></a><a class=item href=https://kane.mx/posts/2016/clustered-session-under-spring-framework/><div><i class="cocktail icon"></i><p>Spring框架下的分布式session管理</p></div></a><a class=item href=https://kane.mx/posts/2016/how-we-build-videome/><div><i class="cocktail icon"></i><p>V秘是如何构建的</p></div></a><a class=item href=https://kane.mx/posts/2016/aliyun-ossfs-sucks/><div><i class="cocktail icon"></i><p>说一说阿里云ossfs</p></div></a><a class=item href=https://kane.mx/posts/2016/weixin-temporary-materials/><div><i class="cocktail icon"></i><p>如何使用微信公众平台的临时素材</p></div></a><a class=item href=https://kane.mx/posts/2016/single-page-app-meets-weixin-pay/><div><i class="cocktail icon"></i><p>单页面应用(single page application)中使用微信支付</p></div></a><a class=item href=https://kane.mx/posts/2016/docker-build-no-space-left-caused-by-inode-exhausted/><div><i class="cocktail icon"></i><p>文件系统的Inode耗尽，会导致Docker编译镜像出现'No space left on device'错误</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/effective-cloud-computing>effective-cloud-computing</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/deploy-aws-cdk-applications-cross-accounts/><div><i class="cocktail icon"></i><p>跨账号跨区域部署AWS CDK编排的应用</p></div></a><a class=item href=https://kane.mx/posts/2020/deploy-sonatype-nexus-oss-on-eks/><div><i class="cocktail icon"></i><p>Deploy Sonatype Nexus repository OSS on EKS</p></div></a><a class=item href=https://kane.mx/posts/2020/serverless-docker-images-analytics/><div><i class="cocktail icon"></i><p>无服务器架构的Docker镜像数据分析应用</p></div></a><a class=item href=https://kane.mx/posts/2020/codecommit-devops-model/><div><i class="cocktail icon"></i><p>基于CodeCommit代码管理的无服务器架构Devops</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cloud-debugging/><div><i class="cocktail icon"></i><p>AWS Cloud Debugging初探</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-batch/><div><i class="cocktail icon"></i><p>AWS Batch简介</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-cdk/><div><i class="cocktail icon"></i><p>AWS CDK简介</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-domain-redirect/><div><i class="cocktail icon"></i><p>无服务器架构的域名重定向服务</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-function-for-aws/><div><i class="cocktail icon"></i><p>Spring Cloud Function -- 跨Serverless平台的函数计算框架</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-or-cloud-native/><div><i class="cocktail icon"></i><p>Spring Cloud or Cloud Native</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part2/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (下)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-dingtalk-callback/><div><i class="cocktail icon"></i><p>基于函数计算的钉钉回调函数接口</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-computing-101/><div><i class="cocktail icon"></i><p>无服务器计算101</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part1/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (上)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/iam-best-practice/><div><i class="cocktail icon"></i><p>IAM最佳实践</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/using-kubernetes-on-cloud/><div><i class="cocktail icon"></i><p>不要自建Kubernetes</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/preface/><div><i class="cocktail icon"></i><p>真的会用云服务吗？</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/kubernetes>kubernetes</a></div><div class=content><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-or-cloud-native/><div><i class="cocktail icon"></i><p>Spring Cloud or Cloud Native</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part2/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (下)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/oauth2-proxy-on-kubernetes/part1/><div><i class="cocktail icon"></i><p>为Kubernetes中任意应用添加基于oauth2的认证保护 (上)</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/using-kubernetes-on-cloud/><div><i class="cocktail icon"></i><p>不要自建Kubernetes</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/serverless-computing>serverless-computing</a></div><div class=content><a class=item href=https://kane.mx/posts/2020/new-http-apis-of-api-gateway/><div><i class="cocktail icon"></i><p>AWS发布更快、更便宜、更易用的HTTP APIs</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-domain-redirect/><div><i class="cocktail icon"></i><p>无服务器架构的域名重定向服务</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/spring-cloud-function-for-aws/><div><i class="cocktail icon"></i><p>Spring Cloud Function -- 跨Serverless平台的函数计算框架</p></div></a><a class=item href=https://kane.mx/posts/2019/serverless-framework/><div><i class="cocktail icon"></i><p>Serverless framework 101</p></div></a><a class=item href=https://kane.mx/posts/2019/aws-lambda-layers/><div><i class="cocktail icon"></i><p>AWS Lambda Layer实践</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-dingtalk-callback/><div><i class="cocktail icon"></i><p>基于函数计算的钉钉回调函数接口</p></div></a><a class=item href=https://kane.mx/posts/effective-cloud-computing/serverless-computing-101/><div><i class="cocktail icon"></i><p>无服务器计算101</p></div></a></div><div class=title><i class="dropdown icon"></i><a class=link href=/categories/trip>trip</a></div><div class=content><a class=item href=https://kane.mx/posts/archive/blogspot/food-and-drinking/><div><i class="cocktail icon"></i><p>Food and Drinking</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/working-workspace/><div><i class="cocktail icon"></i><p>Working Workspace</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/transportation/><div><i class="cocktail icon"></i><p>Transportation</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/working-style/><div><i class="cocktail icon"></i><p>Working style</p></div></a><a class=item href=https://kane.mx/posts/archive/blogspot/day-1/><div><i class="cocktail icon"></i><p>day 1</p></div></a></div></div></section></div><footer class="ui bottom attached center aligned inverted segment"><p>© 2020 The Road</p><p>Powered by <a href=https://gohugo.io/ target=_blank>Hugo</a> with <a href=https://github.com/UtkarshVerma/hugo-dream-plus target=_blank>Dream Plus</a> theme.</p></footer></div></div></div><div class="sixteen wide mobile fifteen wide tablet twelve wide computer column post-list"><section class="ui secondary top attached black segment post-head"><h1 class=post-title>AWS Lambda Layer实践</h1><div class="sub header"><div><span><i class="calendar outline icon"></i>May 14, 2019</span></div><div><span><i class="clock outline icon"></i>2 min read</span></div><div><span><i class="angle double up icon"></i>Last updated on May 14, 2019</span></div></div><hr><article class="post-content twemoji"><p>在<a href=/posts/effective-cloud-computing/serverless-dingtalk-callback/>基于函数计算的钉钉回调函数接口</a>中使用钉钉回调函数案例实践了<a href=https://aws.amazon.com/lambda/>AWS Lambda</a>无服务函数。该示例中，我们将自定义的函数代码及依赖的第三方库（比如json处理库jackson, 钉钉openapi加密库, aws dynamodb client等）整体打包为一个部署包，上传到lamdba代码仓库用于函数执行。</p><p>然而实际项目中，其实有大量的相关函数可能会共享这些基础依赖库、三方函数库(比如headless chrome(Puppeteer), pandoc, OCR library &ndash; Tesseract等等)或者使用自定义runtime(如官方未支持的java11)的需求。AWS Lambda在去年底发布了<a href=https://aws.amazon.com/about-aws/whats-new/2018/11/aws-lambda-now-supports-custom-runtimes-and-layers/>Lambda layers功能</a>来满足上述这些实际开发中的需求。</p><p>接下来，让我们看看如何将<a href=/posts/effective-cloud-computing/serverless-dingtalk-callback/>前文</a>中的<a href=https://github.com/zxkane/dingtalk-callback-on-aws/blob/267b5f11851148f5a23a834b8b7ecd4d3b247ce7/build.gradle.kts#L71-L91>函数依赖</a>放置到一个单独的layer中，作为不同函数的共享依赖库。</p><p>在我们的构建配置<code>build.gradle</code>中，将<a href=https://github.com/zxkane/dingtalk-callback-on-aws/blob/c6a293ac58b6892278c296daa237453279f50064/build.gradle.kts#L153-L157>函数的共享依赖拷贝</a>到java runtime<a href=https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html#configuration-layers-path>特定的目录结构</a><code>java/lib/</code>下，</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">153
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">154
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">155
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">156
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">157
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle>tasks<span style=color:#f92672>.</span><span style=color:#a6e22e>register</span><span style=color:#f92672>&lt;</span>Copy<span style=color:#f92672>&gt;(</span><span style=color:#e6db74>&#34;depsLayer&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    into<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;$buildDir/deps/java/lib&#34;</span><span style=color:#f92672>)</span>
    from<span style=color:#f92672>(</span>configurations<span style=color:#f92672>.</span><span style=color:#a6e22e>compileClasspath</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>())</span>
    from<span style=color:#f92672>(</span>configurations<span style=color:#f92672>.</span><span style=color:#a6e22e>runtimeClasspath</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>())</span>
<span style=color:#f92672>}</span></code></pre></td></tr></table></div></div><p>接下来将共享的依赖创建为一个lambda layer，并且让callback函数依赖这个共享layer，不再将所有的依赖打包为一个很大的部署包减小每次变更需要发布的包大小。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>  <span style=color:#f92672>DependenciesLayer</span>:
    <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::Serverless::LayerVersion</span>
    <span style=color:#f92672>Properties</span>:
      <span style=color:#f92672>LayerName</span>: <span style=color:#ae81ff>DingTalkDependencies</span>
      <span style=color:#f92672>Description</span>: <span style=color:#ae81ff>DingTalk Dependencies Layer</span>
      <span style=color:#f92672>ContentUri</span>: <span style=color:#e6db74>&#39;build/deps&#39;</span>
      <span style=color:#f92672>CompatibleRuntimes</span>:
        - <span style=color:#ae81ff>java8</span>
      <span style=color:#f92672>LicenseInfo</span>: <span style=color:#e6db74>&#39;Available under the MIT-0 license.&#39;</span>
      <span style=color:#f92672>RetentionPolicy</span>: <span style=color:#ae81ff>Retain</span>

  <span style=color:#f92672>CallbackFunction</span>:
    <span style=color:#f92672>Type: AWS::Serverless::Function # More info about Function Resource</span>: <span style=color:#ae81ff>https://github.com/awslabs/serverless-application-model/blob/master/versions/2016-10-31.md#awsserverlessfunction</span>
    <span style=color:#f92672>Properties</span>:
      <span style=color:#f92672>CodeUri</span>: <span style=color:#ae81ff>build/libs/dingtalk-callback-1.0.0-SNAPSHOT.jar</span>
      <span style=color:#f92672>Handler</span>: <span style=color:#ae81ff>com.github.zxkane.dingtalk.Callback::handleRequest</span>
      <span style=color:#f92672>Layers</span>:
        - !<span style=color:#ae81ff>Ref DependenciesLayer</span>
      <span style=color:#ae81ff>Policies:</span></code></pre></td></tr></table></div></div><p>在console查看部署后的函数，如下图，可以看到函数新增了一个layer。</p><figure><img src=/posts/2019/aws-lambda-layers/lambda-with-layers.png alt="lambda with layers"></figure><p>同其他的语言、技术一样，<a href=https://github.com/mthenw/awesome-layers>Awesome Layers</a>项目收集了目前一些常用且维护较好的layer，自创轮子之前可以先参考下😀。</p><p>使用layer同样有以下限制，使用前需要注意，</p><ul><li>依赖的layer数不能超过5个</li><li>函数以及依赖的所有layers解压后不可以超过250MB</li></ul></article></section><section class="ui secondary attached segment dream-tags"><a class="ui label green" href=/tags/%E4%BA%91%E8%AE%A1%E7%AE%97 title=云计算>云计算</a>
<a class="ui label teal" href=/tags/faas title=FaaS>FaaS</a>
<a class="ui label olive" href=/tags/aws title=AWS>AWS</a>
<a class="ui label brown" href=/tags/aws-lambda title="AWS Lambda">AWS Lambda</a>
<a class="ui label red" href=/tags/serverless-computing title="Serverless Computing">Serverless Computing</a></section><section class="ui secondary bottom attached segment share row box"><div class=author><img class=avatar src=/img/portrait.jpg></div><div class="info grow flexbox"><p class=name>Kane</p><p class=desc>Three boys' father, open source mania.</p></div><section class="buttons row box"><div class="facebook none flexbox" href=# onclick="window.open('https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),'facebook-share-dialog','width=626,height=436');return false;"><button class="ui facebook button"><i class="facebook icon"></i>Share</button></div><div class="twitter none flexbox" onclick="window.open('https://twitter.com/intent/tweet?text=Read &#34;AWS Lambda Layer实践  https:\/\/kane.mx\/posts\/2019\/aws-lambda-layers\/','_self')"><button class="ui twitter button"><i class="twitter icon"></i>Tweet</button></div></section></section><script src=https://utteranc.es/client.js repo=zxkane/articles issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></div><div class=back><nav class="ui top secondary menu bar"><div class=item><i class="inverted big link bullseye icon dream-flip-toggle" title="About Me"></i></div><div class=item><a href=https://github.com/zxkane target=_blank><i id=ico class="inverted big link github icon" title=GitHub></i></a></div><div class=item><a href=mailto:me@kane.mx target=_blank><i id=ico class="inverted big link mail icon" title=Email></i></a></div><div class=item><a href=https://www.stackoverflow.com/users/390513/kane target=_blank><i id=ico class="inverted big link stack overflow icon" title="Stack Overflow"></i></a></div></nav><div class="ui centered grid about"><div class="sixteen wide mobile fifteen wide tablet fifteen wide computer column about"><section class="ui stacked segments"><div class="ui inverted segment"><article class=twemoji><h1 id=so-who-am-i>So, Who Am I?</h1><hr><p>I’m the father of three boys. Live in Beijing. Also I&rsquo;m the *uix user, a full stack software engineer, devops and cloud native evangelist.</p><p>Curious about me? Use the social links above to check out my profiles.</p></article></div></section></div></div></div></div></div><script src=/js/site.js></script><script src=https://twemoji.maxcdn.com/2/twemoji.min.js?2.6></script><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-11561366-2','auto');ga('send','pageview');</script><script async src=https://www.google-analytics.com/analytics.js></script><script>(function(){console.log("Twemoji up and making stuff colourful!");for(var b=document.getElementsByClassName("twemoji"),a=0;a<b.length;a++){twemoji.parse(b[a]);}})();</script></body></html>